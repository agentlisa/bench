{
  "Title": "[L03] Duplicated code",
  "Content": "There are instances of duplicated code within the codebase. Duplicating code can lead to issues later in the development lifecycle and leaves the project more prone to the introduction of errors. Such errors can inadvertently be introduced when functionality changes are not replicated across all instances of code that should be identical. Examples of duplicated code include:\n\n\n* In the [`Permitable`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/libraries/Permitable.sol) contract, the [`_permit`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/libraries/Permitable.sol#L12) and [`_permitMemory`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/libraries/Permitable.sol#L31) functions are duplicates.\n* The calculations in the [`getMakerAmount`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/helpers/AmountCalculator.sol#L14) and [`getTakerAmount`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/helpers/AmountCalculator.sol#L20) functions are duplicated in the [`fillOrderRFQTo`](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/OrderRFQMixin.sol#L90) function when calculating [making](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/OrderRFQMixin.sol#L128) and [taking](https://github.com/1inch/limit-order-protocol/blob/4d94eea25e4dac6271bfd703096a5c4a4d899b4a/contracts/OrderRFQMixin.sol#L124) amounts, respectively.\n\n\nRather than duplicating code, consider having just one contract or library containing the duplicated code and using it whenever the duplicated functionality is required.\n\n\n***Update:** Partially fixed in [pull request #60](https://github.com/1inch/limit-order-protocol/pull/60).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/helpers/AmountCalculator.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity 0.8.9;\npragma abicoder v1;\n\nimport \"@openzeppelin/contracts/utils/Address.sol\";\n\n/// @title A helper contract for calculations related to order amounts\ncontract AmountCalculator {\n    using Address for address;\n\n    /// @notice Calculates maker amount\n    /// @return Result Floored maker amount\n    function getMakerAmount(uint256 orderMakerAmount, uint256 orderTakerAmount, uint256 swapTakerAmount) external pure returns(uint256) {\n        return swapTakerAmount * orderMakerAmount / orderTakerAmount;\n    }\n\n    /// @notice Calculates taker amount\n    /// @return Result Ceiled taker amount\n    function getTakerAmount(uint256 orderMakerAmount, uint256 orderTakerAmount, uint256 swapMakerAmount) external pure returns(uint256) {\n        return (swapMakerAmount * orderTakerAmount + orderMakerAmount - 1) / orderMakerAmount;\n    }\n\n    /// @notice Performs an arbitrary call to target with data\n    /// @return Result Bytes transmuted to uint256\n    function arbitraryStaticCall(address target, bytes memory data) external view returns(uint256) {\n        (bytes memory result) = target.functionStaticCall(data, \"AC: arbitraryStaticCall\");\n        return abi.decode(result, (uint256));\n    }\n}"
    }
  ]
}