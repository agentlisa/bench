{
  "Title": "Use general `safeTransferFrom`",
  "Content": "##### Description\nIt is required to check success of transfer. So it is should be handled as in ERC20:\n- https://github.com/RealityCards/RealityCards-Contracts/blob/8c0b05b25a7deef25f98532ae2f8afd4f9a84360/contracts/nfthubs/RCNftHubXdai.sol#L69\n\n##### Recommendation\nIt is recommended to use the `safeTransferFrom()` method from the ERC20 safe library.\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/nfthubs/RCNftHubXdai.sol",
      "content": "pragma solidity 0.5.13;\n\nimport \"@openzeppelin/contracts/token/ERC721/ERC721Full.sol\";\nimport \"@openzeppelin/contracts/ownership/Ownable.sol\";\nimport \"hardhat/console.sol\";\nimport '../interfaces/IRCProxyXdai.sol';\nimport '../interfaces/IRCMarket.sol';\n\n/// @title Reality Cards NFT Hub- xDai side\n/// @author Andrew Stanger\ncontract RCNftHubXdai is Ownable, ERC721Full \n{\n    ////////////////////////////////////\n    //////// VARIABLES /////////////////\n    ////////////////////////////////////\n\n    /// @dev so only markets can move NFTs\n    mapping (address => bool) public isMarket;\n    /// @dev the market each NFT belongs to, so that it can only be moved in withdraw state\n    mapping(uint256 => address) public marketTracker;\n\n    /// @dev governance variables\n    address public factoryAddress;\n\n    ////////////////////////////////////\n    /////////// CONSTRUCTOR ////////////\n    ////////////////////////////////////\n\n    constructor(address _factoryAddress) ERC721Full(\"RealityCards\", \"RC\") public {\n        setFactoryAddress(_factoryAddress);\n    } \n\n    ////////////////////////////////////\n    //////////// ADD MARKETS ///////////\n    ////////////////////////////////////\n\n    /// @dev so only markets can change ownership\n    function addMarket(address _newMarket) external returns(bool) {\n        require(msg.sender == factoryAddress, \"Not factory\");\n        isMarket[_newMarket] = true;\n        return true;\n    }\n\n    ////////////////////////////////////\n    ////////// GOVERNANCE //////////////\n    ////////////////////////////////////\n    \n    /// @dev address of RC factory contract, so only factory can mint\n    function setFactoryAddress(address _newAddress) onlyOwner public {\n        factoryAddress = _newAddress;\n    }\n\n    ////////////////////////////////////\n    ///////// CORE FUNCTIONS ///////////\n    ////////////////////////////////////\n\n    // FACTORY ONLY\n    function mintNft(address _originalOwner, uint256 _tokenId, string calldata _tokenURI) external returns(bool) {\n        require(msg.sender == factoryAddress, \"Not factory\");\n        _mint(_originalOwner, _tokenId); \n        _setTokenURI(_tokenId, _tokenURI);\n        marketTracker[_tokenId] = _originalOwner;\n        return true;\n    }\n\n    // MARKET ONLY\n    function transferNft(address _currentOwner, address _newOwner, uint256 _tokenId) external returns(bool) {\n        require(isMarket[msg.sender], \"Not market\");\n        _transferFrom(_currentOwner, _newOwner, _tokenId);\n        return true;\n    }\n\n    ////////////////////////////////////\n    //////////// OVERRIDES /////////////\n    ////////////////////////////////////\n    /// @dev ensures NFTs can only be moved when market is resolved\n\n    function transferFrom(address from, address to, uint256 tokenId) public {\n        IRCMarket market = IRCMarket(marketTracker[tokenId]);\n        require(market.state() == 3, \"Incorrect state\");\n        require(ownerOf(tokenId) == msg.sender, \"Not owner\");\n        _transferFrom(from, to, tokenId);\n    }\n\n    function safeTransferFrom(address from, address to, uint256 tokenId, bytes memory _data) public {\n        IRCMarket market = IRCMarket(marketTracker[tokenId]);\n        require(market.state() == 3, \"Incorrect state\");\n        require(ownerOf(tokenId) == msg.sender, \"Not owner\");\n        _transferFrom(from, to, tokenId);\n        _data;\n    }\n\n}"
    }
  ]
}