{
  "Title": "[N-05] Hardcoded addresses in contract",
  "Content": "- Severity: Non-Critical\n- Confidence: High\n\n### Description\nAddresses should not be hardcoded in contracts. Instead, they should be declared as immutable and assigned via constructor arguments. This practice keeps the code consistent across deployments on different networks and prevents the need for recompilation when addresses change.\n\n<details>\n\n<summary>\nThere are 3 instances of this issue:\n\n</summary>\n\n- File: solidity/contracts/periphery/oracles/CurveRegistryUtils.sol\n```\n \nLine: 8          ICurveAddressesProvider public constant CURVE_ADDRESSES_PROVIDER =\n    ICurveAddressesProvider(0x0000000022D53366457F9d5E68Ec105046FC4383)\n```\n\n[https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/CurveRegistryUtils.sol#L8-L9](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/CurveRegistryUtils.sol#L8-L9)\n\n- File: solidity/contracts/periphery/oracles/OracleRelay.sol\n```\n \nLine: 8          address public constant wETH_ADDRESS = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\n```\n\n[https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/OracleRelay.sol#L8](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/OracleRelay.sol#L8)\n\n- File: solidity/contracts/periphery/oracles/WstEthOracle.sol\n```\n \nLine: 10          IWStETH public constant WSTETH = IWStETH(0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0)\n```\n\n[https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/WstEthOracle.sol#L10](https://github.com/code-423n4/2023-07-amphora/blob/main/core/solidity/contracts/periphery/oracles/WstEthOracle.sol#L10)\n\n</details>\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2023-07-amphora",
  "Code": [
    {
      "filename": "core/solidity/contracts/periphery/oracles/CurveRegistryUtils.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.9;\n\nimport {ICurveRegistry, ICurveAddressesProvider} from '@interfaces/periphery/ICurveAddressesProvider.sol';\n\nabstract contract CurveRegistryUtils {\n  /// @notice The inmutable curve registry\n  ICurveAddressesProvider public constant CURVE_ADDRESSES_PROVIDER =\n    ICurveAddressesProvider(0x0000000022D53366457F9d5E68Ec105046FC4383);\n\n  /// @notice Returns the lp address of the curve pool\n  function _getLpAddress(address _crvPool) internal view returns (address _lpAddress) {\n    address _registry = CURVE_ADDRESSES_PROVIDER.get_registry();\n    _lpAddress = ICurveRegistry(_registry).get_lp_token(_crvPool);\n  }\n}"
    },
    {
      "filename": "core/solidity/contracts/periphery/oracles/OracleRelay.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.9;\n\nimport {IOracleRelay} from '@interfaces/periphery/IOracleRelay.sol';\n\nabstract contract OracleRelay is IOracleRelay {\n  /// @notice The WETH address\n  address public constant wETH_ADDRESS = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;\n  /// @notice The type of oracle\n  OracleType public oracleType;\n  /// @notice The underlying asset\n  address public underlying;\n\n  constructor(OracleType _oracleType) {\n    oracleType = _oracleType;\n  }\n\n  /// @notice set the underlying address\n  function _setUnderlying(address _underlying) internal {\n    underlying = _underlying;\n  }\n\n  /// @dev Most oracles don't require a state change for pricing, for those who do, override this function\n  function currentValue() external virtual returns (uint256 _currentValue) {\n    _currentValue = peekValue();\n  }\n\n  /// @notice The current reported value of the oracle\n  /// @dev Implementation in _get()\n  /// @return _price The current value\n  function peekValue() public view virtual override returns (uint256 _price);\n}"
    },
    {
      "filename": "core/solidity/contracts/periphery/oracles/WstEthOracle.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.9;\n\nimport {IOracleRelay, OracleRelay} from '@contracts/periphery/oracles/OracleRelay.sol';\nimport {IWStETH} from '@interfaces/utils/IWStETH.sol';\n\n/// @notice Oracle Relay for WstEth\ncontract WstEthOracle is OracleRelay {\n  /// @notice The WstEth contract\n  IWStETH public constant WSTETH = IWStETH(0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0);\n  /// @notice The oracle of the underlying asset\n  IOracleRelay public immutable STETH_ANCHORED_VIEW_UNDERLYING;\n\n  constructor(IOracleRelay _stEthAnchoredViewUnderlying) OracleRelay(OracleType.Chainlink) {\n    STETH_ANCHORED_VIEW_UNDERLYING = _stEthAnchoredViewUnderlying;\n    _setUnderlying(address(WSTETH));\n  }\n\n  /// @notice returns the price with 18 decimals without any state changes\n  /// @dev some oracles require a state change to get the exact current price.\n  ///      This is updated when calling other state changing functions that query the price\n  /// @return _price the current price\n  function peekValue() public view override returns (uint256 _price) {\n    _price = _get();\n  }\n\n  /// @notice The current reported value of the oracle\n  /// @return _value The current value\n  function _get() internal view returns (uint256 _value) {\n    uint256 _stETHPrice = STETH_ANCHORED_VIEW_UNDERLYING.peekValue();\n    uint256 _stETHPerWstEth = WSTETH.stEthPerToken();\n    _value = (_stETHPrice * _stETHPerWstEth) / 1e18;\n  }\n}"
    }
  ]
}