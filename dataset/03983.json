{
  "Title": "[L01] Duplicated onlyWhenFrozen modifier",
  "Content": "The functions [`transfer`](https://github.com/celo-org/celo-monorepo/blob/db2e561e1f13220a98743a7999818e48a5089d13/packages/protocol/contracts/common/GoldToken.sol#L48) and [`transferWithComment`](https://github.com/celo-org/celo-monorepo/blob/db2e561e1f13220a98743a7999818e48a5089d13/packages/protocol/contracts/common/GoldToken.sol#L59) of the `GoldToken` contract have the `onlyWhenNotFrozen` modifier. They both call the internal [`_transfer function`](https://github.com/celo-org/celo-monorepo/blob/db2e561e1f13220a98743a7999818e48a5089d13/packages/protocol/contracts/common/GoldToken.sol#L200), which also has the `onlyWhenNotFrozen` modifier. This causes the modifier to be called twice during the execution of transfers.\n\n\nConsider removing the `onlyWhenNotFrozen` modifier from the `transfer` and `transferWithComment` function, or removing it from the `_transfer` internal function, so it is called only once per transfer.\n\n\n***Update:** Fixed in [pull request #3123](https://github.com/celo-org/celo-monorepo/pull/3123). The modifier was removed from the `transfer` and `transferWithComment` functions.*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/protocol/contracts/common/GoldToken.sol",
      "content": "pragma solidity ^0.5.3;\n\nimport \"openzeppelin-solidity/contracts/math/SafeMath.sol\";\nimport \"openzeppelin-solidity/contracts/token/ERC20/IERC20.sol\";\n\nimport \"./CalledByVm.sol\";\nimport \"./Freezable.sol\";\nimport \"./Initializable.sol\";\nimport \"./interfaces/ICeloToken.sol\";\n\ncontract GoldToken is Initializable, CalledByVm, Freezable, IERC20, ICeloToken {\n  using SafeMath for uint256;\n\n  // Address of the TRANSFER precompiled contract.\n  // solhint-disable state-visibility\n  address constant TRANSFER = address(0xff - 2);\n  string constant NAME = \"Celo Gold\";\n  string constant SYMBOL = \"cGLD\";\n  uint8 constant DECIMALS = 18;\n  uint256 internal totalSupply_;\n  // solhint-enable state-visibility\n\n  mapping(address => mapping(address => uint256)) internal allowed;\n\n  event Transfer(address indexed from, address indexed to, uint256 value);\n\n  event TransferComment(string comment);\n\n  event Approval(address indexed owner, address indexed spender, uint256 value);\n\n  /**\n   * @notice Used in place of the constructor to allow the contract to be upgradable via proxy.\n   * @param registryAddress Address of the Registry contract.\n   */\n  function initialize(address registryAddress) external initializer {\n    totalSupply_ = 0;\n    _transferOwnership(msg.sender);\n    setRegistry(registryAddress);\n  }\n\n  /**\n   * @notice Transfers Celo Gold from one address to another.\n   * @param to The address to transfer Celo Gold to.\n   * @param value The amount of Celo Gold to transfer.\n   * @return True if the transaction succeeds.\n   */\n  // solhint-disable-next-line no-simple-event-func-name\n  function transfer(address to, uint256 value) external onlyWhenNotFrozen returns (bool) {\n    return _transfer(to, value);\n  }\n\n  /**\n   * @notice Transfers Celo Gold from one address to another with a comment.\n   * @param to The address to transfer Celo Gold to.\n   * @param value The amount of Celo Gold to transfer.\n   * @param comment The transfer comment\n   * @return True if the transaction succeeds.\n   */\n  function transferWithComment(address to, uint256 value, string calldata comment)\n    external\n    onlyWhenNotFrozen\n    returns (bool)\n  {\n    bool succeeded = _transfer(to, value);\n    emit TransferComment(comment);\n    return succeeded;\n  }\n\n  /**\n   * @notice Approve a user to transfer Celo Gold on behalf of another user.\n   * @param spender The address which is being approved to spend Celo Gold.\n   * @param value The amount of Celo Gold approved to the spender.\n   * @return True if the transaction succeeds.\n   */\n  function approve(address spender, uint256 value) external returns (bool) {\n    require(spender != address(0), \"cannot set allowance for 0\");\n    allowed[msg.sender][spender] = value;\n    emit Approval(msg.sender, spender, value);\n    return true;\n  }\n\n  /**\n   * @notice Increases the allowance of another user.\n   * @param spender The address which is being approved to spend Celo Gold.\n   * @param value The increment of the amount of Celo Gold approved to the spender.\n   * @return True if the transaction succeeds.\n   */\n  function increaseAllowance(address spender, uint256 value) external returns (bool) {\n    require(spender != address(0), \"cannot set allowance for 0\");\n    uint256 oldValue = allowed[msg.sender][spender];\n    uint256 newValue = oldValue.add(value);\n    allowed[msg.sender][spender] = newValue;\n    emit Approval(msg.sender, spender, newValue);\n    return true;\n  }\n\n  /**\n   * @notice Decreases the allowance of another user.\n   * @param spender The address which is being approved to spend Celo Gold.\n   * @param value The decrement of the amount of Celo Gold approved to the spender.\n   * @return True if the transaction succeeds.\n   */\n  function decreaseAllowance(address spender, uint256 value) external returns (bool) {\n    uint256 oldValue = allowed[msg.sender][spender];\n    uint256 newValue = oldValue.sub(value);\n    allowed[msg.sender][spender] = newValue;\n    emit Approval(msg.sender, spender, newValue);\n    return true;\n  }\n\n  /**\n   * @notice Transfers Celo Gold from one address to another on behalf of a user.\n   * @param from The address to transfer Celo Gold from.\n   * @param to The address to transfer Celo Gold to.\n   * @param value The amount of Celo Gold to transfer.\n   * @return True if the transaction succeeds.\n   */\n  function transferFrom(address from, address to, uint256 value)\n    external\n    onlyWhenNotFrozen\n    returns (bool)\n  {\n    require(to != address(0), \"transfer attempted to reserved address 0x0\");\n    require(value <= balanceOf(from), \"transfer value exceeded balance of sender\");\n    require(\n      value <= allowed[from][msg.sender],\n      \"transfer value exceeded sender's allowance for recipient\"\n    );\n\n    bool success;\n    (success, ) = TRANSFER.call.value(0).gas(gasleft())(abi.encode(from, to, value));\n    require(success, \"Celo Gold transfer failed\");\n\n    allowed[from][msg.sender] = allowed[from][msg.sender].sub(value);\n    emit Transfer(from, to, value);\n    return true;\n  }\n\n  /**\n   * @return The name of the Celo Gold token.\n   */\n  function name() external view returns (string memory) {\n    return NAME;\n  }\n\n  /**\n   * @return The symbol of the Celo Gold token.\n   */\n  function symbol() external view returns (string memory) {\n    return SYMBOL;\n  }\n\n  /**\n   * @return The number of decimal places to which Celo Gold is divisible.\n   */\n  function decimals() external view returns (uint8) {\n    return DECIMALS;\n  }\n\n  /**\n   * @return The total amount of Celo Gold in existence.\n   */\n  function totalSupply() external view returns (uint256) {\n    return totalSupply_;\n  }\n\n  /**\n   * @notice Gets the amount of owner's Celo Gold allowed to be spent by spender.\n   * @param owner The owner of the Celo Gold.\n   * @param spender The spender of the Celo Gold.\n   * @return The amount of Celo Gold owner is allowing spender to spend.\n   */\n  function allowance(address owner, address spender) external view returns (uint256) {\n    return allowed[owner][spender];\n  }\n\n  /**\n   * @notice Increases the variable for total amount of Celo Gold in existence.\n   * @param amount The amount to increase counter by\n   */\n  function increaseSupply(uint256 amount) external onlyVm {\n    totalSupply_ = totalSupply_.add(amount);\n  }\n\n  /**\n   * @notice Gets the balance of the specified address.\n   * @param owner The address to query the balance of.\n   * @return The balance of the specified address.\n   */\n  function balanceOf(address owner) public view returns (uint256) {\n    return owner.balance;\n  }\n\n  /**\n   * @notice internal Celo Gold transfer from one address to another.\n   * @param to The address to transfer Celo Gold to.\n   * @param value The amount of Celo Gold to transfer.\n   * @return True if the transaction succeeds.\n   */\n  function _transfer(address to, uint256 value) internal onlyWhenNotFrozen returns (bool) {\n    require(to != address(0), \"transfer attempted to reserved address 0x0\");\n    require(value <= balanceOf(msg.sender), \"transfer value exceeded balance of sender\");\n\n    bool success;\n    (success, ) = TRANSFER.call.value(0).gas(gasleft())(abi.encode(msg.sender, to, value));\n    require(success, \"Celo Gold transfer failed\");\n    emit Transfer(msg.sender, to, value);\n    return true;\n  }\n}"
    }
  ]
}