{
  "Title": "[H01] Unsupported ERC20 tokens can be stuck in the contract",
  "Content": "**Update:** *Fixed in [pull request #68](https://github.com/endaoment/endaoment-contracts/pull/68).*\n\n\n[Contract interfaces](https://solidity.readthedocs.io/en/latest/contracts.html#interfaces) are contracts that declare function signatures without implementing them. They are used as an specification that decouples the signature of the functions from their implementation, allowing to interoperate with different implementations as long as they adhere to the specification.  \n\nIn the codebase, the `ERC20` token implementation by OpenZeppelin [is used](https://github.com/endaoment/endaoment-contracts/blob/f60aa253d3d869ad6460877f23e6092acb313add/contracts/Org.sol#L7) in the [`Fund`](https://github.com/endaoment/endaoment-contracts/blob/f60aa253d3d869ad6460877f23e6092acb313add/contracts/Fund.sol#L124-L131) and [`Org`](https://github.com/endaoment/endaoment-contracts/blob/f60aa253d3d869ad6460877f23e6092acb313add/contracts/Org.sol#L95) contracts, instead of using the interface.  \n\nThe address of the `ERC20` token to be used [is passed as input parameter](https://github.com/endaoment/endaoment-contracts/blob/f60aa253d3d869ad6460877f23e6092acb313add/contracts/Org.sol#L91).\n\n\nGiven the fact that one can pass arbitrary addresses whether or not they represent valid `ERC20` tokens and that not every `ERC20` contract is implemented exactly as the OpenZeppelin one, it can happen that transactions calling those functions fail due to a mismatch between the `ERC20` OpenZeppelin contract and the target implementation represented by the `tokenAddress`.\n\n\nAnother consequence is that, since anyone can transfer arbitrary `ERC20` tokens to the `Fund` or `Org` contract, if someone accidentally deposits an `ERC20` token which has a different implementation from the OpenZeppelin one, those funds are stuck forever in the contract and canâ€™t be transferred out.\n\n\nAs suggested in [[N03]](#n03), consider using the `IERC20` interface importing it from the `openzeppelin-contracts` package to allow interoperation with any possible implementation of the `ERC20` token standard and avoid the loss of the funds deposited in the contracts.\n\n\n",
  "Impact": "HIGH",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/Org.sol",
      "content": "// SPDX-License-Identifier: BSD 3-Clause\n\npragma solidity ^0.6.10;\n\nimport \"./Administratable.sol\";\n\nimport \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\n\n//ORG CONTRACT\n/**\n * @title Org\n * @author rheeger\n * @notice Org is a contract that serves as a smart wallet for US nonprofit\n * organizations. It holds the organization's federal Tax ID number as taxID, \n * and allows for an address to submit a Claim struct to the contract whereby \n * the organization can direct recieved grant awards from Endaoment Funds.\n */\ncontract Org is Administratable {\n    using SafeMath for uint256;\n\n// ========== STATE VARIABLES ==========\n    \n    struct Claim {\n        string firstName;\n        string lastName;\n        string eMail;\n        address desiredWallet;\n        bool filesSubmitted;\n    }\n\n    uint public taxId;\n    address public orgWallet;\n    Claim[] public claims;\n    event cashOutComplete(uint cashOutAmount);\n\n\n// ========== CONSTRUCTOR ==========    \n    \n    /**\n    * @notice Create new Organization Contract\n    * @param ein The U.S. Tax Identification Number for the Organization\n    * @param adminContractAddress Contract Address for Endaoment Admin\n    */\n    constructor(uint ein, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.ORG_FACTORY){\n        taxId = ein;\n    }\n\n// ========== Org Management & Info ==========\n    \n    /**\n     * @notice Create Organization Claim\n     * @param  fName First name of Administrator\n     * @param  lName Last name of Administrator\n     * @param  fSub Information Submitted successfully.\n     * @param  eMail Email contact for Organization Administrator.\n     * @param  orgAdminAddress Wallet address of Organization's Administrator.\n     */\n    function claimRequest(string memory fName, string memory lName, bool fSub, string memory eMail, address orgAdminAddress) public {\n        require (fSub == true);\n        require (msg.sender == orgAdminAddress);\n        \n        Claim memory newClaim = Claim({\n            firstName: fName,\n            lastName: lName,\n            eMail: eMail,\n            desiredWallet: msg.sender,\n            filesSubmitted: true\n        });\n\n        claims.push(newClaim);\n    }\n\n    /**\n     * @notice Approving Organization Claim \n     * @param  index Index value of Claim.\n     * @param  index Index value of Claim.\n     * @param adminContractAddress Contract Address for Endaoment Admin\n     */\n    function approveClaim(uint index, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.REVIEWER){\n        Claim storage claim = claims[index]; \n        \n        setOrgWallet(claim.desiredWallet, adminContractAddress);\n    }\n\n    /**\n     * @notice Cashing out Organization Contract \n     * @param  desiredWithdrawlAddress Destination for withdrawl\n     * @param tokenAddress Stablecoin address of desired token withdrawl\n     * @param adminContractAddress Contract Address for Endaoment Admin\n     */\n    function cashOutOrg(address desiredWithdrawlAddress, address tokenAddress, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.ACCOUNTANT){\n        ERC20 token = ERC20(tokenAddress);\n        uint256 cashOutAmount = token.balanceOf(address(this));\n\n        token.transfer(desiredWithdrawlAddress, cashOutAmount);\n        emit cashOutComplete(cashOutAmount);\n    }\n\n    function setOrgWallet(address providedWallet, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.REVIEWER){\n        orgWallet = providedWallet;\n    }\n\n     function getTokenBalance(address tokenAddress) public view returns (uint) {\n            ERC20 t = ERC20(tokenAddress);\n            uint256 bal = t.balanceOf(address(this));\n\n        return bal;\n     }\n\n       function getClaimsCount() public view returns (uint) {\n        return claims.length;\n    }\n\n}"
    },
    {
      "filename": "contracts/Org.sol",
      "content": "// SPDX-License-Identifier: BSD 3-Clause\n\npragma solidity ^0.6.10;\n\nimport \"./Administratable.sol\";\n\nimport \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\n\n//ORG CONTRACT\n/**\n * @title Org\n * @author rheeger\n * @notice Org is a contract that serves as a smart wallet for US nonprofit\n * organizations. It holds the organization's federal Tax ID number as taxID, \n * and allows for an address to submit a Claim struct to the contract whereby \n * the organization can direct recieved grant awards from Endaoment Funds.\n */\ncontract Org is Administratable {\n    using SafeMath for uint256;\n\n// ========== STATE VARIABLES ==========\n    \n    struct Claim {\n        string firstName;\n        string lastName;\n        string eMail;\n        address desiredWallet;\n        bool filesSubmitted;\n    }\n\n    uint public taxId;\n    address public orgWallet;\n    Claim[] public claims;\n    event cashOutComplete(uint cashOutAmount);\n\n\n// ========== CONSTRUCTOR ==========    \n    \n    /**\n    * @notice Create new Organization Contract\n    * @param ein The U.S. Tax Identification Number for the Organization\n    * @param adminContractAddress Contract Address for Endaoment Admin\n    */\n    constructor(uint ein, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.ORG_FACTORY){\n        taxId = ein;\n    }\n\n// ========== Org Management & Info ==========\n    \n    /**\n     * @notice Create Organization Claim\n     * @param  fName First name of Administrator\n     * @param  lName Last name of Administrator\n     * @param  fSub Information Submitted successfully.\n     * @param  eMail Email contact for Organization Administrator.\n     * @param  orgAdminAddress Wallet address of Organization's Administrator.\n     */\n    function claimRequest(string memory fName, string memory lName, bool fSub, string memory eMail, address orgAdminAddress) public {\n        require (fSub == true);\n        require (msg.sender == orgAdminAddress);\n        \n        Claim memory newClaim = Claim({\n            firstName: fName,\n            lastName: lName,\n            eMail: eMail,\n            desiredWallet: msg.sender,\n            filesSubmitted: true\n        });\n\n        claims.push(newClaim);\n    }\n\n    /**\n     * @notice Approving Organization Claim \n     * @param  index Index value of Claim.\n     * @param  index Index value of Claim.\n     * @param adminContractAddress Contract Address for Endaoment Admin\n     */\n    function approveClaim(uint index, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.REVIEWER){\n        Claim storage claim = claims[index]; \n        \n        setOrgWallet(claim.desiredWallet, adminContractAddress);\n    }\n\n    /**\n     * @notice Cashing out Organization Contract \n     * @param  desiredWithdrawlAddress Destination for withdrawl\n     * @param tokenAddress Stablecoin address of desired token withdrawl\n     * @param adminContractAddress Contract Address for Endaoment Admin\n     */\n    function cashOutOrg(address desiredWithdrawlAddress, address tokenAddress, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.ACCOUNTANT){\n        ERC20 token = ERC20(tokenAddress);\n        uint256 cashOutAmount = token.balanceOf(address(this));\n\n        token.transfer(desiredWithdrawlAddress, cashOutAmount);\n        emit cashOutComplete(cashOutAmount);\n    }\n\n    function setOrgWallet(address providedWallet, address adminContractAddress) public onlyAdminOrRole(adminContractAddress, IEndaomentAdmin.Role.REVIEWER){\n        orgWallet = providedWallet;\n    }\n\n     function getTokenBalance(address tokenAddress) public view returns (uint) {\n            ERC20 t = ERC20(tokenAddress);\n            uint256 bal = t.balanceOf(address(this));\n\n        return bal;\n     }\n\n       function getClaimsCount() public view returns (uint) {\n        return claims.length;\n    }\n\n}"
    }
  ]
}