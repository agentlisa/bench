{
  "Title": "H-8: `CurveLPStaking` Curve's gauge rewards cannot be claimed",
  "Content": "# Issue H-8: `CurveLPStaking` Curve's gauge rewards cannot be claimed \nSource: https://github.com/sherlock-audit/2022-08-sentiment-judging/tree/main/502-H \n## Found by \nWATCHPUG\n\n## Summary\n\nNote: This issue is a part of the extra scope added by Sentiment AFTER the audit contest. This scope was only reviewed by WatchPug and relates to these three PRs:\n\n1. [Lending deposit cap](https://github.com/sentimentxyz/protocol/pull/234)\n2. [Fee accrual modification](https://github.com/sentimentxyz/protocol/pull/233)\n3. [CRV staking](https://github.com/sentimentxyz/controller/pull/41)\n\nCurve's gauge rewards cannot be claimed.\n\n## Vulnerability Detail\n\nThe sole goal of `CurveLPStakingController` is to stake and earn rewards from Curve's gauge system.\n\nHowever, it doesn't support `claim_rewards()`, and both `deposit()` or `withdraw()` are using the default value (`false`) for `_claim_rewards` parameter.\n\n## Impact\n\nCurve's gauge rewards cannot be claimed.\n\n## Code Snippet\nhttps://github.com/sentimentxyz/controller/blob/be4a7c70ecef788ca9226b46ff108ddd9001b14e/src/curve/CurveLPStakingController.sol#L20-L24\n\n```solidity\n/// @notice deposit(uint256)\nbytes4 constant DEPOSIT = 0xb6b55f25;\n\n/// @notice withdraw(uint256)\nbytes4 constant WITHDRAW = 0x2e1a7d4d;\n```\n\n## Tool used\n\nManual Review\n\n## Recommendation\n\nConsider supporting claim_rewards(address,address) or using deposit(uint256,address,bool) and withdraw(uint256,address,bool) to support claim rewards when deposit() or withdraw().\n\n## Sentiment Team\nFixed controller as recommended to claim gauge rewards and moved gauge token oracle into a separate contract instead. PR [here](https://github.com/sentimentxyz/oracle/pull/42).\n\n## Lead Senior Watson\nConfirmed fix. \n\n\n",
  "Impact": "HIGH",
  "Source": "https://app.sherlock.xyz/audits/contests/1",
  "Code": [
    {
      "filename": "src/curve/CurveLPStakingController.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.15;\n\nimport {IController} from \"../core/IController.sol\";\n\ninterface IChildGauge {\n    function lp_token() external view returns (address);\n}\n\n/**\n    @title Curve LP staking controller\n    @notice Interaction controller for staking curve LP controllers\n*/\ncontract CurveLPStakingController is IController {\n\n    /* -------------------------------------------------------------------------- */\n    /*                               STATE VARIABLES                              */\n    /* -------------------------------------------------------------------------- */\n\n    /// @notice deposit(uint256)\n    bytes4 constant DEPOSIT = 0xb6b55f25;\n\n    /// @notice withdraw(uint256)\n    bytes4 constant WITHDRAW = 0x2e1a7d4d;\n\n    /* -------------------------------------------------------------------------- */\n    /*                             EXTERNAL FUNCTIONS                             */\n    /* -------------------------------------------------------------------------- */\n\n    /// @inheritdoc IController\n    function canCall(address target, bool, bytes calldata data)\n        external\n        view\n        returns (bool, address[] memory, address[] memory)\n    {\n        bytes4 sig = bytes4(data);\n        if (sig == DEPOSIT) {\n            address[] memory tokensIn = new address[](1);\n            address[] memory tokensOut = new address[](1);\n            tokensIn[0] = target;\n            tokensOut[0] = IChildGauge(target).lp_token();\n            return (true, tokensIn, tokensOut);\n        }\n        if (sig == WITHDRAW) {\n            address[] memory tokensIn = new address[](1);\n            address[] memory tokensOut = new address[](1);\n            tokensOut[0] = target;\n            tokensIn[0] = IChildGauge(target).lp_token();\n            return (true, tokensIn, tokensOut);\n        }\n        return (false, new address[](0), new address[](0));\n    }\n}"
    }
  ]
}