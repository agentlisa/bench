{
  "Title": "An unintentionally large vesting period",
  "Content": "##### Description\nThe `VestingEscrowSimple` contract can be initialized with an unintentionally large vesting period, i.e., by supplying a value denoted in milliseconds instead of seconds https://github.com/banteg/yearn-vesting-escrow/blob/945b5ca09d8bb2d2ad9132df7368cb4992496f6a/contracts/VestingEscrowFactory.vy#L92.\n##### Recommendation\nWe recommend performing a range check of the vesting period or denoting it in days in order to prevent issues related to specifying time in seconds or milliseconds.",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/VestingEscrowFactory.vy",
      "content": "# @version 0.3.9\n\n\"\"\"\n@title Vesting Escrow Factory\n@author Curve Finance, Yearn Finance\n@license MIT\n@notice Stores and distributes ERC20 tokens by deploying `VestingEscrowSimple` contracts\n\"\"\"\n\nfrom vyper.interfaces import ERC20\n\n\ninterface VestingEscrowSimple:\n    def initialize(\n        owner: address,\n        token: ERC20,\n        recipient: address,\n        amount: uint256,\n        start_time: uint256,\n        end_time: uint256,\n        cliff_length: uint256,\n        open_claim: bool,\n    ) -> bool: nonpayable\n\n\nevent VestingEscrowCreated:\n    funder: indexed(address)\n    token: indexed(ERC20)\n    recipient: indexed(address)\n    escrow: address\n    amount: uint256\n    vesting_start: uint256\n    vesting_duration: uint256\n    cliff_length: uint256\n    open_claim: bool\n\n\nTARGET: public(immutable(address))\nVYPER: public(immutable(address))\n\n\n@external\ndef __init__(target: address, vyper_donate: address):\n    \"\"\"\n    @notice Contract constructor\n    @dev Prior to deployment you must deploy one copy of `VestingEscrowSimple` which\n         is used as a library for vesting contracts deployed by this factory\n    @param target `VestingEscrowSimple` contract address\n    @param vyper_donate Vyper Safe address for donations (vyperlang.eth on mainnet)\n    \"\"\"\n    TARGET = target\n    VYPER = vyper_donate\n\n\n@external\ndef deploy_vesting_contract(\n    token: ERC20,\n    recipient: address,\n    amount: uint256,\n    vesting_duration: uint256,\n    vesting_start: uint256 = block.timestamp,\n    cliff_length: uint256 = 0,\n    open_claim: bool = True,\n    support_vyper: uint256 = 100,\n    owner: address = msg.sender,\n) -> address:\n    \"\"\"\n    @notice Deploy a new vesting contract\n    @dev Prior to deployment you must approve `amount` + `amount` * `support_vyper` / 10_000\n         tokens\n    @param token ERC20 token being distributed\n    @param recipient Address to vest tokens for\n    @param amount Amount of tokens being vested for `recipient`\n    @param vesting_duration Time period over which tokens are released\n    @param vesting_start Epoch time when tokens begin to vest\n    @param open_claim Switch if anyone can claim for `recipient`\n    @param support_vyper Donation percentage in bps, 1% by default\n    \"\"\"\n    assert cliff_length <= vesting_duration  # dev: incorrect vesting cliff\n    assert vesting_start + vesting_duration > block.timestamp  # dev: just use a transfer, dummy\n    assert vesting_duration > 0  # dev: duration must be > 0\n    assert recipient not in [self, empty(address), token.address, owner]  # dev: wrong recipient\n\n    escrow: address = create_minimal_proxy_to(TARGET)\n\n    VestingEscrowSimple(escrow).initialize(\n        owner,\n        token,\n        recipient,\n        amount,\n        vesting_start,\n        vesting_start + vesting_duration,\n        cliff_length,\n        open_claim,\n    )\n    # skip transferFrom and approve and send directly to escrow\n    assert token.transferFrom(msg.sender, escrow, amount, default_return_value=True)  # dev: funding failed\n    if support_vyper > 0:\n        assert VYPER != empty(address)  # dev: lost donation\n        assert token.transferFrom(\n            msg.sender,\n            VYPER,\n            amount * support_vyper / 10_000,\n            default_return_value=True\n        )  # dev: donation failed\n\n    log VestingEscrowCreated(\n        msg.sender,\n        token,\n        recipient,\n        escrow,\n        amount,\n        vesting_start,\n        vesting_duration,\n        cliff_length,\n        open_claim,\n    )\n    return escrow"
    }
  ]
}