{
  "Title": "[M07] Old owner can frontrun the ownerChanger",
  "Content": "The [`Ownable` contract](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol) is a modified version of [the OpenZepplin `Ownable` contract](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58a3368215581509d05bd3ec4d53cd381c9bb40e/contracts/ownership/Ownable.sol) where a third actor is included: [the `ownerChanger`](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L6).\n\n\nThe `ownerChanger` is can accept an ownership transfer from the old owner to the [`pendingOwner`](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L7).\n\n\nFirst, to perform a successful ownership transfer, the old `owner` needs to [call the `transferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L26) passing the address of the new desired owner, and then the `ownerChanger` needs to accept it by [calling the `acceptTransferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L34).\n\n\nA scenario could happen in which the old owner A tries to deceive the `ownerChanger` by calling [the `transferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L26) with the address of the new owner B, address that the `ownerChanger` would approve, but right after the `ownerChanger` sends the transaction calling [the `acceptTransferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L34), the old owner A calls [the `transferOwnership` function again](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L26) with a higher gasPrice and passing another address C as the parameter. In that case, this last transaction would be mined first and just after that [the `acceptTransferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L34) would confirm the ownership transfer to the undesired address C.\n\n\nAlthough it is very unlikely that the old owner would perform such attack, consider changing [the `acceptTransferOwnership` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Ownable.sol#L34) to ask the `ownerChanger` the address of the new owner so it can be compared to the `pendingOwner` submitted by the old owner.\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/Ownable.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\n // Taking ideas from Open Zeppelin's Pausable contract\r\ncontract Ownable {\r\n    address public owner;\r\n    address public ownerChanger;\r\n    address public pendingOwner;\r\n\r\n    event OwnershipTransferRequested(address newPendingOwner);\r\n\r\n    event OwnershipTransferred(address oldOwner, address newOwner);\r\n\r\n    // The Ownable constructor sets the `ownerChanger` and the original `owner` of the contract.\r\n    constructor (address newOwnerChanger) public {\r\n        owner = msg.sender;\r\n        ownerChanger = newOwnerChanger;\r\n    }\r\n\r\n    // Modifier to make a function callable only by owner\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, 'Sender should be Owner');\r\n        _;\r\n    }\r\n\r\n    // Allows the current owner to transfer control of the contract to a newOwner. (It should be accepted by OwnerChanger)\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0),'New owner can not be zero address');\r\n        pendingOwner = newOwner;\r\n\r\n        emit OwnershipTransferRequested(newOwner);\r\n    }\r\n\r\n    // Owner changer can accept if owner call transferOwnership function\r\n    function acceptTransferOwnership () external {\r\n        require (msg.sender == ownerChanger, 'Sender should be ownerChanger');\r\n        require (pendingOwner != address(0), 'Pending Owner is empty');\r\n        address oldOwner = owner;\r\n        owner = pendingOwner;\r\n        pendingOwner = address(0);\r\n\r\n        emit OwnershipTransferred(oldOwner, pendingOwner);\r\n    }\r\n}"
    },
    {
      "filename": "contracts/Ownable.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\n // Taking ideas from Open Zeppelin's Pausable contract\r\ncontract Ownable {\r\n    address public owner;\r\n    address public ownerChanger;\r\n    address public pendingOwner;\r\n\r\n    event OwnershipTransferRequested(address newPendingOwner);\r\n\r\n    event OwnershipTransferred(address oldOwner, address newOwner);\r\n\r\n    // The Ownable constructor sets the `ownerChanger` and the original `owner` of the contract.\r\n    constructor (address newOwnerChanger) public {\r\n        owner = msg.sender;\r\n        ownerChanger = newOwnerChanger;\r\n    }\r\n\r\n    // Modifier to make a function callable only by owner\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, 'Sender should be Owner');\r\n        _;\r\n    }\r\n\r\n    // Allows the current owner to transfer control of the contract to a newOwner. (It should be accepted by OwnerChanger)\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0),'New owner can not be zero address');\r\n        pendingOwner = newOwner;\r\n\r\n        emit OwnershipTransferRequested(newOwner);\r\n    }\r\n\r\n    // Owner changer can accept if owner call transferOwnership function\r\n    function acceptTransferOwnership () external {\r\n        require (msg.sender == ownerChanger, 'Sender should be ownerChanger');\r\n        require (pendingOwner != address(0), 'Pending Owner is empty');\r\n        address oldOwner = owner;\r\n        owner = pendingOwner;\r\n        pendingOwner = address(0);\r\n\r\n        emit OwnershipTransferred(oldOwner, pendingOwner);\r\n    }\r\n}"
    },
    {
      "filename": "contracts/Ownable.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\n // Taking ideas from Open Zeppelin's Pausable contract\r\ncontract Ownable {\r\n    address public owner;\r\n    address public ownerChanger;\r\n    address public pendingOwner;\r\n\r\n    event OwnershipTransferRequested(address newPendingOwner);\r\n\r\n    event OwnershipTransferred(address oldOwner, address newOwner);\r\n\r\n    // The Ownable constructor sets the `ownerChanger` and the original `owner` of the contract.\r\n    constructor (address newOwnerChanger) public {\r\n        owner = msg.sender;\r\n        ownerChanger = newOwnerChanger;\r\n    }\r\n\r\n    // Modifier to make a function callable only by owner\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, 'Sender should be Owner');\r\n        _;\r\n    }\r\n\r\n    // Allows the current owner to transfer control of the contract to a newOwner. (It should be accepted by OwnerChanger)\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0),'New owner can not be zero address');\r\n        pendingOwner = newOwner;\r\n\r\n        emit OwnershipTransferRequested(newOwner);\r\n    }\r\n\r\n    // Owner changer can accept if owner call transferOwnership function\r\n    function acceptTransferOwnership () external {\r\n        require (msg.sender == ownerChanger, 'Sender should be ownerChanger');\r\n        require (pendingOwner != address(0), 'Pending Owner is empty');\r\n        address oldOwner = owner;\r\n        owner = pendingOwner;\r\n        pendingOwner = address(0);\r\n\r\n        emit OwnershipTransferred(oldOwner, pendingOwner);\r\n    }\r\n}"
    },
    {
      "filename": "contracts/Ownable.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\n // Taking ideas from Open Zeppelin's Pausable contract\r\ncontract Ownable {\r\n    address public owner;\r\n    address public ownerChanger;\r\n    address public pendingOwner;\r\n\r\n    event OwnershipTransferRequested(address newPendingOwner);\r\n\r\n    event OwnershipTransferred(address oldOwner, address newOwner);\r\n\r\n    // The Ownable constructor sets the `ownerChanger` and the original `owner` of the contract.\r\n    constructor (address newOwnerChanger) public {\r\n        owner = msg.sender;\r\n        ownerChanger = newOwnerChanger;\r\n    }\r\n\r\n    // Modifier to make a function callable only by owner\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, 'Sender should be Owner');\r\n        _;\r\n    }\r\n\r\n    // Allows the current owner to transfer control of the contract to a newOwner. (It should be accepted by OwnerChanger)\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0),'New owner can not be zero address');\r\n        pendingOwner = newOwner;\r\n\r\n        emit OwnershipTransferRequested(newOwner);\r\n    }\r\n\r\n    // Owner changer can accept if owner call transferOwnership function\r\n    function acceptTransferOwnership () external {\r\n        require (msg.sender == ownerChanger, 'Sender should be ownerChanger');\r\n        require (pendingOwner != address(0), 'Pending Owner is empty');\r\n        address oldOwner = owner;\r\n        owner = pendingOwner;\r\n        pendingOwner = address(0);\r\n\r\n        emit OwnershipTransferred(oldOwner, pendingOwner);\r\n    }\r\n}"
    }
  ]
}