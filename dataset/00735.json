{
  "Title": "Use of Deprecated Function From Chainlink API",
  "Content": "The [`getPrice` function](https://github.com/Ion-Protocol/ion-protocol/blob/98e282514ac5827196b49f688938e1e44709505a/src/oracles/spot/EthXSpotOracle.sol#L38) of the `EthXSpotOracle` contract pulls the ETHx to USD price from a Redstone oracle using the Chainlink interface using the [deprecated `latestAnswer` function](https://docs.chain.link/data-feeds/api-reference#variables-and-functions-in-accesscontrolledoffchainaggregator).\n\n\nConsider using the non-deprecated `latestRoundData` function from the Chainlink interface.\n\n\n***Update:** Resolved in [pull request #32](https://github.com/Ion-Protocol/ion-protocol/pull/32).*\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "src/oracles/spot/EthXSpotOracle.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity 0.8.21;\n\nimport { SpotOracle } from \"src/oracles/spot/SpotOracle.sol\";\nimport { IChainlink } from \"src/interfaces/IChainlink.sol\";\nimport { WadRayMath } from \"src/libraries/math/WadRayMath.sol\";\n\ninterface IRedstonePriceFeed {\n    function latestAnswer() external view returns (int256 answer);\n}\n\nuint8 constant REDSTONE_DECIMALS = 8;\nuint8 constant CHAINLINK_DECIMALS = 8;\n\ncontract EthXSpotOracle is SpotOracle {\n    using WadRayMath for uint256;\n\n    IRedstonePriceFeed immutable REDSTONE_ETHX_PRICE_FEED;\n    IChainlink immutable USD_PER_ETH_CHAINLINK;\n\n    constructor(\n        uint256 _ltv,\n        address _reserveOracle,\n        address _redstoneEthXPriceFeed,\n        address _usdPerEthChainlink\n    )\n        SpotOracle(_ltv, _reserveOracle)\n    {\n        REDSTONE_ETHX_PRICE_FEED = IRedstonePriceFeed(_redstoneEthXPriceFeed);\n        USD_PER_ETH_CHAINLINK = IChainlink(_usdPerEthChainlink);\n    }\n\n    // @notice Gets the price of ETHx in ETH. \n    // @dev redstone oracle returns dollar value per ETHx with 6 decimals.\n    // This needs to be converted to [wad] and to ETH denomination.\n    // @return ethPerEthX price of ETHx in ETH [wad] \n    function getPrice() public view override returns (uint256 ethPerEthX) {\n        // get price from the protocol feed\n        // usd per ETHx\n\n        uint256 usdPerEthX = uint256(REDSTONE_ETHX_PRICE_FEED.latestAnswer()).scaleUpToWad(REDSTONE_DECIMALS); //\n\n        // usd per ETH\n        (, int256 _usdPerEth,,,) = USD_PER_ETH_CHAINLINK.latestRoundData(); // price of stETH denominated in ETH\n        uint256 usdPerEth = uint256(_usdPerEth).scaleUpToWad(CHAINLINK_DECIMALS); // price of stETH denominated in ETH\n\n        // (USD per ETHx) / (USD per ETH) = (USD per ETHx) * (ETH per USD) = ETH per ETHx\n        ethPerEthX = usdPerEthX.wadDivDown(usdPerEth);\n    }\n}"
    }
  ]
}