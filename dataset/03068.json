{
  "Title": "Seller’s signature not required",
  "Content": "In this protocol, listing an asset is simply having the operator sign either a [`BidInput`](https://github.com/freeverseio/crypto-payments/blob/956a98e53ef540f7b2b40f3b923d0b0e3e5d32ef/contracts/auction/base/ISignableStructsAuction.sol#L19) or a [`BuyNowInput`](https://github.com/freeverseio/crypto-payments/blob/956a98e53ef540f7b2b40f3b923d0b0e3e5d32ef/contracts/buyNow/base/ISignableStructsBuyNow.sol#L18) struct. From there, once a buyer either places a bid or completes a buy-it-now listing, the struct will be saved on-chain. When processing either type of struct, the only requirements around signing is a valid signature from the operator.\n\n\nNowhere in the process is it required for the seller to signal that they intend to sell their asset. Requiring the seller’s signature over the listing would ensure that the origin of the listing was the seller itself. If a signature was not required, users could create phony listings that will never complete.\n\n\nSince the seller is required to actually transfer an asset at the end of a listing, the worst situation that should arise would be a large number of listings that do not complete after they end, resulting in users’ funds being locked for small periods of time.\n\n\nConsider requiring the seller’s signature along with the operator’s when listing assets.\n\n\n***Update**: Partially fixed with commit `097fa4c` of [PR#18](https://github.com/freeverseio/crypto-payments/pull/18). Seller validation is done with a signature over the `paymentId`, which does not remove the need for trust between operator and seller. However, the upgradability allowed via the EIP712 implementation contract allows for future updates which remedy this.*\n\n\n***The Freeverse team states:***\n\n\n\n> Following your suggestion, we decided to start, at least, with what we already have, and require the already-existing L2 sellerSignature to be provided to the payments contract. The data that makes paymentId is available off chain.\n> \n> \n> However, we also agreed with your point and decided that it’ll be nicer to move to a pattern where the seller signature is much closer to the others, so that the payments contract can verify the seller’s intention pre-digest.\n> \n> \n> That’s why the PR intentionally provides an interface for verifySellerSignature where future upgrades of the verification contract (via the setEIP712 method) can include implementations where the verification of the sellerSig makes use of the entire BuyNow/Auction input struct, as suggested. (note that verifySellerSignature already takes as inputs the entire bidInput/buynowInput struct).\n> \n> \n> Since changing the L2 current signature will take time (we first need to fill in details such as the not 1-to-1 mapping, and upgrades require coordination with nodes, etc.), we plan to do it carefully, and incorporate the suggestion using the setEIP712 method in due time.\n> \n> \n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/auction/base/ISignableStructsAuction.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity =0.8.14;\n\n/**\n * @title Interface for Structs required in MetaTXs using EIP712.\n * @author Freeverse.io, www.freeverse.io\n * @dev This contract defines the structure BidInput, required for auction processes.\n *  This structure requires a separate implementation of its EIP712-verifying function.\n */\n\ninterface ISignableStructsAuction {\n\n    /**\n    * @notice The main struct that characterizes a bid\n    * @dev Used as input to the bid/relayedBid methods to either start\n    * @dev an auction or increment a previous existing bid;\n    * @dev it needs to be signed following EIP712\n    */\n    struct BidInput {\n        // the unique Id that identifies a payment process,\n        // common to both Auctions and BuyNows,\n        // obtained from a sufficiently large source of entropy.\n        bytes32 paymentId;\n\n        // the time at which the auction ends if\n        // no bids arrive during the final minutes;\n        // this value is stored on arrival of the first bid,\n        // and possibly incremented on arrival of late bids\n        uint256 endsAt;\n\n        // the bid amount, an integer expressed in the\n        // lowest unit of the currency.\n        uint256 bidAmount;\n\n        // the fee that will be charged by the feeOperator,\n        // expressed as percentage Basis Points (bps), applied to amount.\n        // e.g. feeBPS = 500 implements a 5% fee.\n        uint256 feeBPS;\n\n        // the id of the universe that the asset belongs to.\n        uint256 universeId;\n\n        // the deadline for the payment to arrive to this\n        // contract, otherwise it will be rejected.\n        uint256 deadline;\n\n        // the bidder, providing the required funds, who shall receive\n        // the asset in case of winning the auction.       \n        address bidder;\n\n        // the seller of the asset, who shall receive the funds\n        // (subtracting fees) on successful completion of the auction.\n        address seller;\n    }\n}"
    }
  ]
}