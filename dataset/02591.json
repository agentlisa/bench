{
  "Title": "Missing docstrings",
  "Content": "Throughout the [codebase](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/) there are several parts that do not have docstrings. Some examples are:\n\n\n* [Line 408](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/AuctionBull.sol#L407-L408) of the [`AuctionBull`](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/AuctionBull.sol) contract\n* [Line 96](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol#L95-L96) of the [`LeverageBull`](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol) contract\n* [Line 105](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol#L103-L105) of the [`LeverageBull`](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol) contract\n* [Line 121](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol#L120-L121) of the [`LeverageBull`](https://github.com/opynfinance/squeeth-monorepo/tree/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/LeverageBull.sol) contract\n\n\nAdditionally, the [`AuctionBull` NatSpec documentation](https://github.com/opynfinance/squeeth-monorepo/blob/521203dc26e5a2c3e26c6d4ad02d513e7df63237/packages/bull-vault/src/EmergencyShutdown.sol#L23-L28) is incorrect, since it is referencing the `FlashBull` contract instead.\n\n\nConsider thoroughly documenting all functions (and their parameters) that are part of the contracts’ public API. Functions implementing sensitive functionality, even if not public, should be clearly documented as well. When writing docstrings, consider following the [Ethereum Natural Specification Format](https://solidity.readthedocs.io/en/develop/natspec-format.html) (NatSpec).\n\n\n***Update:** Resolved in [PR #775](https://github.com/opynfinance/squeeth-monorepo/pull/775), [PR #776](https://github.com/opynfinance/squeeth-monorepo/pull/776), [PR #818](https://github.com/opynfinance/squeeth-monorepo/pull/818) and [PR #822](https://github.com/opynfinance/squeeth-monorepo/pull/822).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/bull-vault/src/EmergencyShutdown.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-only\npragma solidity =0.7.6;\n\npragma abicoder v2;\n\n// interface\nimport { IController } from \"squeeth-monorepo/interfaces/IController.sol\";\nimport { IERC20 } from \"openzeppelin/token/ERC20/IERC20.sol\";\nimport { IWETH9 } from \"squeeth-monorepo/interfaces/IWETH9.sol\";\nimport { IUniswapV3Pool } from \"@uniswap/v3-core/contracts/interfaces/IUniswapV3Pool.sol\";\nimport { IBullStrategy } from \"./interface/IBullStrategy.sol\";\n// contract\nimport { UniFlash } from \"./UniFlash.sol\";\nimport { Ownable } from \"openzeppelin/access/Ownable.sol\";\n//lib\nimport { StrategyMath } from \"squeeth-monorepo/strategy/base/StrategyMath.sol\"; // StrategyMath licensed under AGPL-3.0-only\n\n/**\n * Error codes\n * ES1: Strategy has already been fully unwound with redeemShortShutdown()\n */\n\n/**\n * @notice FlashBull contract\n * @dev handle the flashswap interactions\n * @author opyn team\n */\ncontract EmergencyShutdown is UniFlash, Ownable {\n    using StrategyMath for uint256;\n    /// @dev 1e18\n\n    uint256 private constant ONE = 1e18;\n    /// @dev difference in decimals between WETH and USDC\n    uint256 internal constant WETH_DECIMALS_DIFF = 1e12;\n    /// @dev enum to differentiate between Uniswap swap callback function source\n\n    enum FLASH_SOURCE { SHUTDOWN }\n\n    struct ShutdownParams {\n        uint256 shareToUnwind;\n        uint256 ethLimitPrice;\n        uint24 ethPoolFee;\n    }\n\n    /// @dev weth address\n    address private immutable weth;\n    /// @dev usdc address\n    address private immutable usdc;\n    /// @dev bull stratgey address\n    address public immutable bullStrategy;\n\n    constructor(address _bull, address _factory, address _owner) UniFlash(_factory) {\n        bullStrategy = _bull;\n        weth = IController(IBullStrategy(_bull).powerTokenController()).weth();\n        usdc = IController(IBullStrategy(_bull).powerTokenController()).quoteCurrency();\n        transferOwnership(_owner);\n    }\n\n    /**\n     * @notice redeem the Crab shares owned by Bull if Squeeth contracts are shutdown and collapse leverage trade to hold ETH only\n     * @param _params Shutdown params\n     */\n\n    function redeemShortShutdown(ShutdownParams calldata _params) external onlyOwner {\n        require(!IBullStrategy(bullStrategy).hasRedeemedInShutdown(), \"ES1\");\n        uint256 usdcToRepay = IBullStrategy(bullStrategy).calcUsdcToRepay(_params.shareToUnwind);\n        _exactOutFlashSwap(\n            weth,\n            usdc,\n            _params.ethPoolFee,\n            usdcToRepay,\n            usdcToRepay.mul(WETH_DECIMALS_DIFF).wdiv(_params.ethLimitPrice),\n            uint8(FLASH_SOURCE.SHUTDOWN),\n            abi.encodePacked(usdcToRepay, _params.shareToUnwind)\n        );\n    }\n\n    /**\n     * @notice uniswap flash swap callback function\n     * @dev this function will be called by flashswap callback function uniswapV3SwapCallback()\n     */\n    function _uniFlashSwap(UniFlashswapCallbackData memory _uniFlashSwapData) internal override {\n        if (FLASH_SOURCE(_uniFlashSwapData.callSource) == FLASH_SOURCE.SHUTDOWN) {\n            (uint256 usdcToRepay, uint256 shareToUnwind) =\n                abi.decode(_uniFlashSwapData.callData, (uint256, uint256));\n\n            IERC20(usdc).approve(bullStrategy, usdcToRepay);\n            IBullStrategy(bullStrategy).shutdownRepayAndWithdraw(\n                _uniFlashSwapData.amountToPay, shareToUnwind\n            );\n\n            // repay the weth flash swap\n            IWETH9(weth).transfer(_uniFlashSwapData.pool, _uniFlashSwapData.amountToPay);\n        }\n    }\n}"
    }
  ]
}