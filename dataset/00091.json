{
  "Title": "No events emitted inside the `balanceTrackerHook` function",
  "Content": "##### Description\nThere is a `balanceTrackerHook` function defined at the line https://github.com/euler-xyz/reward-streams/blob/95783173eff4668bb177eeefd9e8a9dc1a44669c/src/TrackingRewardStreams.sol#L30. It updates rewards data, `distributionStorage.totalEligible` and `accountStorage.balance` storage variables but doesn't emit any corresponding events.\n\n##### Recommendation\nWe recommend emitting an event at the end of the function mentioned. It can log the updated `distributionStorage.totalEligible` and `accountStorage.balance` variables.\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "src/TrackingRewardStreams.sol",
      "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n\npragma solidity 0.8.24;\n\nimport {Set, SetStorage} from \"evc/Set.sol\";\nimport {BaseRewardStreams} from \"./BaseRewardStreams.sol\";\nimport {ITrackingRewardStreams} from \"./interfaces/IRewardStreams.sol\";\n\n/// @title TrackingRewardStreams\n/// @author Euler Labs (https://www.eulerlabs.com/)\n/// @notice This contract inherits from `BaseRewardStreams` and implements `ITrackingRewardStreams`.\n/// It allows for the rewards to be distributed to the rewarded token holders without requiring explicit staking.\n/// The rewarded token contract must implement `IBalanceTracker` and the `balanceTrackerHook` function.\n/// `balanceTrackerHook` must be called with:\n/// - the account's new balance when account's balance changes,\n/// - the current account's balance when the balance forwarding is enabled,\n/// - the account's balance of 0 when the balance forwarding is disabled.\ncontract TrackingRewardStreams is BaseRewardStreams, ITrackingRewardStreams {\n    using Set for SetStorage;\n\n    /// @notice Constructor for the TrackingRewardStreams contract.\n    /// @param evc The Ethereum Vault Connector contract.\n    /// @param epochDuration The duration of an epoch.\n    constructor(address evc, uint48 epochDuration) BaseRewardStreams(evc, epochDuration) {}\n\n    /// @notice Executes the balance tracking hook for an account\n    /// @param account The account address to execute the hook for\n    /// @param newAccountBalance The new balance of the account\n    /// @param forfeitRecentReward Whether to forfeit the most recent reward and not update the accumulator\n    function balanceTrackerHook(\n        address account,\n        uint256 newAccountBalance,\n        bool forfeitRecentReward\n    ) external override {\n        address rewarded = msg.sender;\n        AccountStorage storage accountStorage = accounts[account][rewarded];\n        uint256 currentAccountBalance = accountStorage.balance;\n        address[] memory rewards = accountStorage.enabledRewards.get();\n\n        for (uint256 i = 0; i < rewards.length; ++i) {\n            address reward = rewards[i];\n            DistributionStorage storage distributionStorage = distributions[rewarded][reward];\n\n            // We always allocate rewards before updating any balances.\n            updateRewardInternal(\n                distributionStorage,\n                accountStorage.earned[reward],\n                rewarded,\n                reward,\n                currentAccountBalance,\n                forfeitRecentReward\n            );\n\n            distributionStorage.totalEligible =\n                distributionStorage.totalEligible + newAccountBalance - currentAccountBalance;\n        }\n\n        accountStorage.balance = newAccountBalance;\n    }\n}"
    }
  ]
}