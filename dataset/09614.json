{
  "Title": "[04] Using ecrecover is against best practice",
  "Content": "\nUsing ecrecover is against best practice. Preferably use ECDSA.recover instead. EIP-2 still allows signature malleability for ecrecover(). Remove this possibility and make the signature unique. However it should be impossible to be a threat by now.\n\n### Proof of Concept\n\n[Volt.sol#L89](https://github.com/code-423n4/2022-03-volt/blob/main/contracts/volt/Volt.sol#L89)<br>\n\n### Recommended Mitigation Steps\n\nTake these implementations into consideration\n\n<https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/cryptography/draft-EIP712.sol>\n\n<https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/extensions/draft-ERC20Permit.sol>\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2022-03-volt",
  "Code": [
    {
      "filename": "contracts/volt/Volt.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity ^0.8.4;\n\nimport \"@openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol\";\nimport \"../refs/CoreRef.sol\";\n\n/// @title FEI stablecoin\n/// @author Fei Protocol\ncontract Volt is IVolt, ERC20Burnable, CoreRef {\n    // solhint-disable-next-line var-name-mixedcase\n    bytes32 public DOMAIN_SEPARATOR;\n    // keccak256(\"Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)\");\n    bytes32 public constant PERMIT_TYPEHASH =\n        0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;\n    mapping(address => uint256) public nonces;\n\n    /// @notice Fei token constructor\n    /// @param core Fei Core address to reference\n    constructor(address core) ERC20(\"VOLT\", \"VOLT\") CoreRef(core) {\n        uint256 chainId;\n        // solhint-disable-next-line no-inline-assembly\n        assembly {\n            chainId := chainid()\n        }\n        DOMAIN_SEPARATOR = keccak256(\n            abi.encode(\n                keccak256(\n                    \"EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)\"\n                ),\n                keccak256(bytes(name())),\n                keccak256(bytes(\"1\")),\n                chainId,\n                address(this)\n            )\n        );\n    }\n\n    /// @notice mint FEI tokens\n    /// @param account the account to mint to\n    /// @param amount the amount to mint\n    function mint(address account, uint256 amount)\n        external\n        override\n        onlyMinter\n        whenNotPaused\n    {\n        _mint(account, amount);\n        emit Minting(account, msg.sender, amount);\n    }\n\n    /// @notice burn FEI tokens from caller\n    /// @param amount the amount to burn\n    function burn(uint256 amount) public override(IVolt, ERC20Burnable) {\n        super.burn(amount);\n        emit Burning(msg.sender, msg.sender, amount);\n    }\n\n    /// @notice permit spending of FEI\n    /// @param owner the FEI holder\n    /// @param spender the approved operator\n    /// @param value the amount approved\n    /// @param deadline the deadline after which the approval is no longer valid\n    function permit(\n        address owner,\n        address spender,\n        uint256 value,\n        uint256 deadline,\n        uint8 v,\n        bytes32 r,\n        bytes32 s\n    ) external override {\n        require(deadline >= block.timestamp, \"Fei: EXPIRED\");\n        bytes32 digest = keccak256(\n            abi.encodePacked(\n                \"\\x19\\x01\",\n                DOMAIN_SEPARATOR,\n                keccak256(\n                    abi.encode(\n                        PERMIT_TYPEHASH,\n                        owner,\n                        spender,\n                        value,\n                        nonces[owner]++,\n                        deadline\n                    )\n                )\n            )\n        );\n        address recoveredAddress = ecrecover(digest, v, r, s);\n        require(\n            recoveredAddress != address(0) && recoveredAddress == owner,\n            \"Fei: INVALID_SIGNATURE\"\n        );\n        _approve(owner, spender, value);\n    }\n}"
    }
  ]
}