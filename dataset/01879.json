{
  "Title": "H-1: `StableOracleDAI` calculates `getPriceUSD` with inverted base/rate tokens for Chainlink price",
  "Content": "# Issue H-1: `StableOracleDAI` calculates `getPriceUSD` with inverted base/rate tokens for Chainlink price \n\nSource: https://github.com/sherlock-audit/2023-05-USSD-judging/issues/102 \n\n## Found by \n0xPkhatri, 0xRobocop, 0xyPhilic, Bahurum, Brenzee, J4de, Juntao, Viktor\\_Cortess, juancito, nobody2018, pengun, sashik\\_eth, shaka, twicek\n## Summary\n\n`StableOracleDAI::getPriceUSD()` calculates the average price between the Uniswap pool price for a pair and the Chainlink feed as part of its result.\n\nThe problem is that it uses `WETH/DAI` as the base/rate tokens for the pool, and `DAI/ETH` for the Chainlink feed, which is the opposite.\n\nThis will incur in a huge price difference that will impact on the amount of USSD tokens being minted, while requesting the price from this oracle.\n\n## Vulnerability Detail\n\nIn `StableOracleDAI::getPrice()` the `price` from the Chainlink feed `priceFeedDAIETH` returns the price as DAI/ETH.\n\nThis can be checked on [Etherscan](https://etherscan.io/address/0x773616E4d11A78F511299002da57A0a94577F1f4#readContract#F10) and the [Chainlink Feeds Page](https://docs.chain.link/data-feeds/price-feeds/addresses/).\n\nAlso note the comment on the code is misleading, as it is refering to another pair:\n\n> chainlink price data is 8 decimals for WETH/USD\n\n```solidity\n/// constructor\n24:    priceFeedDAIETH = AggregatorV3Interface(\n25:        0x773616E4d11A78F511299002da57A0a94577F1f4\n26:    );\n\n/// getPrice()\n46:    // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n47:    //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n48:    (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n```\n\n[Link to code](https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L46-L48)\n\nOn the other hand, the price coming from the Uniswap pool `DAIWethPrice` returns the price as `WETH/DAI`.\n\nNote that the relation WETH/DAI is given by the orders of the token addresses passed as arguments, being the first the base token, and the second the quote token.\n\nAlso note that the variable name `DAIWethPrice` is misleading as well as the base/rate are the opposite (although this doesn't affect the code).\n\n```solidity\n    uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n        1000000000000000000, // 1 Eth\n        0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token) // @audit\n        0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token) // @audit\n        pools, // DAI/WETH pool uni v3\n        600 // period\n    );\n```\n\n[Link to code](https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L36-L42)\n\nFinally, both values are used to calculate an average price of in `((DAIWethPrice + uint256(price) * 1e10) / 2)`.\n\nBut as seen, one has price in `DAI/ETH` and the other one in `WETH/DAI`, which leads to an incorrect result.\n\n```solidity\n    return\n        (wethPriceUSD * 1e18) /\n        ((DAIWethPrice + uint256(price) * 1e10) / 2);\n```\n\n[Link to code](https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L50C15-L52)\n\nThe average will be lower in this case, and the resulting price higher. \n\nThis will be used by `USSD::mintForToken()` for calculating the amount of tokens to mint for the user, and thus giving them much more than they should.\n\nAlso worth mentioning that `USSDRebalancer::rebalance()` also relies on the result of this price calculation and will make it perform trades with incorrect values.\n\n## Impact\n\nUsers will receive far more USSD tokens than they should when they call `mintForToken()`, ruining the token value.\n\nWhen performed the `USSDRebalancer::rebalance()`, all the calculations will be broken for the DAI oracle, leading to incorrect pool trades due to the error in `getPrice()`\n\n## Code Snippet\n\n- https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L46C28-L48\n- https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L36-L42\n- https://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L50C15-L52\n\n## Tool used\n\nManual Review\n\n## Recommendation\n\nCalculate the inverse of the `price` returned by the Chainlink feed so that it can be averaged with the pool price, making sure that both use the correct `WETH/DAI` and `ETH/DAI` base/rate tokens.\n\n\n\n\n\n## Discussion\n\n**T1MOH593**\n\nEscalate for 10 USDC\n\nThis is not a duplicate of https://github.com/sherlock-audit/2023-05-USSD-judging/issues/909.\nIt tells about using DAI/ETH instead of ETH/DAI on Chainlink. And #909 tells about completely different issue with oracles\n\n**sherlock-admin**\n\n > Escalate for 10 USDC\n> \n> This is not a duplicate of https://github.com/sherlock-audit/2023-05-USSD-judging/issues/909.\n> It tells about using DAI/ETH instead of ETH/DAI on Chainlink. And #909 tells about completely different issue with oracles\n\nYou've created a valid escalation for 10 USDC!\n\nTo remove the escalation from consideration: Delete your comment.\n\nYou may delete or edit your escalation comment anytime before the 48-hour escalation window closes. After that, the escalation becomes final.\n\n**0xJuancito**\n\nEscalate for 10 USDC\n\nAgree with the previous comment. \n\nThis is an **independent High** impact finding. It is not a duplicate of https://github.com/sherlock-audit/2023-05-USSD-judging/issues/909, and hasn't been exposed by other findings selected for report.\n\nIt's main point is explained on the Summary:\n\n> The problem is that it uses WETH/DAI as the base/rate tokens for the pool, and DAI/ETH for the Chainlink feed, which is the opposite.\n\nA more detailed explanation and recommendation to fix it is included on the rest of the report.\n\nPossible duplicates:\n\n- https://github.com/sherlock-audit/2023-05-USSD-judging/issues/795\n- https://github.com/sherlock-audit/2023-05-USSD-judging/issues/774\n- https://github.com/sherlock-audit/2023-05-USSD-judging/issues/491\n- https://github.com/sherlock-audit/2023-05-USSD-judging/issues/269\n\n**sherlock-admin**\n\n > Escalate for 10 USDC\n> \n> Agree with the previous comment. \n> \n> This is an **independent High** impact finding. It is not a duplicate of https://github.com/sherlock-audit/2023-05-USSD-judging/issues/909, and hasn't been exposed by other findings selected for report.\n> \n> It's main point is explained on the Summary:\n> \n> > The problem is that it uses WETH/DAI as the base/rate tokens for the pool, and DAI/ETH for the Chainlink feed, which is the opposite.\n> \n> A more detailed explanation and recommendation to fix it is included on the rest of the report.\n> \n> Possible duplicates:\n> \n> - https://github.com/sherlock-audit/2023-05-USSD-judging/issues/795\n> - https://github.com/sherlock-audit/2023-05-USSD-judging/issues/774\n> - https://github.com/sherlock-audit/2023-05-USSD-judging/issues/491\n> - https://github.com/sherlock-audit/2023-05-USSD-judging/issues/269\n\nYou've created a valid escalation for 10 USDC!\n\nTo remove the escalation from consideration: Delete your comment.\n\nYou may delete or edit your escalation comment anytime before the 48-hour escalation window closes. After that, the escalation becomes final.\n\n**ctf-sec**\n\nSee my comments in https://github.com/sherlock-audit/2023-05-USSD-judging/issues/555\n\n**hrishibhat**\n\nResult:\nHigh\nHas duplicates \nThis is a valid separate issue.\n\n\n**sherlock-admin**\n\nEscalations have been resolved successfully!\n\nEscalation status:\n- [T1MOH593](https://github.com/sherlock-audit/2023-05-USSD-judging/issues/102/#issuecomment-1604525700): accepted\n- [0xJuancito](https://github.com/sherlock-audit/2023-05-USSD-judging/issues/102/#issuecomment-1605034302): accepted\n\n",
  "Impact": "HIGH",
  "Source": "https://app.sherlock.xyz/audits/contests/82",
  "Code": [
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    }
  ]
}