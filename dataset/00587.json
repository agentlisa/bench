{
  "Title": "MCP and CCR management",
  "Content": "##### Description\n`MCP` and `CCR` are constants:\nhttps://github.com/Threshold-USD/dev/blob/800c6c19e44628dfda3cecaea6eedcb498bf0bf3/packages/contracts/contracts/Dependencies/LiquityBase.sol#L21\nOver time, the value and volatility of the collateral token may change. It will require to adapt `MCP` and `CCR` to new market behavior. \n\n##### Recommendation\nWe recommend that you add methods for changing `MCP` and `CCR` parameters.\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/contracts/contracts/Dependencies/LiquityBase.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity ^0.8.17;\n\nimport \"./BaseMath.sol\";\nimport \"./LiquityMath.sol\";\nimport \"../Interfaces/IActivePool.sol\";\nimport \"../Interfaces/IDefaultPool.sol\";\nimport \"../Interfaces/IPriceFeed.sol\";\nimport \"../Interfaces/ILiquityBase.sol\";\n\n/*\n* Base contract for TroveManager, BorrowerOperations and StabilityPool. Contains global system constants and\n* common functions.\n*/\ncontract LiquityBase is BaseMath, ILiquityBase {\n\n    uint256 constant public _100pct = 1000000000000000000; // 1e18 == 100%\n\n    // Minimum collateral ratio for individual troves\n    uint256 constant public MCR = 1100000000000000000; // 110%\n\n    // Critical system collateral ratio. If the system's total collateral ratio (TCR) falls below the CCR, Recovery Mode is triggered.\n    uint256 constant public CCR = 1500000000000000000; // 150%\n\n    // Amount of THUSD to be locked in gas pool on opening troves\n    uint256 constant public THUSD_GAS_COMPENSATION = 200e18;\n\n    // Minimum amount of net THUSD debt a trove must have\n    uint256 constant public MIN_NET_DEBT = 1800e18;\n    // uint256 constant public MIN_NET_DEBT = 0;\n\n    uint256 constant public PERCENT_DIVISOR = 200; // dividing by 200 yields 0.5%\n\n    uint256 constant public BORROWING_FEE_FLOOR = DECIMAL_PRECISION / 1000 * 5; // 0.5%\n\n    IActivePool public activePool;\n\n    IDefaultPool public defaultPool;\n\n    IPriceFeed public override priceFeed;\n\n    // --- Gas compensation functions ---\n\n    // Returns the composite debt (drawn debt + gas compensation) of a trove, for the purpose of ICR calculation\n    function _getCompositeDebt(uint256 _debt) internal pure returns (uint) {\n        return _debt + THUSD_GAS_COMPENSATION;\n    }\n\n    function _getNetDebt(uint256 _debt) internal pure returns (uint) {\n        return _debt - THUSD_GAS_COMPENSATION;\n    }\n\n    // Return the amount of collateral to be drawn from a trove's collateral and sent as gas compensation.\n    function _getCollGasCompensation(uint256 _entireColl) internal pure returns (uint) {\n        return _entireColl / PERCENT_DIVISOR;\n    }\n\n    function getEntireSystemColl() public view returns (uint256 entireSystemColl) {\n        uint256 activeColl = activePool.getCollateralBalance();\n        uint256 liquidatedColl = defaultPool.getCollateralBalance();\n\n        return activeColl + liquidatedColl;\n    }\n\n    function getEntireSystemDebt() public view returns (uint256 entireSystemDebt) {\n        uint256 activeDebt = activePool.getTHUSDDebt();\n        uint256 closedDebt = defaultPool.getTHUSDDebt();\n\n        return activeDebt + closedDebt;\n    }\n\n    function _getTCR(uint256 _price) internal view returns (uint256 TCR) {\n        uint256 entireSystemColl = getEntireSystemColl();\n        uint256 entireSystemDebt = getEntireSystemDebt();\n\n        TCR = LiquityMath._computeCR(entireSystemColl, entireSystemDebt, _price);\n        return TCR;\n    }\n\n    function _checkRecoveryMode(uint256 _price) internal view returns (bool) {\n        uint256 TCR = _getTCR(_price);\n        return TCR < CCR;\n    }\n\n    function _requireUserAcceptsFee(uint256 _fee, uint256 _amount, uint256 _maxFeePercentage) internal pure {\n        uint256 feePercentage = _fee * DECIMAL_PRECISION / _amount;\n        require(feePercentage <= _maxFeePercentage, \"Fee exceeded provided maximum\");\n    }\n}"
    }
  ]
}