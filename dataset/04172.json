{
  "Title": "[L07][Fixed] Mismatches between contracts and interfaces",
  "Content": "Interfaces define the exposed functionality of the implemented contracts. However, in several interfaces there are functions from the counterpart contracts that are not defined, as listed below.\n\n\n* The [`OracleInterface` interface](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/interfaces/OracleInterface.sol#L4) is missing the [`getDisputer`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Oracle.sol#L99) and the [`setDisputer`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Oracle.sol#L202) function.\n* The [`WhitelistInterface` interface](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/interfaces/WhitelistInterface.sol#L4) is missing the [`addressBook`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L14) getter, the [`blacklistProduct`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L153), [`blacklistCollateral`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L182), [`blacklistOtoken`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L204), [`whitelisteCallee`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L215), and [`blacklistCallee`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Whitelist.sol#L226) functions.\n* The [`OtokenInterface` interface](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/interfaces/OtokenInterface.sol#L4) is missing the [`addressBook`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/Otoken.sol#L20) getter.\n* The [`MarginPoolInterface` interface](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/interfaces/MarginPoolInterface.sol#L4) is missing the [`addressBook`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L22) and [`farmer`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L24) getters, and the [`getStoredBalance`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L105), [`farm`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L160), and [`setFarmer`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L182) functions. Also, it has a mismatch between the name of the implemented [`batchTransferToPool`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L115) and [`batchTransferToUser`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginPool.sol#L137) functions and the ones in the interface.\n* The [`MarginCalculatorInterface` interface](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/interfaces/MarginCalculatorInterface.sol#L8) should use `calldata` instead of `memory` due to the explicit use of the `external` visibility in interfaces, and it is missing the [`addressBook`](https://github.com/opynfinance/GammaProtocol/blob/d151621b33134789b29dc78eb89dad2b557b25b9/contracts/MarginCalculator.sol#L24) getter.\n\n\nConsider applying the necessary changes in the mentioned interfaces and contracts so that definitions and implementations fully match.\n\n\n**Update:** *Fixed in [PR#287](https://github.com/opynfinance/GammaProtocol/pull/287).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/interfaces/OracleInterface.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity 0.6.10;\n\ninterface OracleInterface {\n    function isLockingPeriodOver(address _asset, uint256 _expiryTimestamp) external view returns (bool);\n\n    function isDisputePeriodOver(address _asset, uint256 _expiryTimestamp) external view returns (bool);\n\n    function getExpiryPrice(address _asset, uint256 _expiryTimestamp) external view returns (uint256, bool);\n\n    function getPricer(address _asset) external view returns (address);\n\n    function getPrice(address _asset) external view returns (uint256);\n\n    function getPricerLockingPeriod(address _pricer) external view returns (uint256);\n\n    function getPricerDisputePeriod(address _pricer) external view returns (uint256);\n\n    // Non-view function\n\n    function setAssetPricer(address _asset, address _pricer) external;\n\n    function setLockingPeriod(address _pricer, uint256 _lockingPeriod) external;\n\n    function setDisputePeriod(address _pricer, uint256 _disputePeriod) external;\n\n    function setExpiryPrice(\n        address _asset,\n        uint256 _expiryTimestamp,\n        uint256 _price\n    ) external;\n\n    function disputeExpiryPrice(\n        address _asset,\n        uint256 _expiryTimestamp,\n        uint256 _price\n    ) external;\n}"
    },
    {
      "filename": "contracts/interfaces/WhitelistInterface.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity 0.6.10;\n\ninterface WhitelistInterface {\n    /* View functions */\n    function isWhitelistedProduct(\n        address _underlying,\n        address _strike,\n        address _collateral,\n        bool _isPut\n    ) external view returns (bool);\n\n    function isWhitelistedCollateral(address _collateral) external view returns (bool);\n\n    function isWhitelistedOtoken(address _otoken) external view returns (bool);\n\n    /* Admin / factory only functions */\n    function whitelistProduct(\n        address _underlying,\n        address _strike,\n        address _collateral,\n        bool _isPut\n    ) external;\n\n    function whitelistCollateral(address _collateral) external;\n\n    function whitelistOtoken(address _otoken) external;\n\n    function isWhitelistedCallee(address _callee) external view returns (bool);\n}"
    },
    {
      "filename": "contracts/interfaces/OtokenInterface.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity 0.6.10;\n\ninterface OtokenInterface {\n    function underlyingAsset() external view returns (address);\n\n    function strikeAsset() external view returns (address);\n\n    function collateralAsset() external view returns (address);\n\n    function strikePrice() external view returns (uint256);\n\n    function expiryTimestamp() external view returns (uint256);\n\n    function isPut() external view returns (bool);\n\n    function init(\n        address _addressBook,\n        address _underlyingAsset,\n        address _strikeAsset,\n        address _collateralAsset,\n        uint256 _strikePrice,\n        uint256 _expiry,\n        bool _isPut\n    ) external;\n\n    function mintOtoken(address account, uint256 amount) external;\n\n    function burnOtoken(address account, uint256 amount) external;\n}"
    },
    {
      "filename": "contracts/interfaces/MarginPoolInterface.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity 0.6.10;\n\ninterface MarginPoolInterface {\n    function transferToPool(\n        address _asset,\n        address _user,\n        uint256 _amount\n    ) external;\n\n    function transferToUser(\n        address _asset,\n        address _user,\n        uint256 _amount\n    ) external;\n\n    function transferToPool(\n        address[] calldata _asset,\n        address[] calldata _user,\n        uint256[] calldata _amount\n    ) external;\n\n    function transferToUser(\n        address[] calldata _asset,\n        address[] calldata _user,\n        uint256[] calldata _amount\n    ) external;\n}"
    },
    {
      "filename": "contracts/interfaces/MarginCalculatorInterface.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity 0.6.10;\n\npragma experimental ABIEncoderV2;\n\nimport {MarginVault} from \"../libs/MarginVault.sol\";\n\ninterface MarginCalculatorInterface {\n    function getExpiredPayoutRate(address _otoken) external view returns (uint256);\n\n    function getExcessCollateral(MarginVault.Vault memory _vault)\n        external\n        view\n        returns (uint256 netValue, bool isExcess);\n}"
    }
  ]
}