{
  "Title": "[04] Pool's `ParamLibrary.check` function for `TimeswapV2PoolCollectParam` checks `param.strike == 0` less restrictively than pool's other  `ParamLibrary.check` functions",
  "Content": "\nAs shown below, calling the pool's `ParamLibrary.check` function for `TimeswapV2PoolCollectParam` will not revert when `param.strike` is 0 while one or more of `param.long0Requested`, `param.long1Requested`, or `param.shortRequested` is not 0. However, calling the pool's other `ParamLibrary.check` functions for other `param` will revert whenever `param.strike == 0` is true. To handle the `param.strike == 0` check consistently, please consider updating the `&& param.strike == 0` condition to `|| param.strike == 0` in the pool's `ParamLibrary.check` function for `TimeswapV2PoolCollectParam`.\n\nhttps://github.com/code-423n4/2023-01-timeswap/blob/main/packages/v2-pool/src/structs/Param.sol#L133-L194\n\n```solidity\n    function check(TimeswapV2PoolCollectParam memory param) internal pure {\n        ...\n        if (param.long0Requested == 0 && param.long1Requested == 0 && param.shortRequested == 0 && param.strike == 0) Error.zeroInput();\n    }\n\n    ...\n    function check(TimeswapV2PoolMintParam memory param, uint96 blockTimestamp) internal pure {\n        ...\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    ...\n    function check(TimeswapV2PoolBurnParam memory param, uint96 blockTimestamp) internal pure {\n        ...\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    ...\n    function check(TimeswapV2PoolDeleverageParam memory param, uint96 blockTimestamp) internal pure {\n        ...\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    ...\n    function check(TimeswapV2PoolLeverageParam memory param, uint96 blockTimestamp) internal pure {\n        ...\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    ...\n    function check(TimeswapV2PoolRebalanceParam memory param, uint96 blockTimestamp) internal pure {\n        ...\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n```\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2023-01-timeswap",
  "Code": [
    {
      "filename": "packages/v2-pool/src/structs/Param.sol",
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity =0.8.8;\n\nimport {Error} from \"@timeswap-labs/v2-library/src/Error.sol\";\n\nimport {TimeswapV2PoolMint, TimeswapV2PoolBurn, TimeswapV2PoolDeleverage, TimeswapV2PoolLeverage, TimeswapV2PoolRebalance, TransactionLibrary} from \"../enums/Transaction.sol\";\n\n/// @dev The parameter for collectTransactionFees and collectProtocolFees functions.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param long0To The receipient of long0 positions.\n/// @param long1To The receipient of long1 positions.\n/// @param shortTo The receipient of short positions.\n/// @param long0Requested The maximum amount of long0 positions wanted.\n/// @param long1Requested The maximum amount of long1 positions wanted.\n/// @param shortRequested The maximum amount of short positions wanted.\nstruct TimeswapV2PoolCollectParam {\n    uint256 strike;\n    uint256 maturity;\n    address long0To;\n    address long1To;\n    address shortTo;\n    uint256 long0Requested;\n    uint256 long1Requested;\n    uint256 shortRequested;\n}\n\n/// @dev The parameter for mint function.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param to The receipient of liquidity positions.\n/// @param transaction The type of mint transaction, more information in Transaction module.\n/// @param delta If transaction is GivenLiquidity, the amount of liquidity minted. Note that this value must be uint160.\n/// If transaction is GivenLong, the amount of long position in base denomination to be deposited.\n/// If transaction is GivenShort, the amount of short position to be deposited.\n/// @param data The data to be sent to the function, which will go to the mint choice callback.\nstruct TimeswapV2PoolMintParam {\n    uint256 strike;\n    uint256 maturity;\n    address to;\n    TimeswapV2PoolMint transaction;\n    uint256 delta;\n    bytes data;\n}\n\n/// @dev The parameter for burn function.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param long0To The receipient of long0 positions.\n/// @param long1To The receipient of long1 positions.\n/// @param shortTo The receipient of short positions.\n/// @param transaction The type of burn transaction, more information in Transaction module.\n/// @param delta If transaction is GivenLiquidity, the amount of liquidity burnt. Note that this value must be uint160.\n/// If transaction is GivenLong, the amount of long position in base denomination to be withdrawn.\n/// If transaction is GivenShort, the amount of short position to be withdrawn.\n/// @param data The data to be sent to the function, which will go to the burn choice callback.\nstruct TimeswapV2PoolBurnParam {\n    uint256 strike;\n    uint256 maturity;\n    address long0To;\n    address long1To;\n    address shortTo;\n    TimeswapV2PoolBurn transaction;\n    uint256 delta;\n    bytes data;\n}\n\n/// @dev The parameter for deleverage function.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param to The receipient of short positions.\n/// @param transaction The type of deleverage transaction, more information in Transaction module.\n/// @param delta If transaction is GivenDeltaSqrtInterestRate, the decrease in square root interest rate.\n/// If transaction is GivenLong, the amount of long position in base denomination to be deposited.\n/// If transaction is GivenShort, the amount of short position to be withdrawn.\n/// If transaction is  GivenSum, the sum amount of long position in base denomination to be deposited, and short position to be withdrawn.\n/// @param data The data to be sent to the function, which will go to the deleverage choice callback.\nstruct TimeswapV2PoolDeleverageParam {\n    uint256 strike;\n    uint256 maturity;\n    address to;\n    TimeswapV2PoolDeleverage transaction;\n    uint256 delta;\n    bytes data;\n}\n\n/// @dev The parameter for leverage function.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param long0To The receipient of long0 positions.\n/// @param long1To The receipient of long1 positions.\n/// @param transaction The type of leverage transaction, more information in Transaction module.\n/// @param delta If transaction is GivenDeltaSqrtInterestRate, the increase in square root interest rate.\n/// If transaction is GivenLong, the amount of long position in base denomination to be withdrawn.\n/// If transaction is GivenShort, the amount of short position to be deposited.\n/// If transaction is  GivenSum, the sum amount of long position in base denomination to be withdrawn, and short position to be deposited.\n/// @param data The data to be sent to the function, which will go to the leverage choice callback.\nstruct TimeswapV2PoolLeverageParam {\n    uint256 strike;\n    uint256 maturity;\n    address long0To;\n    address long1To;\n    TimeswapV2PoolLeverage transaction;\n    uint256 delta;\n    bytes data;\n}\n\n/// @dev The parameter for rebalance function.\n/// @param strike The strike price of the pool.\n/// @param maturity The maturity of the pool.\n/// @param to When Long0ToLong1, the recipient of long1 positions.\n/// When Long1ToLong0, the receipient of long0 positions.\n/// @param isLong0ToLong1 Long0ToLong1 when true. Long1ToLong0 when false.\n/// @param transaction The type of rebalance transaction, more information in Transaction module.\n/// @param delta If transaction is GivenLong0 and Long0ToLong1, the amount of long0 positions to be deposited.\n/// If transaction is GivenLong0 and Long1ToLong0, the amount of long1 positions to be withdrawn.\n/// If transaction is GivenLong1 and Long0ToLong1, the amount of long1 positions to be withdrawn.\n/// If transaction is GivenLong1 and Long1ToLong0, the amount of long1 positions to be deposited.\n/// @param data The data to be sent to the function, which will go to the rebalance callback.\nstruct TimeswapV2PoolRebalanceParam {\n    uint256 strike;\n    uint256 maturity;\n    address to;\n    bool isLong0ToLong1;\n    TimeswapV2PoolRebalance transaction;\n    uint256 delta;\n    bytes data;\n}\n\nlibrary ParamLibrary {\n    /// @dev Sanity checks\n    /// @param param the parameter for collectTransactionFees or collectProtocolFees transaction.\n    function check(TimeswapV2PoolCollectParam memory param) internal pure {\n        if (param.long0To == address(0) || param.long1To == address(0) || param.shortTo == address(0)) Error.zeroAddress();\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.long0Requested == 0 && param.long1Requested == 0 && param.shortRequested == 0 && param.strike == 0) Error.zeroInput();\n    }\n\n    /// @dev Sanity checks\n    /// @param param the parameter for mint transaction.\n    /// @param blockTimestamp the current block timestamp.\n    function check(TimeswapV2PoolMintParam memory param, uint96 blockTimestamp) internal pure {\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.maturity < blockTimestamp) Error.alreadyMatured(param.maturity, blockTimestamp);\n        if (param.to == address(0)) Error.zeroAddress();\n        TransactionLibrary.check(param.transaction);\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    /// @dev Sanity checks\n    /// @param param the parameter for burn transaction.\n    /// @param blockTimestamp the current block timestamp.\n    function check(TimeswapV2PoolBurnParam memory param, uint96 blockTimestamp) internal pure {\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.maturity < blockTimestamp) Error.alreadyMatured(param.maturity, blockTimestamp);\n        if (param.long0To == address(0) || param.long1To == address(0) || param.shortTo == address(0)) Error.zeroAddress();\n\n        TransactionLibrary.check(param.transaction);\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    /// @dev Sanity checks\n    /// @param param the parameter for deleverage transaction.\n    /// @param blockTimestamp the current block timestamp.\n    function check(TimeswapV2PoolDeleverageParam memory param, uint96 blockTimestamp) internal pure {\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.maturity < blockTimestamp) Error.alreadyMatured(param.maturity, blockTimestamp);\n        if (param.to == address(0)) Error.zeroAddress();\n        TransactionLibrary.check(param.transaction);\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    /// @dev Sanity checks\n    /// @param param the parameter for leverage transaction.\n    /// @param blockTimestamp the current block timestamp.\n    function check(TimeswapV2PoolLeverageParam memory param, uint96 blockTimestamp) internal pure {\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.maturity < blockTimestamp) Error.alreadyMatured(param.maturity, blockTimestamp);\n        if (param.long0To == address(0) || param.long1To == address(0)) Error.zeroAddress();\n\n        TransactionLibrary.check(param.transaction);\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n\n    /// @dev Sanity checks\n    /// @param param the parameter for rebalance transaction.\n    /// @param blockTimestamp the current block timestamp.\n    function check(TimeswapV2PoolRebalanceParam memory param, uint96 blockTimestamp) internal pure {\n        if (param.maturity > type(uint96).max) Error.incorrectMaturity(param.maturity);\n        if (param.maturity < blockTimestamp) Error.alreadyMatured(param.maturity, blockTimestamp);\n        if (param.to == address(0)) Error.zeroAddress();\n        TransactionLibrary.check(param.transaction);\n        if (param.delta == 0 || param.strike == 0) Error.zeroInput();\n    }\n}"
    }
  ]
}