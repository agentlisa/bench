{
  "Title": "[G-10]  Use a more recent version of solidity",
  "Content": "<h2 id=\"g-10--use-a-more-recent-version-of-solidity\" style=\"position:relative;\"><a href=\"#g-10--use-a-more-recent-version-of-solidity\" aria-label=\"g 10  use a more recent version of solidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-10]  Use a more recent version of solidity</h2>\n<p>Use a solidity version of at least 0.8.2 to get simple compiler automatic inlining<br>\nUse a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads<br>\nUse a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than <code>revert()/require()</code> strings<br>\nUse a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value<br></p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">governance</span><span class=\"mtk1\">/</span><span class=\"mtk12\">IController</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">3</span><span class=\"mtk1\">:    </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> &gt;=</span><span class=\"mtk7\">0.6</span><span class=\"mtk1\">.</span><span class=\"mtk7\">12</span><span class=\"mtk1\"> &lt;</span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/governance/IController.sol#L3\">https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/governance/IController.sol#L3</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">staking</span><span class=\"mtk1\">/</span><span class=\"mtk12\">IStakingData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">3</span><span class=\"mtk1\">:    </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> &gt;=</span><span class=\"mtk7\">0.6</span><span class=\"mtk1\">.</span><span class=\"mtk7\">12</span><span class=\"mtk1\"> &lt;</span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/staking/IStakingData.sol#L3\">https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/staking/IStakingData.sol#L3</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"75\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">staking</span><span class=\"mtk1\">/</span><span class=\"mtk12\">IStaking</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">3</span><span class=\"mtk1\">:    </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> &gt;=</span><span class=\"mtk7\">0.6</span><span class=\"mtk1\">.</span><span class=\"mtk7\">12</span><span class=\"mtk1\"> &lt;</span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/staking/IStaking.sol#L3\">https://github.com/code-423n4/2022-10-thegraph/blob/48e7c7cf641847e07ba07e01176cb17ba8ad6432/contracts/staking/IStaking.sol#L3</a></p>\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/contests/2022-10-the-graph-l2-bridge-contest",
  "Code": [
    {
      "filename": "contracts/governance/IController.sol",
      "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n\npragma solidity >=0.6.12 <0.8.0;\n\ninterface IController {\n    function getGovernor() external view returns (address);\n\n    // -- Registry --\n\n    function setContractProxy(bytes32 _id, address _contractAddress) external;\n\n    function unsetContractProxy(bytes32 _id) external;\n\n    function updateController(bytes32 _id, address _controller) external;\n\n    function getContractProxy(bytes32 _id) external view returns (address);\n\n    // -- Pausing --\n\n    function setPartialPaused(bool _partialPaused) external;\n\n    function setPaused(bool _paused) external;\n\n    function setPauseGuardian(address _newPauseGuardian) external;\n\n    function paused() external view returns (bool);\n\n    function partialPaused() external view returns (bool);\n}"
    },
    {
      "filename": "contracts/staking/IStakingData.sol",
      "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n\npragma solidity >=0.6.12 <0.8.0;\n\ninterface IStakingData {\n    /**\n     * @dev Allocate GRT tokens for the purpose of serving queries of a subgraph deployment\n     * An allocation is created in the allocate() function and consumed in claim()\n     */\n    struct Allocation {\n        address indexer;\n        bytes32 subgraphDeploymentID;\n        uint256 tokens; // Tokens allocated to a SubgraphDeployment\n        uint256 createdAtEpoch; // Epoch when it was created\n        uint256 closedAtEpoch; // Epoch when it was closed\n        uint256 collectedFees; // Collected fees for the allocation\n        uint256 effectiveAllocation; // Effective allocation when closed\n        uint256 accRewardsPerAllocatedToken; // Snapshot used for reward calc\n    }\n\n    /**\n     * @dev Represents a request to close an allocation with a specific proof of indexing.\n     * This is passed when calling closeAllocationMany to define the closing parameters for\n     * each allocation.\n     */\n    struct CloseAllocationRequest {\n        address allocationID;\n        bytes32 poi;\n    }\n\n    // -- Delegation Data --\n\n    /**\n     * @dev Delegation pool information. One per indexer.\n     */\n    struct DelegationPool {\n        uint32 cooldownBlocks; // Blocks to wait before updating parameters\n        uint32 indexingRewardCut; // in PPM\n        uint32 queryFeeCut; // in PPM\n        uint256 updatedAtBlock; // Block when the pool was last updated\n        uint256 tokens; // Total tokens as pool reserves\n        uint256 shares; // Total shares minted in the pool\n        mapping(address => Delegation) delegators; // Mapping of delegator => Delegation\n    }\n\n    /**\n     * @dev Individual delegation data of a delegator in a pool.\n     */\n    struct Delegation {\n        uint256 shares; // Shares owned by a delegator in the pool\n        uint256 tokensLocked; // Tokens locked for undelegation\n        uint256 tokensLockedUntil; // Block when locked tokens can be withdrawn\n    }\n}"
    },
    {
      "filename": "contracts/staking/IStaking.sol",
      "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n\npragma solidity >=0.6.12 <0.8.0;\npragma abicoder v2;\n\nimport \"./IStakingData.sol\";\n\ninterface IStaking is IStakingData {\n    // -- Allocation Data --\n\n    /**\n     * @dev Possible states an allocation can be\n     * States:\n     * - Null = indexer == address(0)\n     * - Active = not Null && tokens > 0\n     * - Closed = Active && closedAtEpoch != 0\n     * - Finalized = Closed && closedAtEpoch + channelDisputeEpochs > now()\n     * - Claimed = not Null && tokens == 0\n     */\n    enum AllocationState {\n        Null,\n        Active,\n        Closed,\n        Finalized,\n        Claimed\n    }\n\n    // -- Configuration --\n\n    function setMinimumIndexerStake(uint256 _minimumIndexerStake) external;\n\n    function setThawingPeriod(uint32 _thawingPeriod) external;\n\n    function setCurationPercentage(uint32 _percentage) external;\n\n    function setProtocolPercentage(uint32 _percentage) external;\n\n    function setChannelDisputeEpochs(uint32 _channelDisputeEpochs) external;\n\n    function setMaxAllocationEpochs(uint32 _maxAllocationEpochs) external;\n\n    function setRebateRatio(uint32 _alphaNumerator, uint32 _alphaDenominator) external;\n\n    function setDelegationRatio(uint32 _delegationRatio) external;\n\n    function setDelegationParameters(\n        uint32 _indexingRewardCut,\n        uint32 _queryFeeCut,\n        uint32 _cooldownBlocks\n    ) external;\n\n    function setDelegationParametersCooldown(uint32 _blocks) external;\n\n    function setDelegationUnbondingPeriod(uint32 _delegationUnbondingPeriod) external;\n\n    function setDelegationTaxPercentage(uint32 _percentage) external;\n\n    function setSlasher(address _slasher, bool _allowed) external;\n\n    function setAssetHolder(address _assetHolder, bool _allowed) external;\n\n    // -- Operation --\n\n    function setOperator(address _operator, bool _allowed) external;\n\n    function isOperator(address _operator, address _indexer) external view returns (bool);\n\n    // -- Staking --\n\n    function stake(uint256 _tokens) external;\n\n    function stakeTo(address _indexer, uint256 _tokens) external;\n\n    function unstake(uint256 _tokens) external;\n\n    function slash(\n        address _indexer,\n        uint256 _tokens,\n        uint256 _reward,\n        address _beneficiary\n    ) external;\n\n    function withdraw() external;\n\n    function setRewardsDestination(address _destination) external;\n\n    // -- Delegation --\n\n    function delegate(address _indexer, uint256 _tokens) external returns (uint256);\n\n    function undelegate(address _indexer, uint256 _shares) external returns (uint256);\n\n    function withdrawDelegated(address _indexer, address _newIndexer) external returns (uint256);\n\n    // -- Channel management and allocations --\n\n    function allocate(\n        bytes32 _subgraphDeploymentID,\n        uint256 _tokens,\n        address _allocationID,\n        bytes32 _metadata,\n        bytes calldata _proof\n    ) external;\n\n    function allocateFrom(\n        address _indexer,\n        bytes32 _subgraphDeploymentID,\n        uint256 _tokens,\n        address _allocationID,\n        bytes32 _metadata,\n        bytes calldata _proof\n    ) external;\n\n    function closeAllocation(address _allocationID, bytes32 _poi) external;\n\n    function closeAllocationMany(CloseAllocationRequest[] calldata _requests) external;\n\n    function closeAndAllocate(\n        address _oldAllocationID,\n        bytes32 _poi,\n        address _indexer,\n        bytes32 _subgraphDeploymentID,\n        uint256 _tokens,\n        address _allocationID,\n        bytes32 _metadata,\n        bytes calldata _proof\n    ) external;\n\n    function collect(uint256 _tokens, address _allocationID) external;\n\n    function claim(address _allocationID, bool _restake) external;\n\n    function claimMany(address[] calldata _allocationID, bool _restake) external;\n\n    // -- Getters and calculations --\n\n    function hasStake(address _indexer) external view returns (bool);\n\n    function getIndexerStakedTokens(address _indexer) external view returns (uint256);\n\n    function getIndexerCapacity(address _indexer) external view returns (uint256);\n\n    function getAllocation(address _allocationID) external view returns (Allocation memory);\n\n    function getAllocationState(address _allocationID) external view returns (AllocationState);\n\n    function isAllocation(address _allocationID) external view returns (bool);\n\n    function getSubgraphAllocatedTokens(bytes32 _subgraphDeploymentID)\n        external\n        view\n        returns (uint256);\n\n    function getDelegation(address _indexer, address _delegator)\n        external\n        view\n        returns (Delegation memory);\n\n    function isDelegator(address _indexer, address _delegator) external view returns (bool);\n}"
    }
  ]
}