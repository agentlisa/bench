{
  "Title": "M-1: [WP-M1] getRewards() can be triggered by external parties which will result in the rewards not be tracking properly by the system",
  "Content": "# Issue M-1: [WP-M1] getRewards() can be triggered by external parties which will result in the rewards not be tracking properly by the system \n\nSource: https://github.com/sherlock-audit/2022-12-sentiment-judging/issues/15 \n\n## Found by \nWATCHPUG\n\n## Summary\n\n`ConvexRewardPool#getReward(address)` can be called by any address besides the owner themself.\n\n## Vulnerability Detail\n\nThe reward tokens will only be added to the assets list when `getReward()` is called.\n\nIf there is a third party that is \"helping\" the `account` to call `getReward()` from time to time, by keeping the value of unclaimed rewards low, the account owner may not have the motivation to take the initiative to call `getReward()` via the `AccountManager`.\n\nAs a result, the reward tokens may never get added to the account's assets list.\n\n## Impact\n\nIf the helper/attacker continuously claims the rewards on behalf of the victim, the rewards will not be accounted for in the victim's total assets.\n\nAs a result, the victim's account can be liquidated while actual there are enough assets in their account, it is just that these are not accounted for.\n\n## Code Snippet\n\nhttps://github.com/sentimentxyz/controller/blob/507274a0803ceaa3cbbaf2a696e2458e18437b2f/src/convex/ConvexBoosterController.sol#L31-L46\n\nhttps://arbiscan.io/address/0x63F00F688086F0109d586501E783e33f2C950e78\n\n## Tool used\n\nManual Review\n\n## Recommendation\n\nConsider adding all the reward tokens to the account's assets list in `ConvexBoosterController.sol#canDeposit()`.\n\n## Discussion\n\n**r0ohafza**\n\nfix: https://github.com/sentimentxyz/controller/pull/54\n\n\n\n\n",
  "Impact": "MEDIUM",
  "Source": "https://app.sherlock.xyz/audits/contests/28",
  "Code": [
    {
      "filename": "src/convex/ConvexBoosterController.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\nimport {IController} from \"../core/IController.sol\";\n\ninterface IBooster {\n    function poolInfo(uint256) external view returns(address, address, address, bool, address);\n}\n\ncontract ConvexBoosterController is IController {\n\n    address public immutable BOOSTER;\n\n    /// @notice deposit(uint256,uint256)\n    bytes4 constant DEPOSIT = 0xe2bbb158;\n\n    constructor(address booster) {\n        BOOSTER = booster;\n    }\n\n    function canCall(address, bool, bytes calldata data)\n        external\n        view\n        returns (bool, address[] memory, address[] memory)\n    {\n        bytes4 sig = bytes4(data);\n        if (sig == DEPOSIT) return canDeposit(data[4:]);\n        return (false, new address[](0), new address[](0));\n    }\n\n    function canDeposit(bytes calldata data)\n        internal\n        view\n        returns (bool, address[] memory, address[] memory)\n    {\n        (uint pid, ) = abi.decode(data, (uint, uint));\n        (address lpToken, , address rewardPool, ,) = IBooster(BOOSTER).poolInfo(pid);\n\n        address[] memory tokensIn = new address[](1);\n        tokensIn[0] = rewardPool;\n\n        address[] memory tokensOut = new address[](1);\n        tokensOut[0] = lpToken;\n\n        return (true, tokensIn, tokensOut);\n    }\n}"
    }
  ]
}