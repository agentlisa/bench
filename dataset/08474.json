{
  "Title": "[G-06] Clones for cheap contract deployment",
  "Content": "\nThere's a way to save a significant amount of gas on deployment using Clones: <https://www.youtube.com/watch?v=3Mw-pMmJ7TA> .\n\nWith the standard way using the `new` keyword, each contract created contains the entire logic. Using proxies allow only the first implementation to contain the logic, saving deployment costs on subsequent instances deployed.\n\n#### PROOF OF CONCEPT\n\nInstances:\n\n#### Creator.sol\n\n[address zct = address(new ZcToken(p, u, m, c, marketPlace, n, s, d))](https://github.com/code-423n4/2022-07-swivel/blob/daf72892d8a8d6eaa43b9e7d1924ccb0e612ee3c/Creator/Creator.sol#L40)\\\n[address tracker = address(new VaultTracker(p, m, c, sw))](https://github.com/code-423n4/2022-07-swivel/blob/daf72892d8a8d6eaa43b9e7d1924ccb0e612ee3c/Creator/Creator.sol#L41)\n\n### Recommended Mitigation Steps\n\nUse a proxy system, see [here](https://youtu.be/3Mw-pMmJ7TA?t=915) for an example.\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/contests/2022-07-swivel-v3-contest",
  "Code": [
    {
      "filename": "Creator/Creator.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\n\npragma solidity 0.8.13;\n\nimport './ZcToken.sol';\nimport './VaultTracker.sol';\n\ncontract Creator {\n  /// @dev A single custom error capable of indicating a wide range of detected errors by providing\n  /// an error code value whose string representation is documented <here>, and any possible other values\n  /// that are pertinent to the error.\n  error Exception(uint8, uint256, uint256, address, address);\n\n  address public admin;\n  address public marketPlace;\n\n  constructor() {\n    admin = msg.sender;\n  }\n\n  /// @notice Allows the owner to create new markets\n  /// @param p Protocol associated with the new market\n  /// @param u Underlying token associated with the new market\n  /// @param m Maturity timestamp of the new market\n  /// @param c Compounding Token address associated with the new market\n  /// @param sw Address of the deployed swivel contract\n  /// @param n Name of the new market zcToken\n  /// @param s Symbol of the new market zcToken\n  /// @param d Decimals of the new market zcToken\n  function create (\n    uint8 p,\n    address u,\n    uint256 m,\n    address c,\n    address sw,\n    string memory n,\n    string memory s,\n    uint8 d\n  ) external authorized(marketPlace) returns (address, address) {\n    address zct = address(new ZcToken(p, u, m, c, marketPlace, n, s, d));\n    address tracker = address(new VaultTracker(p, m, c, sw));\n\n    return (zct, tracker);\n  }\n\n  /// @param a Address of a new admin\n  function setAdmin(address a) external authorized(admin) returns (bool) {\n    admin = a;\n    return true;\n  }\n\n  /// @param m Address of the deployed marketPlace contract\n  /// @notice We only allow this to be set once\n  function setMarketPlace(address m) external authorized(admin) returns (bool) {\n    if (marketPlace != address(0)) {\n      revert Exception(33, 0, 0, marketPlace, address(0)); \n    }\n\n    marketPlace = m;\n    return true;\n  }\n\n  modifier authorized(address a) {\n    if(msg.sender != a) { revert Exception(0, 0, 0, msg.sender, a); }\n      _;\n  }\n}"
    },
    {
      "filename": "Creator/Creator.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\n\npragma solidity 0.8.13;\n\nimport './ZcToken.sol';\nimport './VaultTracker.sol';\n\ncontract Creator {\n  /// @dev A single custom error capable of indicating a wide range of detected errors by providing\n  /// an error code value whose string representation is documented <here>, and any possible other values\n  /// that are pertinent to the error.\n  error Exception(uint8, uint256, uint256, address, address);\n\n  address public admin;\n  address public marketPlace;\n\n  constructor() {\n    admin = msg.sender;\n  }\n\n  /// @notice Allows the owner to create new markets\n  /// @param p Protocol associated with the new market\n  /// @param u Underlying token associated with the new market\n  /// @param m Maturity timestamp of the new market\n  /// @param c Compounding Token address associated with the new market\n  /// @param sw Address of the deployed swivel contract\n  /// @param n Name of the new market zcToken\n  /// @param s Symbol of the new market zcToken\n  /// @param d Decimals of the new market zcToken\n  function create (\n    uint8 p,\n    address u,\n    uint256 m,\n    address c,\n    address sw,\n    string memory n,\n    string memory s,\n    uint8 d\n  ) external authorized(marketPlace) returns (address, address) {\n    address zct = address(new ZcToken(p, u, m, c, marketPlace, n, s, d));\n    address tracker = address(new VaultTracker(p, m, c, sw));\n\n    return (zct, tracker);\n  }\n\n  /// @param a Address of a new admin\n  function setAdmin(address a) external authorized(admin) returns (bool) {\n    admin = a;\n    return true;\n  }\n\n  /// @param m Address of the deployed marketPlace contract\n  /// @notice We only allow this to be set once\n  function setMarketPlace(address m) external authorized(admin) returns (bool) {\n    if (marketPlace != address(0)) {\n      revert Exception(33, 0, 0, marketPlace, address(0)); \n    }\n\n    marketPlace = m;\n    return true;\n  }\n\n  modifier authorized(address a) {\n    if(msg.sender != a) { revert Exception(0, 0, 0, msg.sender, a); }\n      _;\n  }\n}"
    }
  ]
}