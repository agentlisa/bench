{
  "Title": "M-2: Subaccount#execute lacks payable",
  "Content": "# Issue M-2: Subaccount#execute lacks payable \n\nSource: https://github.com/sherlock-audit/2023-04-jojo-judging/issues/111 \n\n## Found by \n0xlmanini, Brenzee, T1MOH, ctf\\_sec, immeas, n1punp, nobody2018, p0wd3r, rvierdiiev, yixxas\n## Summary\n\n`Subaccount#execute` lacks `payable`. If `value` in `Subaccount#execute`Â is not zero, it could always revert.\n\n## Vulnerability Detail\n\n`Subaccount#execute` lacks `payable`. The caller cannot send the value.\n\n```solidity\nfunction execute(address to, bytes calldata data, uint256 value) external onlyOwner returns (bytes memory){\n        require(to != address(0));\n->      (bool success, bytes memory returnData) = to.call{value: value}(data);\n        if (!success) {\n            assembly {\n                let ptr := mload(0x40)\n                let size := returndatasize()\n                returndatacopy(ptr, 0, size)\n                revert(ptr, size)\n            }\n        }\n        emit ExecuteTransaction(owner, address(this), to, data, value);\n        return returnData;\n    }\n```\n\nThe `Subaccount` contract does not implement `receive() payable` or `fallback() payable`, so it is unable to receive value (eth) . Therefore, `Subaccount#execute` needs to add `payable`.\n\n## Impact\n\n`Subaccount#execute` cannot work if `value` != 0.\n\n## Code Snippet\n\nhttps://github.com/sherlock-audit/2023-04-jojo/blob/main/smart-contract-EVM/contracts/subaccount/Subaccount.sol#L45-L58\n\n## Tool used\n\nManual Review\n\n## Recommendation\n\nAdd a `receive() external payable` to the contract or `execute()` to add a `payable` modifier.\n\n\n\n## Discussion\n\n**JoscelynFarr**\n\nfix link:\nhttps://github.com/JOJOexchange/smart-contract-EVM/commit/64dfd055deeae857fa99d4703cdbf7ba1291b8ad\n\n**IAm0x52**\n\nFix looks good. `execute()` is now payable and value is check to make sure no ETH is left in the contract\n\n",
  "Impact": "MEDIUM",
  "Source": "https://app.sherlock.xyz/audits/contests/70",
  "Code": [
    {
      "filename": "smart-contract-EVM/contracts/subaccount/Subaccount.sol",
      "content": "/*\n    Copyright 2022 JOJO Exchange\n    SPDX-License-Identifier: BUSL-1.1\n*/\n\npragma solidity 0.8.9;\n\nimport \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\n\n/// @notice Subaccount can help its owner manage risk and positions.\n/// You can open orders with isolated positions via Subaccount.\n/// You can also let others trade for you by setting them as authorized\n/// operators. Operators have no access to fund transfer.\ncontract Subaccount {\n    // ========== storage ==========\n\n    /*\n       This is not a standard ownable contract because the ownership\n       can not be transferred. This contract is designed to be\n       initializable to better support clone, which is a low gas\n       deployment solution.\n    */\n    address public owner;\n    bool public initialized;\n\n    // ========== modifier ==========\n\n    modifier onlyOwner() {\n        require(owner == msg.sender, \"Ownable: caller is not the owner\");\n        _;\n    }\n\n    // ========== event ==========\n    event ExecuteTransaction(address indexed owner, address subaccount, address to, bytes data, uint256 value);\n\n    // ========== functions ==========\n\n    function init(address _owner) external {\n        require(!initialized, \"ALREADY INITIALIZED\");\n        initialized = true;\n        owner = _owner;\n    }\n\n    function execute(address to, bytes calldata data, uint256 value) external onlyOwner returns (bytes memory){\n        require(to != address(0));\n        (bool success, bytes memory returnData) = to.call{value: value}(data);\n        if (!success) {\n            assembly {\n                let ptr := mload(0x40)\n                let size := returndatasize()\n                returndatacopy(ptr, 0, size)\n                revert(ptr, size)\n            }\n        }\n        emit ExecuteTransaction(owner, address(this), to, data, value);\n        return returnData;\n    }\n}"
    }
  ]
}