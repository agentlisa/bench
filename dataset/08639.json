{
  "Title": "[M-13] Sending batch withdrawal requests can possibly DoS",
  "Content": "_Submitted by berndartmueller_\n\nThe function `BatchRequests.sendWithdrawalRequests` allows calling the `sendWithdrawalRequests` function on all of the Yieldy contracts at once. However, due to the unbounded `for` loop, if many Yieldy contracts are added to `contracts`, this function can potentially DoS due to reaching the block gas limit.\n\n### Proof of Concept\n\n[BatchRequests.sendWithdrawalRequests](https://github.com/code-423n4/2022-06-yieldy/blob/524f3b83522125fb7d4677fa7a7e5ba5a2c0fe67/src/contracts/BatchRequests.sol#L14-L27)\n\n```solidity\nfunction sendWithdrawalRequests() external {\n    uint256 contractsLength = contracts.length;\n    for (uint256 i; i < contractsLength; ) {\n        if (\n            contracts[i] != address(0) &&\n            IStaking(contracts[i]).canBatchTransactions()\n        ) {\n            IStaking(contracts[i]).sendWithdrawalRequests();\n        }\n        unchecked {\n            ++i;\n        }\n    }\n}\n```\n\n### Recommended mitigation steps\n\nAdd `offset` and `limit` function parameters to implement a \"paginated\" for loop.\n\n**[toshiSat (Yieldy) acknowledged and commented](https://github.com/code-423n4/2022-06-yieldy-findings/issues/280#issuecomment-1167783591):**\n > Only the owner of the contract can add addresses to the contract.\n\n**[JasoonS (judge) commented](https://github.com/code-423n4/2022-06-yieldy-findings/issues/280#issuecomment-1198077126):**\n > Hmm, would consider making this Low. But keeping it medium highlights the importance to be aware of this.\n\n\n\n***\n\n",
  "Impact": "MEDIUM",
  "Source": "https://code4rena.com/contests/2022-06-yieldy-contest",
  "Code": [
    {
      "filename": "src/contracts/BatchRequests.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-or-later\npragma solidity 0.8.9;\n\nimport \"../interfaces/IStaking.sol\";\nimport \"../structs/Batch.sol\";\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\n\ncontract BatchRequests is Ownable {\n    address[] public contracts;\n\n    /**\n        @notice sendWithdrawalRequests on all addresses in contracts\n     */\n    function sendWithdrawalRequests() external {\n        uint256 contractsLength = contracts.length;\n        for (uint256 i; i < contractsLength; ) {\n            if (\n                contracts[i] != address(0) &&\n                IStaking(contracts[i]).canBatchTransactions()\n            ) {\n                IStaking(contracts[i]).sendWithdrawalRequests();\n            }\n            unchecked {\n                ++i;\n            }\n        }\n    }\n\n    /**\n        @notice shows which contracts can batch\n        @return (address, bool)[]\n     */\n    function canBatchContracts() external view returns (Batch[] memory) {\n        uint256 contractsLength = contracts.length;\n        Batch[] memory batch = new Batch[](contractsLength);\n        for (uint256 i; i < contractsLength; ) {\n            bool canBatch = IStaking(contracts[i]).canBatchTransactions();\n            batch[i] = Batch(contracts[i], canBatch);\n            unchecked {\n                ++i;\n            }\n        }\n        return batch;\n    }\n\n    /**\n        @notice shows if contracts can batch by index\n        @return (address, bool)\n     */\n    function canBatchContractByIndex(uint256 _index)\n        external\n        view\n        returns (address, bool)\n    {\n        return (\n            contracts[_index],\n            IStaking(contracts[_index]).canBatchTransactions()\n        );\n    }\n\n    /**\n        @notice get address in contracts by index\n        @return address\n     */\n    function getAddressByIndex(uint256 _index) external view returns (address) {\n        return contracts[_index];\n    }\n\n    /**\n        @notice get addresses in contracts\n        @return address[]\n     */\n    function getAddresses() external view returns (address[] memory) {\n        return contracts;\n    }\n\n    /**\n        @notice add address to contracts array\n        @param _address - address to add\n     */\n    function addAddress(address _address) external onlyOwner {\n        contracts.push(_address);\n    }\n\n    /**\n        @notice remove address to contracts array\n        @param _address - address to remove\n     */\n    function removeAddress(address _address) external onlyOwner {\n        uint256 contractsLength = contracts.length;\n        for (uint256 i; i < contractsLength; ) {\n            if (contracts[i] == _address) {\n                delete contracts[i];\n            }\n            unchecked {\n                ++i;\n            }\n        }\n    }\n}"
    }
  ]
}