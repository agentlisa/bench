{
  "Title": "M-3: Vulnerable GovernorVotesQuorumFraction version",
  "Content": "# Issue M-3: Vulnerable GovernorVotesQuorumFraction version \n\nSource: https://github.com/sherlock-audit/2023-01-uxd-judging/issues/423 \n\n## Found by \nctf\\_sec, HonorLt\n\n## Summary\nThe protocol uses an OZ version of contracts that contain a known vulnerability in government contracts.\n\n## Vulnerability Detail\n```UXDGovernor``` contract inherits from ```GovernorVotesQuorumFraction```:\n```solidity\n contract UXDGovernor is\n    ReentrancyGuard,\n    Governor,\n    GovernorVotes,\n    GovernorVotesQuorumFraction,\n    GovernorTimelockControl,\n    GovernorCountingSimple,\n    GovernorSettings\n```\nAn OZ security recommendation has revealed a known vulnerability in this contract: https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-xrc4-737v-9q75\n\nIt was patched in version _4.7.2_, but this protocol uses an older version:\n  _\"@openzeppelin/contracts\": \"^4.6.0\"_\n\n## Impact\nThe potential impact is described in the OZ advisory.\nThis issue was assigned with a severity of High from OZ, so I am sticking with it in this submission.\n\n## Code Snippet\n\nhttps://github.com/sherlock-audit/2023-01-uxd/blob/main/contracts/governance/UXDGovernor.sol#L37\n\n## Tool used\n\nManual Review\n\n## Recommendation\nUpdate the OZ version of contracts to version >=_4.7.2_ or at least follow the workarounds of OZ if not possible otherwise.\n\n## Discussion\n\n**WarTech9**\n\nThis was already fixed here: https://github.com/UXDProtocol/uxd-evm/commit/dcaa0e857111f3f7946ee5c5a188dbb23ca80859\n\n**hrishibhat**\n\nThis requires certain scenario where the previous quorum should have failed & the quorum fraction has to be changed post which this issue could be valid. \nConsidering this issue a valid medium. \n\n\n\n",
  "Impact": "MEDIUM",
  "Source": "https://app.sherlock.xyz/audits/contests/33",
  "Code": [
    {
      "filename": "contracts/governance/UXDGovernor.sol",
      "content": "// SPDX-License-Identifier: BUSL-1.1\npragma solidity ^0.8.17;\n\nimport {ReentrancyGuard} from \"@openzeppelin/contracts/security/ReentrancyGuard.sol\";\nimport {IGovernor, Governor} from \"@openzeppelin/contracts/governance/Governor.sol\";\nimport {IVotes, GovernorVotes} from \"@openzeppelin/contracts/governance/extensions/GovernorVotes.sol\";\nimport {GovernorVotesQuorumFraction} from \"@openzeppelin/contracts/governance/extensions/GovernorVotesQuorumFraction.sol\";\nimport {GovernorSettings} from \"@openzeppelin/contracts/governance/extensions/GovernorSettings.sol\";\nimport {TimelockController, GovernorTimelockControl} from \"@openzeppelin/contracts/governance/extensions/GovernorTimelockControl.sol\";\nimport {GovernorCountingSimple} from \"@openzeppelin/contracts/governance/extensions/GovernorCountingSimple.sol\";\nimport {IERC20} from \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\n\nstruct GovernorParams {\n    uint256 votingDelay;\n    uint256 votingPeriod;\n    uint256 proposalThreshold;\n    uint256 quorumFraction;\n}\n\n/// @title UXDGoverner\n/// @notice Provides governance for the UXD protocol.\n/// @dev UXDGovernor is an implementation of the OpenZeppelin Governor system.\n/// The following modules in the OpenZeppelin governor system are used:\n/// - Governor: The governance executor that manages and executes governance proposals.\n/// - GovernorVotes: For extracting votes out of on ERC20Votes token (UXP).\n/// - GovernorVotesQuorumFraction: Sets the quorum as a fraction of total token supply.\n/// - GovernorTimelockControl: Controls the delay between a proposal passing and being executed.\n/// - GovernorCountingSimple: Provides simple rules for counting votes.\n/// - GovernorSettings: Allows for changing the voting delay, voting period, and proposal threshold.\n/// The order of specifying the base contracts matters as overridden methods are called\n/// based on C3 linearization:\n/// https://docs.soliditylang.org/en/v0.8.13/contracts.html#multiple-inheritance-and-linearization\ncontract UXDGovernor is\n    ReentrancyGuard,\n    Governor,\n    GovernorVotes,\n    GovernorVotesQuorumFraction,\n    GovernorTimelockControl,\n    GovernorCountingSimple,\n    GovernorSettings\n{\n    ///         Errors\n    error GovERC20ApprovalFailed(address token, address to, uint256 amount);\n    error GovERC20TransferFailed(address token, address to, uint256 amount);\n\n    constructor(IVotes _token, TimelockController _timelock, GovernorParams memory _params)\n        Governor(\"UXDGovernor\")\n        GovernorVotes(_token)\n        GovernorSettings(_params.votingDelay, _params.votingPeriod, _params.proposalThreshold)\n        GovernorVotesQuorumFraction(_params.quorumFraction)\n        GovernorTimelockControl(_timelock)\n    {}\n\n    ///////////////////////////////////////////////////////////////////\n    ///                 GovernorSettings\n    ///////////////////////////////////////////////////////////////////\n    /// @notice The delay between proposal creation and when voting starts.\n    /// @dev Delay, in number of block, between the proposal is created and the vote starts.\n    /// This can be increased to leave time for users to buy voting power, or delegate it,\n    /// before the voting of a proposal starts.\n    /// @return votingDelay in number of blocks between proposal creation and voting start.\n    function votingDelay()\n        public\n        view\n        override(IGovernor, GovernorSettings)\n        returns (uint256)\n    {\n        return super.votingDelay();\n    }\n\n    // /// @notice The length of time users can vote on a proposal.\n    // /// @dev The number of blocks betwen vote start and vote end.\n    // /// @return votingPeriod The number of blocks between vote start and end.\n    function votingPeriod()\n        public\n        view\n        override(IGovernor, GovernorSettings)\n        returns (uint256)\n    {\n        return super.votingPeriod();\n    }\n\n    /// @notice The number of votes required to become a proposer.\n    /// @return threshold The number of votes required.\n    function proposalThreshold()\n        public\n        view\n        override(Governor, GovernorSettings)\n        returns (uint256)\n    {\n        return super.proposalThreshold();\n    }\n\n    // The functions below are overrides required by Solidity.\n\n    /// @notice Returns the current state of a proposal\n    /// @dev  State possiblities are:\n    /// See {IGovernor-ProposalState} for the list of states\n    /// @param proposalId the ID of proposal to check.\n    /// @return state the current state of the proposal\n    function state(uint256 proposalId)\n        public\n        view\n        override(Governor, GovernorTimelockControl)\n        returns (ProposalState)\n    {\n        return super.state(proposalId);\n    }\n\n    function _execute(\n        uint256 proposalId,\n        address[] memory targets,\n        uint256[] memory values,\n        bytes[] memory calldatas,\n        bytes32 descriptionHash\n    ) internal override(Governor, GovernorTimelockControl) {\n        super._execute(proposalId, targets, values, calldatas, descriptionHash);\n    }\n\n    function _cancel(\n        address[] memory targets,\n        uint256[] memory values,\n        bytes[] memory calldatas,\n        bytes32 descriptionHash\n    ) internal override(Governor, GovernorTimelockControl) returns (uint256) {\n        return super._cancel(targets, values, calldatas, descriptionHash);\n    }\n\n    function _executor()\n        internal\n        virtual\n        view\n        override(Governor, GovernorTimelockControl)\n        returns (address)\n    {\n        return super._executor();\n    }\n\n    //////////////////////////////////////////////////////////////////////\n    ///                 GovernorCountingSimple\n    //////////////////////////////////////////////////////////////////////\n\n    /**\n     * @dev See {IGovernor-COUNTING_MODE}.\n     */\n    // solhint-disable-next-line func-name-mixedcase\n    function COUNTING_MODE()\n        public\n        pure\n        virtual\n        override(IGovernor, GovernorCountingSimple)\n        returns (string memory)\n    {\n        return super.COUNTING_MODE();\n    }\n\n    /**\n     * @dev See {IGovernor-hasVoted}.\n     */\n    function hasVoted(uint256 proposalId, address account)\n        public\n        view\n        virtual\n        override(IGovernor, GovernorCountingSimple)\n        returns (bool)\n    {\n        return super.hasVoted(proposalId, account);\n    }\n\n    /// @notice Explain to an end user what this does\n    /// @dev EIP-165 support https://github.com/ethereum/EIPs/issues/165\n    /// this lets callers check if a given interface is supported\n    /// @param interfaceId The id to check for\n    /// @return true if the interfaceId is supported\n    function supportsInterface(bytes4 interfaceId)\n        public\n        view\n        override(Governor, GovernorTimelockControl)\n        returns (bool)\n    {\n        return super.supportsInterface(interfaceId);\n    }\n\n    /////////////////////////////////////////////////////////////\n    ///                 Value transfers\n    /////////////////////////////////////////////////////////////\n\n    /// @notice Approve the transfer of an ERC20 token out of this contract.\n    /// @dev Can only be called by governance.\n    /// @param token The ERC20 token address.\n    /// @param spender The address allowed to spend.\n    /// @param amount The amount to transfer.\n    function approveERC20(\n        address token,\n        address spender,\n        uint256 amount\n    ) external onlyGovernance {\n        if (!(IERC20(token).approve(spender, amount))) {\n            revert GovERC20ApprovalFailed(token, spender, amount);\n        }\n    }\n\n    /// @notice Transfer ERC20 tokens out of this contract\n    /// @dev Can only be called by governance.\n    /// @param token The ERC20 token address.\n    /// @param to The address to transfer token to\n    /// @param amount The amount to transfer\n    function transferERC20(\n        address token,\n        address to,\n        uint256 amount\n    ) external onlyGovernance nonReentrant {\n        if (!(IERC20(token).transfer(to, amount))) {\n            revert GovERC20TransferFailed(token, to, amount);\n        }\n    }\n}"
    }
  ]
}