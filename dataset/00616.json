{
  "Title": "World Resource ID ROOT String Has Unexpected Length",
  "Content": "The `WorldResourceIdInstance` library has helper functions to get information from an encoded `World` resource ID such as type, namespace and name. These fields can also be returned as a string using the `toString` function.\n\n\nHowever, while the resource namespace is [expected to occupy 14 bytes](https://github.com/latticexyz/mud/blob/12a9eb1afb18a7f7cb43d774cabb2d5af7c74e6b/packages/world/src/WorldResourceId.sol#L10), the [`ROOT_NAMESPACE_STRING`](https://github.com/latticexyz/mud/blob/12a9eb1afb18a7f7cb43d774cabb2d5af7c74e6b/packages/world/src/WorldResourceId.sol#L13) is actually a `bytes16` value. The string output could, therefore, have an unexpected length.\n\n\nConsider changing the constant's type from `bytes16` to `bytes14`.\n\n\n***Update:** Resolved in [pull request #1976](https://github.com/latticexyz/mud/pull/1976).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/world/src/WorldResourceId.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity >=0.8.21;\n\nimport { Bytes } from \"@latticexyz/store/src/Bytes.sol\";\nimport { ResourceId, ResourceIdInstance, TYPE_BITS } from \"@latticexyz/store/src/ResourceId.sol\";\n\nimport { ROOT_NAMESPACE, ROOT_NAME } from \"./constants.sol\";\nimport { RESOURCE_NAMESPACE, MASK_RESOURCE_NAMESPACE } from \"./worldResourceTypes.sol\";\n\nuint256 constant NAMESPACE_BITS = 14 * 8;\nuint256 constant NAME_BITS = 16 * 8;\n\nbytes16 constant ROOT_NAMESPACE_STRING = bytes16(\"ROOT_NAMESPACE\");\nbytes16 constant ROOT_NAME_STRING = bytes16(\"ROOT_NAME\");\n\nbytes32 constant NAMESPACE_MASK = bytes32(~bytes14(\"\")) >> (TYPE_BITS);\n\n/**\n * @title WorldResourceIdLib\n * @notice A library for handling World Resource ID encoding and decoding.\n */\nlibrary WorldResourceIdLib {\n  /**\n   * @notice Encode a resource ID.\n   * @param typeId The resource type ID.\n   * @param namespace The namespace of the resource.\n   * @param name The name of the resource.\n   * @return A 32-byte resource ID.\n   */\n  function encode(bytes2 typeId, bytes14 namespace, bytes16 name) internal pure returns (ResourceId) {\n    return\n      ResourceId.wrap(\n        bytes32(typeId) | (bytes32(namespace) >> TYPE_BITS) | (bytes32(name) >> (TYPE_BITS + NAMESPACE_BITS))\n      );\n  }\n\n  /**\n   * @notice Encode a namespace to resource ID.\n   * @param namespace The namespace to be encoded.\n   * @return A 32-byte resource ID with the namespace encoded.\n   */\n  function encodeNamespace(bytes14 namespace) internal pure returns (ResourceId) {\n    return ResourceId.wrap(bytes32(RESOURCE_NAMESPACE) | (bytes32(namespace) >> (TYPE_BITS)));\n  }\n\n  /**\n   * @notice Convert a padded string to a trimmed string.\n   * @param paddedString The input string with potential padding.\n   * @return A string without trailing null ASCII characters.\n   */\n  function toTrimmedString(bytes16 paddedString) internal pure returns (string memory) {\n    uint256 length;\n    for (; length < 16; length++) if (Bytes.slice1(paddedString, length) == 0) break;\n    bytes memory packedSelector = abi.encodePacked(paddedString);\n    return string(Bytes.setLength(packedSelector, length));\n  }\n}\n\n/**\n * @title WorldResourceIdInstance\n * @notice A library for handling instances of World Resource IDs.\n */\nlibrary WorldResourceIdInstance {\n  /**\n   * @notice Get the namespace from a resource ID.\n   * @param resourceId The resource ID.\n   * @return A 14-byte namespace.\n   */\n  function getNamespace(ResourceId resourceId) internal pure returns (bytes14) {\n    return bytes14(ResourceId.unwrap(resourceId) << (TYPE_BITS));\n  }\n\n  /**\n   * @notice Get the namespace ID from a resource ID.\n   * @param resourceId The resource ID.\n   * @return A 32-byte namespace resource ID.\n   */\n  function getNamespaceId(ResourceId resourceId) internal pure returns (ResourceId) {\n    return ResourceId.wrap((ResourceId.unwrap(resourceId) & NAMESPACE_MASK) | MASK_RESOURCE_NAMESPACE);\n  }\n\n  /**\n   * @notice Get the name from a resource ID.\n   * @param resourceId The resource ID.\n   * @return A 16-byte name.\n   */\n  function getName(ResourceId resourceId) internal pure returns (bytes16) {\n    return bytes16(ResourceId.unwrap(resourceId) << (TYPE_BITS + NAMESPACE_BITS));\n  }\n\n  /**\n   * @notice Convert a resource ID to a string.\n   * @param resourceId The resource ID.\n   * @return A string representation of the resource ID.\n   */\n  function toString(ResourceId resourceId) internal pure returns (string memory) {\n    bytes2 resourceType = ResourceIdInstance.getType(resourceId);\n    bytes14 resourceNamespace = getNamespace(resourceId);\n    bytes16 resourceName = getName(resourceId);\n    return\n      string(\n        abi.encodePacked(\n          resourceType,\n          \":\",\n          resourceNamespace == ROOT_NAMESPACE ? ROOT_NAMESPACE_STRING : resourceNamespace,\n          \":\",\n          resourceName == ROOT_NAME ? ROOT_NAME_STRING : resourceName\n        )\n      );\n  }\n}"
    }
  ]
}