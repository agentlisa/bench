{
  "Title": "Resetting of `withdrawSeasons` state was not executed on-chain as part of the BIP-36 upgrade",
  "Content": "The [addition](https://github.com/BeanstalkFarms/Beanstalk/blob/12c608a22535e3a1fe379db1153185fe43851ea7/protocol/contracts/beanstalk/init/InitBipNewSilo.sol#L42-L43) of `s.season.withdrawSeasons = 0` to `InitBipNewSilo::init` does not appear to have been present in the [version](https://etherscan.io/address/0xf6c77e64473b913101f0ec1bfb75a386aba15b9e#code) executed as part of the BIP-36 upgrade. Therefore, to have the state of Beanstalk accurately reflect this change, another upgrade should be performed to have this logic executed on-chain.\n\n**Beanstalk Farms:** Fixed in commit [cca6250](https://github.com/BeanstalkFarms/Beanstalk/pull/655/commits/cca625052179764c930be707a68a43952ec54ddf).\n\n**Cyfrin:** Acknowledged.",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "protocol/contracts/beanstalk/init/InitBipNewSilo.sol",
      "content": "/*\n SPDX-License-Identifier: MIT\n*/\n\npragma solidity =0.7.6;\npragma experimental ABIEncoderV2;\n\nimport {IBean} from \"../../interfaces/IBean.sol\";\nimport {AppStorage} from \"../AppStorage.sol\";\nimport \"contracts/C.sol\";\nimport {IERC1155} from \"@openzeppelin/contracts/token/ERC1155/IERC1155.sol\";\nimport {LibDiamond} from \"contracts/libraries/LibDiamond.sol\";\nimport {LibWhitelist} from \"contracts/libraries/Silo/LibWhitelist.sol\";\n\n\n/**\n * @author Publius\n * @title InitBipNewSilo runs the code for the silo update.\n**/\n\ncontract InitBipNewSilo {\n\n    AppStorage internal s;\n\n    uint32 constant private BEAN_SEEDS_PER_BDV = 2e6;\n    uint32 constant private BEAN_3CRV_SEEDS_PER_BDV = 4e6;\n    uint32 constant private UNRIPE_BEAN_SEEDS_PER_BDV = 0;\n    uint32 constant private UNRIPE_BEAN_3CRV_SEEDS_PER_BDV = 0;\n    \n    uint32 constant private STALK_ISSUED_PER_BDV = 10000;\n    \n    \n    function init() external {\n        LibDiamond.DiamondStorage storage ds = LibDiamond.diamondStorage();\n        \n        // this adds the ERC1155 indentifier to the diamond:\n        ds.supportedInterfaces[type(IERC1155).interfaceId] = true;\n\n        // Clear the storage variable\n        delete s.s.deprecated_seeds;\n\n        // set the withdrawTimer to 0: \n        s.season.withdrawSeasons = 0;\n\n        //update all silo info for current Silo-able assets\n\n        uint32 currentSeason = s.season.current;\n\n        s.ss[C.BEAN].stalkEarnedPerSeason = BEAN_SEEDS_PER_BDV;\n        s.ss[C.BEAN].stalkIssuedPerBdv = STALK_ISSUED_PER_BDV;\n        s.ss[C.BEAN].milestoneSeason = currentSeason;\n        s.ss[C.BEAN].milestoneStem = 0;\n\n\n        s.ss[C.CURVE_BEAN_METAPOOL].stalkEarnedPerSeason = BEAN_3CRV_SEEDS_PER_BDV;\n        s.ss[C.CURVE_BEAN_METAPOOL].stalkIssuedPerBdv = STALK_ISSUED_PER_BDV;\n        s.ss[C.CURVE_BEAN_METAPOOL].milestoneSeason = currentSeason;\n        s.ss[C.CURVE_BEAN_METAPOOL].milestoneStem = 0;\n\n\n        s.ss[C.UNRIPE_BEAN].stalkEarnedPerSeason = UNRIPE_BEAN_SEEDS_PER_BDV;\n        s.ss[C.UNRIPE_BEAN].stalkIssuedPerBdv = STALK_ISSUED_PER_BDV;\n        s.ss[C.UNRIPE_BEAN].milestoneSeason = currentSeason;\n        s.ss[C.UNRIPE_BEAN].milestoneStem = 0;\n\n\n        s.ss[address(C.unripeLP())].stalkEarnedPerSeason = UNRIPE_BEAN_3CRV_SEEDS_PER_BDV;\n        s.ss[address(C.unripeLP())].stalkIssuedPerBdv = STALK_ISSUED_PER_BDV;\n        s.ss[address(C.unripeLP())].milestoneSeason = currentSeason;\n        s.ss[address(C.unripeLP())].milestoneStem = 0;\n\n        //emit event for unripe LP/Beans from 4 to 1 grown stalk per bdv per season\n        emit LibWhitelist.UpdatedStalkPerBdvPerSeason(address(C.unripeLP()), UNRIPE_BEAN_3CRV_SEEDS_PER_BDV, s.season.current);\n        emit LibWhitelist.UpdatedStalkPerBdvPerSeason(address(C.unripeBean()), UNRIPE_BEAN_SEEDS_PER_BDV, s.season.current);\n\n        //set the stemStartSeason to the current season\n        s.season.stemStartSeason = uint16(currentSeason); //storing as uint16 to save storage space\n    }\n}"
    }
  ]
}