{
  "Title": "[M01] Owner can overrule pauser actions",
  "Content": "The [`HoldefiPauser` contract](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/HoldefiPauser.sol) implements the functionality to pause specific functions at will in case a problem appears in the platform. The only accounts that can perform such task [are the `owner` and the `pauser` accounts](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/HoldefiPauser.sol#L29).\n\n\nNevertheless, [the time-off period](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/HoldefiPauser.sol#L21) that the pause event has to achieve is modifiable only by the owner by calling [the `setPauseDuration` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/HoldefiPauser.sol#L86) and if the owner decides to suppress the duration by setting it as zero, [the `isPause` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/HoldefiPauser.sol#L45) will always return `true`, no matter what the pauser account does.\n\n\nConsider setting a minimum duration for the time-off period to prevent that the pauser account loses its powers.\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/HoldefiPauser.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\nimport \"./Ownable.sol\";\r\n\r\n// Taking ideas from Open Zeppelin's Pausable contract\r\ncontract HoldefiPauser is Ownable {    \r\n    address public pauser;\r\n\r\n     // '0' -> supply\r\n     // '1' -> withdrawSupply\r\n     // '2' -> collatralize\r\n     // '3' -> withdrawCollateral\r\n     // '4' -> borrow\r\n     // '5' -> repayBorrrow\r\n     // '6' -> liquidateBorrowerCollateral\r\n     // '7' -> buyLiquidatedCollateral\r\n    \r\n    uint constant functionsNum = 8;\r\n    uint[8] public paused;\r\n\r\n    uint public pauseDuration = 2592000;\r\n\r\n     \r\n    constructor (address newOwnerChanger) Ownable(newOwnerChanger) public {\r\n    }\r\n\r\n    // Modifier to make a function callable only by owner or pauser   \r\n    modifier onlyPausers() {\r\n        require(msg.sender == owner || msg.sender == pauser , 'Sender should be Owner or Pauser');\r\n        _;\r\n    }\r\n    \r\n    // Modifier to make a function callable only when a functions is not paused.\r\n    modifier whenNotPaused(uint index) {\r\n        require(!isPause(index), \"Pausable: paused\");\r\n        _;\r\n    }\r\n\r\n    // Modifier to make a function callable only when a functions is paused.\r\n    modifier whenPaused(uint index) {\r\n        require(isPause(index), \"Pausable: not paused\");\r\n        _;\r\n    }\r\n\r\n    function isPause(uint index) public view returns(bool res) {\r\n        if (block.timestamp - paused[index] >= pauseDuration) {\r\n            res = false;\r\n        }\r\n        else {\r\n            res = true;\r\n        }\r\n    }\r\n    \r\n    // Called by pausers to pause, triggers stopped state.\r\n    function pause(uint index) public onlyPausers {\r\n        paused[index] = block.timestamp;\r\n    }\r\n\r\n    // Called by owner to unpause, returns to normal state.\r\n    function unpause(uint index) public onlyOwner {\r\n        paused[index] = 0;\r\n    }\r\n\r\n    // Called by pausers to pause, triggers stopped state for selected functions\r\n    function batchPause(bool[8] memory newPaused) public onlyPausers {\r\n        for (uint i=0; i<functionsNum; i++) {\r\n            if (newPaused[i] == true){\r\n                pause(i);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Called by pausers to pause, returns to normal state for selected functions\r\n    function batchUnpause(bool[8] memory newUnpaused) public onlyOwner {\r\n        for (uint i=0; i<functionsNum; i++) {\r\n            if (newUnpaused[i] == true){\r\n                unpause(i);\r\n            }\r\n        }\r\n    }\r\n    // Called by owner to set a new pauser\r\n    function setPauser(address newPauser) external onlyOwner {\r\n        pauser = newPauser;\r\n    }\r\n\r\n    function setPauseDuration(uint newPauseDuration) external onlyOwner {\r\n        pauseDuration = newPauseDuration;\r\n    }\r\n}"
    }
  ]
}