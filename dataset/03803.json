{
  "Title": "[M03] Anyone can set the Holdefi contractâ€™s address in the CollateralsWallet contract",
  "Content": "The [`CollateralsWallet` contract](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol) is in charge of letting the [`Holdefi` contract](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/Holdefi.sol) to withdraw a collateral asset if needed through the [`withdraw` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol#L20). For this, the [`holdefiContract` storage variable](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol#L11) must be set first through the [`setHoldefiContract` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol#L14), which is independent from the `CollateralsWallet` contract creation.\n\n\nThe problem resides in the fact that the [`setHoldefiContract` function](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol#L14) does not have any restriction and can be called by any address and, thus, the [`holdefiContract` storage value](https://github.com/holdefi/Holdefi/blob/f4df394d7cf6df347b1f1e9af8e2676c5933c2c9/contracts/CollateralsWallet.sol#L11) can be set by any external actor right after the contract creation, and will be able to call the `withdraw` function afterwards and steal the tokens held by the `CollateralsWallet` contract in any ERC20 contract, if there are any in the first place.\n\n\nConsider setting the `holdefiContract` storage variable on the contract creation instead of setting it in a separate function, or consider using the `Ownable` contract for setting an owner of the `CollateralsWallet` contract so the `setHoldefiContract` can only be called by a trusted actor.\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/CollateralsWallet.sol",
      "content": "pragma solidity ^0.5.16;\r\n\r\ninterface ERC20 {\r\n\r\n    function transfer(address recipient, uint256 amount) external returns (bool);\r\n}\r\n\r\n// This contract holds collateralls\r\ncontract CollateralsWallet {\r\n\r\n\taddress public holdefiContract;\r\n\r\n\t// Disposable function to Get in touch with Holdefi contract\r\n\tfunction setHoldefiContract(address holdefiContractAddress) external {\r\n\t\trequire (holdefiContract == address(0),'Should be set once');\r\n\t\tholdefiContract = holdefiContractAddress;\r\n\t}\r\n\t\r\n\t// Holdefi contract withdraws collateral's tokens from this contract to caller's account\r\n\tfunction withdraw (address collateralAsset, address payable recipient, uint amount) external {\r\n\t\trequire (msg.sender == holdefiContract,'Sender should be holdefi contract');\r\n\t\t\r\n\t\tif (collateralAsset == address(0)){\r\n\t\t\trecipient.transfer(amount);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tERC20 token = ERC20(collateralAsset);\r\n\t\t\tbool success = token.transfer(recipient, amount);\r\n\t\t\trequire (success, 'Cannot Transfer Token');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction () payable external {\r\n\t\trequire (msg.sender == holdefiContract,'Sender should be holdefi contract');\r\n\t}\r\n}"
    }
  ]
}