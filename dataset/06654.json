{
  "Title": "[G-05] Avoid emitting storage values",
  "Content": "Caching of a state variable replaces each `Gwarmaccess (100 gas)` with a much cheaper stack read. We can avoid unecessary SLOADs by caching storage values that were previously accessed and emitting those cached values.\n\nhttps://github.com/code-423n4/2023-05-ajna/blob/main/ajna-grants/src/grants/GrantFund.sol#L58-L64\n\n### Cache expression and emit cached value instead of reading from storage\n```solidity\nFile: ajna-grants/src/grants/GrantFund.sol\n58:    function fundTreasury(uint256 fundingAmount_) external override {\n59:        IERC20 token = IERC20(ajnaTokenAddress);\n60:        // update treasury accounting\n61:        treasury += fundingAmount_;\n62:        emit FundTreasury(fundingAmount_, treasury); // @audit: emit expression\n```\n```diff\ndiff --git a/src/grants/GrantFund.sol b/src/grants/GrantFund.sol\nindex 3d568b0..fb9f369 100644\n--- a/src/grants/GrantFund.sol\n+++ b/src/grants/GrantFund.sol\n@@ -59,12 +59,14 @@ contract GrantFund is IGrantFund, ExtraordinaryFunding, StandardFunding {\n         IERC20 token = IERC20(ajnaTokenAddress);\n\n         // update treasury accounting\n-        treasury += fundingAmount_;\n+        uint256 _newTreasury = treasury + fundingAmount_;\n+        treasury = _newTreasury;\n\n-        emit FundTreasury(fundingAmount_, treasury);\n+        emit FundTreasury(fundingAmount_, _newTreasury);\n\n         // transfer ajna tokens to the treasury\n         token.safeTransferFrom(msg.sender, address(this), fundingAmount_);\n     }\n\n }\n```\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/reports/2023-05-ajna",
  "Code": [
    {
      "filename": "ajna-grants/src/grants/GrantFund.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity 0.8.16;\n\nimport { IERC20 }    from \"@oz/token/ERC20/IERC20.sol\";\nimport { SafeERC20 } from \"@oz/token/ERC20/utils/SafeERC20.sol\";\n\nimport { ExtraordinaryFunding } from \"./base/ExtraordinaryFunding.sol\";\nimport { StandardFunding }      from \"./base/StandardFunding.sol\";\n\nimport { IGrantFund } from \"./interfaces/IGrantFund.sol\";\n\ncontract GrantFund is IGrantFund, ExtraordinaryFunding, StandardFunding {\n\n    using SafeERC20 for IERC20;\n\n    /**************************/\n    /*** Proposal Functions ***/\n    /**************************/\n\n    /// @inheritdoc IGrantFund\n    function hashProposal(\n        address[] memory targets_,\n        uint256[] memory values_,\n        bytes[] memory calldatas_,\n        bytes32 descriptionHash_\n    ) external pure override returns (uint256 proposalId_) {\n        proposalId_ = _hashProposal(targets_, values_, calldatas_, descriptionHash_);\n    }\n\n    /**\n     * @notice Given a proposalId, find if it is a standard or extraordinary proposal.\n     * @param proposalId_ The id of the proposal to query the mechanism of.\n     * @return FundingMechanism to which the proposal was submitted.\n     */\n    function findMechanismOfProposal(\n        uint256 proposalId_\n    ) public view returns (FundingMechanism) {\n        if (_standardFundingProposals[proposalId_].proposalId != 0)           return FundingMechanism.Standard;\n        else if (_extraordinaryFundingProposals[proposalId_].proposalId != 0) return FundingMechanism.Extraordinary;\n        else revert ProposalNotFound();\n    }\n\n    /// @inheritdoc IGrantFund\n    function state(\n        uint256 proposalId_\n    ) external view override returns (ProposalState) {\n        FundingMechanism mechanism = findMechanismOfProposal(proposalId_);\n\n        return mechanism == FundingMechanism.Standard ? _standardProposalState(proposalId_) : _getExtraordinaryProposalState(proposalId_);\n    }\n\n    /**************************/\n    /*** Treasury Functions ***/\n    /**************************/\n\n    /// @inheritdoc IGrantFund\n    function fundTreasury(uint256 fundingAmount_) external override {\n        IERC20 token = IERC20(ajnaTokenAddress);\n\n        // update treasury accounting\n        treasury += fundingAmount_;\n\n        emit FundTreasury(fundingAmount_, treasury);\n\n        // transfer ajna tokens to the treasury\n        token.safeTransferFrom(msg.sender, address(this), fundingAmount_);\n    }\n\n}"
    }
  ]
}