{
  "Title": "[N-02] Typos",
  "Content": "\n1.  File: contracts/NFTLoanFacilitator.sol (line [303](https://github.com/code-423n4/2022-04-backed/blob/e8015d7c4b295af131f017e646ba1b99c8f608f0/contracts/NFTLoanFacilitator.sol#L303))\n\n```solidity\n* @notice Updates originationFeeRate the faciliator keeps of each loan amount\n```\n\nfaciliator\n\n2.  File: contracts/interfaces/INFTLoanFacilitator.sol (line [65](https://github.com/code-423n4/2022-04-backed/blob/e8015d7c4b295af131f017e646ba1b99c8f608f0/contracts/interfaces/INFTLoanFacilitator.sol#L65))\n\n```solidity\n* @param minLoanAmount mimimum loan amount\n```\n\nmimimum\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2022-04-backed",
  "Code": [
    {
      "filename": "contracts/NFTLoanFacilitator.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-only\npragma solidity 0.8.12;\n\nimport {IERC721} from \"@openzeppelin/contracts/token/ERC721/IERC721.sol\";\nimport {SafeTransferLib, ERC20} from \"@rari-capital/solmate/src/utils/SafeTransferLib.sol\";\nimport {Ownable} from \"@openzeppelin/contracts/access/Ownable.sol\";\n\nimport {INFTLoanFacilitator} from './interfaces/INFTLoanFacilitator.sol';\nimport {IERC721Mintable} from './interfaces/IERC721Mintable.sol';\nimport {ILendTicket} from './interfaces/ILendTicket.sol';\n\ncontract NFTLoanFacilitator is Ownable, INFTLoanFacilitator {\n    using SafeTransferLib for ERC20;\n\n    // ==== constants ====\n\n    /** \n     * See {INFTLoanFacilitator-INTEREST_RATE_DECIMALS}.     \n     * @dev lowest non-zero APR possible = (1/10^3) = 0.001 = 0.1%\n     */\n    uint8 public constant override INTEREST_RATE_DECIMALS = 3;\n\n    /// See {INFTLoanFacilitator-SCALAR}.\n    uint256 public constant override SCALAR = 10 ** INTEREST_RATE_DECIMALS;\n\n    \n    // ==== state variables ====\n\n    /// See {INFTLoanFacilitator-originationFeeRate}.\n    /// @dev starts at 1%\n    uint256 public override originationFeeRate = 10 ** (INTEREST_RATE_DECIMALS - 2);\n\n    /// See {INFTLoanFacilitator-requiredImprovementRate}.\n    /// @dev starts at 10%\n    uint256 public override requiredImprovementRate = 10 ** (INTEREST_RATE_DECIMALS - 1);\n\n    /// See {INFTLoanFacilitator-lendTicketContract}.\n    address public override lendTicketContract;\n\n    /// See {INFTLoanFacilitator-borrowTicketContract}.\n    address public override borrowTicketContract;\n\n    /// See {INFTLoanFacilitator-loanInfo}.\n    mapping(uint256 => Loan) public loanInfo;\n\n    /// @dev tracks loan count\n    uint256 private _nonce = 1;\n\n    \n    // ==== modifiers ====\n\n    modifier notClosed(uint256 loanId) { \n        require(!loanInfo[loanId].closed, \"NFTLoanFacilitator: loan closed\");\n        _; \n    }\n\n\n    // ==== constructor ====\n\n    constructor(address _manager) {\n        transferOwnership(_manager);\n    }\n\n    \n    // ==== state changing external functions ====\n\n    /// See {INFTLoanFacilitator-createLoan}.\n    function createLoan(\n        uint256 collateralTokenId,\n        address collateralContractAddress,\n        uint16 maxPerAnumInterest,\n        uint128 minLoanAmount,\n        address loanAssetContractAddress,\n        uint32 minDurationSeconds,\n        address mintBorrowTicketTo\n    )\n        external\n        override\n        returns (uint256 id) \n    {\n        require(minDurationSeconds != 0, 'NFTLoanFacilitator: 0 duration');\n        require(minLoanAmount != 0, 'NFTLoanFacilitator: 0 loan amount');\n        require(collateralContractAddress != lendTicketContract,\n        'NFTLoanFacilitator: cannot use tickets as collateral');\n        require(collateralContractAddress != borrowTicketContract, \n        'NFTLoanFacilitator: cannot use tickets as collateral');\n        \n        IERC721(collateralContractAddress).transferFrom(msg.sender, address(this), collateralTokenId);\n\n        unchecked {\n            id = _nonce++;\n        }\n\n        Loan storage loan = loanInfo[id];\n        loan.loanAssetContractAddress = loanAssetContractAddress;\n        loan.loanAmount = minLoanAmount;\n        loan.collateralTokenId = collateralTokenId;\n        loan.collateralContractAddress = collateralContractAddress;\n        loan.perAnumInterestRate = maxPerAnumInterest;\n        loan.durationSeconds = minDurationSeconds;\n        \n        IERC721Mintable(borrowTicketContract).mint(mintBorrowTicketTo, id);\n        emit CreateLoan(\n            id,\n            msg.sender,\n            collateralTokenId,\n            collateralContractAddress,\n            maxPerAnumInterest,\n            loanAssetContractAddress,\n            minLoanAmount,\n            minDurationSeconds\n        );\n    }\n\n    /// See {INFTLoanFacilitator-closeLoan}.\n    function closeLoan(uint256 loanId, address sendCollateralTo) external override notClosed(loanId) {\n        require(IERC721(borrowTicketContract).ownerOf(loanId) == msg.sender,\n        \"NFTLoanFacilitator: borrow ticket holder only\");\n\n        Loan storage loan = loanInfo[loanId];\n        require(loan.lastAccumulatedTimestamp == 0, \"NFTLoanFacilitator: has lender, use repayAndCloseLoan\");\n        \n        loan.closed = true;\n        IERC721(loan.collateralContractAddress).transferFrom(address(this), sendCollateralTo, loan.collateralTokenId);\n        emit Close(loanId);\n    }\n\n    /// See {INFTLoanFacilitator-lend}.\n    function lend(\n        uint256 loanId,\n        uint16 interestRate,\n        uint128 amount,\n        uint32 durationSeconds,\n        address sendLendTicketTo\n    )\n        external\n        override\n        notClosed(loanId)\n    {\n        Loan storage loan = loanInfo[loanId];\n        \n        if (loan.lastAccumulatedTimestamp == 0) {\n            address loanAssetContractAddress = loan.loanAssetContractAddress;\n            require(loanAssetContractAddress != address(0), \"NFTLoanFacilitator: invalid loan\");\n\n            require(interestRate <= loan.perAnumInterestRate, 'NFTLoanFacilitator: rate too high');\n            require(durationSeconds >= loan.durationSeconds, 'NFTLoanFacilitator: duration too low');\n            require(amount >= loan.loanAmount, 'NFTLoanFacilitator: amount too low');\n        \n            loan.perAnumInterestRate = interestRate;\n            loan.lastAccumulatedTimestamp = uint40(block.timestamp);\n            loan.durationSeconds = durationSeconds;\n            loan.loanAmount = amount;\n\n            ERC20(loanAssetContractAddress).safeTransferFrom(msg.sender, address(this), amount);\n            uint256 facilitatorTake = amount * originationFeeRate / SCALAR;\n            ERC20(loanAssetContractAddress).safeTransfer(\n                IERC721(borrowTicketContract).ownerOf(loanId),\n                amount - facilitatorTake\n            );\n            IERC721Mintable(lendTicketContract).mint(sendLendTicketTo, loanId);\n        } else {\n            uint256 previousLoanAmount = loan.loanAmount;\n            // will underflow if amount < previousAmount\n            uint256 amountIncrease = amount - previousLoanAmount;\n\n            {\n                uint256 previousInterestRate = loan.perAnumInterestRate;\n                uint256 previousDurationSeconds = loan.durationSeconds;\n\n                require(interestRate <= previousInterestRate, 'NFTLoanFacilitator: rate too high');\n                require(durationSeconds >= previousDurationSeconds, 'NFTLoanFacilitator: duration too low');\n\n                require((previousLoanAmount * requiredImprovementRate / SCALAR) <= amountIncrease\n                || previousDurationSeconds + (previousDurationSeconds * requiredImprovementRate / SCALAR) <= durationSeconds \n                || (previousInterestRate != 0 // do not allow rate improvement if rate already 0\n                    && previousInterestRate - (previousInterestRate * requiredImprovementRate / SCALAR) >= interestRate), \n                \"NFTLoanFacilitator: proposed terms must be better than existing terms\");\n            }\n\n            uint256 accumulatedInterest = _interestOwed(\n                previousLoanAmount,\n                loan.lastAccumulatedTimestamp,\n                loan.perAnumInterestRate,\n                loan.accumulatedInterest\n            );\n\n            require(accumulatedInterest <= type(uint128).max,\n            \"NFTLoanFacilitator: accumulated interest exceeds uint128\");\n\n            loan.perAnumInterestRate = interestRate;\n            loan.lastAccumulatedTimestamp = uint40(block.timestamp);\n            loan.durationSeconds = durationSeconds;\n            loan.loanAmount = amount;\n            loan.accumulatedInterest = uint128(accumulatedInterest);\n\n            address currentLoanOwner = IERC721(lendTicketContract).ownerOf(loanId);\n            if (amountIncrease > 0) {\n                address loanAssetContractAddress = loan.loanAssetContractAddress;\n                ERC20(loanAssetContractAddress).safeTransferFrom(\n                    msg.sender,\n                    address(this),\n                    amount + accumulatedInterest\n                );\n                ERC20(loanAssetContractAddress).safeTransfer(\n                    currentLoanOwner,\n                    accumulatedInterest + previousLoanAmount\n                );\n                uint256 facilitatorTake = (amountIncrease * originationFeeRate / SCALAR);\n                ERC20(loanAssetContractAddress).safeTransfer(\n                    IERC721(borrowTicketContract).ownerOf(loanId),\n                    amountIncrease - facilitatorTake\n                );\n            } else {\n                ERC20(loan.loanAssetContractAddress).safeTransferFrom(\n                    msg.sender,\n                    currentLoanOwner,\n                    accumulatedInterest + previousLoanAmount\n                );\n            }\n            ILendTicket(lendTicketContract).loanFacilitatorTransfer(currentLoanOwner, sendLendTicketTo, loanId);\n            \n            emit BuyoutLender(loanId, msg.sender, currentLoanOwner, accumulatedInterest, previousLoanAmount);\n        }\n\n        emit Lend(loanId, msg.sender, interestRate, amount, durationSeconds);\n    }\n\n    /// See {INFTLoanFacilitator-repayAndCloseLoan}.\n    function repayAndCloseLoan(uint256 loanId) external override notClosed(loanId) {\n        Loan storage loan = loanInfo[loanId];\n\n        uint256 interest = _interestOwed(\n            loan.loanAmount,\n            loan.lastAccumulatedTimestamp,\n            loan.perAnumInterestRate,\n            loan.accumulatedInterest\n        );\n        address lender = IERC721(lendTicketContract).ownerOf(loanId);\n        loan.closed = true;\n        ERC20(loan.loanAssetContractAddress).safeTransferFrom(msg.sender, lender, interest + loan.loanAmount);\n        IERC721(loan.collateralContractAddress).safeTransferFrom(\n            address(this),\n            IERC721(borrowTicketContract).ownerOf(loanId),\n            loan.collateralTokenId\n        );\n\n        emit Repay(loanId, msg.sender, lender, interest, loan.loanAmount);\n        emit Close(loanId);\n    }\n\n    /// See {INFTLoanFacilitator-seizeCollateral}.\n    function seizeCollateral(uint256 loanId, address sendCollateralTo) external override notClosed(loanId) {\n        require(IERC721(lendTicketContract).ownerOf(loanId) == msg.sender, \n        \"NFTLoanFacilitator: lend ticket holder only\");\n\n        Loan storage loan = loanInfo[loanId];\n        require(block.timestamp > loan.durationSeconds + loan.lastAccumulatedTimestamp,\n        \"NFTLoanFacilitator: payment is not late\");\n\n        loan.closed = true;\n        IERC721(loan.collateralContractAddress).safeTransferFrom(\n            address(this),\n            sendCollateralTo,\n            loan.collateralTokenId\n        );\n\n        emit SeizeCollateral(loanId);\n        emit Close(loanId);\n    }\n\n    \n    // === owner state changing ===\n\n    /**\n     * @notice Sets lendTicketContract to _contract\n     * @dev cannot be set if lendTicketContract is already set\n     */\n    function setLendTicketContract(address _contract) external onlyOwner {\n        require(lendTicketContract == address(0), 'NFTLoanFacilitator: already set');\n\n        lendTicketContract = _contract;\n    }\n\n    /**\n     * @notice Sets borrowTicketContract to _contract\n     * @dev cannot be set if borrowTicketContract is already set\n     */\n    function setBorrowTicketContract(address _contract) external onlyOwner {\n        require(borrowTicketContract == address(0), 'NFTLoanFacilitator: already set');\n\n        borrowTicketContract = _contract;\n    }\n\n    /// @notice Transfers `amount` of loan origination fees for `asset` to `to`\n    function withdrawOriginationFees(address asset, uint256 amount, address to) external onlyOwner {\n        ERC20(asset).safeTransfer(to, amount);\n\n        emit WithdrawOriginationFees(asset, amount, to);\n    }\n\n    /**\n     * @notice Updates originationFeeRate the faciliator keeps of each loan amount\n     * @dev Cannot be set higher than 5%\n     */\n    function updateOriginationFeeRate(uint32 _originationFeeRate) external onlyOwner {\n        require(_originationFeeRate <= 5 * (10 ** (INTEREST_RATE_DECIMALS - 2)), \"NFTLoanFacilitator: max fee 5%\");\n        \n        originationFeeRate = _originationFeeRate;\n\n        emit UpdateOriginationFeeRate(_originationFeeRate);\n    }\n\n    /**\n     * @notice updates the percent improvement required of at least one loan term when buying out lender \n     * a loan that already has a lender. E.g. setting this value to 10 means duration or amount\n     * must be 10% higher or interest rate must be 10% lower. \n     * @dev Cannot be 0.\n     */\n    function updateRequiredImprovementRate(uint256 _improvementRate) external onlyOwner {\n        require(_improvementRate > 0, 'NFTLoanFacilitator: 0 improvement rate');\n\n        requiredImprovementRate = _improvementRate;\n\n        emit UpdateRequiredImprovementRate(_improvementRate);\n    }\n\n    \n    // ==== external view ====\n\n    /// See {INFTLoanFacilitator-loanInfoStruct}.\n    function loanInfoStruct(uint256 loanId) external view override returns (Loan memory) {\n        return loanInfo[loanId];\n    }\n\n    /// See {INFTLoanFacilitator-totalOwed}.\n    function totalOwed(uint256 loanId) external view override returns (uint256) {\n        Loan storage loan = loanInfo[loanId];\n        if (loan.closed || loan.lastAccumulatedTimestamp == 0) return 0;\n\n        return loanInfo[loanId].loanAmount + _interestOwed(\n            loan.loanAmount,\n            loan.lastAccumulatedTimestamp,\n            loan.perAnumInterestRate,\n            loan.accumulatedInterest\n        );\n    }\n\n    /// See {INFTLoanFacilitator-interestOwed}.\n    function interestOwed(uint256 loanId) external view override returns (uint256) {\n        Loan storage loan = loanInfo[loanId];\n        if(loan.closed || loan.lastAccumulatedTimestamp == 0) return 0;\n\n        return _interestOwed(\n            loan.loanAmount,\n            loan.lastAccumulatedTimestamp,\n            loan.perAnumInterestRate,\n            loan.accumulatedInterest\n        );\n    }\n\n    /// See {INFTLoanFacilitator-loanEndSeconds}.\n    function loanEndSeconds(uint256 loanId) external view override returns (uint256) {\n        Loan storage loan = loanInfo[loanId];\n        return loan.durationSeconds + loan.lastAccumulatedTimestamp;\n    }\n\n    \n    // === private ===\n\n    /// @dev Returns the total interest owed on loan\n    function _interestOwed(\n        uint256 loanAmount,\n        uint256 lastAccumulatedTimestamp,\n        uint256 perAnumInterestRate,\n        uint256 accumulatedInterest\n    ) \n        internal \n        view \n        returns (uint256) \n    {\n        return loanAmount\n            * (block.timestamp - lastAccumulatedTimestamp)\n            * (perAnumInterestRate * 1e18 / 365 days)\n            / 1e21 // SCALAR * 1e18\n            + accumulatedInterest;\n    }\n}"
    },
    {
      "filename": "contracts/interfaces/INFTLoanFacilitator.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.12;\n\ninterface INFTLoanFacilitator {\n    /// @notice See loanInfo\n    struct Loan {\n        bool closed;\n        uint16 perAnumInterestRate;\n        uint32 durationSeconds;\n        uint40 lastAccumulatedTimestamp;\n        address collateralContractAddress;\n        address loanAssetContractAddress;\n        uint128 accumulatedInterest;\n        uint128 loanAmount;\n        uint256 collateralTokenId;\n    }\n\n    /**\n     * @notice The magnitude of SCALAR\n     * @dev 10^INTEREST_RATE_DECIMALS = 1 = 100%\n     */\n    function INTEREST_RATE_DECIMALS() external returns (uint8);\n\n    /**\n     * @notice The SCALAR for all percentages in the loan facilitator contract\n     * @dev Any interest rate passed to a function should already been multiplied by SCALAR\n     */\n    function SCALAR() external returns (uint256);\n\n    /**\n     * @notice The percent of the loan amount that the facilitator will take as a fee, scaled by SCALAR\n     * @dev Starts set to 1%. Can only be set to 0 - 5%. \n     */\n    function originationFeeRate() external returns (uint256);\n\n    /**\n     * @notice The lend ticket contract associated with this loan faciliator\n     * @dev Once set, cannot be modified\n     */\n    function lendTicketContract() external returns (address);\n\n    /**\n     * @notice The borrow ticket contract associated with this loan faciliator\n     * @dev Once set, cannot be modified\n     */\n    function borrowTicketContract() external returns (address);\n\n    /**\n     * @notice The percent improvement required of at least one loan term when buying out current lender \n     * a loan that already has a lender, scaled by SCALAR. \n     * E.g. setting this value to 100 (10%) means, when replacing a lender, the new loan terms must have\n     * at least 10% greater duration or loan amount or at least 10% lower interest rate. \n     * @dev Starts at 100 = 10%. Only owner can set. Cannot be set to 0.\n     */\n    function requiredImprovementRate() external returns (uint256);\n    \n    /**\n     * @notice Emitted when the loan is created\n     * @param id The id of the new loan, matches the token id of the borrow ticket minted in the same transaction\n     * @param minter msg.sender\n     * @param collateralTokenId The token id of the collateral NFT\n     * @param collateralContract The contract address of the collateral NFT\n     * @param maxInterestRate The max per anum interest rate, scaled by SCALAR\n     * @param loanAssetContract The contract address of the loan asset\n     * @param minLoanAmount mimimum loan amount\n     * @param minDurationSeconds minimum loan duration in seconds\n    */\n    event CreateLoan(\n        uint256 indexed id,\n        address indexed minter,\n        uint256 collateralTokenId,\n        address collateralContract,\n        uint256 maxInterestRate,\n        address loanAssetContract,\n        uint256 minLoanAmount,\n        uint256 minDurationSeconds\n        );\n\n    /** \n     * @notice Emitted when ticket is closed\n     * @param id The id of the ticket which has been closed\n     */\n    event Close(uint256 indexed id);\n\n    /** \n     * @notice Emitted when the loan is underwritten or re-underwritten\n     * @param id The id of the ticket which is being underwritten\n     * @param lender msg.sender\n     * @param interestRate The per anum interest rate, scaled by SCALAR, for the loan\n     * @param loanAmount The loan amount\n     * @param durationSeconds The loan duration in seconds \n     */\n    event Lend(\n        uint256 indexed id,\n        address indexed lender,\n        uint256 interestRate,\n        uint256 loanAmount,\n        uint256 durationSeconds\n    );\n\n    /**\n     * @notice Emitted when a loan is being re-underwritten, the current loan ticket holder is being bought out\n     * @param lender msg.sender\n     * @param replacedLoanOwner The current loan ticket holder\n     * @param interestEarned The amount of interest the loan has accrued from first lender to this buyout\n     * @param replacedAmount The loan amount prior to buyout\n     */    \n    event BuyoutLender(\n        uint256 indexed id,\n        address indexed lender,\n        address indexed replacedLoanOwner,\n        uint256 interestEarned,\n        uint256 replacedAmount\n    );\n    \n    /**\n     * @notice Emitted when loan is repaid\n     * @param id The loan id\n     * @param repayer msg.sender\n     * @param loanOwner The current holder of the lend ticket for this loan, token id matching the loan id\n     * @param interestEarned The total interest accumulated on the loan\n     * @param loanAmount The loan amount\n     */\n    event Repay(\n        uint256 indexed id,\n        address indexed repayer,\n        address indexed loanOwner,\n        uint256 interestEarned,\n        uint256 loanAmount\n    );\n\n    /**\n     * @notice Emitted when loan NFT collateral is seized \n     * @param id The ticket id\n     */\n    event SeizeCollateral(uint256 indexed id);\n\n     /**\n      * @notice Emitted when origination fees are withdrawn\n      * @dev only owner can call\n      * @param asset the ERC20 asset withdrawn\n      * @param amount the amount withdrawn\n      * @param to the address the withdrawn amount was sent to\n      */\n     event WithdrawOriginationFees(address asset, uint256 amount, address to);\n\n      /**\n      * @notice Emitted when originationFeeRate is updated\n      * @dev only owner can call, value is scaled by SCALAR, 100% = SCALAR\n      * @param feeRate the new origination fee rate\n      */\n     event UpdateOriginationFeeRate(uint32 feeRate);\n\n     /**\n      * @notice Emitted when requiredImprovementRate is updated\n      * @dev only owner can call, value is scaled by SCALAR, 100% = SCALAR\n      * @param improvementRate the new required improvementRate\n      */\n     event UpdateRequiredImprovementRate(uint256 improvementRate);\n\n    /**\n     * @notice (1) transfers the collateral NFT to the loan facilitator contract \n     * (2) creates the loan, populating loanInfo in the facilitator contract,\n     * and (3) mints a Borrow Ticket to mintBorrowTicketTo\n     * @dev loan duration or loan amount cannot be 0, \n     * this is done to protect borrowers from accidentally passing a default value\n     * and also because it creates odd lending and buyout behavior: possible to lend\n     * for 0 value or 0 duration, and possible to buyout with no improvement because, for example\n     * previousDurationSeconds + (previousDurationSeconds * requiredImprovementRate / SCALAR) <= durationSeconds\n     * evaluates to true if previousDurationSeconds is 0 and durationSeconds is 0.\n     * loanAssetContractAddress cannot be address(0), we check this because Solmate SafeTransferLib\n     * does not revert with address(0) and this could cause odd behavior.\n     * collateralContractAddress cannot be address(borrowTicket) or address(lendTicket).\n     * @param collateralTokenId The token id of the collateral NFT \n     * @param collateralContractAddress The contract address of the collateral NFT\n     * @param maxPerAnumInterest The maximum per anum interest rate for this loan, scaled by SCALAR\n     * @param minLoanAmount The minimum acceptable loan amount for this loan\n     * @param loanAssetContractAddress The address of the loan asset\n     * @param minDurationSeconds The minimum duration for this loan\n     * @param mintBorrowTicketTo An address to mint the Borrow Ticket corresponding to this loan to\n     * @return id of the created loan\n     */\n    function createLoan(\n            uint256 collateralTokenId,\n            address collateralContractAddress,\n            uint16 maxPerAnumInterest,\n            uint128 minLoanAmount,\n            address loanAssetContractAddress,\n            uint32 minDurationSeconds,\n            address mintBorrowTicketTo\n    ) external returns (uint256 id);\n\n    /**\n     * @notice Closes the loan, sends the NFT collateral to sendCollateralTo\n     * @dev Can only be called by the holder of the Borrow Ticket with tokenId\n     * matching the loanId. Can only be called if loan has not be underwritten,\n     * i.e. lastAccumulatedInterestTimestamp = 0\n     * @param loanId The loan id\n     * @param sendCollateralTo The address to send the collateral NFT to\n     */\n    function closeLoan(uint256 loanId, address sendCollateralTo) external;\n\n    /**\n     * @notice Lends, meeting or beating the proposed loan terms, \n     * transferring `amount` of the loan asset \n     * to the facilitator contract. If the loan has not yet been underwritten, \n     * a Lend Ticket is minted to `sendLendTicketTo`. If the loan has already been \n     * underwritten, then this is a buyout, and the Lend Ticket will be transferred\n     * from the current holder to `sendLendTicketTo`. Also in the case of a buyout, interestOwed()\n     * is transferred from the caller to the facilitator contract, in addition to `amount`, and\n     * totalOwed() is paid to the current Lend Ticket holder.\n     * @dev Loan terms must meet or beat loan terms. If a buyout, at least one loan term\n     * must be improved by at least 10%. E.g. 10% longer duration, 10% lower interest, \n     * 10% higher amount\n     * @param loanId The loan id\n     * @param interestRate The per anum interest rate, scaled by SCALAR\n     * @param amount The loan amount\n     * @param durationSeconds The loan duration in seconds\n     * @param sendLendTicketTo The address to send the Lend Ticket to\n     */\n    function lend(\n            uint256 loanId,\n            uint16 interestRate,\n            uint128 amount,\n            uint32 durationSeconds,\n            address sendLendTicketTo\n    ) external;\n\n    /**\n     * @notice repays and closes the loan, transferring totalOwed() to the current Lend Ticket holder\n     * and transferring the collateral NFT to the Borrow Ticket holder.\n     * @param loanId The loan id\n     */\n    function repayAndCloseLoan(uint256 loanId) external;\n\n    /**\n     * @notice Transfers the collateral NFT to `sendCollateralTo` and closes the loan.\n     * @dev Can only be called by Lend Ticket holder. Can only be called \n     * if block.timestamp > loanEndSeconds()\n     * @param loanId The loan id\n     * @param sendCollateralTo The address to send the collateral NFT to\n     */\n    function seizeCollateral(uint256 loanId, address sendCollateralTo) external;\n\n    /**\n     * @notice returns the info for this loan\n     * @param loanId The id of the loan\n     * @return closed Whether or not the ticket is closed\n     * @return perAnumInterestRate The per anum interest rate, scaled by SCALAR\n     * @return durationSeconds The loan duration in seconds\n     \n     * @return lastAccumulatedTimestamp The timestamp (in seconds) when interest was last accumulated, \n     * i.e. the timestamp of the most recent underwriting\n     * @return collateralContractAddress The contract address of the NFT collateral \n     * @return loanAssetContractAddress The contract address of the loan asset.\n     * @return accumulatedInterest The amount of interest accumulated on the loan prior to the current lender\n     * @return loanAmount The loan amount\n     * @return collateralTokenId The token ID of the NFT collateral\n     */\n    function loanInfo(uint256 loanId)\n        external \n        view \n        returns (\n            bool closed,\n            uint16 perAnumInterestRate,\n            uint32 durationSeconds,\n            uint40 lastAccumulatedTimestamp,\n            address collateralContractAddress,\n            address loanAssetContractAddress,\n            uint128 accumulatedInterest,\n            uint128 loanAmount,\n            uint256 collateralTokenId\n        );\n\n    /**\n     * @notice returns the info for this loan\n     * @dev this is a convenience method for other contracts that would prefer to have the \n     * Loan object not decomposed. \n     * @param loanId The id of the loan\n     * @return Loan struct corresponding to loanId\n     */\n    function loanInfoStruct(uint256 loanId) external view returns (Loan memory);\n\n    /**\n     * @notice returns the total amount owed for the loan, i.e. principal + interest\n     * @param loanId The loan id\n     */\n    function totalOwed(uint256 loanId) view external returns (uint256);\n\n    /**\n     * @notice returns the interest owed on the loan, in loan asset units\n     * @param loanId The loan id\n     */\n    function interestOwed(uint256 loanId) view external returns (uint256);\n\n    /**\n     * @notice returns the unix timestamp (seconds) of the loan end\n     * @param loanId The loan id\n     */\n    function loanEndSeconds(uint256 loanId) view external returns (uint256);\n}"
    }
  ]
}