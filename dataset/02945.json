{
  "Title": "Able to close non-empty staking pool",
  "Content": "A staking pool can be [closed](https://github.com/neptune-mutual-blue/protocol/blob/73fc82fbe0d1388867b7df669983fe42760daeb1/contracts/pool/Staking/StakingPoolBase.sol#L51-L59) without checking if there is any remaining liquidity of either the staking token or the reward token. Once the pool is closed, neither [`deposit`](https://github.com/neptune-mutual-blue/protocol/blob/73fc82fbe0d1388867b7df669983fe42760daeb1/contracts/pool/Staking/StakingPools.sol#L20-L23) nor [`withdraw`](https://github.com/neptune-mutual-blue/protocol/blob/73fc82fbe0d1388867b7df669983fe42760daeb1/contracts/pool/Staking/StakingPools.sol#L39-L41) functions are allowed. Hence, users won’t be able to access their funds. However a recovery agent is still able to [retrieve](https://github.com/neptune-mutual-blue/protocol/blob/73fc82fbe0d1388867b7df669983fe42760daeb1/contracts/core/Recoverable.sol#L49) both staking and reward tokens and distribute them as desired.\n\n\nConsider checking for remaining liquidity before closing a pool.\n\n\n**Update:** *Fixed as of commit `86b0caa0995ffcdbb1deecf8547c9a3db8c23821` in [pull request #160](https://github.com/neptune-mutual-blue/protocol/pull/160).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/pool/Staking/StakingPoolBase.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\nimport \"../../interfaces/IStore.sol\";\nimport \"../../interfaces/IStakingPools.sol\";\nimport \"../../libraries/AccessControlLibV1.sol\";\nimport \"../../libraries/ValidationLibV1.sol\";\nimport \"../../libraries/StoreKeyUtil.sol\";\nimport \"../../libraries/StakingPoolCoreLibV1.sol\";\nimport \"../../libraries/StakingPoolLibV1.sol\";\nimport \"../../core/Recoverable.sol\";\n\nabstract contract StakingPoolBase is IStakingPools, Recoverable {\n  using AccessControlLibV1 for IStore;\n  using ValidationLibV1 for IStore;\n  using StoreKeyUtil for IStore;\n  using StakingPoolCoreLibV1 for IStore;\n\n  constructor(IStore s) Recoverable(s) {} //solhint-disable-line\n\n  /**\n   * @dev Adds or edits the pool by key\n   * @param key Enter the key of the pool you want to create or edit\n   * @param name Enter a name for this pool\n   * @param poolType Specify the pool type: TokenStaking or PODStaking\n   * @param addresses[0] stakingToken The token which is staked in this pool\n   * @param addresses[1] uniStakingTokenDollarPair Enter a Uniswap stablecoin pair address of the staking token\n   * @param addresses[2] rewardToken The token which is rewarded in this pool\n   * @param addresses[3] uniRewardTokenDollarPair Enter a Uniswap stablecoin pair address of the staking token\n   * @param values[0] stakingTarget Specify the target amount in the staking token. You can not exceed the target.\n   * @param values[1] maxStake Specify the maximum amount that can be staken at a time.\n   * @param values[2] platformFee Enter the platform fee which is deducted on reward and on the reward token\n   * @param values[3] rewardPerBlock Specify the amount of reward token awarded per block\n   * @param values[4] lockupPeriodInBlocks Enter a lockup period during when the staked tokens can't be withdrawn\n   * @param values[5] rewardTokenDeposit Enter the value of reward token you are depositing in this transaction.\n   */\n  function addOrEditPool(\n    bytes32 key,\n    string calldata name,\n    StakingPoolType poolType,\n    address[] calldata addresses,\n    uint256[] calldata values\n  ) external override nonReentrant {\n    // @suppress-zero-value-check The uint values are checked in the function `addOrEditPoolInternal`\n    s.mustNotBePaused();\n    AccessControlLibV1.mustBeAdmin(s);\n\n    s.addOrEditPoolInternal(key, name, addresses, values);\n    emit PoolUpdated(key, name, poolType, addresses[0], addresses[1], addresses[2], addresses[3], values[5], values[1], values[3], values[4], values[2]);\n  }\n\n  function closePool(bytes32 key) external override nonReentrant {\n    s.mustNotBePaused();\n    AccessControlLibV1.mustBeAdmin(s);\n    require(s.getBoolByKeys(StakingPoolCoreLibV1.NS_POOL, key), \"Unknown Pool\");\n\n    s.deleteBoolByKeys(StakingPoolCoreLibV1.NS_POOL, key);\n    emit PoolClosed(key, s.getStringByKeys(StakingPoolCoreLibV1.NS_POOL, key));\n  }\n\n  /**\n   * @dev Version number of this contract\n   */\n  function version() external pure override returns (bytes32) {\n    return \"v0.1\";\n  }\n\n  /**\n   * @dev Name of this contract\n   */\n  function getName() external pure override returns (bytes32) {\n    return ProtoUtilV1.CNAME_STAKING_POOL;\n  }\n}"
    }
  ]
}