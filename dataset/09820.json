{
  "Title": "[L-02] Use OZ upgrades (hardhat) plugin to handle proxy deployments and upgrades",
  "Content": "\n### Description\n\nThe project manually deploys and manages their own proxy contract and upgrades. I strongly recommend that the team use the upgrades plugin from OpenZeppelin instead, because it provides an important feature of validating that the incoming implementations are upgrade safe.\n\nI note that the plugin is part of [`package.json`](https://github.com/code-423n4/2022-02-jpyc/blob/main/package.json#L14) and was imported into [hardhat config](https://github.com/code-423n4/2022-02-jpyc/blob/main/hardhat.config.js#L7) file, but am puzzled why it wasnâ€™t used (at least in tests).\n\n### Recommended Mitigation Steps\n\nStrongly consider using the [OZ upgrades plugin](https://github.com/OpenZeppelin/openzeppelin-upgrades) to manage deployments. More information about its usage can be found in [their documentation](https://docs.openzeppelin.com/upgrades-plugins/1.x/) and [UUPS Proxy](https://forum.openzeppelin.com/t/uups-proxies-tutorial-solidity-javascript/7786) guide.\n\nAn example is provided below:\n\n```jsx\nconst { ethers, upgrades } = require(\"hardhat\");\n\ncontract('TestDeploymentAndUpgrade', async function (accounts) {\n  const minter = accounts[6];\n  const masterMinter = accounts[3];\n  const pauser = accounts[4];\n  const blocklister = accounts[5];\n\n  it('should do deployment and upgrades', async () => {\n    // Deploying\n    const FiatTokenV1 = await ethers.getContractFactory(\"FiatTokenV1\");\n    const instance = await upgrades.deployProxy(FiatTokenV1, [\n      'JPY Coin',\n      'JPYC',\n      'JPY',\n      18,\n      masterMinter,\n      pauser,\n      blocklister,\n      minter\n      ],\n      { kind: 'uups' });\n      await instance.deployed();\n\t\n      // Upgrading\n      const FiatTokenV2 = await ethers.getContractFactory(\"FiatTokenV2\");\n      const upgraded = await upgrades.upgradeProxy(instance.address, FiatTokenV2);\n    });\n});\n```\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/contests/2022-02-jpyc-contest",
  "Code": [
    {
      "filename": "package.json",
      "content": "{\n  \"name\": \"jpycv2\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"@openzeppelin/contracts\": \"^4.4.1\",\n    \"@openzeppelin/contracts-upgradeable\": \"^4.4.1\",\n    \"@openzeppelin/hardhat-upgrades\": \"^1.12.0\",\n    \"@openzeppelin/test-helpers\": \"^0.5.15\",\n    \"dotenv\": \"^10.0.0\",\n    \"eth-sig-util\": \"^3.0.1\",\n    \"ethereumjs-wallet\": \"^1.0.2\",\n    \"hardhat\": \"^2.7.0\",\n    \"solidity-coverage\": \"^0.7.17\"\n  },\n  \"devDependencies\": {\n    \"@nomiclabs/hardhat-ethers\": \"^2.0.2\",\n    \"@nomiclabs/hardhat-truffle5\": \"^2.0.3\",\n    \"@nomiclabs/hardhat-waffle\": \"^2.0.1\",\n    \"@nomiclabs/hardhat-web3\": \"^2.0.0\",\n    \"chai\": \"^4.3.4\",\n    \"ethereum-waffle\": \"^3.4.0\",\n    \"ethers\": \"^5.5.1\",\n    \"hardhat-contract-sizer\": \"^2.3.0\",\n    \"web3\": \"^1.6.1\"\n  }\n}"
    }
  ]
}