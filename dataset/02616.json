{
  "Title": "Parallel share cap setting",
  "Content": "The configuration manager determines the maximum vault shares available for minting. When setting a new cap through the [`setCap`](https://github.com/pods-finance/yield-contracts/blob/9389ab46e9ecdd1ea1fd7228c9d9c6821c00f057/contracts/configuration/ConfigurationManager.sol#L55) function, the target contract address is checked for the zero address, and a `SetCap` event is emitted.\n\n\nHowever, the underlying [`setParameter`](https://github.com/pods-finance/yield-contracts/blob/9389ab46e9ecdd1ea1fd7228c9d9c6821c00f057/contracts/configuration/ConfigurationManager.sol#L25) function can be called directly to change the maximum vault shares available. This will bypass the zero address check and emit a `ParameterSet` event instead of the expected `SetCap` event.\n\n\nConsider ensuring consistency between the two mechanisms in setting the share cap. Depending on the desired outcome, this could involve removing the `setParameter` function and adding individual get and set functions for all necessary configuration parameters.\n\n\n**Update:** *Fixed in commit [`cbe61d0`](https://github.com/pods-finance/yield-contracts/pull/44/commits/cbe61d00834aafcbcc9c342dc80dd97d65a4b5b8).*\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/configuration/ConfigurationManager.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-or-later\n\npragma solidity 0.8.9;\n\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\nimport \"../interfaces/IConfigurationManager.sol\";\n\n/**\n * @title ConfigurationManager\n * @author Pods Finance\n * @notice Allows contracts to read protocol-wide settings\n */\ncontract ConfigurationManager is IConfigurationManager, Ownable {\n    mapping(address => mapping(bytes32 => uint256)) private _parameters;\n    mapping(address => bool) private _allowedVault;\n    address private immutable _global = address(0);\n    bytes32 constant CAP = \"CAP\";\n\n    /**\n     * @dev Define a parameter\n     * @param target The parameter name\n     * @param name The parameter name\n     * @param value The parameter value\n     */\n    function setParameter(\n        address target,\n        bytes32 name,\n        uint256 value\n    ) public override onlyOwner {\n        _parameters[target][name] = value;\n        emit ParameterSet(target, name, value);\n    }\n\n    /**\n     * @dev Get the value of a defined parameter\n     * @param name The parameter name\n     */\n    function getParameter(address target, bytes32 name) external view override returns (uint256) {\n        return _parameters[target][name];\n    }\n\n    /**\n     * @dev Get the value of a defined parameter\n     * @param name The parameter name\n     */\n    function getGlobalParameter(bytes32 name) external view override returns (uint256) {\n        return _parameters[_global][name];\n    }\n\n    /**\n     * @dev Defines a cap value to a contract\n     * @param target The contract address\n     * @param value Cap amount\n     */\n    function setCap(address target, uint256 value) external override onlyOwner {\n        if (target == address(0)) revert ConfigurationManager__InvalidCapTarget();\n        setParameter(target, CAP, value);\n        emit SetCap(target, value);\n    }\n\n    /**\n     * @dev Get the value of a defined cap\n     * Note that 0 cap means that the contract is not capped\n     * @param target The contract address\n     */\n    function getCap(address target) external view override returns (uint256) {\n        return this.getParameter(target, CAP);\n    }\n\n    /**\n     * @dev Sets the allowance to migrate to a `vault` address\n     * @param vault The contract address\n     * @param allowed Allowance status\n     */\n    function setAllowedVault(address vault, bool allowed) external override onlyOwner {\n        _allowedVault[vault] = allowed;\n        emit VaultAllowanceSet(vault, allowed);\n    }\n\n    /**\n     * @dev Returns if a vault is allowed\n     * @param vault The contract address\n     */\n    function isVaultAllowed(address vault) external view override returns (bool) {\n        return _allowedVault[vault];\n    }\n}"
    },
    {
      "filename": "contracts/configuration/ConfigurationManager.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-or-later\n\npragma solidity 0.8.9;\n\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\nimport \"../interfaces/IConfigurationManager.sol\";\n\n/**\n * @title ConfigurationManager\n * @author Pods Finance\n * @notice Allows contracts to read protocol-wide settings\n */\ncontract ConfigurationManager is IConfigurationManager, Ownable {\n    mapping(address => mapping(bytes32 => uint256)) private _parameters;\n    mapping(address => bool) private _allowedVault;\n    address private immutable _global = address(0);\n    bytes32 constant CAP = \"CAP\";\n\n    /**\n     * @dev Define a parameter\n     * @param target The parameter name\n     * @param name The parameter name\n     * @param value The parameter value\n     */\n    function setParameter(\n        address target,\n        bytes32 name,\n        uint256 value\n    ) public override onlyOwner {\n        _parameters[target][name] = value;\n        emit ParameterSet(target, name, value);\n    }\n\n    /**\n     * @dev Get the value of a defined parameter\n     * @param name The parameter name\n     */\n    function getParameter(address target, bytes32 name) external view override returns (uint256) {\n        return _parameters[target][name];\n    }\n\n    /**\n     * @dev Get the value of a defined parameter\n     * @param name The parameter name\n     */\n    function getGlobalParameter(bytes32 name) external view override returns (uint256) {\n        return _parameters[_global][name];\n    }\n\n    /**\n     * @dev Defines a cap value to a contract\n     * @param target The contract address\n     * @param value Cap amount\n     */\n    function setCap(address target, uint256 value) external override onlyOwner {\n        if (target == address(0)) revert ConfigurationManager__InvalidCapTarget();\n        setParameter(target, CAP, value);\n        emit SetCap(target, value);\n    }\n\n    /**\n     * @dev Get the value of a defined cap\n     * Note that 0 cap means that the contract is not capped\n     * @param target The contract address\n     */\n    function getCap(address target) external view override returns (uint256) {\n        return this.getParameter(target, CAP);\n    }\n\n    /**\n     * @dev Sets the allowance to migrate to a `vault` address\n     * @param vault The contract address\n     * @param allowed Allowance status\n     */\n    function setAllowedVault(address vault, bool allowed) external override onlyOwner {\n        _allowedVault[vault] = allowed;\n        emit VaultAllowanceSet(vault, allowed);\n    }\n\n    /**\n     * @dev Returns if a vault is allowed\n     * @param vault The contract address\n     */\n    function isVaultAllowed(address vault) external view override returns (bool) {\n        return _allowedVault[vault];\n    }\n}"
    }
  ]
}