{
  "Title": "[L18] An account can trigger an approval event on behalf of another account",
  "Content": "The [`StabilierToken` contract](https://github.com/emptysetsquad/emptyset/blob/bf9753ef9cd5b17236036257f290e0d0b850a029/protocol/contracts/src/stabilizer/StabilizerToken.sol#L27) implements the functionalities of the `sESD` ERC20 token.\n\n\nOne of those is the [`transferFrom` function](https://github.com/emptysetsquad/emptyset/blob/bf9753ef9cd5b17236036257f290e0d0b850a029/protocol/contracts/src/stabilizer/StabilizerToken.sol#L93) that allows to transfer tokens on behalf of another user when the allowance is properly set.\n\n\nHowever, if a non-allowed user tries to transfer zero number of tokens on behalf of another another account by calling the `transferFrom` function, the transaction not only will succeed but it will trigger both [`Transfer`](https://github.com/emptysetsquad/emptyset/blob/bf9753ef9cd5b17236036257f290e0d0b850a029/protocol/contracts/src/stabilizer/StabilizerToken.sol#L114) and [`Approval`](https://github.com/emptysetsquad/emptyset/blob/bf9753ef9cd5b17236036257f290e0d0b850a029/protocol/contracts/src/stabilizer/StabilizerToken.sol#L157) event emission, meaning that the malicious user could disguise this harmless transaction as an approval on a non-owned account.\n\n\nConsider requiring a non-zero value transfer when using the `transferFrom` function to prevent users from being deceived and to improve the readability of off-chain services that track event logs.\n\n\n***Update**: Acknowledged. The EmptySetSquad team statement for this issue:*\n\n\n\n> \n> *Won’t fix – will stick with current behavior to conform to OZs implementation of ERC20.*\n> \n> \n> \n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "protocol/contracts/src/stabilizer/StabilizerToken.sol",
      "content": "/*\n    Copyright 2021 Empty Set Squad <emptysetsquad@protonmail.com>\n\n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an \"AS IS\" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n*/\n\npragma solidity 0.5.17;\npragma experimental ABIEncoderV2;\n\nimport \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport \"./StabilizerState.sol\";\n\n/**\n * @title StabilizerToken\n * @notice Stabilizer sESD ERC20 implementation logic\n */\ncontract StabilizerToken is StabilizerAccessors {\n    using SafeMath for uint256;\n\n    /**\n     * @notice Emitted when `value` sESD is transferred from `from` to `to`\n     */\n    event Transfer(address indexed from, address indexed to, uint256 value);\n    /**\n     * @notice Emitted when `owner` approves `spender` for `value` sESD\n     */\n    event Approval(address indexed owner, address indexed spender, uint256 value);\n\n    /**\n     * @notice Display name of the sESD token\n     * return sESD name\n     */\n    function name() public view returns (string memory) {\n        return \"Saved Empty Set Dollar\";\n    }\n\n    /**\n     * @notice Symbol of the sESD token\n     * return sESD symbol\n     */\n    function symbol() public view returns (string memory) {\n        return \"sESD\";\n    }\n\n    /**\n     * @notice Display decimals of precision for the sESD token\n     * return sESD decimals\n     */\n    function decimals() public view returns (uint8) {\n        return 18;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from the caller to the `recipient`\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transfer(address recipient, uint256 amount) public returns (bool) {\n        _transfer(msg.sender, recipient, amount);\n        return true;\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the caller\n     * @param spender Account being approved to transfer caller's funds\n     * @param amount Amount of sESD to approve\n     * return Whether the approval was successful\n     */\n    function approve(address spender, uint256 amount) public returns (bool) {\n        _approve(msg.sender, spender, amount);\n        return true;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev caller must have the required approval amount from `sender`\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transferFrom(address sender, address recipient, uint256 amount) public returns (bool) {\n        _transfer(sender, recipient, amount);\n        _approve(sender, msg.sender, allowance(sender, msg.sender).sub(amount, \"StabilizerToken: transfer amount exceeds allowance\"));\n        return true;\n    }\n\n    // INTERNAL\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev Internal only - helper\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     */\n    function _transfer(address sender, address recipient, uint256 amount) internal {\n        require(sender != address(0), \"StabilizerToken: transfer from the zero address\");\n        require(recipient != address(0), \"StabilizerToken: transfer to the zero address\");\n\n        _transferBalance(sender, recipient, amount, \"StabilizerToken: transfer amount exceeds balance\");\n\n        emit Transfer(sender, recipient, amount);\n    }\n\n    /**\n     * @notice Mints `amount` sESD to `account`\n     * @dev Internal only - helper\n     * @param account Account to receive minted sESD\n     * @param amount Amount of sESD to mint\n     */\n    function _mint(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: mint to the zero address\");\n\n        _incrementBalance(account, amount);\n\n        emit Transfer(address(0), account, amount);\n    }\n\n    /**\n     * @notice Burns `amount` sESD from `account`\n     * @dev Internal only - helper\n     * @param account Account being burned from\n     * @param amount Amount of sESD to burn\n     */\n    function _burn(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: burn from the zero address\");\n\n        _decrementBalance(account, amount, \"StabilizerToken: burn amount exceeds balance\");\n\n        emit Transfer(account, address(0), amount);\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the `owner`\n     * @param owner Account approving sESD to be transferred\n     * @param spender Account being approved to transfer sESD\n     * @param amount Amount of sESD to approve\n     */\n    function _approve(address owner, address spender, uint256 amount) internal {\n        require(owner != address(0), \"StabilizerToken: approve from the zero address\");\n        require(spender != address(0), \"StabilizerToken: approve to the zero address\");\n\n        _updateAllowance(owner, spender, amount);\n\n        emit Approval(owner, spender, amount);\n    }\n}"
    },
    {
      "filename": "protocol/contracts/src/stabilizer/StabilizerToken.sol",
      "content": "/*\n    Copyright 2021 Empty Set Squad <emptysetsquad@protonmail.com>\n\n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an \"AS IS\" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n*/\n\npragma solidity 0.5.17;\npragma experimental ABIEncoderV2;\n\nimport \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport \"./StabilizerState.sol\";\n\n/**\n * @title StabilizerToken\n * @notice Stabilizer sESD ERC20 implementation logic\n */\ncontract StabilizerToken is StabilizerAccessors {\n    using SafeMath for uint256;\n\n    /**\n     * @notice Emitted when `value` sESD is transferred from `from` to `to`\n     */\n    event Transfer(address indexed from, address indexed to, uint256 value);\n    /**\n     * @notice Emitted when `owner` approves `spender` for `value` sESD\n     */\n    event Approval(address indexed owner, address indexed spender, uint256 value);\n\n    /**\n     * @notice Display name of the sESD token\n     * return sESD name\n     */\n    function name() public view returns (string memory) {\n        return \"Saved Empty Set Dollar\";\n    }\n\n    /**\n     * @notice Symbol of the sESD token\n     * return sESD symbol\n     */\n    function symbol() public view returns (string memory) {\n        return \"sESD\";\n    }\n\n    /**\n     * @notice Display decimals of precision for the sESD token\n     * return sESD decimals\n     */\n    function decimals() public view returns (uint8) {\n        return 18;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from the caller to the `recipient`\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transfer(address recipient, uint256 amount) public returns (bool) {\n        _transfer(msg.sender, recipient, amount);\n        return true;\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the caller\n     * @param spender Account being approved to transfer caller's funds\n     * @param amount Amount of sESD to approve\n     * return Whether the approval was successful\n     */\n    function approve(address spender, uint256 amount) public returns (bool) {\n        _approve(msg.sender, spender, amount);\n        return true;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev caller must have the required approval amount from `sender`\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transferFrom(address sender, address recipient, uint256 amount) public returns (bool) {\n        _transfer(sender, recipient, amount);\n        _approve(sender, msg.sender, allowance(sender, msg.sender).sub(amount, \"StabilizerToken: transfer amount exceeds allowance\"));\n        return true;\n    }\n\n    // INTERNAL\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev Internal only - helper\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     */\n    function _transfer(address sender, address recipient, uint256 amount) internal {\n        require(sender != address(0), \"StabilizerToken: transfer from the zero address\");\n        require(recipient != address(0), \"StabilizerToken: transfer to the zero address\");\n\n        _transferBalance(sender, recipient, amount, \"StabilizerToken: transfer amount exceeds balance\");\n\n        emit Transfer(sender, recipient, amount);\n    }\n\n    /**\n     * @notice Mints `amount` sESD to `account`\n     * @dev Internal only - helper\n     * @param account Account to receive minted sESD\n     * @param amount Amount of sESD to mint\n     */\n    function _mint(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: mint to the zero address\");\n\n        _incrementBalance(account, amount);\n\n        emit Transfer(address(0), account, amount);\n    }\n\n    /**\n     * @notice Burns `amount` sESD from `account`\n     * @dev Internal only - helper\n     * @param account Account being burned from\n     * @param amount Amount of sESD to burn\n     */\n    function _burn(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: burn from the zero address\");\n\n        _decrementBalance(account, amount, \"StabilizerToken: burn amount exceeds balance\");\n\n        emit Transfer(account, address(0), amount);\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the `owner`\n     * @param owner Account approving sESD to be transferred\n     * @param spender Account being approved to transfer sESD\n     * @param amount Amount of sESD to approve\n     */\n    function _approve(address owner, address spender, uint256 amount) internal {\n        require(owner != address(0), \"StabilizerToken: approve from the zero address\");\n        require(spender != address(0), \"StabilizerToken: approve to the zero address\");\n\n        _updateAllowance(owner, spender, amount);\n\n        emit Approval(owner, spender, amount);\n    }\n}"
    },
    {
      "filename": "protocol/contracts/src/stabilizer/StabilizerToken.sol",
      "content": "/*\n    Copyright 2021 Empty Set Squad <emptysetsquad@protonmail.com>\n\n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an \"AS IS\" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n*/\n\npragma solidity 0.5.17;\npragma experimental ABIEncoderV2;\n\nimport \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport \"./StabilizerState.sol\";\n\n/**\n * @title StabilizerToken\n * @notice Stabilizer sESD ERC20 implementation logic\n */\ncontract StabilizerToken is StabilizerAccessors {\n    using SafeMath for uint256;\n\n    /**\n     * @notice Emitted when `value` sESD is transferred from `from` to `to`\n     */\n    event Transfer(address indexed from, address indexed to, uint256 value);\n    /**\n     * @notice Emitted when `owner` approves `spender` for `value` sESD\n     */\n    event Approval(address indexed owner, address indexed spender, uint256 value);\n\n    /**\n     * @notice Display name of the sESD token\n     * return sESD name\n     */\n    function name() public view returns (string memory) {\n        return \"Saved Empty Set Dollar\";\n    }\n\n    /**\n     * @notice Symbol of the sESD token\n     * return sESD symbol\n     */\n    function symbol() public view returns (string memory) {\n        return \"sESD\";\n    }\n\n    /**\n     * @notice Display decimals of precision for the sESD token\n     * return sESD decimals\n     */\n    function decimals() public view returns (uint8) {\n        return 18;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from the caller to the `recipient`\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transfer(address recipient, uint256 amount) public returns (bool) {\n        _transfer(msg.sender, recipient, amount);\n        return true;\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the caller\n     * @param spender Account being approved to transfer caller's funds\n     * @param amount Amount of sESD to approve\n     * return Whether the approval was successful\n     */\n    function approve(address spender, uint256 amount) public returns (bool) {\n        _approve(msg.sender, spender, amount);\n        return true;\n    }\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev caller must have the required approval amount from `sender`\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     * return Whether the transfer was successful\n     */\n    function transferFrom(address sender, address recipient, uint256 amount) public returns (bool) {\n        _transfer(sender, recipient, amount);\n        _approve(sender, msg.sender, allowance(sender, msg.sender).sub(amount, \"StabilizerToken: transfer amount exceeds allowance\"));\n        return true;\n    }\n\n    // INTERNAL\n\n    /**\n     * @notice Transfers `amount` sESD from `sender` to the `recipient`\n     * @dev Internal only - helper\n     * @param sender Account to send the sESD\n     * @param recipient Account to receive the sESD\n     * @param amount Amount of sESD to transfer\n     */\n    function _transfer(address sender, address recipient, uint256 amount) internal {\n        require(sender != address(0), \"StabilizerToken: transfer from the zero address\");\n        require(recipient != address(0), \"StabilizerToken: transfer to the zero address\");\n\n        _transferBalance(sender, recipient, amount, \"StabilizerToken: transfer amount exceeds balance\");\n\n        emit Transfer(sender, recipient, amount);\n    }\n\n    /**\n     * @notice Mints `amount` sESD to `account`\n     * @dev Internal only - helper\n     * @param account Account to receive minted sESD\n     * @param amount Amount of sESD to mint\n     */\n    function _mint(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: mint to the zero address\");\n\n        _incrementBalance(account, amount);\n\n        emit Transfer(address(0), account, amount);\n    }\n\n    /**\n     * @notice Burns `amount` sESD from `account`\n     * @dev Internal only - helper\n     * @param account Account being burned from\n     * @param amount Amount of sESD to burn\n     */\n    function _burn(address account, uint256 amount) internal {\n        require(account != address(0), \"StabilizerToken: burn from the zero address\");\n\n        _decrementBalance(account, amount, \"StabilizerToken: burn amount exceeds balance\");\n\n        emit Transfer(account, address(0), amount);\n    }\n\n    /**\n     * @notice Approves `spender` to transfer `amount` sESD of the `owner`\n     * @param owner Account approving sESD to be transferred\n     * @param spender Account being approved to transfer sESD\n     * @param amount Amount of sESD to approve\n     */\n    function _approve(address owner, address spender, uint256 amount) internal {\n        require(owner != address(0), \"StabilizerToken: approve from the zero address\");\n        require(spender != address(0), \"StabilizerToken: approve to the zero address\");\n\n        _updateAllowance(owner, spender, amount);\n\n        emit Approval(owner, spender, amount);\n    }\n}"
    }
  ]
}