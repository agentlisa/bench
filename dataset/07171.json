{
  "Title": "[G-10] Gas overflow during iteration (DoS)",
  "Content": "\nEach iteration of the cycle requires a gas flow. A moment may come when more gas is required than it is allocated to record one block. In this case, all iterations of the loop will fail.\n\n```diff\npackages/v2-option/src/structs/Process.sol:\n  32      /// @param isAddToken1 IsAddToken1 if true. IsSubToken0 if false\n  33:     function updateProcess(Process[] storage processing, uint256 token0Amount, uint256 token1Amount, bool isAddToken0, bool isAddToken1) internal {\n+              require(processing.length.length() < maxProcessingLengt, \"max length\");\n  34:         for (uint256 i; i < processing.length; ) {\n  35:             Process storage process = processing[i];\n  36: \n  37:             if (token0Amount != 0) process.balance0Target = isAddToken0 ? process.balance0Target + token0Amount : process.balance0Target - token0Amount;\n  38: \n  39:             if (token1Amount != 0) process.balance1Target = isAddToken1 ? process.balance1Target + token1Amount : process.balance1Target - token1Amount;\n  40: \n  41:             unchecked {\n  42:                 i++;\n  43:             }\n  44:         }\n  45:      }\n```\nhttps://github.com/code-423n4/2023-01-timeswap/blob/main/packages/v2-option/src/structs/Process.sol#L33-L45\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/reports/2023-01-timeswap",
  "Code": [
    {
      "filename": "packages/v2-option/src/structs/Process.sol",
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity =0.8.8;\n\n/// @dev Processing information required for interacting multple options in a single contract.\n/// @notice Since mint, burn, and swap are all flashable transactions.\n/// When doing a mint transaction, do not burn or swap the newly minted positions,\n/// or risk transaction failure.\n/// When doing a swap transaction, do not burn or swap the newly swapped positions,\n/// or risk transaction failure.\n/// @notice For example, if only long0 is minted.\n/// Then calling swap on that long0 position of the same strike and maturity can risk transaction failure.\n/// If calling swap on long1 position received elsewhere, that will be fine.\n/// If calling swap on long1 but different strike and maturity is fine as well.\n/// @param strike The strike ratio of token1 per token0 of the option.\n/// @param maturity The maturity of the option.\n/// @param balance0Target The required balance of token0 to be held in the option.\n/// @param balance1Target The required balance of token1 to be held in the option.\nstruct Process {\n    uint256 strike;\n    uint256 maturity;\n    uint256 balance0Target;\n    uint256 balance1Target;\n}\n\nlibrary ProcessLibrary {\n    /// @dev update process for managing how many tokens required from msg.sender.\n    /// @dev reentrancy safety as well.\n    /// @param processing The current array of processes.\n    /// @param token0Amount If isAddToken0 then token0 amount to be deposited, else the token0 amount withdrawn.\n    /// @param token1Amount If isAddToken1 then token1 amount to be deposited, else the token1 amount withdrawn.\n    /// @param isAddToken0 IsAddToken0 if true. IsSubToken0 if false.\n    /// @param isAddToken1 IsAddToken1 if true. IsSubToken0 if false.\n    function updateProcess(Process[] storage processing, uint256 token0Amount, uint256 token1Amount, bool isAddToken0, bool isAddToken1) internal {\n        for (uint256 i; i < processing.length; ) {\n            Process storage process = processing[i];\n\n            if (token0Amount != 0) process.balance0Target = isAddToken0 ? process.balance0Target + token0Amount : process.balance0Target - token0Amount;\n\n            if (token1Amount != 0) process.balance1Target = isAddToken1 ? process.balance1Target + token1Amount : process.balance1Target - token1Amount;\n\n            unchecked {\n                i++;\n            }\n        }\n    }\n}"
    }
  ]
}