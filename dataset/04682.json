{
  "Title": "Timestamp usage",
  "Content": "There’s a problem with using timestamps and `now` (alias for `block.timestamp`) for contract logic, based on the fact that miners can perform some manipulation. In general, [it’s better not to rely on timestamps for contract logic](https://github.com/ConsenSys/smart-contract-best-practices#timestamp-dependence). The solutions is to use `block.number` instead, and approximate dates with expected block heights and time periods with expected block amounts.\n\n\nThe GNTAllocation contract uses timestamps at [several](https://github.com/imapp-pl/golem-crowdfunding/blob/50100b27a7c6841ed430a028d100f5d45ba08fb1/contracts/GNTAllocation.sol#L22) [points](https://github.com/imapp-pl/golem-crowdfunding/blob/50100b27a7c6841ed430a028d100f5d45ba08fb1/contracts/GNTAllocation.sol#L56). The risk of miner manipulation, though, is really low. The potential damage is also limited: miners could only slightly manipulate the developer lock period duration. We recommend the team to consider the potential risk and switch to `block.number` if necessary.\n\n\nFor more info on this topic, see [this stack exchange question](https://ethereum.stackexchange.com/questions/413/can-a-contract-safely-rely-on-block-timestamp).\n\n\n`block.number` is correctly used in the Token.sol file.\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/GNTAllocation.sol",
      "content": "pragma solidity ^0.4.4;\n\nimport \"./Token.sol\";\n\ncontract GNTAllocation {\n    // Total number of allocations to distribute additional tokens among\n    // developers and the Golem Factory. The Golem Factory has right to 20000\n    // allocations, developers to 10000 allocations, divides among individual\n    // developers by numbers specified in  `allocations` table.\n    uint256 constant totalAllocations = 30000;\n\n    // Addresses of developer and the Golem Factory to allocations mapping.\n    mapping (address => uint256) allocations;\n\n    GolemNetworkToken gnt;\n    uint256 unlockedAt;\n\n    uint256 tokensCreated = 0;\n\n    function GNTAllocation(address _golemFactory) internal {\n        gnt = GolemNetworkToken(msg.sender);\n        unlockedAt = now + 6 * 30 days;\n\n        // For the Golem Factory:\n        allocations[_golemFactory] = 20000; // 12/18 pp of 30000 allocations.\n\n        // For developers:\n        allocations[0xde00] = 2500; // 25.0% of developers' allocations (10000).\n        allocations[0xde01] =  730; //  7.3% of developers' allocations.\n        allocations[0xde02] =  730;\n        allocations[0xde03] =  730;\n        allocations[0xde04] =  730;\n        allocations[0xde05] =  730;\n        allocations[0xde06] =  630; //  6.3% of developers' allocations.\n        allocations[0xde07] =  630;\n        allocations[0xde08] =  630;\n        allocations[0xde09] =  630;\n        allocations[0xde10] =  310; //  3.1% of developers' allocations.\n        allocations[0xde11] =  153; //  1.53% of developers' allocations.\n        allocations[0xde12] =  150; //  1.5% of developers' allocations.\n        allocations[0xde13] =  100; //  1.0% of developers' allocations.\n        allocations[0xde14] =  100;\n        allocations[0xde15] =  100;\n        allocations[0xde16] =   70; //  0.7% of developers' allocations.\n        allocations[0xde17] =   70;\n        allocations[0xde18] =   70;\n        allocations[0xde19] =   70;\n        allocations[0xde20] =   70;\n        allocations[0xde21] =   42; //  0.42% of developers' allocations.\n        allocations[0xde22] =   25; //  0.25% of developers' allocations.\n    }\n\n    // Allows developer to unlock its allocated tokens by transferring them back\n    // to developer's address.\n    function unlock() external {\n        if (now < unlockedAt) throw;\n\n        // During first unlock attempt fetch total number of locked tokens.\n        if (tokensCreated == 0)\n            tokensCreated = gnt.balanceOf(this);\n\n        var allocation = allocations[msg.sender];\n        allocations[msg.sender] = 0;\n        var toTransfer = tokensCreated * allocation / totalAllocations;\n\n        // Will fail if allocation (and therefore toTransfer) is 0.\n        if (!gnt.transfer(msg.sender, toTransfer)) throw;\n    }\n}"
    }
  ]
}