{
  "Title": "[N-02] The `destination` address should be emitted in the userEscrow contract in the function `transferOut`",
  "Content": "\nhttps://github.com/code-423n4/2023-09-centrifuge/blob/512e7a71ebd9ae76384f837204216f26380c9f91/src/UserEscrow.sol#L49\n\nDue to that the receiver can be different address from the user address , the `destination` address should be emitted.\n```solidity \n    function transferOut(address token, address destination, address receiver, uint256 amount) external auth {\n        require(destinations[token][destination] >= amount, \"UserEscrow/transfer-failed\");\n        require(\n            receiver == destination || (ERC20Like(token).allowance(destination, receiver) == type(uint256).max),\n            \"UserEscrow/receiver-has-no-allowance\"\n        );\n        destinations[token][destination] -= amount;\n\n        SafeTransferLib.safeTransfer(token, receiver, amount);\n        emit TransferOut(token, receiver, amount);\n    }\n``` \n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2023-09-centrifuge",
  "Code": [
    {
      "filename": "src/UserEscrow.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-only\npragma solidity 0.8.21;\n\nimport {Auth} from \"./util/Auth.sol\";\nimport {SafeTransferLib} from \"./util/SafeTransferLib.sol\";\n\ninterface ERC20Like {\n    function allowance(address owner, address spender) external view returns (uint256);\n}\n\n/// @title  User Escrow\n/// @notice Escrow contract that holds tokens for specific destinations.\n///         Ensures that once tokens are transferred in, they can only be\n///         transferred out to the pre-chosen destinations, by wards.\ncontract UserEscrow is Auth {\n    /// @dev Map by token and destination\n    mapping(address => mapping(address => uint256)) destinations;\n\n    // --- Events ---\n    event TransferIn(address indexed token, address indexed source, address indexed destination, uint256 amount);\n    event TransferOut(address indexed token, address indexed destination, uint256 amount);\n\n    constructor() {\n        wards[msg.sender] = 1;\n        emit Rely(msg.sender);\n    }\n\n    // --- Token transfers ---\n    function transferIn(address token, address source, address destination, uint256 amount) external auth {\n        destinations[token][destination] += amount;\n\n        SafeTransferLib.safeTransferFrom(token, source, address(this), amount);\n        emit TransferIn(token, source, destination, amount);\n    }\n\n    function transferOut(address token, address destination, address receiver, uint256 amount) external auth {\n        require(destinations[token][destination] >= amount, \"UserEscrow/transfer-failed\");\n        require(\n            /// @dev transferOut can only be initiated by the destination address or an authorized admin.\n            ///      The check is just an additional protection to secure destination funds in case of compromized auth.\n            ///      Since userEscrow is not able to decrease the allowance for the receiver,\n            ///      a transfer is only possible in case receiver has received the full allowance from destination address.\n            receiver == destination || (ERC20Like(token).allowance(destination, receiver) == type(uint256).max),\n            \"UserEscrow/receiver-has-no-allowance\"\n        );\n        destinations[token][destination] -= amount;\n\n        SafeTransferLib.safeTransfer(token, receiver, amount);\n        emit TransferOut(token, receiver, amount);\n    }\n}"
    }
  ]
}