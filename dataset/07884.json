{
  "Title": "[L-02]  Avoid ",
  "Content": "<h2 id=\"l-02--avoid-shadowing-inherited-state-variables\" style=\"position:relative;\"><a href=\"#l-02--avoid-shadowing-inherited-state-variables\" aria-label=\"l 02  avoid shadowing inherited state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02]  Avoid <em>shadowing</em> <code>inherited state variables</code></h2>\n<h3 id=\"context-10\" style=\"position:relative;\"><a href=\"#context-10\" aria-label=\"context 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Context</h3>\n<p><a href=\"https://github.com/code-423n4/2022-10-thegraph/blob/main/contracts/upgrades/GraphProxy.sol#L140\">GraphProxy.sol#L140</a></p>\n<h3 id=\"description-14\" style=\"position:relative;\"><a href=\"#description-14\" aria-label=\"description 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>In <code>GraphProxy.sol#L140</code>, there is a local variable named <code>_pendingImplementation</code>, but there is a function named <code>_pendingImplementation()</code> in the inherited <code>GraphProxyStorage</code> with the same name. This use causes compilers to issue warnings, negatively affecting checking and code readability. </p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_acceptUpgrade</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_pendingImplementation</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_pendingImplementation</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Address</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isContract</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_pendingImplementation</span><span class=\"mtk1\">), </span><span class=\"mtk8\">\"Implementation must be a contract\"</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_pendingImplementation</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) &amp;&amp; </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">_pendingImplementation</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk8\">\"Caller must be the pending implementation\"</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );        </span><span class=\"mtk3\">// Codes...</span></span></span></code></pre>\n<h3 id=\"recommendation-10\" style=\"position:relative;\"><a href=\"#recommendation-10\" aria-label=\"recommendation 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h3>\n<p>Avoid using variables with the same name, including inherited in the same contract, if used, it must be specified in the NatSpec comments.</p>\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/contests/2022-10-the-graph-l2-bridge-contest",
  "Code": [
    {
      "filename": "contracts/upgrades/GraphProxy.sol",
      "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n\npragma solidity ^0.7.6;\n\nimport \"@openzeppelin/contracts/utils/Address.sol\";\n\nimport \"./GraphProxyStorage.sol\";\n\n/**\n * @title Graph Proxy\n * @dev Graph Proxy contract used to delegate call implementation contracts and support upgrades.\n * This contract should NOT define storage as it is managed by GraphProxyStorage.\n * This contract implements a proxy that is upgradeable by an admin.\n * https://docs.openzeppelin.com/upgrades-plugins/1.x/proxies#transparent-proxies-and-function-clashes\n */\ncontract GraphProxy is GraphProxyStorage {\n    /**\n     * @dev Modifier used internally that will delegate the call to the implementation unless\n     * the sender is the admin.\n     */\n    modifier ifAdmin() {\n        if (msg.sender == _admin()) {\n            _;\n        } else {\n            _fallback();\n        }\n    }\n\n    /**\n     * @dev Modifier used internally that will delegate the call to the implementation unless\n     * the sender is the admin or pending implementation.\n     */\n    modifier ifAdminOrPendingImpl() {\n        if (msg.sender == _admin() || msg.sender == _pendingImplementation()) {\n            _;\n        } else {\n            _fallback();\n        }\n    }\n\n    /**\n     * @dev Contract constructor.\n     * @param _impl Address of the initial implementation\n     * @param _admin Address of the proxy admin\n     */\n    constructor(address _impl, address _admin) {\n        assert(ADMIN_SLOT == bytes32(uint256(keccak256(\"eip1967.proxy.admin\")) - 1));\n        assert(\n            IMPLEMENTATION_SLOT == bytes32(uint256(keccak256(\"eip1967.proxy.implementation\")) - 1)\n        );\n        assert(\n            PENDING_IMPLEMENTATION_SLOT ==\n                bytes32(uint256(keccak256(\"eip1967.proxy.pendingImplementation\")) - 1)\n        );\n\n        _setAdmin(_admin);\n        _setPendingImplementation(_impl);\n    }\n\n    /**\n     * @dev Returns the current admin.\n     *\n     * NOTE: Only the admin and implementation can call this function.\n     *\n     * TIP: To get this value clients can read directly from the storage slot shown below (specified by EIP1967) using the\n     * https://eth.wiki/json-rpc/API#eth_getstorageat[`eth_getStorageAt`] RPC call.\n     * `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`\n     */\n    function admin() external ifAdminOrPendingImpl returns (address) {\n        return _admin();\n    }\n\n    /**\n     * @dev Returns the current implementation.\n     *\n     * NOTE: Only the admin can call this function.\n     *\n     * TIP: To get this value clients can read directly from the storage slot shown below (specified by EIP1967) using the\n     * https://eth.wiki/json-rpc/API#eth_getstorageat[`eth_getStorageAt`] RPC call.\n     * `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`\n     */\n    function implementation() external ifAdminOrPendingImpl returns (address) {\n        return _implementation();\n    }\n\n    /**\n     * @dev Returns the current pending implementation.\n     *\n     * NOTE: Only the admin can call this function.\n     *\n     * TIP: To get this value clients can read directly from the storage slot shown below (specified by EIP1967) using the\n     * https://eth.wiki/json-rpc/API#eth_getstorageat[`eth_getStorageAt`] RPC call.\n     * `0x9e5eddc59e0b171f57125ab86bee043d9128098c3a6b9adb4f2e86333c2f6f8c`\n     */\n    function pendingImplementation() external ifAdminOrPendingImpl returns (address) {\n        return _pendingImplementation();\n    }\n\n    /**\n     * @dev Changes the admin of the proxy.\n     *\n     * NOTE: Only the admin can call this function.\n     */\n    function setAdmin(address _newAdmin) external ifAdmin {\n        require(_newAdmin != address(0), \"Cannot change the admin of a proxy to the zero address\");\n        _setAdmin(_newAdmin);\n    }\n\n    /**\n     * @dev Upgrades to a new implementation contract.\n     * @param _newImplementation Address of implementation contract\n     *\n     * NOTE: Only the admin can call this function.\n     */\n    function upgradeTo(address _newImplementation) external ifAdmin {\n        _setPendingImplementation(_newImplementation);\n    }\n\n    /**\n     * @dev Admin function for new implementation to accept its role as implementation.\n     */\n    function acceptUpgrade() external ifAdminOrPendingImpl {\n        _acceptUpgrade();\n    }\n\n    /**\n     * @dev Admin function for new implementation to accept its role as implementation.\n     */\n    function acceptUpgradeAndCall(bytes calldata data) external ifAdminOrPendingImpl {\n        _acceptUpgrade();\n        // solhint-disable-next-line avoid-low-level-calls\n        (bool success, ) = _implementation().delegatecall(data);\n        require(success);\n    }\n\n    /**\n     * @dev Admin function for new implementation to accept its role as implementation.\n     */\n    function _acceptUpgrade() internal {\n        address _pendingImplementation = _pendingImplementation();\n        require(Address.isContract(_pendingImplementation), \"Implementation must be a contract\");\n        require(\n            _pendingImplementation != address(0) && msg.sender == _pendingImplementation,\n            \"Caller must be the pending implementation\"\n        );\n\n        _setImplementation(_pendingImplementation);\n        _setPendingImplementation(address(0));\n    }\n\n    /**\n     * @dev Delegates the current call to implementation.\n     * This function does not return to its internal call site, it will return directly to the\n     * external caller.\n     */\n    function _fallback() internal {\n        require(msg.sender != _admin(), \"Cannot fallback to proxy target\");\n\n        assembly {\n            // (a) get free memory pointer\n            let ptr := mload(0x40)\n\n            // (b) get address of the implementation\n            let impl := and(sload(IMPLEMENTATION_SLOT), 0xffffffffffffffffffffffffffffffffffffffff)\n\n            // (1) copy incoming call data\n            calldatacopy(ptr, 0, calldatasize())\n\n            // (2) forward call to logic contract\n            let result := delegatecall(gas(), impl, ptr, calldatasize(), 0, 0)\n            let size := returndatasize()\n\n            // (3) retrieve return data\n            returndatacopy(ptr, 0, size)\n\n            // (4) forward return data back to caller\n            switch result\n            case 0 {\n                revert(ptr, size)\n            }\n            default {\n                return(ptr, size)\n            }\n        }\n    }\n\n    /**\n     * @dev Fallback function that delegates calls to implementation. Will run if no other\n     * function in the contract matches the call data.\n     */\n    fallback() external payable {\n        _fallback();\n    }\n\n    /**\n     * @dev Fallback function that delegates calls to implementation. Will run if call data\n     * is empty.\n     */\n    receive() external payable {\n        _fallback();\n    }\n}"
    }
  ]
}