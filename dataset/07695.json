{
  "Title": "[G-09] ",
  "Content": "<h2 id=\"g-09-require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" style=\"position:relative;\"><a href=\"#g-09-require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" aria-label=\"g 09 require or revert statements that check input arguments should be at the top of the function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewbox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] <code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</h2>\n<p>Checks that involve constants should come before checks that involve state variables, function calls, and calculations. By doing these checks first, the function is able to revert before wasting a Gcoldsload (2100 gas*) in a function that may ultimately revert in the unhappy case.</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-11-non-fungible/blob/main/contracts/Pool.sol#L71-L72\">Pool.sol#L71-L72</a></li>\n</ul>\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/contests/2022-11-non-fungible-trading-contest",
  "Code": [
    {
      "filename": "contracts/Pool.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.17;\n\nimport \"@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol\";\nimport \"@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol\";\n\nimport \"./interfaces/IPool.sol\";\n\n/**\n * @title Pool\n * @dev ETH pool; funds can only be transferred by Exchange or Swap\n */\ncontract Pool is IPool, OwnableUpgradeable, UUPSUpgradeable {\n    // required by the OZ UUPS module\n    function _authorizeUpgrade(address) internal override onlyOwner {}\n\n    address private constant EXCHANGE = 0x707531c9999AaeF9232C8FEfBA31FBa4cB78d84a;\n    // TODO: set proper address before deployment\n    address private constant SWAP = 0x707531c9999AaeF9232C8FEfBA31FBa4cB78d84a;\n\n    mapping(address => uint256) private _balances;\n\n    event Transfer(address indexed from, address indexed to, uint256 amount);\n\n    /**\n     * @dev receive deposit function\n     */\n    receive() external payable {\n        deposit();\n    }\n\n    /**\n     * @dev deposit ETH into pool\n     */\n    function deposit() public payable {\n        _balances[msg.sender] += msg.value;\n        emit Transfer(msg.sender, address(0), msg.value);\n    }\n\n    /**\n     * @dev withdraw ETH from pool\n     * @param amount Amount to withdraw\n     */\n    function withdraw(uint256 amount) public {\n        require(_balances[msg.sender] >= amount);\n        _balances[msg.sender] -= amount;\n        (bool success,) = payable(msg.sender).call{value: amount}(\"\");\n        require(success);\n        emit Transfer(address(0), msg.sender, amount);\n    }\n\n    /**\n     * @dev transferFrom Transfer balances within pool; only callable by Swap and Exchange\n     * @param from Pool fund sender\n     * @param to Pool fund recipient\n     * @param amount Amount to transfer\n     */\n    function transferFrom(address from, address to, uint256 amount)\n        public\n        returns (bool)\n    {\n        if (msg.sender != EXCHANGE && msg.sender != SWAP) {\n            revert('Caller is not authorized to transfer');\n        }\n        _transfer(from, to, amount);\n\n        return true;\n    }\n\n    function _transfer(address from, address to, uint256 amount) private {\n        require(_balances[from] >= amount);\n        require(to != address(0));\n        _balances[from] -= amount;\n        _balances[to] += amount;\n\n        emit Transfer(from, to, amount);\n    }\n\n    function balanceOf(address user) public view returns (uint256) {\n        return _balances[user];\n    }\n\n    function totalSupply() public view returns (uint256) {\n        return address(this).balance;\n    }\n}"
    }
  ]
}