{
  "Title": "[G-05] Use a more recent version of solidity",
  "Content": "\nUse a solidity version of at least 0.8.2 to get compiler automatic inlining\nUse a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads\nUse a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than `revert()/require()` strings\nUse a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value\n\n1.  File: contracts/pcv/compound/CompoundPCVDepositBase.sol (line [2](https://github.com/code-423n4/2022-03-volt/blob/f1210bf3151095e4d371c9e9d7682d9031860bbd/contracts/pcv/compound/CompoundPCVDepositBase.sol#L2))\n\n```solidity\npragma solidity ^0.8.0;\n```\n\n2.  File: contracts/pcv/compound/ERC20CompoundPCVDeposit.sol (line [2](https://github.com/code-423n4/2022-03-volt/blob/f1210bf3151095e4d371c9e9d7682d9031860bbd/contracts/pcv/compound/ERC20CompoundPCVDeposit.sol#L2))\n\n```solidity\npragma solidity ^0.8.0;\n```\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/contests/2022-03-volt-protocol-contest",
  "Code": [
    {
      "filename": "contracts/pcv/compound/CompoundPCVDepositBase.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity ^0.8.0;\n\nimport \"../PCVDeposit.sol\";\nimport \"../../refs/CoreRef.sol\";\nimport \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\n\ninterface CToken {\n    function redeemUnderlying(uint256 redeemAmount) external returns (uint256);\n\n    function exchangeRateStored() external view returns (uint256);\n\n    function balanceOf(address account) external view returns (uint256);\n\n    function isCToken() external view returns (bool);\n\n    function isCEther() external view returns (bool);\n}\n\n/// @title base class for a Compound PCV Deposit\n/// @author Fei Protocol\nabstract contract CompoundPCVDepositBase is PCVDeposit {\n    CToken public cToken;\n\n    uint256 private constant EXCHANGE_RATE_SCALE = 1e18;\n\n    /// @notice Compound PCV Deposit constructor\n    /// @param _core Fei Core for reference\n    /// @param _cToken Compound cToken to deposit\n    constructor(address _core, address _cToken) CoreRef(_core) {\n        cToken = CToken(_cToken);\n        require(cToken.isCToken(), \"CompoundPCVDeposit: Not a cToken\");\n    }\n\n    /// @notice withdraw tokens from the PCV allocation\n    /// @param amountUnderlying of tokens withdrawn\n    /// @param to the address to send PCV to\n    function withdraw(address to, uint256 amountUnderlying)\n        external\n        override\n        onlyPCVController\n        whenNotPaused\n    {\n        require(\n            cToken.redeemUnderlying(amountUnderlying) == 0,\n            \"CompoundPCVDeposit: redeem error\"\n        );\n        _transferUnderlying(to, amountUnderlying);\n        emit Withdrawal(msg.sender, to, amountUnderlying);\n    }\n\n    /// @notice returns total balance of PCV in the Deposit excluding the FEI\n    /// @dev returns stale values from Compound if the market hasn't been updated\n    function balance() public view override returns (uint256) {\n        uint256 exchangeRate = cToken.exchangeRateStored();\n        return\n            (cToken.balanceOf(address(this)) * exchangeRate) /\n            EXCHANGE_RATE_SCALE;\n    }\n\n    function _transferUnderlying(address to, uint256 amount) internal virtual;\n}"
    },
    {
      "filename": "contracts/pcv/compound/ERC20CompoundPCVDeposit.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity ^0.8.0;\n\nimport \"./CompoundPCVDepositBase.sol\";\n\ninterface CErc20 {\n    function mint(uint256 amount) external returns (uint256);\n\n    function underlying() external returns (address);\n}\n\n/// @title ERC-20 implementation for a Compound PCV Deposit\n/// @author Fei Protocol\ncontract ERC20CompoundPCVDeposit is CompoundPCVDepositBase {\n    /// @notice the token underlying the cToken\n    IERC20 public token;\n\n    /// @notice Compound ERC20 PCV Deposit constructor\n    /// @param _core Fei Core for reference\n    /// @param _cToken Compound cToken to deposit\n    constructor(address _core, address _cToken)\n        CompoundPCVDepositBase(_core, _cToken)\n    {\n        token = IERC20(CErc20(_cToken).underlying());\n    }\n\n    /// @notice deposit ERC-20 tokens to Compound\n    function deposit() external override whenNotPaused {\n        uint256 amount = token.balanceOf(address(this));\n\n        token.approve(address(cToken), amount);\n\n        // Compound returns non-zero when there is an error\n        require(\n            CErc20(address(cToken)).mint(amount) == 0,\n            \"ERC20CompoundPCVDeposit: deposit error\"\n        );\n\n        emit Deposit(msg.sender, amount);\n    }\n\n    function _transferUnderlying(address to, uint256 amount) internal override {\n        SafeERC20.safeTransfer(token, to, amount);\n    }\n\n    /// @notice display the related token of the balance reported\n    function balanceReportedIn() public view override returns (address) {\n        return address(token);\n    }\n}"
    }
  ]
}