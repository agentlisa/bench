{
  "Title": "[H-01] Anyone can update the address of the Router in the DcntEth contract to any address they would like to set.",
  "Content": "\nBy allowing anybody to set the address of the Router contract to any address they want to set it allows malicious users to get access to the mint and burn functions of the DcntEth contract.\n\n### Proof of Concept\n\nThe [`DcntEth::setRouter() function`](https://github.com/decentxyz/decent-bridge/blob/7f90fd4489551b69c20d11eeecb17a3f564afb18/src/DcntEth.sol#L20-L22) has not an access control to restrict who can call this function. This allows anybody to set the address of the router contract to any address they'd like to set it.\n\n> DcntEth.sol\n\n```solidity\n//@audit-issue => No access control to restrict who can set the address of the router contract\nfunction setRouter(address _router) public {\n    router = _router;\n}\n```\n\nThe functions [`DcntEth::mint() function`](https://github.com/decentxyz/decent-bridge/blob/7f90fd4489551b69c20d11eeecb17a3f564afb18/src/DcntEth.sol#L24-L26) & [`DcntEth::burn() function`](https://github.com/decentxyz/decent-bridge/blob/7f90fd4489551b69c20d11eeecb17a3f564afb18/src/DcntEth.sol#L28-L30) can be called only by the router contract.\n\n> DcntEth.sol\n\n```solidity\n\n    //@audit-info => Only the router can call the mint()\n    function mint(address _to, uint256 _amount) public onlyRouter {\n        _mint(_to, _amount);\n    }\n\n    //@audit-info => Only the router can call the burn()\n    function burn(address _from, uint256 _amount) public onlyRouter {\n        _burn(_from, _amount);\n    }\n```\n\nA malicious user can set the address of the router contract to an account of their own and:\n\n1.  Gain access to mint unlimited amounts of DcntEth token, which could be used to disrupt the crosschain accounting mechanism, or to steal the deposited weth in the DecentEthRouter contract.\n2.  Burn all the DcntEth tokens that were issued to the DecentEthRouter contract when liquidity providers deposited their WETH or ETH into it.\n3.  Cause a DoS to the add and remove liquidity functions of the DecentEthRouter contract. All of these functions end up calling the [`DcntEth::mint() function`](https://github.com/decentxyz/decent-bridge/blob/7f90fd4489551b69c20d11eeecb17a3f564afb18/src/DcntEth.sol#L24-L26) or the [`DcntEth::burn() function`](https://github.com/decentxyz/decent-bridge/blob/7f90fd4489551b69c20d11eeecb17a3f564afb18/src/DcntEth.sol#L28-L30), if the router address is set to be different than the address of the DecentEthRouter, all the calls made from the DecentEthRouter to the DcnEth contract will revert.\n\n> DecentEthRouter.sol\n\n<details>\n\n```solidity\n\n    /// @inheritdoc IDecentEthRouter\n    function addLiquidityEth()\n        public\n        payable\n        onlyEthChain\n        userDepositing(msg.value)\n    {\n        weth.deposit{value: msg.value}();\n        \n        //@audit-issue => If router in the dcnteth contract is not set to the address of the DecentEthRouter, this call will revert\n        dcntEth.mint(address(this), msg.value);\n    }\n\n    /// @inheritdoc IDecentEthRouter\n    function removeLiquidityEth(\n        uint256 amount\n    ) public onlyEthChain userIsWithdrawing(amount) {\n\n      //@audit-issue => If router in the dcnteth contract is not set to the address of the DecentEthRouter, this call will revert\n        dcntEth.burn(address(this), amount);\n        weth.withdraw(amount);\n        payable(msg.sender).transfer(amount);\n    }\n\n    /// @inheritdoc IDecentEthRouter\n    function addLiquidityWeth(\n        uint256 amount\n    ) public payable userDepositing(amount) {\n        weth.transferFrom(msg.sender, address(this), amount);\n\n        //@audit-issue => If router in the dcnteth contract is not set to the address of the DecentEthRouter, this call will revert\n        dcntEth.mint(address(this), amount);\n    }\n\n    /// @inheritdoc IDecentEthRouter\n    function removeLiquidityWeth(\n        uint256 amount\n    ) public userIsWithdrawing(amount) {\n\n      //@audit-issue => If router in the dcnteth contract is not set to the address of the DecentEthRouter, this call will revert\n        dcntEth.burn(address(this), amount);\n        weth.transfer(msg.sender, amount);\n    }\n```\n\n</details>\n\n### Recommended Mitigation Steps\n\nMake sure to add an Acess Control mechanism to limit who can set the address of the Router in the DcnEth contract.\n\n\n**[0xsomeone (Judge) commented](https://github.com/code-423n4/2024-01-decent-findings/issues/721#issuecomment-1925323247):**\n > This and all relevant submissions correctly specify that the lack of access control in the `DcntEth::setRouter` function can be exploited maliciously and effectively compromise the entire TVL of the Decent ETH token.\n> \n> A high-risk severity is appropriate, and this submission was selected as the best due to detailing all possible impacts:\n> \n> - Arbitrary mints of the token to withdraw funds provided as liquidity to `UTB`\n> - Arbitrary burns to sabotage liquidity pools and other escrow-based contracts\n> - Sabotage of liquidity provision function invocations\n\n**[wkantaros (Decent) confirmed](https://github.com/code-423n4/2024-01-decent-findings/issues/721#issuecomment-1942664512)**\n\n***\n\n",
  "Impact": "HIGH",
  "Source": "https://code4rena.com/reports/2024-01-decent",
  "Code": [
    {
      "filename": "src/DcntEth.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.13;\nimport {OFTV2} from \"solidity-examples/token/oft/v2/OFTV2.sol\";\n\ncontract DcntEth is OFTV2 {\n    address public router;\n\n    modifier onlyRouter() {\n        require(msg.sender == router);\n        _;\n    }\n\n    constructor(\n        address _layerZeroEndpoint\n    ) OFTV2(\"Decent Eth\", \"DcntEth\", 18, _layerZeroEndpoint) {}\n\n    /**\n     * @param _router the decentEthRouter associated with this eth\n     */\n    function setRouter(address _router) public {\n        router = _router;\n    }\n\n    function mint(address _to, uint256 _amount) public onlyRouter {\n        _mint(_to, _amount);\n    }\n\n    function burn(address _from, uint256 _amount) public onlyRouter {\n        _burn(_from, _amount);\n    }\n\n    function mintByOwner(address _to, uint256 _amount) public onlyOwner {\n        _mint(_to, _amount);\n    }\n\n    function burnByOwner(address _from, uint256 _amount) public onlyOwner {\n        _burn(_from, _amount);\n    }\n}"
    },
    {
      "filename": "src/DcntEth.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.13;\nimport {OFTV2} from \"solidity-examples/token/oft/v2/OFTV2.sol\";\n\ncontract DcntEth is OFTV2 {\n    address public router;\n\n    modifier onlyRouter() {\n        require(msg.sender == router);\n        _;\n    }\n\n    constructor(\n        address _layerZeroEndpoint\n    ) OFTV2(\"Decent Eth\", \"DcntEth\", 18, _layerZeroEndpoint) {}\n\n    /**\n     * @param _router the decentEthRouter associated with this eth\n     */\n    function setRouter(address _router) public {\n        router = _router;\n    }\n\n    function mint(address _to, uint256 _amount) public onlyRouter {\n        _mint(_to, _amount);\n    }\n\n    function burn(address _from, uint256 _amount) public onlyRouter {\n        _burn(_from, _amount);\n    }\n\n    function mintByOwner(address _to, uint256 _amount) public onlyOwner {\n        _mint(_to, _amount);\n    }\n\n    function burnByOwner(address _from, uint256 _amount) public onlyOwner {\n        _burn(_from, _amount);\n    }\n}"
    },
    {
      "filename": "src/DcntEth.sol",
      "content": "// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.13;\nimport {OFTV2} from \"solidity-examples/token/oft/v2/OFTV2.sol\";\n\ncontract DcntEth is OFTV2 {\n    address public router;\n\n    modifier onlyRouter() {\n        require(msg.sender == router);\n        _;\n    }\n\n    constructor(\n        address _layerZeroEndpoint\n    ) OFTV2(\"Decent Eth\", \"DcntEth\", 18, _layerZeroEndpoint) {}\n\n    /**\n     * @param _router the decentEthRouter associated with this eth\n     */\n    function setRouter(address _router) public {\n        router = _router;\n    }\n\n    function mint(address _to, uint256 _amount) public onlyRouter {\n        _mint(_to, _amount);\n    }\n\n    function burn(address _from, uint256 _amount) public onlyRouter {\n        _burn(_from, _amount);\n    }\n\n    function mintByOwner(address _to, uint256 _amount) public onlyOwner {\n        _mint(_to, _amount);\n    }\n\n    function burnByOwner(address _from, uint256 _amount) public onlyOwner {\n        _burn(_from, _amount);\n    }\n}"
    }
  ]
}