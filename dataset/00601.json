{
  "Title": "requireInterface Is Incorrectly Specified",
  "Content": "The [`requireInterface` function](https://github.com/latticexyz/mud/blob/12a9eb1afb18a7f7cb43d774cabb2d5af7c74e6b/packages/world/src/requireInterface.sol#L19) is incorrectly specified in two ways.\n\n\nFirstly, it uses a `try-catch` block to revert with a meaningful error if the contract does not implement the expected interface. However, this will only catch errors that occur in the context of the target contract. If the target contract has no code, or returns a value that cannot be decoded as a boolean, the error will occur in the caller's context and will revert outside the `try-catch` block.\n\n\nSecondly, it discards some requirements of the [EIP specification](https://eips.ethereum.org/EIPS/eip-165). To be compliant, it should confirm that the `supportsInterface` function returns `false` for the invalid interface `0xffffffff`, and that it does not consume more than 30000 gas. This ensures that unrelated contracts that happen to have a fallback function that returns at least 32 bytes will not mistakenly pass the validation.\n\n\nConsider using the [OpenZeppelin `ERC165Checker` contract](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/merge/release-v5.0/contracts/utils/introspection/ERC165Checker.sol), or correcting these deviations.\n\n\n***Update:** Resolved in [pull request #2016](https://github.com/latticexyz/mud/pull/2016).*\n\n\n",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "packages/world/src/requireInterface.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity >=0.8.21;\n\nimport { IERC165 } from \"./IERC165.sol\";\nimport { IWorldErrors } from \"./IWorldErrors.sol\";\n\n/**\n * @title Interface Validator\n * @notice Utility function to validate interface support on a given contract using ERC-165.\n * @dev This function uses the ERC-165 standard's `supportsInterface` to check if a given contract supports a specific interface.\n */\n\n/**\n * @notice Checks if a given contract at `contractAddress` supports the interface with ID `interfaceId`.\n * @dev Uses the ERC-165 `supportsInterface` method. If the contract doesn't support the interface or doesn't implement ERC-165, the function will revert with a relevant error message.\n * @param contractAddress The address of the contract to check.\n * @param interfaceId The interface ID to verify.\n */\nfunction requireInterface(address contractAddress, bytes4 interfaceId) view {\n  try IERC165(contractAddress).supportsInterface(interfaceId) returns (bool supported) {\n    if (!supported) {\n      revert IWorldErrors.World_InterfaceNotSupported(contractAddress, interfaceId);\n    }\n  } catch {\n    revert IWorldErrors.World_InterfaceNotSupported(contractAddress, interfaceId);\n  }\n}"
    }
  ]
}