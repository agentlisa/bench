{
  "Title": "[L05] Interfaces are missing functions present in their implementations",
  "Content": "Interfaces in the codebase are not fully matching their implementation, defining only a part of the functionalities implemented in their respectives contracts. Some of them are:\n\n\n* The [`IMetaTransactionWallet` interface](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol#L3) is implemented by the [`MetaTransactionWallet` contract](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/common/MetaTransactionWallet.sol). The interface does not include all function such as the [`getMetaTransactionSigner` function](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/common/MetaTransactionWallet.sol#L139).\n* The [`IElection` interface](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/interfaces/IElection.sol#L3) is implemented by the [`Election` contract](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/Election.sol#L20). Functions such as the [`getTotalVotesForGroup` function](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/Election.sol#L535) are not defined in the interface.\n* The [`IReleaseGold` interface](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/interfaces/IReleaseGold.sol#L3) is implemented by the [`ReleaseGold` contract](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/ReleaseGold.sol). Not all functions implemented in that contract are included as definitions in the interface, such as the [`setCanExpire` function](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/ReleaseGold.sol#L279).\n* The [`IValidators` interface](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/common/interfaces/IValidators.sol#L3) is implemented by the [`Validators` contract](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/Validators.sol). The interface does not include all functions implemented by the contract, such as the [`getCommissionUpdateDelay` function](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/governance/Validators.sol#L285).\n* The [`IAttestations` interface](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/identity/interfaces/IAttestations.sol#L3) is implemented by the [`Attestations` contract](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/identity/Attestations.sol). Not all the implemented functions are defined in the interface, such as the [`getAttestationIssuers` function](https://github.com/celo-org/celo-monorepo/blob/b2f0a58fcc7667d41585123aae5b24c47aa894f6/packages/protocol/contracts/identity/Attestations.sol#L360).\n\n\nThese mismatches between the interface and its implementation are confusing. It can mean that there are problems with the modeling of the system or that the updates to the implemenations and interfaces got out of sync.\n\n\nConsider adding these, and all other, missing functions to the corresponding interface, so there is one basic implementation that directly matches the interface specification. Alternatively, if there are reasons for these functions to be only in the implementations, for each case consider to add a new contract that inherits from the basic implementation, to move the extra functions to this contract, and to add to its docstrings the reason for extending the interface.\n\n\n***Update**: Partially fixed on [pull request 4958](https://github.com/celo-org/celo-monorepo/pull/4958). There are still some interfaces that do not represent their corresponding implementation, such as the [`IExchange` interface](https://github.com/celo-org/celo-monorepo/blob/f25f23c0e69a6ee588c932da9b5e886c0c64a4d2/packages/protocol/contracts/stability/interfaces/IExchange.sol#L3).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IMetaTransactionWallet {\n  function setSigner(address) external;\n  function setEip712DomainSeparator() external;\n  function executeTransaction(address, uint256, bytes calldata) external returns (bytes memory);\n  function executeTransactions(\n    address[] calldata,\n    uint256[] calldata,\n    bytes calldata,\n    uint256[] calldata\n  ) external;\n  function executeMetaTransaction(address, uint256, bytes calldata, uint8, bytes32, bytes32)\n    external\n    returns (bytes memory);\n}"
    },
    {
      "filename": "packages/protocol/contracts/governance/interfaces/IElection.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IElection {\n  function getTotalVotes() external view returns (uint256);\n  function getActiveVotes() external view returns (uint256);\n  function getTotalVotesByAccount(address) external view returns (uint256);\n  function markGroupIneligible(address) external;\n  function markGroupEligible(address, address, address) external;\n  function electValidatorSigners() external view returns (address[] memory);\n  function vote(address, uint256, address, address) external returns (bool);\n  function activate(address) external returns (bool);\n  function revokeActive(address, uint256, address, address, uint256) external returns (bool);\n  function revokeAllActive(address, address, address, uint256) external returns (bool);\n  function revokePending(address, uint256, address, address, uint256) external returns (bool);\n  function forceDecrementVotes(\n    address,\n    uint256,\n    address[] calldata,\n    address[] calldata,\n    uint256[] calldata\n  ) external returns (uint256);\n}"
    },
    {
      "filename": "packages/protocol/contracts/governance/interfaces/IReleaseGold.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IReleaseGold {\n  function isRevoked() external view returns (bool);\n  function withdraw(uint256) external;\n  function refundAndFinalize() external;\n  function revoke() external;\n  function lockGold(uint256) external;\n  function unlockGold(uint256) external;\n  function relockGold(uint256, uint256) external;\n  function withdrawLockedGold(uint256) external;\n  function authorizeVoteSigner(address payable, uint8, bytes32, bytes32) external;\n  function createAccount() external;\n  function setAccount(string calldata, bytes calldata, address, uint8, bytes32, bytes32) external;\n  function setAccountName(string calldata) external;\n  function setAccountWalletAddress(address, uint8, bytes32, bytes32) external;\n  function setAccountDataEncryptionKey(bytes calldata) external;\n  function setAccountMetadataURL(string calldata) external;\n  function revokeActive(address, uint256, address, address, uint256) external;\n  function revokePending(address, uint256, address, address, uint256) external;\n\n  function getTotalBalance() external view returns (uint256);\n  function getRemainingTotalBalance() external view returns (uint256);\n  function getRemainingUnlockedBalance() external view returns (uint256);\n  function getRemainingLockedBalance() external view returns (uint256);\n  function getCurrentReleasedTotalAmount() external view returns (uint256);\n}"
    },
    {
      "filename": "packages/protocol/contracts/common/interfaces/IValidators.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IValidators {\n  function addValidator(address) external;\n  function removeValidator(address, uint256) external;\n  function addPublicKey(address, bytes calldata) external;\n  function getValidators() external view returns (address[] memory);\n  function getPublicKey(address) external view returns (bytes memory);\n}"
    },
    {
      "filename": "packages/protocol/contracts/identity/interfaces/IAttestations.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IAttestations {\n  function setAttestationRequestFee(address, uint256) external;\n  function request(bytes32, uint256, address) external;\n  function selectIssuers(bytes32) external;\n  function complete(bytes32, uint8, bytes32, bytes32) external;\n  function revoke(bytes32, uint256) external;\n  function withdraw(address) external;\n\n  function setAttestationExpiryBlocks(uint256) external;\n\n  function getMaxAttestations() external view returns (uint256);\n\n  function getUnselectedRequest(bytes32, address) external view returns (uint32, uint32, address);\n  function getAttestationRequestFee(address) external view returns (uint256);\n\n  function lookupAccountsForIdentifier(bytes32) external view returns (address[] memory);\n\n  function getAttestationStats(bytes32, address) external view returns (uint32, uint32);\n\n  function getAttestationState(bytes32, address, address)\n    external\n    view\n    returns (uint8, uint32, address);\n  function getCompletableAttestations(bytes32, address)\n    external\n    view\n    returns (uint32[] memory, address[] memory, uint256[] memory, bytes memory);\n\n  function requireNAttestationsRequested(bytes32, address, uint32) external view;\n  function approveTransfer(bytes32, uint256, address, address, bool) external;\n}"
    }
  ]
}