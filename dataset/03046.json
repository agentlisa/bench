{
  "Title": "M-6: Signature malleability not protected against",
  "Content": "# Issue M-6: Signature malleability not protected against \n\nSource: https://github.com/sherlock-audit/2022-09-harpie-judging/tree/main/010-M \n\n## Found by \n0xNazgul, pashov, IllIllI, ladboy233, defsec, sirhashalot\n\n## Summary\nOpenZeppelin has a vulnerability in versions lower than 4.7.3, which can be exploited by an attacker. The project uses a vulnerable version\n\n## Vulnerability Detail\nAll of the conditions from the advisory are satisfied: the signature comes in a single `bytes` argument, `ECDSA.recover()` is used, and the signatures themselves are used for replay protection checks\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-4h98-2769-gh6h\n\nIf a user calls `changeRecipientAddress()`, notices a mistake, then calls `changeRecipientAddress()` again, an attacker can use signature malleability to re-submit the first change request, as long as the old request has not expired yet.\n\n## Impact\nThe wrong, potentially now-malicious, address will be the valid change recipient, which could lead to the loss of funds (e.g. the attacker attacked, the user changed to another compromised address, noticed the issue, then changed to a whole new account address, but the attacker was able to change it back and withdraw the funds to the unprotected address).\n\n## Code Snippet\nhttps://github.com/Harpieio/contracts/blob/97083d7ce8ae9d85e29a139b1e981464ff92b89e/package.json#L23\n\n## Tool used\n\nManual Review\n\n## Recommendation\nChange to version 4.7.3\n\n## Lead Senior Watson\nGood find and the fix seems straightforward. Upgrade OZ.\n\n## Harpie Team\nUpdated openzeppelin NPM package to do ECDSA 4.7.3. Fix [here](https://github.com/Harpieio/contracts/pull/4/commits/74e54edfe43480f71d30acac578627c38366ffa6).\n\n## Lead Senior Watson\nConfirmed fix. \n\n",
  "Impact": "MEDIUM",
  "Source": "https://app.sherlock.xyz/audits/contests/3",
  "Code": [
    {
      "filename": "package.json",
      "content": "{\n  \"name\": \"hardhat-tutorial\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@nomiclabs/hardhat-ethers\": \"^2.0.6\",\n    \"@nomiclabs/hardhat-etherscan\": \"^3.0.4\",\n    \"@nomiclabs/hardhat-waffle\": \"^2.0.3\",\n    \"chai\": \"^4.3.6\",\n    \"ethereum-waffle\": \"^3.4.4\",\n    \"ethers\": \"^5.6.6\",\n    \"hardhat\": \"^2.9.5\",\n    \"hardhat-gas-reporter\": \"^1.0.8\"\n  },\n  \"dependencies\": {\n    \"@openzeppelin/contracts\": \"^4.6.0\",\n    \"chai-as-promised\": \"^7.1.1\",\n    \"dotenv\": \"^16.0.1\"\n  }\n}"
    }
  ]
}