{
  "Title": "Unsafe Typecasting in uintMul() and uintDiv()",
  "Content": "\n\n\nThe divisor argument of [`uintDiv`](https://github.com/VenusProtocol/venus-protocol/blob/f31a0543da039dab69112c6be3e36ea54959503b/contracts/Tokens/Prime/libs/FixedMath.sol#L32) and the multiplier argument of [`uintMul`](https://github.com/VenusProtocol/venus-protocol/blob/f31a0543da039dab69112c6be3e36ea54959503b/contracts/Tokens/Prime/libs/FixedMath.sol#L43) in the `FixedMath` library are both signed integers. \n\n\nThe results of multiplication and division operations involving these arguments will therefore be signed, and the results of both the `uintDiv` and `uintMul` functions are downcast to `uint256`. \n\n\nWhile this may produce the correct results when the multiplier and divisor arguments are properly-encoded fixed-point numbers, it will produce erroneous results when the high bit of either of these arguments is set. \n\n\nConsider adding a check to ensure that the multiplier argument of `uintMul` and the divisor argument of `uintDiv` are well-formed fixed-point numbers. \n\n\n\n\n\n***Update:** Resolved at commit [61ad1e7](https://github.com/VenusProtocol/venus-protocol/commit/61ad1e7a6dc5c1f6860152293f84335d617a1094).*\n\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/Tokens/Prime/libs/FixedMath.sol",
      "content": "// SPDX-License-Identifier: MIT\n// solhint-disable var-name-mixedcase\n\npragma solidity 0.8.13;\n\nimport \"@openzeppelin/contracts-upgradeable/utils/math/SafeCastUpgradeable.sol\";\nimport \"./FixedMath0x.sol\";\n\nusing SafeCastUpgradeable for uint256;\n\nlibrary FixedMath {\n    error InvalidFraction(uint256 n, uint256 d);\n\n    /**\n     * @notice Convert some uint256 fraction `n` numerator / `d` denominator to a fixed-point number `f`.\n     * @param n numerator\n     * @param d denominator\n     * @return fixed-point number\n     */\n    function toFixed(uint256 n, uint256 d) internal pure returns (int256) {\n        if (d.toInt256() < n.toInt256()) revert InvalidFraction(n, d);\n\n        return (n.toInt256() * FixedMath0x.FIXED_1) / int256(d.toInt256());\n    }\n\n    /**\n     * @notice Divide some unsigned int `u` by a fixed point number `f`\n     * @param u unsigned dividend\n     * @param f fixed point divisor, in FIXED_1 units\n     * @return unsigned int quotient\n     */\n    function uintDiv(uint256 u, int256 f) internal pure returns (uint256) {\n        // multiply `u` by FIXED_1 to cancel out the built-in FIXED_1 in f\n        return uint256((u.toInt256() * FixedMath0x.FIXED_1) / f);\n    }\n\n    /**\n     * @notice Multiply some unsigned int `u` by a fixed point number `f`\n     * @param u unsigned multiplicand\n     * @param f fixed point multiplier, in FIXED_1 units\n     * @return unsigned int product\n     */\n    function uintMul(uint256 u, int256 f) internal pure returns (uint256) {\n        // divide the product by FIXED_1 to cancel out the built-in FIXED_1 in f\n        return uint256((u.toInt256() * f) / FixedMath0x.FIXED_1);\n    }\n\n    /// @notice see FixedMath0x\n    function ln(int256 x) internal pure returns (int256 r) {\n        return FixedMath0x.ln(x);\n    }\n\n    /// @notice see FixedMath0x\n    function exp(int256 x) internal pure returns (int256 r) {\n        return FixedMath0x.exp(x);\n    }\n}"
    }
  ]
}