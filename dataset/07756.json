{
  "Title": "[G-03] Reorder structure layout",
  "Content": "\nThe following structures could be optimized moving the position of certain values in order to save a lot slots:\n\n```diff\n    struct EncryptedBid {\n        address sender;\n+       ECCMath.Point pubKey;\n        uint128 quoteAmount;\n        uint128 filledBaseAmount;\n        uint128 baseWithdrawn;\n        bytes32 commitment;\n-       ECCMath.Point pubKey;\n        bytes32 encryptedMessage;\n    }\n```\n\n```diff\n    struct AuctionParameters {\n        address baseToken;\n        address quoteToken;\n+       ECCMath.Point pubKey;\n        uint256 reserveQuotePerBase;\n        uint128 totalBaseAmount;\n        uint128 minimumBidQuote;\n        bytes32 merkleRoot;\n-       ECCMath.Point pubKey;\n    }\n```\n\n**Reference:**\n\n- https://ethdebug.github.io/solidity-data-representation\n\n> Enums are represented by integers; the possibility listed first by 0, the next by 1, and so forth. An enum type just acts like uintN, where N is the smallest legal value large enough to accomodate all the possibilities.\n\n- https://docs.soliditylang.org/en/v0.8.17/internals/layout_in_storage.html#storage-inplace-encoding\n\n**Affected source code:**\n\n- [ISizeSealed.sol:46](https://github.com/code-423n4/2022-11-size/blob/706a77e585d0852eae6ba0dca73dc73eb37f8fb6/src/interfaces/ISizeSealed.sol#L46)\n- [ISizeSealed.sol:83](https://github.com/code-423n4/2022-11-size/blob/706a77e585d0852eae6ba0dca73dc73eb37f8fb6/src/interfaces/ISizeSealed.sol#L83)\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/contests/2022-11-size-contest",
  "Code": [
    {
      "filename": "src/interfaces/ISizeSealed.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0\npragma solidity 0.8.17;\n\nimport {ECCMath} from \"../util/ECCMath.sol\";\n\ninterface ISizeSealed {\n    ////////////////////////////////////\n    ///            ERRORS            ///\n    ////////////////////////////////////\n\n    error InvalidTimestamp();\n    error InvalidCliffPercent();\n    error InvalidBidAmount();\n    error InvalidState();\n    error InvalidReserve();\n    error InvalidCalldata();\n    error UnauthorizedCaller();\n    error CommitmentMismatch();\n    error InvalidProof();\n    error InvalidPrivateKey();\n    error UnexpectedBalanceChange();\n    error InvalidSorting();\n\n    /////////////////////////////////////////\n    ///              ENUMS                ///\n    /////////////////////////////////////////\n\n    enum States {\n        Created,\n        AcceptingBids,\n        RevealPeriod,\n        Voided,\n        Finalized\n    }\n\n    /////////////////////////////////////////\n    ///              STRUCTS              ///\n    /////////////////////////////////////////\n\n    struct EncryptedBid {\n        address sender;\n        uint128 quoteAmount;\n        uint128 filledBaseAmount;\n        uint128 baseWithdrawn;\n        bytes32 commitment;\n        ECCMath.Point pubKey;\n        bytes32 encryptedMessage;\n    }\n\n    /// @param startTimestamp When the auction opens for bidding\n    /// @param endTimestamp When the auction closes for bidding\n    /// @param vestingStartTimestamp When linear vesting starts\n    /// @param vestingEndTimestamp When linear vesting is complete\n    /// @param cliffPercent Normalized percentage of base tokens to unlock at vesting start\n    struct Timings {\n        uint32 startTimestamp;\n        uint32 endTimestamp;\n        uint32 vestingStartTimestamp;\n        uint32 vestingEndTimestamp;\n        uint128 cliffPercent;\n    }\n\n    struct AuctionData {\n        address seller;\n        uint128 lowestBase;\n        uint128 lowestQuote;\n        uint256 privKey;\n    }\n\n    /// @param baseToken The ERC20 to be sold by the seller\n    /// @param quoteToken The ERC20 to be bid by the bidders\n    /// @param reserveQuotePerBase Minimum price that bids will be filled at\n    /// @param totalBaseAmount Max amount of `baseToken` to be auctioned\n    /// @param minimumBidQuote Minimum quote amount a bid can buy\n    /// @param pubKey On-chain storage of seller's ephemeral public key\n    struct AuctionParameters {\n        address baseToken;\n        address quoteToken;\n        uint256 reserveQuotePerBase;\n        uint128 totalBaseAmount;\n        uint128 minimumBidQuote;\n        bytes32 merkleRoot;\n        ECCMath.Point pubKey;\n    }\n\n    struct Auction {\n        Timings timings;\n        AuctionData data;\n        AuctionParameters params;\n        EncryptedBid[] bids;\n    }\n\n    ////////////////////////////////////\n    ///            EVENTS            ///\n    ////////////////////////////////////\n\n    event AuctionCreated(\n        uint256 auctionId, address seller, AuctionParameters params, Timings timings, bytes encryptedPrivKey\n    );\n\n    event AuctionCancelled(uint256 auctionId);\n\n    event Bid(\n        address sender,\n        uint256 auctionId,\n        uint256 bidIndex,\n        uint128 quoteAmount,\n        bytes32 commitment,\n        ECCMath.Point pubKey,\n        bytes32 encryptedMessage,\n        bytes encryptedPrivateKey\n    );\n\n    event BidCancelled(uint256 auctionId, uint256 bidIndex);\n\n    event RevealedKey(uint256 auctionId, uint256 privateKey);\n\n    event AuctionFinalized(uint256 auctionId, uint256[] bidIndices, uint256 filledBase, uint256 filledQuote);\n\n    event BidRefund(uint256 auctionId, uint256 bidIndex);\n\n    event Withdrawal(uint256 auctionId, uint256 bidIndex, uint256 withdrawAmount, uint256 remainingAmount);\n}"
    },
    {
      "filename": "src/interfaces/ISizeSealed.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0\npragma solidity 0.8.17;\n\nimport {ECCMath} from \"../util/ECCMath.sol\";\n\ninterface ISizeSealed {\n    ////////////////////////////////////\n    ///            ERRORS            ///\n    ////////////////////////////////////\n\n    error InvalidTimestamp();\n    error InvalidCliffPercent();\n    error InvalidBidAmount();\n    error InvalidState();\n    error InvalidReserve();\n    error InvalidCalldata();\n    error UnauthorizedCaller();\n    error CommitmentMismatch();\n    error InvalidProof();\n    error InvalidPrivateKey();\n    error UnexpectedBalanceChange();\n    error InvalidSorting();\n\n    /////////////////////////////////////////\n    ///              ENUMS                ///\n    /////////////////////////////////////////\n\n    enum States {\n        Created,\n        AcceptingBids,\n        RevealPeriod,\n        Voided,\n        Finalized\n    }\n\n    /////////////////////////////////////////\n    ///              STRUCTS              ///\n    /////////////////////////////////////////\n\n    struct EncryptedBid {\n        address sender;\n        uint128 quoteAmount;\n        uint128 filledBaseAmount;\n        uint128 baseWithdrawn;\n        bytes32 commitment;\n        ECCMath.Point pubKey;\n        bytes32 encryptedMessage;\n    }\n\n    /// @param startTimestamp When the auction opens for bidding\n    /// @param endTimestamp When the auction closes for bidding\n    /// @param vestingStartTimestamp When linear vesting starts\n    /// @param vestingEndTimestamp When linear vesting is complete\n    /// @param cliffPercent Normalized percentage of base tokens to unlock at vesting start\n    struct Timings {\n        uint32 startTimestamp;\n        uint32 endTimestamp;\n        uint32 vestingStartTimestamp;\n        uint32 vestingEndTimestamp;\n        uint128 cliffPercent;\n    }\n\n    struct AuctionData {\n        address seller;\n        uint128 lowestBase;\n        uint128 lowestQuote;\n        uint256 privKey;\n    }\n\n    /// @param baseToken The ERC20 to be sold by the seller\n    /// @param quoteToken The ERC20 to be bid by the bidders\n    /// @param reserveQuotePerBase Minimum price that bids will be filled at\n    /// @param totalBaseAmount Max amount of `baseToken` to be auctioned\n    /// @param minimumBidQuote Minimum quote amount a bid can buy\n    /// @param pubKey On-chain storage of seller's ephemeral public key\n    struct AuctionParameters {\n        address baseToken;\n        address quoteToken;\n        uint256 reserveQuotePerBase;\n        uint128 totalBaseAmount;\n        uint128 minimumBidQuote;\n        bytes32 merkleRoot;\n        ECCMath.Point pubKey;\n    }\n\n    struct Auction {\n        Timings timings;\n        AuctionData data;\n        AuctionParameters params;\n        EncryptedBid[] bids;\n    }\n\n    ////////////////////////////////////\n    ///            EVENTS            ///\n    ////////////////////////////////////\n\n    event AuctionCreated(\n        uint256 auctionId, address seller, AuctionParameters params, Timings timings, bytes encryptedPrivKey\n    );\n\n    event AuctionCancelled(uint256 auctionId);\n\n    event Bid(\n        address sender,\n        uint256 auctionId,\n        uint256 bidIndex,\n        uint128 quoteAmount,\n        bytes32 commitment,\n        ECCMath.Point pubKey,\n        bytes32 encryptedMessage,\n        bytes encryptedPrivateKey\n    );\n\n    event BidCancelled(uint256 auctionId, uint256 bidIndex);\n\n    event RevealedKey(uint256 auctionId, uint256 privateKey);\n\n    event AuctionFinalized(uint256 auctionId, uint256[] bidIndices, uint256 filledBase, uint256 filledQuote);\n\n    event BidRefund(uint256 auctionId, uint256 bidIndex);\n\n    event Withdrawal(uint256 auctionId, uint256 bidIndex, uint256 withdrawAmount, uint256 remainingAmount);\n}"
    }
  ]
}