{
  "Title": "Constant block time assumption could be invalidated, affecting calculation of `SeasonFacet::gm` incentives",
  "Content": "The block time of Ethereum, despite having never been constant, always has a target time toward which blocks are added. On occasion, this value has changed. Initially, in PoW Ethereum, the block time target was approximately 13-14 seconds, but with the PoS Merge in 2022 this [changed](https://ycharts.com/indicators/ethereum_average_block_time) to 12 seconds. This means that any [assumption](https://github.com/BeanstalkFarms/Beanstalk/blob/c7a20e56a0a6659c09314a877b440198eff0cd81/protocol/contracts/C.sol#L28) of a constant average block time could be invalidated. Therefore, the blocks late [calculation](https://github.com/BeanstalkFarms/Beanstalk/blob/c7a20e56a0a6659c09314a877b440198eff0cd81/protocol/contracts/beanstalk/sun/SeasonFacet/SeasonFacet.sol#L136-L141) within the call to [`SeasonFacet::incentivize`](https://github.com/BeanstalkFarms/Beanstalk/blob/c7a20e56a0a6659c09314a877b440198eff0cd81/protocol/contracts/beanstalk/sun/SeasonFacet/SeasonFacet.sol#L61) would be incorrect if, in future, the target block time changes, affecting the [expected Bean rewards](https://github.com/BeanstalkFarms/Beanstalk/blob/c7a20e56a0a6659c09314a877b440198eff0cd81/protocol/contracts/libraries/LibIncentive.sol#L65-L107).",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "protocol/contracts/C.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity =0.7.6;\npragma experimental ABIEncoderV2;\n\nimport \"./interfaces/IBean.sol\";\nimport \"./interfaces/ICurve.sol\";\nimport \"./interfaces/IFertilizer.sol\";\nimport \"./interfaces/IProxyAdmin.sol\";\nimport \"./libraries/Decimal.sol\";\n\n/**\n * @title C\n * @author Publius\n * @notice Contains constants used throughout Beanstalk.\n */\nlibrary C {\n    using Decimal for Decimal.D256;\n    using SafeMath for uint256;\n\n    //////////////////// Globals ////////////////////\n\n    uint256 internal constant PRECISION = 1e18;\n    uint256 private constant CHAIN_ID = 1;\n    bytes constant BYTES_ZERO = new bytes(0);\n\n    /// @dev The block time for the chain in seconds.\n    uint256 internal constant BLOCK_LENGTH_SECONDS = 12;\n\n    //////////////////// Season ////////////////////\n\n    /// @dev The length of a Season meaured in seconds.\n    uint256 private constant CURRENT_SEASON_PERIOD = 3600; // 1 hour\n    uint256 internal constant SOP_PRECISION = 1e24;\n\n    //////////////////// Silo ////////////////////\n\n    uint256 internal constant SEEDS_PER_BEAN = 2;\n    uint256 internal constant STALK_PER_BEAN = 10000;\n    uint256 private constant ROOTS_BASE = 1e12;\n\n    //////////////////// Exploit Migration ////////////////////\n\n    uint256 private constant UNRIPE_LP_PER_DOLLAR = 1884592; // 145_113_507_403_282 / 77_000_000\n    uint256 private constant ADD_LP_RATIO = 866616;\n    uint256 private constant INITIAL_HAIRCUT = 185564685220298701;\n\n    //////////////////// Contracts ////////////////////\n\n    address internal constant BEAN = 0xBEA0000029AD1c77D3d5D23Ba2D8893dB9d1Efab;\n    address internal constant CURVE_BEAN_METAPOOL = 0xc9C32cd16Bf7eFB85Ff14e0c8603cc90F6F2eE49;\n\n    address internal constant UNRIPE_BEAN = 0x1BEA0050E63e05FBb5D8BA2f10cf5800B6224449;\n    address internal constant UNRIPE_LP = 0x1BEA3CcD22F4EBd3d37d731BA31Eeca95713716D;\n\n    address private constant CURVE_3_POOL = 0xbEbc44782C7dB0a1A60Cb6fe97d0b483032FF1C7;\n    address private constant THREE_CRV = 0x6c3F90f043a72FA612cbac8115EE7e52BDe6E490;\n\n    address private constant FERTILIZER = 0x402c84De2Ce49aF88f5e2eF3710ff89bFED36cB6;\n    address private constant FERTILIZER_ADMIN = 0xfECB01359263C12Aa9eD838F878A596F0064aa6e;\n\n    address private constant TRI_CRYPTO = 0xc4AD29ba4B3c580e6D59105FFf484999997675Ff;\n    address private constant TRI_CRYPTO_POOL = 0xD51a44d3FaE010294C616388b506AcdA1bfAAE46;\n    address private constant CURVE_ZAP = 0xA79828DF1850E8a3A3064576f380D90aECDD3359;\n\n    address private constant UNRIPE_CURVE_BEAN_LUSD_POOL = 0xD652c40fBb3f06d6B58Cb9aa9CFF063eE63d465D;\n    address private constant UNRIPE_CURVE_BEAN_METAPOOL = 0x3a70DfA7d2262988064A2D051dd47521E43c9BdD;\n\n    address internal constant USDC = 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48;\n    address internal constant USDT = 0xdAC17F958D2ee523a2206206994597C13D831ec7;\n    address internal constant WETH = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;\n    address internal constant UNIV3_ETH_USDC_POOL = 0x8ad599c3A0ff1De082011EFDDc58f1908eb6e6D8; // 0.3% pool\n    address internal constant UNIV3_ETH_USDT_POOL = 0x4e68Ccd3E89f51C3074ca5072bbAC773960dFa36; // 0.3% pool\n\n    // Use external contract for block.basefee as to avoid upgrading existing contracts to solidity v8\n    address private constant BASE_FEE_CONTRACT = 0x84292919cB64b590C0131550483707E43Ef223aC;\n\n    //////////////////// Well ////////////////////\n\n    uint256 internal constant WELL_MINIMUM_BEAN_BALANCE = 1000_000_000; // 1,000 Beans\n    address constant internal BEANSTALK_PUMP = 0xc4AD29ba4B3c580e6D59105FFf484999997675Ff;\n    address constant BEAN_ETH_WELL = 0x9bAaB117304f7D6517048e371025dB8f89a8DbE5;\n\n    function getSeasonPeriod() internal pure returns (uint256) {\n        return CURRENT_SEASON_PERIOD;\n    }\n\n    function getBlockLengthSeconds() internal pure returns (uint256) {\n        return BLOCK_LENGTH_SECONDS;\n    }\n\n    function getChainId() internal pure returns (uint256) {\n        return CHAIN_ID;\n    }\n\n    function getSeedsPerBean() internal pure returns (uint256) {\n        return SEEDS_PER_BEAN;\n    }\n\n    function getStalkPerBean() internal pure returns (uint256) {\n      return STALK_PER_BEAN;\n    }\n\n    function getRootsBase() internal pure returns (uint256) {\n        return ROOTS_BASE;\n    }\n\n    /**\n     * @dev The pre-exploit BEAN:3CRV Curve metapool address.\n     */\n    function unripeLPPool1() internal pure returns (address) {\n        return UNRIPE_CURVE_BEAN_METAPOOL;\n    }\n\n    /**\n     * @dev The pre-exploit BEAN:LUSD Curve plain pool address.\n     */\n    function unripeLPPool2() internal pure returns (address) {\n        return UNRIPE_CURVE_BEAN_LUSD_POOL;\n    }\n\n    function unripeBean() internal pure returns (IERC20) {\n        return IERC20(UNRIPE_BEAN);\n    }\n\n    function unripeLP() internal pure returns (IERC20) {\n        return IERC20(UNRIPE_LP);\n    }\n\n    function bean() internal pure returns (IBean) {\n        return IBean(BEAN);\n    }\n\n    function usdc() internal pure returns (IERC20) {\n        return IERC20(USDC);\n    }\n\n    function curveMetapool() internal pure returns (ICurvePool) {\n        return ICurvePool(CURVE_BEAN_METAPOOL);\n    }\n\n    function curve3Pool() internal pure returns (I3Curve) {\n        return I3Curve(CURVE_3_POOL);\n    }\n    \n    function curveZap() internal pure returns (ICurveZap) {\n        return ICurveZap(CURVE_ZAP);\n    }\n\n    function curveZapAddress() internal pure returns (address) {\n        return CURVE_ZAP;\n    }\n\n    function curve3PoolAddress() internal pure returns (address) {\n        return CURVE_3_POOL;\n    }\n\n    function threeCrv() internal pure returns (IERC20) {\n        return IERC20(THREE_CRV);\n    }\n\n    function UniV3EthUsdc() internal pure returns (address){\n        return UNIV3_ETH_USDC_POOL;\n    }\n\n    function fertilizer() internal pure returns (IFertilizer) {\n        return IFertilizer(FERTILIZER);\n    }\n\n    function fertilizerAddress() internal pure returns (address) {\n        return FERTILIZER;\n    }\n\n    function fertilizerAdmin() internal pure returns (IProxyAdmin) {\n        return IProxyAdmin(FERTILIZER_ADMIN);\n    }\n\n    function triCryptoPoolAddress() internal pure returns (address) {\n        return TRI_CRYPTO_POOL;\n    }\n\n    function triCrypto() internal pure returns (IERC20) {\n        return IERC20(TRI_CRYPTO);\n    }\n\n    function unripeLPPerDollar() internal pure returns (uint256) {\n        return UNRIPE_LP_PER_DOLLAR;\n    }\n\n    function dollarPerUnripeLP() internal pure returns (uint256) {\n        return 1e12/UNRIPE_LP_PER_DOLLAR;\n    }\n\n    function exploitAddLPRatio() internal pure returns (uint256) {\n        return ADD_LP_RATIO;\n    }\n\n    function precision() internal pure returns (uint256) {\n        return PRECISION;\n    }\n\n    function initialRecap() internal pure returns (uint256) {\n        return INITIAL_HAIRCUT;\n    }\n\n}"
    }
  ]
}