{
  "Title": "[G-03] Use calldata instead of memory for function parameters",
  "Content": "If a reference type function parameter is read-only, it is cheaper in gas to use calldata instead of memory. Calldata is a non-modifiable, non-persistent area where function arguments are stored, and behaves mostly like memory.\n\nNote that I've also flagged instances where the function is public but can be marked as external since it's not called by the contract.\n\n<details>\n\n### NounsDAOLogicV3.sol.updateProposal(): use calldata for `targets,values,signatures,calldatas,description` (Saves 2251 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol#L278-L288\n\n**Gas benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 10622    | 20773   | 14500 | 92416 |\n| After  | 9612    | 18522   | 12580 | 90342 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n278:    function updateProposal(\n279:        uint256 proposalId,\n280:        address[] memory targets,\n281:        uint256[] memory values,\n282:        string[] memory signatures,\n283:        bytes[] memory calldatas,\n284:        string memory description,\n285:        string memory updateMessage\n286:    ) external {\n287:        ds.updateProposal(proposalId, targets, values, signatures, calldatas, description, updateMessage);\n288:    }\n```\nLast variable has not been modified to avoid the stack too deep error\n```diff\ndiff --git a/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol b/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\nindex 00c5ccdc..4e8281cb 100644\n--- a/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n+++ b/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n@@ -277,11 +277,11 @@ contract NounsDAOLogicV3 is NounsDAOStorageV3, NounsDAOEventsV3 {\n      */\n     function updateProposal(\n         uint256 proposalId,\n-        address[] memory targets,\n-        uint256[] memory values,\n-        string[] memory signatures,\n-        bytes[] memory calldatas,\n-        string memory description,\n+        address[] calldata targets,\n+        uint256[] calldata values,\n+        string[] calldata signatures,\n+        bytes[] calldata calldatas,\n+        string calldata description,\n         string memory updateMessage\n     ) external {\n         ds.updateProposal(proposalId, targets, values, signatures, calldatas, description, updateMessage);\n```\n\n### NounsDAOLogicV3.sol.updateProposalTransactions(): use calldata for `targets,values,signatures,calldatas,updateMessage` (Saves 2301 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol#L313-L322\n\n**Gas benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 9566    | 19643   | 13349 | 90201 |\n| After  | 8515    | 17342   | 11461 | 88076 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n313:    function updateProposalTransactions(\n314:        uint256 proposalId,\n315:        address[] memory targets,\n316:        uint256[] memory values,\n317:        string[] memory signatures,\n318:        bytes[] memory calldatas,\n319:        string memory updateMessage\n320:    ) external {\n321:        ds.updateProposalTransactions(proposalId, targets, values, signatures, calldatas, updateMessage);\n322:    }\n```\n\n```diff\n     function updateProposalTransactions(\n         uint256 proposalId,\n-        address[] memory targets,\n-        uint256[] memory values,\n-        string[] memory signatures,\n-        bytes[] memory calldatas,\n-        string memory updateMessage\n+        address[] calldata targets,\n+        uint256[] calldata values,\n+        string[] calldata signatures,\n+        bytes[] calldata calldatas,\n+        string calldata updateMessage\n     ) external {\n         ds.updateProposalTransactions(proposalId, targets, values, signatures, calldatas, updateMessage);\n     }\n```\n\n### NounsDAOLogicV3.sol.updateProposalBySigs(): use calldata for `proposerSignatures,targets,values` (Saves 2197 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol#L338-L355\n\n**Gas benchmarks**\n\n|        | Min  | Average | Median | Max   |\n| ------ | ---- | ------- | ------ | ----- |\n| Before | 15239  | 38005   | 33310  | 122687 |\n| After  | 14700 | 35808   | 31945  | 120500 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n338:    function updateProposalBySigs(\n339:        uint256 proposalId,\n340:        ProposerSignature[] memory proposerSignatures,\n341:        address[] memory targets,\n342:        uint256[] memory values,\n343:        string[] memory signatures,\n344:        bytes[] memory calldatas,\n345:        string memory description,\n346:        string memory updateMessage\n347:    ) external {\n348:        ds.updateProposalBySigs(\n349:            proposalId,\n350:            proposerSignatures,\n351:            NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n352:            description,\n353:            updateMessage\n354:        );\n355:    }\n```\nWe cannot refactor all variables to avoid stack too deep error\n```diff\n     function updateProposalBySigs(\n         uint256 proposalId,\n-        ProposerSignature[] memory proposerSignatures,\n-        address[] memory targets,\n-        uint256[] memory values,\n+        ProposerSignature[] calldata proposerSignatures,\n+        address[] calldata targets,\n+        uint256[] calldata values,\n         string[] memory signatures,\n         bytes[] memory calldatas,\n         string memory description,\n```\n\n### NounsDAOLogicV3.sol.proposeBySigs(): use calldata for `proposerSignatures,targets,values,signatures` (Saves 1565 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol#L236-L250\n\n**Gas benchmarks**\n\n|        | Min  | Average | Median | Max   |\n| ------ | ---- | ------- | ------ | ----- |\n| Before | 13725  | 431650   | 431722  | 535759 |\n| After  | 13336 | 430085   | 430511  | 533718 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n236:    function proposeBySigs(\n237:        ProposerSignature[] memory proposerSignatures,\n238:        address[] memory targets,\n239:        uint256[] memory values,\n240:        string[] memory signatures,\n241:        bytes[] memory calldatas,\n242:        string memory description\n243:    ) external returns (uint256) {\n244:        return\n245:            ds.proposeBySigs(\n246:                proposerSignatures,\n247:                NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n248:                description\n249:            );\n250:    }\n```\nNote: not all variables are changed, this is to avoid the stack too deep error\n\n```diff\n     function proposeBySigs(\n-        ProposerSignature[] memory proposerSignatures,\n-        address[] memory targets,\n-        uint256[] memory values,\n-        string[] memory signatures,\n+        ProposerSignature[] calldata proposerSignatures,\n+        address[] calldata targets,\n+        uint256[] calldata values,\n+        string[] calldata signatures,\n         bytes[] memory calldatas,\n         string memory description\n     ) external returns (uint256) {\n```\n\n### NounsDAOLogicV3.sol.proposeOnTimelockV1():  Change to external and use calldata for `targets,values,signatures,calldatas,description` (Saves 541 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol#L210-L222\n\n**Gas benchmarks**\n\n|        | Min  | Average | Median | Max   |\n| ------ | ---- | ------- | ------ | ----- |\n| Before | 341736  | 683821   | 683821  | 1025906 |\n| After  | 341705 | 683280   | 683280  | 1024855 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol\n210:    function proposeOnTimelockV1(\n211:        address[] memory targets,\n212:        uint256[] memory values,\n213:        string[] memory signatures,\n214:        bytes[] memory calldatas,\n215:        string memory description\n216:    ) public returns (uint256) {\n217:        return\n218:            ds.proposeOnTimelockV1(\n219:                NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n220:                description\n221:            );\n222:    }\n```\n\n```diff\n     function proposeOnTimelockV1(\n-        address[] memory targets,\n-        uint256[] memory values,\n-        string[] memory signatures,\n-        bytes[] memory calldatas,\n-        string memory description\n-    ) public returns (uint256) {\n+        address[] calldata targets,\n+        uint256[] calldata values,\n+        string[] calldata signatures,\n+        bytes[] calldata calldatas,\n+        string calldata description\n+    ) external returns (uint256) {\n         return\n             ds.proposeOnTimelockV1(\n                 NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n```\n\n### NounsDAOLogicV1Fork.sol.quit(): use calldata for `erc20TokensToInclude` (Saves 105 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol#L206-L216\n\n**Gas benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 14309    | 165989   | 151098 | 347452 |\n| After  | 165884    | 165884   | 151011 | 347390 |\n\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol\n206:    function quit(uint256[] calldata tokenIds, address[] memory erc20TokensToInclude) external nonReentrant {\n\n208:        address[] memory erc20TokensToIncludeInQuit_ = erc20TokensToIncludeInQuit;\n209:        for (uint256 i = 0; i < erc20TokensToInclude.length; i++) {\n210:            if (!isAddressIn(erc20TokensToInclude[i], erc20TokensToIncludeInQuit_)) {\n211:                revert TokensMustBeASubsetOfWhitelistedTokens();\n212:            }\n```\n\n```diff\ndiff --git a/packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol b/packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol\nindex 0b098e44..beaff3ab 100644\n--- a/packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol\n+++ b/packages/nouns-contracts/contracts/governance/fork/newdao/governance/NounsDAOLogicV1Fork.sol\n@@ -203,7 +203,7 @@ contract NounsDAOLogicV1Fork is UUPSUpgradeable, ReentrancyGuardUpgradeable, Nou\n         quitInternal(tokenIds, erc20TokensToIncludeInQuit);\n     }\n\n-    function quit(uint256[] calldata tokenIds, address[] memory erc20TokensToInclude) external nonReentrant {\n+    function quit(uint256[] calldata tokenIds, address[] calldata erc20TokensToInclude) external nonReentrant {\n         // check that erc20TokensToInclude is a subset of `erc20TokensToIncludeInQuit`\n         address[] memory erc20TokensToIncludeInQuit_ = erc20TokensToIncludeInQuit;\n         for (uint256 i = 0; i < erc20TokensToInclude.length; i++) {\n```\n\n### Change to external and use calldata on signature and data (Save 520 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol#L130-L148\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 26117    | 27113   | 26117 | 29751 |\n| After  | 25652    | 26593   | 25652 | 28749 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol\n130:    function queueTransaction(\n131:        address target,\n132:        uint256 value,\n133:        string memory signature,\n134:        bytes memory data,\n135:        uint256 eta\n136:    ) public returns (bytes32) {\n\n143:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n        \n146:        emit QueueTransaction(txHash, target, value, signature, data, eta);\n147:        return txHash;\n148:    }\n```\n\n```diff\n@@ -130,10 +130,10 @@ contract NounsDAOExecutorV2 is UUPSUpgradeable, Initializable {\n     function queueTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public returns (bytes32) {\n+    ) external returns (bytes32) {\n         require(msg.sender == admin, 'NounsDAOExecutor::queueTransaction: Call must come from admin.');\n         require(\n             eta >= getBlockTimestamp() + delay,\n```\n\n### Change to external and use calldata on signature and data (Save 462 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol#L150-L163\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 10017    | 10068   | 10017 | 10426 |\n| After  | 9552    | 9606   | 9552 | 9882 |\n\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol\n150:    function cancelTransaction(\n151:        address target,\n152:        uint256 value,\n153:        string memory signature,\n154:        bytes memory data,\n155:        uint256 eta\n156:    ) public {\n\n159:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n\n162:        emit CancelTransaction(txHash, target, value, signature, data, eta);\n163:    }\n```\n\n```diff\n@@ -150,10 +150,10 @@ contract NounsDAOExecutorV2 is UUPSUpgradeable, Initializable {\n     function cancelTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public {\n+    ) external {\n         require(msg.sender == admin, 'NounsDAOExecutor::cancelTransaction: Call must come from admin.');\n\n         bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n```\n\n### Change to external and use calldata on signature and data (Save 412 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol#L165-L202\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 2437    | 53364   | 29527 | 339600 |\n| After  | 2048    | 52952   | 28893 | 339006 |\n\n\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutorV2.sol\n165:    function executeTransaction(\n166:        address target,\n167:        uint256 value,\n168:        string memory signature,\n169:        bytes memory data,\n170:        uint256 eta\n171:    ) public returns (bytes memory) {\n\n174:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n\n189:        if (bytes(signature).length == 0) {\n190:            callData = data;\n191:        } else {\n192:            callData = abi.encodePacked(bytes4(keccak256(bytes(signature))), data);\n193:        }\n\n199:        emit ExecuteTransaction(txHash, target, value, signature, data, eta);\n```\n\n```diff\n@@ -165,10 +165,10 @@ contract NounsDAOExecutorV2 is UUPSUpgradeable, Initializable {\n     function executeTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public returns (bytes memory) {\n+    ) external returns (bytes memory) {\n         require(msg.sender == admin, 'NounsDAOExecutor::executeTransaction: Call must come from admin.');\n\n         bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n```\n\n### Change to external and use calldata on signature and data (Save 786 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol#L107-L125\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 26107    | 28172   | 28107 | 29783 |\n| After  | 25691    | 27386   | 27691 | 28240 |\n\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n107:    function queueTransaction(\n108:        address target,\n109:        uint256 value,\n110:        string memory signature,\n111:        bytes memory data,\n112:        uint256 eta\n113:    ) public returns (bytes32) {\n\n120:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n\n123:        emit QueueTransaction(txHash, target, value, signature, data, eta);\n```\n\n```diff\ndiff --git a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\nindex 2f87cd01..d705c94d 100644\n--- a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n+++ b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n@@ -107,10 +107,10 @@ contract NounsDAOExecutor {\n     function queueTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public returns (bytes32) {\n+    ) external returns (bytes32) {\n         require(msg.sender == admin, 'NounsDAOExecutor::queueTransaction: Call must come from admin.');\n         require(\n             eta >= getBlockTimestamp() + delay,\n```\n\n### Change to external and use calldata on signature and data (Save 404 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol#L127-L140\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 4788    | 8671   | 9985 | 9985 |\n| After  | 4456    | 8267   | 9569 | 9569 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n127:    function cancelTransaction(\n128:        address target,\n129:        uint256 value,\n130:        string memory signature,\n131:        bytes memory data,\n132:        uint256 eta\n133:    ) public {\n\n136:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n\n139:        emit CancelTransaction(txHash, target, value, signature, data, eta);\n140:    }\n```\n\n```diff\ndiff --git a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\nindex 2f87cd01..25956a16 100644\n--- a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n+++ b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n@@ -127,10 +127,10 @@ contract NounsDAOExecutor {\n     function cancelTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public {\n+    ) external {\n         require(msg.sender == admin, 'NounsDAOExecutor::cancelTransaction: Call must come from admin.');\n\n         bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n```\n\n### Change to external and use calldata on signature and data (Save 785 gas on average)\nhttps://github.com/nounsDAO/nouns-monorepo/blob/718211e063d511eeda1084710f6a682955e80dcb/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol#L142-L179\n\n**Gas Benchmarks**\n\n|        | Min    | Average | Median   | Max   |\n| ------ | --- | ------- | ----- | ----- |\n| Before | 2360    | 42009   | 30881 | 142555 |\n| After  | 2020    | 41224   | 30668 | 140491 |\n```solidity\nFile: /packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n142:    function executeTransaction(\n143:        address target,\n144:        uint256 value,\n145:        string memory signature,\n146:        bytes memory data,\n147:        uint256 eta\n148:    ) public returns (bytes memory) {\n\n151:        bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n\n166:        if (bytes(signature).length == 0) {\n167:            callData = data;\n168:        } else {\n169:            callData = abi.encodePacked(bytes4(keccak256(bytes(signature))), data);\n170:        }\n\n172:        // solium-disable-next-line security/no-call-value\n173:        (bool success, bytes memory returnData) = target.call{ value: value }(callData);\n\n\n176:        emit ExecuteTransaction(txHash, target, value, signature, data, eta);\n```\n\n```diff\ndiff --git a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\nindex 2f87cd01..d3d4b135 100644\n--- a/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n+++ b/packages/nouns-contracts/contracts/governance/NounsDAOExecutor.sol\n@@ -142,10 +142,10 @@ contract NounsDAOExecutor {\n     function executeTransaction(\n         address target,\n         uint256 value,\n-        string memory signature,\n-        bytes memory data,\n+        string calldata signature,\n+        bytes calldata data,\n         uint256 eta\n-    ) public returns (bytes memory) {\n+    ) external returns (bytes memory) {\n         require(msg.sender == admin, 'NounsDAOExecutor::executeTransaction: Call must come from admin.');\n\n         bytes32 txHash = keccak256(abi.encode(target, value, signature, data, eta));\n```\n\n</details>\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/reports/2023-07-nounsdao",
  "Code": [
    {
      "filename": "packages/nouns-contracts/contracts/governance/NounsDAOLogicV3.sol",
      "content": "// SPDX-License-Identifier: BSD-3-Clause\n\n/// @title The Nouns DAO logic version 3\n\n/*********************************\n * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ *\n * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ *\n * ░░░░░░█████████░░█████████░░░ *\n * ░░░░░░██░░░████░░██░░░████░░░ *\n * ░░██████░░░████████░░░████░░░ *\n * ░░██░░██░░░████░░██░░░████░░░ *\n * ░░██░░██░░░████░░██░░░████░░░ *\n * ░░░░░░█████████░░█████████░░░ *\n * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ *\n * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ *\n *********************************/\n\n// LICENSE\n// NounsDAOLogicV2.sol is a modified version of Compound Lab's GovernorBravoDelegate.sol:\n// https://github.com/compound-finance/compound-protocol/blob/b9b14038612d846b83f8a009a82c38974ff2dcfe/contracts/Governance/GovernorBravoDelegate.sol\n//\n// GovernorBravoDelegate.sol source code Copyright 2020 Compound Labs, Inc. licensed under the BSD-3-Clause license.\n// With modifications by Nounders DAO.\n//\n// Additional conditions of BSD-3-Clause can be found here: https://opensource.org/licenses/BSD-3-Clause\n//\n// MODIFICATIONS\n// See NounsDAOLogicV1 for initial GovernorBravoDelegate modifications.\n// See NounsDAOLogicV2 for additional modifications\n//\n// NounsDAOLogicV3 adds:\n// - Contract has been broken down to use libraries because of contract size limitations\n// - Proposal editing: allowing proposers to update their proposal’s transactions and text description,\n// during the Updatable period only, which is the state upon proposal creation. Editing also works with signatures,\n// assuming the proposer is able to accumulate signatures from the same signers.\n// - Propose by signature: allowing Nouners and delegates to pool their voting power towards submitting a proposal,\n// by submitting their signature, instead of the current approach where sponsors must delegate their votes to help\n// a proposer achieve threshold.\n// - Objection-only Period: a conditional voting period that gets activated upon a last-minute proposal swing\n// from defeated to successful, affording against voters more reaction time.\n// Only against votes are possible during the objection period.\n// - Votes snapshot after voting delay: moving votes snapshot up, to provide Nouners with reaction time per proposal,\n// to get their votes ready (e.g. some might want to move their delegations around).\n// In NounsDAOLogicV2 the vote snapshot block is the proposal creation block.\n// - Nouns fork: any token holder can signal to fork (exit) in response to a governance proposal.\n// If a quorum of a configured threshold amount of tokens signals to exit, the fork will succeed.\n// This will deploy a new DAO and send part of the treasury to the new DAO.\n//\n// 2 new states have been added to the proposal state machine: Updatable, ObjectionPeriod\n//\n// Updated state machine:\n// Updatable -> Pending -> Active -> ObjectionPeriod (conditional) -> Succeeded -> Queued -> Executed\n//                                                                 ┖> Defeated\n//\n\npragma solidity ^0.8.19;\n\nimport './NounsDAOInterfaces.sol';\nimport { NounsDAOV3Admin } from './NounsDAOV3Admin.sol';\nimport { NounsDAOV3DynamicQuorum } from './NounsDAOV3DynamicQuorum.sol';\nimport { NounsDAOV3Votes } from './NounsDAOV3Votes.sol';\nimport { NounsDAOV3Proposals } from './NounsDAOV3Proposals.sol';\nimport { NounsDAOV3Fork } from './fork/NounsDAOV3Fork.sol';\n\ncontract NounsDAOLogicV3 is NounsDAOStorageV3, NounsDAOEventsV3 {\n    using NounsDAOV3Admin for StorageV3;\n    using NounsDAOV3DynamicQuorum for StorageV3;\n    using NounsDAOV3Votes for StorageV3;\n    using NounsDAOV3Proposals for StorageV3;\n    using NounsDAOV3Fork for StorageV3;\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   CONSTANTS\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /// @notice The minimum setable proposal threshold\n    function MIN_PROPOSAL_THRESHOLD_BPS() public pure returns (uint256) {\n        return NounsDAOV3Admin.MIN_PROPOSAL_THRESHOLD_BPS;\n    }\n\n    /// @notice The maximum setable proposal threshold\n    function MAX_PROPOSAL_THRESHOLD_BPS() public pure returns (uint256) {\n        return NounsDAOV3Admin.MAX_PROPOSAL_THRESHOLD_BPS;\n    }\n\n    /// @notice The minimum setable voting period in blocks\n    function MIN_VOTING_PERIOD() public pure returns (uint256) {\n        return NounsDAOV3Admin.MIN_VOTING_PERIOD_BLOCKS;\n    }\n\n    /// @notice The max setable voting period in blocks\n    function MAX_VOTING_PERIOD() public pure returns (uint256) {\n        return NounsDAOV3Admin.MAX_VOTING_PERIOD_BLOCKS;\n    }\n\n    /// @notice The min setable voting delay in blocks\n    function MIN_VOTING_DELAY() public pure returns (uint256) {\n        return NounsDAOV3Admin.MIN_VOTING_DELAY_BLOCKS;\n    }\n\n    /// @notice The max setable voting delay in blocks\n    function MAX_VOTING_DELAY() public pure returns (uint256) {\n        return NounsDAOV3Admin.MAX_VOTING_DELAY_BLOCKS;\n    }\n\n    /// @notice The maximum number of actions that can be included in a proposal\n    function proposalMaxOperations() public pure returns (uint256) {\n        return NounsDAOV3Proposals.PROPOSAL_MAX_OPERATIONS;\n    }\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   ERRORS\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    error AdminOnly();\n    error CanOnlyInitializeOnce();\n    error InvalidTimelockAddress();\n    error InvalidNounsAddress();\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   INITIALIZER\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /**\n     * @notice Used to initialize the contract during delegator contructor\n     * @dev This will only be called for a newly deployed DAO, not as part of an upgrade from V2 to V3\n     * @param timelock_ The address of the NounsDAOExecutor\n     * @param nouns_ The address of the NOUN tokens\n     * @param forkEscrow_ The escrow contract used for creating forks\n     * @param forkDAODeployer_ The contract used to deploy new forked DAOs\n     * @param vetoer_ The address allowed to unilaterally veto proposals\n     * @param daoParams_ Initial DAO parameters\n     * @param dynamicQuorumParams_ The initial dynamic quorum parameters\n     */\n    function initialize(\n        address timelock_,\n        address nouns_,\n        address forkEscrow_,\n        address forkDAODeployer_,\n        address vetoer_,\n        NounsDAOParams calldata daoParams_,\n        DynamicQuorumParams calldata dynamicQuorumParams_\n    ) public virtual {\n        if (address(ds.timelock) != address(0)) revert CanOnlyInitializeOnce();\n        if (msg.sender != ds.admin) revert AdminOnly();\n        if (timelock_ == address(0)) revert InvalidTimelockAddress();\n        if (nouns_ == address(0)) revert InvalidNounsAddress();\n\n        ds._setVotingPeriod(daoParams_.votingPeriod);\n        ds._setVotingDelay(daoParams_.votingDelay);\n        ds._setProposalThresholdBPS(daoParams_.proposalThresholdBPS);\n        ds.timelock = INounsDAOExecutorV2(timelock_);\n        ds.nouns = NounsTokenLike(nouns_);\n        ds.forkEscrow = INounsDAOForkEscrow(forkEscrow_);\n        ds.forkDAODeployer = IForkDAODeployer(forkDAODeployer_);\n        ds.vetoer = vetoer_;\n        _setDynamicQuorumParams(\n            dynamicQuorumParams_.minQuorumVotesBPS,\n            dynamicQuorumParams_.maxQuorumVotesBPS,\n            dynamicQuorumParams_.quorumCoefficient\n        );\n\n        ds._setLastMinuteWindowInBlocks(daoParams_.lastMinuteWindowInBlocks);\n        ds._setObjectionPeriodDurationInBlocks(daoParams_.objectionPeriodDurationInBlocks);\n        ds._setProposalUpdatablePeriodInBlocks(daoParams_.proposalUpdatablePeriodInBlocks);\n    }\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   PROPOSALS\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /**\n     * @notice Function used to propose a new proposal. Sender must have delegates above the proposal threshold\n     * @param targets Target addresses for proposal calls\n     * @param values Eth values for proposal calls\n     * @param signatures Function signatures for proposal calls\n     * @param calldatas Calldatas for proposal calls\n     * @param description String description of the proposal\n     * @return uint256 Proposal id of new proposal\n     */\n    function propose(\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory description\n    ) public returns (uint256) {\n        return ds.propose(NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas), description);\n    }\n\n    /**\n     * @notice Function used to propose a new proposal. Sender must have delegates above the proposal threshold.\n     * This proposal would be executed via the timelockV1 contract. This is meant to be used in case timelockV1\n     * is still holding funds or has special permissions to execute on certain contracts.\n     * @param targets Target addresses for proposal calls\n     * @param values Eth values for proposal calls\n     * @param signatures Function signatures for proposal calls\n     * @param calldatas Calldatas for proposal calls\n     * @param description String description of the proposal\n     * @return uint256 Proposal id of new proposal\n     */\n    function proposeOnTimelockV1(\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory description\n    ) public returns (uint256) {\n        return\n            ds.proposeOnTimelockV1(\n                NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n                description\n            );\n    }\n\n    /**\n     * @notice Function used to propose a new proposal. Sender and signers must have delegates above the proposal threshold\n     * Signers are regarded as co-proposers, and therefore have the ability to cancel the proposal at any time.\n     * @param proposerSignatures Array of signers who have signed the proposal and their signatures.\n     * @dev The signatures follow EIP-712. See `PROPOSAL_TYPEHASH` in NounsDAOV3Proposals.sol\n     * @param targets Target addresses for proposal calls\n     * @param values Eth values for proposal calls\n     * @param signatures Function signatures for proposal calls\n     * @param calldatas Calldatas for proposal calls\n     * @param description String description of the proposal\n     * @return uint256 Proposal id of new proposal\n     */\n    function proposeBySigs(\n        ProposerSignature[] memory proposerSignatures,\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory description\n    ) external returns (uint256) {\n        return\n            ds.proposeBySigs(\n                proposerSignatures,\n                NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n                description\n            );\n    }\n\n    /**\n     * @notice Invalidates a signature that may be used for signing a new proposal.\n     * Once a signature is canceled, the sender can no longer use it again.\n     * If the sender changes their mind and want to sign the proposal, they can change the expiry timestamp\n     * in order to produce a new signature.\n     * The signature will only be invalidated when used by the sender. If used by a different account, it will\n     * not be invalidated.\n     * Cancelling a signature for an existing proposal will have no effect. Signers have the ability to cancel\n     * a proposal they signed if necessary.\n     * @param sig The signature to cancel\n     */\n    function cancelSig(bytes calldata sig) external {\n        ds.cancelSig(sig);\n    }\n\n    /**\n     * @notice Update a proposal transactions and description.\n     * Only the proposer can update it, and only during the updateable period.\n     * @param proposalId Proposal's id\n     * @param targets Updated target addresses for proposal calls\n     * @param values Updated eth values for proposal calls\n     * @param signatures Updated function signatures for proposal calls\n     * @param calldatas Updated calldatas for proposal calls\n     * @param description Updated description of the proposal\n     * @param updateMessage Short message to explain the update\n     */\n    function updateProposal(\n        uint256 proposalId,\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory description,\n        string memory updateMessage\n    ) external {\n        ds.updateProposal(proposalId, targets, values, signatures, calldatas, description, updateMessage);\n    }\n\n    /**\n     * @notice Updates the proposal's description. Only the proposer can update it, and only during the updateable period.\n     * @param proposalId Proposal's id\n     * @param description Updated description of the proposal\n     * @param updateMessage Short message to explain the update\n     */\n    function updateProposalDescription(\n        uint256 proposalId,\n        string calldata description,\n        string calldata updateMessage\n    ) external {\n        ds.updateProposalDescription(proposalId, description, updateMessage);\n    }\n\n    /**\n     * @notice Updates the proposal's transactions. Only the proposer can update it, and only during the updateable period.\n     * @param proposalId Proposal's id\n     * @param targets Updated target addresses for proposal calls\n     * @param values Updated eth values for proposal calls\n     * @param signatures Updated function signatures for proposal calls\n     * @param calldatas Updated calldatas for proposal calls\n     * @param updateMessage Short message to explain the update\n     */\n    function updateProposalTransactions(\n        uint256 proposalId,\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory updateMessage\n    ) external {\n        ds.updateProposalTransactions(proposalId, targets, values, signatures, calldatas, updateMessage);\n    }\n\n    /**\n     * @notice Update a proposal's transactions and description that was created with proposeBySigs.\n     * Only the proposer can update it, during the updateable period.\n     * Requires the original signers to sign the update.\n     * @param proposalId Proposal's id\n     * @param proposerSignatures Array of signers who have signed the proposal and their signatures.\n     * @dev The signatures follow EIP-712. See `UPDATE_PROPOSAL_TYPEHASH` in NounsDAOV3Proposals.sol\n     * @param targets Updated target addresses for proposal calls\n     * @param values Updated eth values for proposal calls\n     * @param signatures Updated function signatures for proposal calls\n     * @param calldatas Updated calldatas for proposal calls\n     * @param description Updated description of the proposal\n     * @param updateMessage Short message to explain the update\n     */\n    function updateProposalBySigs(\n        uint256 proposalId,\n        ProposerSignature[] memory proposerSignatures,\n        address[] memory targets,\n        uint256[] memory values,\n        string[] memory signatures,\n        bytes[] memory calldatas,\n        string memory description,\n        string memory updateMessage\n    ) external {\n        ds.updateProposalBySigs(\n            proposalId,\n            proposerSignatures,\n            NounsDAOV3Proposals.ProposalTxs(targets, values, signatures, calldatas),\n            description,\n            updateMessage\n        );\n    }\n\n    /**\n     * @notice Queues a proposal of state succeeded\n     * @param proposalId The id of the proposal to queue\n     */\n    function queue(uint256 proposalId) external {\n        ds.queue(proposalId);\n    }\n\n    /**\n     * @notice Executes a queued proposal if eta has passed\n     * @param proposalId The id of the proposal to execute\n     */\n    function execute(uint256 proposalId) external {\n        ds.execute(proposalId);\n    }\n\n    /**\n     * @notice Executes a queued proposal on timelockV1 if eta has passed\n     * This is only required for proposal that were queued on timelockV1, but before the upgrade to DAO V3.\n     * These proposals will not have the `executeOnTimelockV1` bool turned on.\n     */\n    function executeOnTimelockV1(uint256 proposalId) external {\n        ds.executeOnTimelockV1(proposalId);\n    }\n\n    /**\n     * @notice Cancels a proposal only if sender is the proposer or a signer, or proposer & signers voting power\n     * dropped below proposal threshold\n     * @param proposalId The id of the proposal to cancel\n     */\n    function cancel(uint256 proposalId) external {\n        ds.cancel(proposalId);\n    }\n\n    /**\n     * @notice Gets the state of a proposal\n     * @param proposalId The id of the proposal\n     * @return Proposal state\n     */\n    function state(uint256 proposalId) public view returns (ProposalState) {\n        return ds.state(proposalId);\n    }\n\n    /**\n     * @notice Gets actions of a proposal\n     * @param proposalId the id of the proposal\n     * @return targets\n     * @return values\n     * @return signatures\n     * @return calldatas\n     */\n    function getActions(uint256 proposalId)\n        external\n        view\n        returns (\n            address[] memory targets,\n            uint256[] memory values,\n            string[] memory signatures,\n            bytes[] memory calldatas\n        )\n    {\n        return ds.getActions(proposalId);\n    }\n\n    /**\n     * @notice Gets the receipt for a voter on a given proposal\n     * @param proposalId the id of proposal\n     * @param voter The address of the voter\n     * @return The voting receipt\n     */\n    function getReceipt(uint256 proposalId, address voter) external view returns (Receipt memory) {\n        return ds.getReceipt(proposalId, voter);\n    }\n\n    /**\n     * @notice Returns the proposal details given a proposal id.\n     *     The `quorumVotes` member holds the *current* quorum, given the current votes.\n     * @param proposalId the proposal id to get the data for\n     * @return A `ProposalCondensed` struct with the proposal data, backwards compatible with V1 and V2\n     */\n    function proposals(uint256 proposalId) external view returns (NounsDAOStorageV2.ProposalCondensed memory) {\n        return ds.proposals(proposalId);\n    }\n\n    /**\n     * @notice Returns the proposal details given a proposal id.\n     *     The `quorumVotes` member holds the *current* quorum, given the current votes.\n     * @param proposalId the proposal id to get the data for\n     * @return A `ProposalCondensed` struct with the proposal data, not backwards compatible as it contains additional values\n     * like `objectionPeriodEndBlock` and `signers`\n     */\n    function proposalsV3(uint256 proposalId) external view returns (ProposalCondensed memory) {\n        return ds.proposalsV3(proposalId);\n    }\n\n    /**\n     * @notice Current proposal threshold using Noun Total Supply\n     * Differs from `GovernerBravo` which uses fixed amount\n     */\n    function proposalThreshold() public view returns (uint256) {\n        return ds.proposalThreshold(ds.adjustedTotalSupply());\n    }\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   DAO FORK\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /**\n     * @notice Escrow Nouns to contribute to the fork threshold\n     * @dev Requires approving the tokenIds or the entire noun token to the DAO contract\n     * @param tokenIds the tokenIds to escrow. They will be sent to the DAO once the fork threshold is reached and the escrow is closed.\n     * @param proposalIds array of proposal ids which are the reason for wanting to fork. This will only be used to emit event.\n     * @param reason the reason for want to fork. This will only be used to emit event.\n     */\n    function escrowToFork(\n        uint256[] calldata tokenIds,\n        uint256[] calldata proposalIds,\n        string calldata reason\n    ) external {\n        ds.escrowToFork(tokenIds, proposalIds, reason);\n    }\n\n    /**\n     * @notice Withdraw Nouns from the fork escrow. Only possible if the fork has not been executed.\n     * Only allowed to withdraw tokens that the sender has escrowed.\n     * @param tokenIds the tokenIds to withdraw\n     */\n    function withdrawFromForkEscrow(uint256[] calldata tokenIds) external {\n        ds.withdrawFromForkEscrow(tokenIds);\n    }\n\n    /**\n     * @notice Execute the fork. Only possible if the fork threshold has been met.\n     * This will deploy a new DAO and send part of the treasury to the new DAO's treasury.\n     * This will also close the active escrow and all nouns in the escrow belong to the original DAO.\n     * @return forkTreasury The address of the new DAO's treasury\n     * @return forkToken The address of the new DAO's token\n     */\n    function executeFork() external returns (address forkTreasury, address forkToken) {\n        return ds.executeFork();\n    }\n\n    /**\n     * @notice Joins a fork while a fork is active\n     * @param tokenIds the tokenIds to send to the DAO in exchange for joining the fork\n     * @param proposalIds array of proposal ids which are the reason for wanting to fork. This will only be used to emit event.\n     * @param reason the reason for want to fork. This will only be used to emit event.\n     */\n    function joinFork(\n        uint256[] calldata tokenIds,\n        uint256[] calldata proposalIds,\n        string calldata reason\n    ) external {\n        ds.joinFork(tokenIds, proposalIds, reason);\n    }\n\n    /**\n     * @notice Withdraws nouns from the fork escrow to the treasury after the fork has been executed\n     * @dev Only the DAO can call this function\n     * @param tokenIds the tokenIds to withdraw\n     */\n    function withdrawDAONounsFromEscrowToTreasury(uint256[] calldata tokenIds) external {\n        ds.withdrawDAONounsFromEscrowToTreasury(tokenIds);\n    }\n\n    /**\n     * @notice Withdraws nouns from the fork escrow after the fork has been executed to an address other than the treasury\n     * @dev Only the DAO can call this function\n     * @param tokenIds the tokenIds to withdraw\n     * @param to the address to send the nouns to\n     */\n    function withdrawDAONounsFromEscrowIncreasingTotalSupply(uint256[] calldata tokenIds, address to) external {\n        ds.withdrawDAONounsFromEscrowIncreasingTotalSupply(tokenIds, to);\n    }\n\n    /**\n     * @notice Returns the number of nouns in supply minus nouns owned by the DAO, i.e. held in the treasury or in an\n     * escrow after it has closed.\n     * This is used when calculating proposal threshold, quorum, fork threshold & treasury split.\n     */\n    function adjustedTotalSupply() external view returns (uint256) {\n        return ds.adjustedTotalSupply();\n    }\n\n    /**\n     * @notice returns the required number of tokens to escrow to trigger a fork\n     */\n    function forkThreshold() external view returns (uint256) {\n        return ds.forkThreshold();\n    }\n\n    /**\n     * @notice Returns the number of tokens currently in escrow, contributing to the fork threshold\n     */\n    function numTokensInForkEscrow() external view returns (uint256) {\n        return ds.numTokensInForkEscrow();\n    }\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   VOTES\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /**\n     * @notice Vetoes a proposal only if sender is the vetoer and the proposal has not been executed.\n     * @param proposalId The id of the proposal to veto\n     */\n    function veto(uint256 proposalId) external {\n        ds.veto(proposalId);\n    }\n\n    /**\n     * @notice Cast a vote for a proposal\n     * @param proposalId The id of the proposal to vote on\n     * @param support The support value for the vote. 0=against, 1=for, 2=abstain\n     */\n    function castVote(uint256 proposalId, uint8 support) external {\n        ds.castVote(proposalId, support);\n    }\n\n    /**\n     * @notice Cast a vote for a proposal, asking the DAO to refund gas costs.\n     * Users with > 0 votes receive refunds. Refunds are partial when using a gas priority fee higher than the DAO's cap.\n     * Refunds are partial when the DAO's balance is insufficient.\n     * No refund is sent when the DAO's balance is empty. No refund is sent to users with no votes.\n     * Voting takes place regardless of refund success.\n     * @param proposalId The id of the proposal to vote on\n     * @param support The support value for the vote. 0=against, 1=for, 2=abstain\n     * @dev Reentrancy is defended against in `castVoteInternal` at the `receipt.hasVoted == false` require statement.\n     */\n    function castRefundableVote(uint256 proposalId, uint8 support) external {\n        ds.castRefundableVote(proposalId, support);\n    }\n\n    /**\n     * @notice Cast a vote for a proposal, asking the DAO to refund gas costs.\n     * Users with > 0 votes receive refunds. Refunds are partial when using a gas priority fee higher than the DAO's cap.\n     * Refunds are partial when the DAO's balance is insufficient.\n     * No refund is sent when the DAO's balance is empty. No refund is sent to users with no votes.\n     * Voting takes place regardless of refund success.\n     * @param proposalId The id of the proposal to vote on\n     * @param support The support value for the vote. 0=against, 1=for, 2=abstain\n     * @param reason The reason given for the vote by the voter\n     * @dev Reentrancy is defended against in `castVoteInternal` at the `receipt.hasVoted == false` require statement.\n     */\n    function castRefundableVoteWithReason(\n        uint256 proposalId,\n        uint8 support,\n        string calldata reason\n    ) external {\n        ds.castRefundableVoteWithReason(proposalId, support, reason);\n    }\n\n    /**\n     * @notice Cast a vote for a proposal with a reason\n     * @param proposalId The id of the proposal to vote on\n     * @param support The support value for the vote. 0=against, 1=for, 2=abstain\n     * @param reason The reason given for the vote by the voter\n     */\n    function castVoteWithReason(\n        uint256 proposalId,\n        uint8 support,\n        string calldata reason\n    ) external {\n        ds.castVoteWithReason(proposalId, support, reason);\n    }\n\n    /**\n     * @notice Cast a vote for a proposal by signature\n     * @dev External function that accepts EIP-712 signatures for voting on proposals.\n     */\n    function castVoteBySig(\n        uint256 proposalId,\n        uint8 support,\n        uint8 v,\n        bytes32 r,\n        bytes32 s\n    ) external {\n        ds.castVoteBySig(proposalId, support, v, r, s);\n    }\n\n    /**\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     *   ADMIN\n     * ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n     */\n\n    /**\n     * @notice Admin function for setting the voting delay. Best to set voting delay to at least a few days, to give\n     * voters time to make sense of proposals, e.g. 21,600 blocks which should be at least 3 days.\n     * @param newVotingDelay new voting delay, in blocks\n     */\n    function _setVotingDelay(uint256 newVotingDelay) external {\n        ds._setVotingDelay(newVotingDelay);\n    }\n\n    /**\n     * @notice Admin function for setting the voting period\n     * @param newVotingPeriod new voting period, in blocks\n     */\n    function _setVotingPeriod(uint256 newVotingPeriod) external {\n        ds._setVotingPeriod(newVotingPeriod);\n    }\n\n    /**\n     * @notice Admin function for setting the proposal threshold basis points\n     * @dev newProposalThresholdBPS must be in [`MIN_PROPOSAL_THRESHOLD_BPS`,`MAX_PROPOSAL_THRESHOLD_BPS`]\n     * @param newProposalThresholdBPS new proposal threshold\n     */\n    function _setProposalThresholdBPS(uint256 newProposalThresholdBPS) external {\n        ds._setProposalThresholdBPS(newProposalThresholdBPS);\n    }\n\n    /**\n     * @notice Admin function for setting the objection period duration\n     * @param newObjectionPeriodDurationInBlocks new objection period duration, in blocks\n     */\n    function _setObjectionPeriodDurationInBlocks(uint32 newObjectionPeriodDurationInBlocks) external {\n        ds._setObjectionPeriodDurationInBlocks(newObjectionPeriodDurationInBlocks);\n    }\n\n    /**\n     * @notice Admin function for setting the objection period last minute window\n     * @param newLastMinuteWindowInBlocks new objection period last minute window, in blocks\n     */\n    function _setLastMinuteWindowInBlocks(uint32 newLastMinuteWindowInBlocks) external {\n        ds._setLastMinuteWindowInBlocks(newLastMinuteWindowInBlocks);\n    }\n\n    /**\n     * @notice Admin function for setting the proposal updatable period\n     * @param newProposalUpdatablePeriodInBlocks the new proposal updatable period, in blocks\n     */\n    function _setProposalUpdatablePeriodInBlocks(uint32 newProposalUpdatablePeriodInBlocks) external {\n        ds._setProposalUpdatablePeriodInBlocks(newProposalUpdatablePeriodInBlocks);\n    }\n\n    /**\n     * @notice Begins transfer of admin rights. The newPendingAdmin must call `_acceptAdmin` to finalize the transfer.\n     * @dev Admin function to begin change of admin. The newPendingAdmin must call `_acceptAdmin` to finalize the transfer.\n     * @param newPendingAdmin New pending admin.\n     */\n    function _setPendingAdmin(address newPendingAdmin) external {\n        ds._setPendingAdmin(newPendingAdmin);\n    }\n\n    /**\n     * @notice Accepts transfer of admin rights. msg.sender must be pendingAdmin\n     * @dev Admin function for pending admin to accept role and update admin\n     */\n    function _acceptAdmin() external {\n        ds._acceptAdmin();\n    }\n\n    /**\n     * @notice Begins transition of vetoer. The newPendingVetoer must call _acceptVetoer to finalize the transfer.\n     * @param newPendingVetoer New Pending Vetoer\n     */\n    function _setPendingVetoer(address newPendingVetoer) public {\n        ds._setPendingVetoer(newPendingVetoer);\n    }\n\n    /**\n     * @notice Called by the pendingVetoer to accept role and update vetoer\n     */\n    function _acceptVetoer() external {\n        ds._acceptVetoer();\n    }\n\n    /**\n     * @notice Burns veto priviledges\n     * @dev Vetoer function destroying veto power forever\n     */\n    function _burnVetoPower() public {\n        ds._burnVetoPower();\n    }\n\n    /**\n     * @notice Admin function for setting the minimum quorum votes bps\n     * @param newMinQuorumVotesBPS minimum quorum votes bps\n     *     Must be between `MIN_QUORUM_VOTES_BPS_LOWER_BOUND` and `MIN_QUORUM_VOTES_BPS_UPPER_BOUND`\n     *     Must be lower than or equal to maxQuorumVotesBPS\n     */\n    function _setMinQuorumVotesBPS(uint16 newMinQuorumVotesBPS) external {\n        ds._setMinQuorumVotesBPS(newMinQuorumVotesBPS);\n    }\n\n    /**\n     * @notice Admin function for setting the maximum quorum votes bps\n     * @param newMaxQuorumVotesBPS maximum quorum votes bps\n     *     Must be lower than `MAX_QUORUM_VOTES_BPS_UPPER_BOUND`\n     *     Must be higher than or equal to minQuorumVotesBPS\n     */\n    function _setMaxQuorumVotesBPS(uint16 newMaxQuorumVotesBPS) external {\n        ds._setMaxQuorumVotesBPS(newMaxQuorumVotesBPS);\n    }\n\n    /**\n     * @notice Admin function for setting the dynamic quorum coefficient\n     * @param newQuorumCoefficient the new coefficient, as a fixed point integer with 6 decimals\n     */\n    function _setQuorumCoefficient(uint32 newQuorumCoefficient) external {\n        ds._setQuorumCoefficient(newQuorumCoefficient);\n    }\n\n    /**\n     * @notice Admin function for setting all the dynamic quorum parameters\n     * @param newMinQuorumVotesBPS minimum quorum votes bps\n     *     Must be between `MIN_QUORUM_VOTES_BPS_LOWER_BOUND` and `MIN_QUORUM_VOTES_BPS_UPPER_BOUND`\n     *     Must be lower than or equal to maxQuorumVotesBPS\n     * @param newMaxQuorumVotesBPS maximum quorum votes bps\n     *     Must be lower than `MAX_QUORUM_VOTES_BPS_UPPER_BOUND`\n     *     Must be higher than or equal to minQuorumVotesBPS\n     * @param newQuorumCoefficient the new coefficient, as a fixed point integer with 6 decimals\n     */\n    function _setDynamicQuorumParams(\n        uint16 newMinQuorumVotesBPS,\n        uint16 newMaxQuorumVotesBPS,\n        uint32 newQuorumCoefficient\n    ) public {\n        ds._setDynamicQuorumParams(newMinQuorumVotesBPS, newMaxQuorumVotesBPS, newQuorumCoefficient);\n    }\n\n    /**\n     * @notice Withdraws all the ETH in the contract. This is callable only by the admin (timelock).\n     */\n    function _withdraw() external returns (uint256, bool) {\n        return ds._withdraw();\n    }\n\n    /**\n     * @notice Admin function for setting the fork period\n     * @param newForkPeriod the new fork proposal period, in seconds\n     */\n    function _setForkPeriod(uint256 newForkPeriod) external {\n        ds._setForkPeriod(newForkPeriod);\n    }\n\n    /**\n     * @notice Admin function for setting the fork threshold\n     * @param newForkThresholdBPS the new fork proposal threshold, in basis points\n     */\n    function _"
    }
  ]
}