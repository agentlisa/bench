{
  "Title": "[N-13] Libraries, interfaces, and external imports can be ordered nicely",
  "Content": "\nE.g. group all libraries first, then interfaces, then OZ imports\n\nhttps://github.com/code-423n4/2022-06-nested/blob/b4a153c943d54755711a2f7b80cbbf3a5bb49d76/contracts/libraries/StakingLPVaultHelpers.sol#L4-L12\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2022-06-nested",
  "Code": [
    {
      "filename": "contracts/libraries/StakingLPVaultHelpers.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-or-later\npragma solidity 0.8.14;\n\nimport \"./../Withdrawer.sol\";\nimport \"./../libraries/ExchangeHelpers.sol\";\nimport \"./../libraries/CurveHelpers/CurveHelpers.sol\";\nimport \"@openzeppelin/contracts/token/ERC20/IERC20.sol\";\nimport \"./../interfaces/external/ICurvePool/ICurvePool.sol\";\nimport \"./../interfaces/external/ICurvePool/ICurvePoolETH.sol\";\nimport \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\nimport \"./../interfaces/external/IStakingVault/IStakingVault.sol\";\nimport \"./../interfaces/external/ICurvePool/ICurvePoolNonETH.sol\";\n\n/// @notice Library for LP Staking Vaults deposit/withdraw\nlibrary StakingLPVaultHelpers {\n    using SafeERC20 for IERC20;\n\n    /// @dev  Add liquidity in a Curve pool with ETH and deposit\n    ///       the LP token in a staking vault\n    /// @param vault The staking vault address to deposit into\n    /// @param pool The Curve pool to add liquitiy in\n    /// @param lpToken The Curve pool LP token\n    /// @param poolCoinAmount The number of token in the Curve pool\n    /// @param eth ETH address\n    /// @param amount ETH amount to add in the Curve pool\n    function _addLiquidityAndDepositETH(\n        address vault,\n        ICurvePoolETH pool,\n        IERC20 lpToken,\n        uint256 poolCoinAmount,\n        address eth,\n        uint256 amount\n    ) internal {\n        uint256 lpTokenBalanceBefore = lpToken.balanceOf(address(this));\n\n        if (poolCoinAmount == 2) {\n            pool.add_liquidity{ value: amount }(CurveHelpers.getAmounts2Coins(pool, eth, amount), 0);\n        } else if (poolCoinAmount == 3) {\n            pool.add_liquidity{ value: amount }(CurveHelpers.getAmounts3Coins(pool, eth, amount), 0);\n        } else {\n            pool.add_liquidity{ value: amount }(CurveHelpers.getAmounts4Coins(pool, eth, amount), 0);\n        }\n\n        uint256 lpTokenToDeposit = lpToken.balanceOf(address(this)) - lpTokenBalanceBefore;\n        ExchangeHelpers.setMaxAllowance(lpToken, vault);\n        IStakingVault(vault).deposit(lpTokenToDeposit);\n    }\n\n    /// @dev  Add liquidity in a Curve pool and deposit\n    ///       the LP token in a staking vault\n    /// @param vault The staking vault address to deposit into\n    /// @param pool The Curve pool to add liquitiy in\n    /// @param lpToken The Curve pool lpToken\n    /// @param poolCoinAmount The number of token in the Curve pool\n    /// @param token Token to add in the Curve pool liquidity\n    /// @param amount Token amount to add in the Curve pool\n    function _addLiquidityAndDeposit(\n        address vault,\n        ICurvePoolNonETH pool,\n        IERC20 lpToken,\n        uint256 poolCoinAmount,\n        address token,\n        uint256 amount\n    ) internal {\n        uint256 lpTokenBalanceBefore = lpToken.balanceOf(address(this));\n        ExchangeHelpers.setMaxAllowance(IERC20(token), address(pool));\n\n        if (poolCoinAmount == 2) {\n            pool.add_liquidity(CurveHelpers.getAmounts2Coins(pool, token, amount), 0);\n        } else if (poolCoinAmount == 3) {\n            pool.add_liquidity(CurveHelpers.getAmounts3Coins(pool, token, amount), 0);\n        } else {\n            pool.add_liquidity(CurveHelpers.getAmounts4Coins(pool, token, amount), 0);\n        }\n\n        uint256 lpTokenToDeposit = lpToken.balanceOf(address(this)) - lpTokenBalanceBefore;\n        ExchangeHelpers.setMaxAllowance(lpToken, vault);\n        IStakingVault(vault).deposit(lpTokenToDeposit);\n    }\n\n    /// @dev Withdraw the LP token from the staking vault and\n    ///      remove the liquidity from the Curve pool\n    /// @param vault The staking vault address to withdraw from\n    /// @param amount The amount to withdraw\n    /// @param pool The Curve pool to remove liquitiy from\n    /// @param lpToken The Curve pool LP token\n    /// @param poolCoinAmount The number of token in the Curve pool\n    /// @param outputToken Output token to receive\n    function _withdrawAndRemoveLiquidity128(\n        address vault,\n        uint256 amount,\n        ICurvePool pool,\n        IERC20 lpToken,\n        uint256 poolCoinAmount,\n        address outputToken\n    ) internal {\n        uint256 lpTokenBalanceBefore = lpToken.balanceOf(address(this));\n        IStakingVault(vault).withdraw(amount);\n\n        bool success = CurveHelpers.removeLiquidityOneCoin(\n            pool,\n            lpToken.balanceOf(address(this)) - lpTokenBalanceBefore,\n            outputToken,\n            poolCoinAmount,\n            bytes4(keccak256(bytes(\"remove_liquidity_one_coin(uint256,int128,uint256)\")))\n        );\n\n        require(success, \"SDCSO: CURVE_RM_LIQUIDITY_FAILED\");\n    }\n\n    /// @dev Withdraw the LP token from the staking vault and\n    ///      remove the liquidity from the Curve pool\n    /// @param vault The staking vault address to withdraw from\n    /// @param amount The amount to withdraw\n    /// @param pool The Curve pool to remove liquitiy from\n    /// @param lpToken The Curve pool LP token\n    /// @param poolCoinAmount The number of token in the Curve pool\n    /// @param outputToken Output token to receive\n    function _withdrawAndRemoveLiquidity256(\n        address vault,\n        uint256 amount,\n        ICurvePool pool,\n        IERC20 lpToken,\n        uint256 poolCoinAmount,\n        address outputToken\n    ) internal {\n        uint256 lpTokenBalanceBefore = lpToken.balanceOf(address(this));\n        IStakingVault(vault).withdraw(amount);\n\n        bool success = CurveHelpers.removeLiquidityOneCoin(\n            pool,\n            lpToken.balanceOf(address(this)) - lpTokenBalanceBefore,\n            outputToken,\n            poolCoinAmount,\n            bytes4(keccak256(bytes(\"remove_liquidity_one_coin(uint256,uint256,uint256)\")))\n        );\n\n        require(success, \"SDCSO: CURVE_RM_LIQUIDITY_FAILED\");\n    }\n}"
    }
  ]
}