{
  "Title": "[N-04] Incorrect documentation of `registerControllerFactory()`",
  "Content": "\n[WildcatArchController Line 106](https://github.com/code-423n4/2023-10-wildcat/blob/main/src/WildcatArchController.sol#L106)\n\n### Issue Description\n\nThe documentation in the [GitBook](https://wildcat-protocol.gitbook.io/wildcat/technical-deep-dive/component-overview/wildcatarchcontroller.sol) states that the function `registerControllerFactory()` only reverts if \"The controller factory has already been registered.\" This is inaccurate because the function also uses the `onlyOwner()` modifier, which causes it to revert if called by someone other than the owner.\n\n### Recommended Mitigation Steps\n\nRevise the documentation to include the statement \"Called by someone other than the owner.\"\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2023-10-wildcat",
  "Code": [
    {
      "filename": "src/WildcatArchController.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity >=0.8.20;\n\nimport { EnumerableSet } from 'openzeppelin/contracts/utils/structs/EnumerableSet.sol';\nimport 'solady/auth/Ownable.sol';\nimport './libraries/MathUtils.sol';\n\ncontract WildcatArchController is Ownable {\n  using EnumerableSet for EnumerableSet.AddressSet;\n\n  EnumerableSet.AddressSet internal _markets;\n  EnumerableSet.AddressSet internal _controllerFactories;\n  EnumerableSet.AddressSet internal _borrowers;\n  EnumerableSet.AddressSet internal _controllers;\n\n  error NotControllerFactory();\n  error NotController();\n\n  error BorrowerAlreadyExists();\n  error ControllerFactoryAlreadyExists();\n  error ControllerAlreadyExists();\n  error MarketAlreadyExists();\n\n  error BorrowerDoesNotExist();\n  error ControllerFactoryDoesNotExist();\n  error ControllerDoesNotExist();\n  error MarketDoesNotExist();\n\n  event MarketAdded(address indexed controller, address market);\n  event MarketRemoved(address market);\n\n  event ControllerFactoryAdded(address controllerFactory);\n  event ControllerFactoryRemoved(address controllerFactory);\n\n  event BorrowerAdded(address borrower);\n  event BorrowerRemoved(address borrower);\n\n  event ControllerAdded(address indexed controllerFactory, address controller);\n  event ControllerRemoved(address controller);\n\n  modifier onlyControllerFactory() {\n    if (!_controllerFactories.contains(msg.sender)) {\n      revert NotControllerFactory();\n    }\n    _;\n  }\n\n  modifier onlyController() {\n    if (!_controllers.contains(msg.sender)) {\n      revert NotController();\n    }\n    _;\n  }\n\n  constructor() {\n    _initializeOwner(msg.sender);\n  }\n\n  /* ========================================================================== */\n  /*                                  Borrowers                                 */\n  /* ========================================================================== */\n\n  function registerBorrower(address borrower) external onlyOwner {\n    if (!_borrowers.add(borrower)) {\n      revert BorrowerAlreadyExists();\n    }\n    emit BorrowerAdded(borrower);\n  }\n\n  function removeBorrower(address borrower) external onlyOwner {\n    if (!_borrowers.remove(borrower)) {\n      revert BorrowerDoesNotExist();\n    }\n    emit BorrowerRemoved(borrower);\n  }\n\n  function isRegisteredBorrower(address borrower) external view returns (bool) {\n    return _borrowers.contains(borrower);\n  }\n\n  function getRegisteredBorrowers() external view returns (address[] memory) {\n    return _borrowers.values();\n  }\n\n  function getRegisteredBorrowers(\n    uint256 start,\n    uint256 end\n  ) external view returns (address[] memory arr) {\n    uint256 len = _borrowers.length();\n    end = MathUtils.min(end, len);\n    uint256 count = end - start;\n    arr = new address[](count);\n    for (uint256 i = 0; i < count; i++) {\n      arr[i] = _borrowers.at(start + i);\n    }\n  }\n\n  function getRegisteredBorrowersCount() external view returns (uint256) {\n    return _borrowers.length();\n  }\n\n  /* ========================================================================== */\n  /*                            Controller Factories                            */\n  /* ========================================================================== */\n\n  function registerControllerFactory(address factory) external onlyOwner {\n    if (!_controllerFactories.add(factory)) {\n      revert ControllerFactoryAlreadyExists();\n    }\n    emit ControllerFactoryAdded(factory);\n  }\n\n  function removeControllerFactory(address factory) external onlyOwner {\n    if (!_controllerFactories.remove(factory)) {\n      revert ControllerFactoryDoesNotExist();\n    }\n    emit ControllerFactoryRemoved(factory);\n  }\n\n  function isRegisteredControllerFactory(address factory) external view returns (bool) {\n    return _controllerFactories.contains(factory);\n  }\n\n  function getRegisteredControllerFactories() external view returns (address[] memory) {\n    return _controllerFactories.values();\n  }\n\n  function getRegisteredControllerFactories(\n    uint256 start,\n    uint256 end\n  ) external view returns (address[] memory arr) {\n    uint256 len = _controllerFactories.length();\n    end = MathUtils.min(end, len);\n    uint256 count = end - start;\n    arr = new address[](count);\n    for (uint256 i = 0; i < count; i++) {\n      arr[i] = _controllerFactories.at(start + i);\n    }\n  }\n\n  function getRegisteredControllerFactoriesCount() external view returns (uint256) {\n    return _controllerFactories.length();\n  }\n\n  /* ========================================================================== */\n  /*                                 Controllers                                */\n  /* ========================================================================== */\n\n  function registerController(address controller) external onlyControllerFactory {\n    if (!_controllers.add(controller)) {\n      revert ControllerAlreadyExists();\n    }\n    emit ControllerAdded(msg.sender, controller);\n  }\n\n  function removeController(address controller) external onlyOwner {\n    if (!_controllers.remove(controller)) {\n      revert ControllerDoesNotExist();\n    }\n    emit ControllerRemoved(controller);\n  }\n\n  function isRegisteredController(address controller) external view returns (bool) {\n    return _controllers.contains(controller);\n  }\n\n  function getRegisteredControllers() external view returns (address[] memory) {\n    return _controllers.values();\n  }\n\n  function getRegisteredControllers(\n    uint256 start,\n    uint256 end\n  ) external view returns (address[] memory arr) {\n    uint256 len = _controllers.length();\n    end = MathUtils.min(end, len);\n    uint256 count = end - start;\n    arr = new address[](count);\n    for (uint256 i = 0; i < count; i++) {\n      arr[i] = _controllers.at(start + i);\n    }\n  }\n\n  function getRegisteredControllersCount() external view returns (uint256) {\n    return _controllers.length();\n  }\n\n  /* ========================================================================== */\n  /*                                   Markets                                   */\n  /* ========================================================================== */\n\n  function registerMarket(address market) external onlyController {\n    if (!_markets.add(market)) {\n      revert MarketAlreadyExists();\n    }\n    emit MarketAdded(msg.sender, market);\n  }\n\n  function removeMarket(address market) external onlyOwner {\n    if (!_markets.remove(market)) {\n      revert MarketDoesNotExist();\n    }\n    emit MarketRemoved(market);\n  }\n\n  function isRegisteredMarket(address market) external view returns (bool) {\n    return _markets.contains(market);\n  }\n\n  function getRegisteredMarkets() external view returns (address[] memory) {\n    return _markets.values();\n  }\n\n  function getRegisteredMarkets(\n    uint256 start,\n    uint256 end\n  ) external view returns (address[] memory arr) {\n    uint256 len = _markets.length();\n    end = MathUtils.min(end, len);\n    uint256 count = end - start;\n    arr = new address[](count);\n    for (uint256 i = 0; i < count; i++) {\n      arr[i] = _markets.at(start + i);\n    }\n  }\n\n  function getRegisteredMarketsCount() external view returns (uint256) {\n    return _markets.length();\n  }\n}"
    }
  ]
}