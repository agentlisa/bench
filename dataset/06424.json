{
  "Title": "[M-10] Owner in `VaultProxy.sol ` is `address(0)`",
  "Content": "\nThe owner variable in the `VaultProxy.sol` is going to be zero because of a bug in `staderConfig`.\nThe `intialize` function in `staderConfig` grants the admin role to an admin passed in the native `_grantRole()`, but does not update the mapping that `getAdmin` reads from.\n\n```solidity\n    function initialise(\n        bool _isValidatorWithdrawalVault,\n        uint8 _poolId,\n        uint256 _id,\n        address _staderConfig\n    ) external {\n        if (isInitialized) {\n            revert AlreadyInitialized();\n        }\n        UtilLib.checkNonZeroAddress(_staderConfig);\n        isValidatorWithdrawalVault = _isValidatorWithdrawalVault;\n        isInitialized = true;\n        poolId = _poolId;\n        id = _id;\n        staderConfig = IStaderConfig(_staderConfig);\n\n        //@audit-issue Admin is zero on initialize\n        //address(0) is going to  be returned, wrt stader.initialize\n        owner = staderConfig.getAdmin();\n    }\n```\n<https://github.com/code-423n4/2023-06-stader/blob/7566b5a35f32ebd55d3578b8bd05c038feb7d9cc/contracts/StaderConfig.sol#L85-L103> <br><https://github.com/code-423n4/2023-06-stader/blob/7566b5a35f32ebd55d3578b8bd05c038feb7d9cc/contracts/StaderConfig.sol#L361-L363>\n\nThe intialization of the vaults would not revert and all functions restricted to the owner would be inaccessible, unless function `updateAdmin` is called.\n\n<https://github.com/code-423n4/2023-06-stader/blob/7566b5a35f32ebd55d3578b8bd05c038feb7d9cc/contracts/StaderConfig.sol#L176-L183>\n\nThe update admin does not revoke functions for the current admin in the `AccessControl` contract either, because the address returned is address zero.\n\n### Proof of Concept\n\n```solidity\n\npragma solidity 0.8.16;\n\nimport '../../contracts/library/UtilLib.sol';\n\nimport '../../contracts/StaderConfig.sol';\nimport '../../contracts/VaultProxy.sol';\nimport '../../contracts/ValidatorWithdrawalVault.sol';\nimport '../../contracts/OperatorRewardsCollector.sol';\n\nimport './mocks/PoolUtilsMock.sol';\nimport './mocks/PenaltyMockForVault.sol';\nimport './mocks/SDCollateralMock.sol';\nimport './mocks/StakePoolManagerMock.sol';\n\nimport 'forge-std/Test.sol';\nimport '@openzeppelin/contracts/proxy/transparent/TransparentUpgradeableProxy.sol';\nimport '@openzeppelin/contracts/proxy/transparent/ProxyAdmin.sol';\n\ncontract ValidatorWithdrawalVaultTest is Test {\n    address staderAdmin;\n    address staderManager;\n    address staderTreasury;\n    PoolUtilsMock poolUtils;\n\n    uint8 poolId;\n    uint256 validatorId;\n\n    StaderConfig staderConfig;\n    VaultProxy withdrawVault;\n    OperatorRewardsCollector operatorRC;\n\n    function setUp() public {\n        poolId = 1;\n        validatorId = 1;\n\n        staderAdmin = vm.addr(100);\n        staderManager = vm.addr(101);\n        address ethDepositAddr = vm.addr(102);\n\n        ProxyAdmin proxyAdmin = new ProxyAdmin();\n\n        StaderConfig configImpl = new StaderConfig();\n        TransparentUpgradeableProxy configProxy = new TransparentUpgradeableProxy(\n            address(configImpl),\n            address(proxyAdmin),\n            ''\n        );\n        staderConfig = StaderConfig(address(configProxy));\n        staderConfig.initialize(staderAdmin, ethDepositAddr);\n\n        OperatorRewardsCollector operatorRCImpl = new OperatorRewardsCollector();\n        TransparentUpgradeableProxy operatorRCProxy = new TransparentUpgradeableProxy(\n            address(operatorRCImpl),\n            address(proxyAdmin),\n            ''\n        );\n        operatorRC = OperatorRewardsCollector(address(operatorRCProxy));\n        operatorRC.initialize(staderAdmin, address(staderConfig));\n\n        poolUtils = new PoolUtilsMock(address(staderConfig));\n        PenaltyMockForVault penaltyContract = new PenaltyMockForVault();\n        SDCollateralMock sdCollateral = new SDCollateralMock();\n        ValidatorWithdrawalVault withdrawVaultImpl = new ValidatorWithdrawalVault();\n\n        vm.startPrank(staderAdmin);\n        staderConfig.updatePoolUtils(address(poolUtils));\n        staderConfig.updatePenaltyContract(address(penaltyContract));\n        staderConfig.updateSDCollateral(address(sdCollateral));\n        staderConfig.updateOperatorRewardsCollector(address(operatorRC));\n        staderConfig.updateValidatorWithdrawalVaultImplementation(address(withdrawVaultImpl));\n\n        vm.stopPrank();\n\n        withdrawVault = new VaultProxy();\n        withdrawVault.initialise(true, poolId, validatorId, address(staderConfig));\n    }\n\n    function testAdminRights() public {\n       vm.startPrank(staderAdmin);\n      staderConfig.grantRole(staderConfig.MANAGER(), staderManager); \n      vm.stopPrank();\n    }\n    function testFetchAdminAndVaultOwner() public{\n        address _admin = staderConfig.getAdmin();\n        assertEq(_admin, address(0));\n        address _owner = withdrawVault.owner();\n        assertEq(_owner, address(0));\n    }\n    \n}\n```\n\n### Tools Used\n\nFoundry\n\n### Recommended Mitigation Steps\n\n`StaderConfig.initialize` should add `setAccount(ADMIN, _admin);` at the last line.\n\n### Assessed type\n\nAccess Control\n\n\n**[Picodes (judge) decreased severity to Medium](https://github.com/code-423n4/2022-06-stader-findings/issues/133#issuecomment-1618123059)**\n\n**[sanjay-staderlabs (Stader) disagreed with severity, acknowledged and commented](https://github.com/code-423n4/2022-06-stader-findings/issues/133#issuecomment-1619520724):**\n > We are handling it as a part of the deployment process; `updateAdmin(address _admin)` is called during deployment process.\n\n**[sanjay-staderlabs (Stader) commented](https://github.com/code-423n4/2022-06-stader-findings/issues/133#issuecomment-1622917002):**\n > @Picodes - can you please check this? It think it should be part for QA.\n> Thanks\n\n**[Picodes (judge) commented](https://github.com/code-423n4/2022-06-stader-findings/issues/133#issuecomment-1623790281):**\n > Considering the audited version of the code, especially in combination with [issue 390](https://github.com/code-423n4/2022-06-stader-findings/issues/390), I still think this qualifies for Medium severity.\n\n\n***\n\n",
  "Impact": "MEDIUM",
  "Source": "https://code4rena.com/reports/2023-06-stader",
  "Code": [
    {
      "filename": "contracts/StaderConfig.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.16;\n\nimport './library/UtilLib.sol';\n\nimport './interfaces/IStaderConfig.sol';\n\nimport '@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol';\n\ncontract StaderConfig is IStaderConfig, Initializable, AccessControlUpgradeable {\n    // staked ETH per node on beacon chain i.e. 32 ETH\n    bytes32 public constant ETH_PER_NODE = keccak256('ETH_PER_NODE');\n    //amount of ETH for pre-deposit on beacon chain i.e 1 ETH\n    bytes32 public constant PRE_DEPOSIT_SIZE = keccak256('PRE_DEPOSIT_SIZE');\n    //amount of ETH for full deposit on beacon chain i.e 31 ETH\n    bytes32 public constant FULL_DEPOSIT_SIZE = keccak256('FULL_DEPOSIT_SIZE');\n    // ETH to WEI ratio i.e 10**18\n    bytes32 public constant DECIMALS = keccak256('DECIMALS');\n    //Total fee bips\n    bytes32 public constant TOTAL_FEE = keccak256('TOTAL_FEE');\n    //maximum length of operator name string\n    bytes32 public constant OPERATOR_MAX_NAME_LENGTH = keccak256('OPERATOR_MAX_NAME_LENGTH');\n\n    bytes32 public constant SOCIALIZING_POOL_CYCLE_DURATION = keccak256('SOCIALIZING_POOL_CYCLE_DURATION');\n    bytes32 public constant SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD =\n        keccak256('SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD');\n    bytes32 public constant REWARD_THRESHOLD = keccak256('REWARD_THRESHOLD');\n    bytes32 public constant MIN_DEPOSIT_AMOUNT = keccak256('MIN_DEPOSIT_AMOUNT');\n    bytes32 public constant MAX_DEPOSIT_AMOUNT = keccak256('MAX_DEPOSIT_AMOUNT');\n    bytes32 public constant MIN_WITHDRAW_AMOUNT = keccak256('MIN_WITHDRAW_AMOUNT');\n    bytes32 public constant MAX_WITHDRAW_AMOUNT = keccak256('MAX_WITHDRAW_AMOUNT');\n    //minimum delay between user requesting withdraw and request finalization\n    bytes32 public constant MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST =\n        keccak256('MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST');\n    bytes32 public constant WITHDRAWN_KEYS_BATCH_SIZE = keccak256('WITHDRAWN_KEYS_BATCH_SIZE');\n\n    bytes32 public constant ADMIN = keccak256('ADMIN');\n    bytes32 public constant STADER_TREASURY = keccak256('STADER_TREASURY');\n\n    bytes32 public constant override POOL_UTILS = keccak256('POOL_UTILS');\n    bytes32 public constant override POOL_SELECTOR = keccak256('POOL_SELECTOR');\n    bytes32 public constant override SD_COLLATERAL = keccak256('SD_COLLATERAL');\n    bytes32 public constant override OPERATOR_REWARD_COLLECTOR = keccak256('OPERATOR_REWARD_COLLECTOR');\n    bytes32 public constant override VAULT_FACTORY = keccak256('VAULT_FACTORY');\n    bytes32 public constant override STADER_ORACLE = keccak256('STADER_ORACLE');\n    bytes32 public constant override AUCTION_CONTRACT = keccak256('AuctionContract');\n    bytes32 public constant override PENALTY_CONTRACT = keccak256('PENALTY_CONTRACT');\n    bytes32 public constant override PERMISSIONED_POOL = keccak256('PERMISSIONED_POOL');\n    bytes32 public constant override STAKE_POOL_MANAGER = keccak256('STAKE_POOL_MANAGER');\n    bytes32 public constant override ETH_DEPOSIT_CONTRACT = keccak256('ETH_DEPOSIT_CONTRACT');\n    bytes32 public constant override PERMISSIONLESS_POOL = keccak256('PERMISSIONLESS_POOL');\n    bytes32 public constant override USER_WITHDRAW_MANAGER = keccak256('USER_WITHDRAW_MANAGER');\n    bytes32 public constant override STADER_INSURANCE_FUND = keccak256('STADER_INSURANCE_FUND');\n    bytes32 public constant override PERMISSIONED_NODE_REGISTRY = keccak256('PERMISSIONED_NODE_REGISTRY');\n    bytes32 public constant override PERMISSIONLESS_NODE_REGISTRY = keccak256('PERMISSIONLESS_NODE_REGISTRY');\n    bytes32 public constant override PERMISSIONED_SOCIALIZING_POOL = keccak256('PERMISSIONED_SOCIALIZING_POOL');\n    bytes32 public constant override PERMISSIONLESS_SOCIALIZING_POOL = keccak256('PERMISSIONLESS_SOCIALIZING_POOL');\n    bytes32 public constant override NODE_EL_REWARD_VAULT_IMPLEMENTATION =\n        keccak256('NODE_EL_REWARD_VAULT_IMPLEMENTATION');\n    bytes32 public constant override VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION =\n        keccak256('VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION');\n\n    //POR Feed Proxy\n    bytes32 public constant override ETH_BALANCE_POR_FEED = keccak256('ETH_BALANCE_POR_FEED');\n    bytes32 public constant override ETHX_SUPPLY_POR_FEED = keccak256('ETHX_SUPPLY_POR_FEED');\n\n    //Roles\n    bytes32 public constant override MANAGER = keccak256('MANAGER');\n    bytes32 public constant override OPERATOR = keccak256('OPERATOR');\n\n    bytes32 public constant SD = keccak256('SD');\n    bytes32 public constant ETHx = keccak256('ETHx');\n\n    mapping(bytes32 => uint256) private constantsMap;\n    mapping(bytes32 => uint256) private variablesMap;\n    mapping(bytes32 => address) private accountsMap;\n    mapping(bytes32 => address) private contractsMap;\n    mapping(bytes32 => address) private tokensMap;\n\n    /// @custom:oz-upgrades-unsafe-allow constructor\n    constructor() {\n        _disableInitializers();\n    }\n\n    function initialize(address _admin, address _ethDepositContract) external initializer {\n        UtilLib.checkNonZeroAddress(_admin);\n        UtilLib.checkNonZeroAddress(_ethDepositContract);\n        __AccessControl_init();\n        setConstant(ETH_PER_NODE, 32 ether);\n        setConstant(PRE_DEPOSIT_SIZE, 1 ether);\n        setConstant(FULL_DEPOSIT_SIZE, 31 ether);\n        setConstant(TOTAL_FEE, 10000);\n        setConstant(DECIMALS, 10**18);\n        setConstant(OPERATOR_MAX_NAME_LENGTH, 255);\n        setVariable(MIN_DEPOSIT_AMOUNT, 10**14);\n        setVariable(MAX_DEPOSIT_AMOUNT, 10000 ether);\n        setVariable(MIN_WITHDRAW_AMOUNT, 10**14);\n        setVariable(MAX_WITHDRAW_AMOUNT, 10000 ether);\n        setVariable(WITHDRAWN_KEYS_BATCH_SIZE, 50);\n        setVariable(MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST, 600);\n        setContract(ETH_DEPOSIT_CONTRACT, _ethDepositContract);\n        _grantRole(DEFAULT_ADMIN_ROLE, _admin);\n    }\n\n    //Variables Setters\n\n    function updateSocializingPoolCycleDuration(uint256 _socializingPoolCycleDuration) external onlyRole(MANAGER) {\n        setVariable(SOCIALIZING_POOL_CYCLE_DURATION, _socializingPoolCycleDuration);\n    }\n\n    function updateSocializingPoolOptInCoolingPeriod(uint256 _SocializePoolOptInCoolingPeriod)\n        external\n        onlyRole(MANAGER)\n    {\n        setVariable(SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD, _SocializePoolOptInCoolingPeriod);\n    }\n\n    function updateRewardsThreshold(uint256 _rewardsThreshold) external onlyRole(MANAGER) {\n        setVariable(REWARD_THRESHOLD, _rewardsThreshold);\n    }\n\n    /**\n     * @dev update the minimum deposit amount\n     * @param _minDepositAmount minimum deposit amount\n     */\n    function updateMinDepositAmount(uint256 _minDepositAmount) external onlyRole(MANAGER) {\n        setVariable(MIN_DEPOSIT_AMOUNT, _minDepositAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the maximum deposit amount\n     * @param _maxDepositAmount maximum deposit amount\n     */\n    function updateMaxDepositAmount(uint256 _maxDepositAmount) external onlyRole(MANAGER) {\n        setVariable(MAX_DEPOSIT_AMOUNT, _maxDepositAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the minimum withdraw amount\n     * @param _minWithdrawAmount minimum withdraw amount\n     */\n    function updateMinWithdrawAmount(uint256 _minWithdrawAmount) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setVariable(MIN_WITHDRAW_AMOUNT, _minWithdrawAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the maximum withdraw amount\n     * @param _maxWithdrawAmount maximum withdraw amount\n     */\n    function updateMaxWithdrawAmount(uint256 _maxWithdrawAmount) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setVariable(MAX_WITHDRAW_AMOUNT, _maxWithdrawAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    function updateMinBlockDelayToFinalizeWithdrawRequest(uint256 _minBlockDelay)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setVariable(MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST, _minBlockDelay);\n    }\n\n    /**\n     * @notice update the max number of withdrawn validator keys reported by oracle in single tx\n     * @dev only `OPERATOR` can call\n     * @param _withdrawnKeysBatchSize updated maximum withdrawn key limit in the oracle input\n     */\n    function updateWithdrawnKeysBatchSize(uint256 _withdrawnKeysBatchSize) external onlyRole(OPERATOR) {\n        setVariable(WITHDRAWN_KEYS_BATCH_SIZE, _withdrawnKeysBatchSize);\n    }\n\n    //Accounts Setters\n\n    function updateAdmin(address _admin) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        address oldAdmin = accountsMap[ADMIN];\n\n        _grantRole(DEFAULT_ADMIN_ROLE, _admin);\n        setAccount(ADMIN, _admin);\n\n        _revokeRole(DEFAULT_ADMIN_ROLE, oldAdmin);\n    }\n\n    function updateStaderTreasury(address _staderTreasury) external onlyRole(MANAGER) {\n        setAccount(STADER_TREASURY, _staderTreasury);\n    }\n\n    // Contracts Setters\n\n    function updatePoolUtils(address _poolUtils) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(POOL_UTILS, _poolUtils);\n    }\n\n    function updatePoolSelector(address _poolSelector) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(POOL_SELECTOR, _poolSelector);\n    }\n\n    function updateSDCollateral(address _sdCollateral) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(SD_COLLATERAL, _sdCollateral);\n    }\n\n    function updateOperatorRewardsCollector(address _operatorRewardsCollector) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(OPERATOR_REWARD_COLLECTOR, _operatorRewardsCollector);\n    }\n\n    function updateVaultFactory(address _vaultFactory) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(VAULT_FACTORY, _vaultFactory);\n    }\n\n    function updateAuctionContract(address _auctionContract) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(AUCTION_CONTRACT, _auctionContract);\n    }\n\n    function updateStaderOracle(address _staderOracle) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STADER_ORACLE, _staderOracle);\n    }\n\n    function updatePenaltyContract(address _penaltyContract) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PENALTY_CONTRACT, _penaltyContract);\n    }\n\n    function updatePermissionedPool(address _permissionedPool) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONED_POOL, _permissionedPool);\n    }\n\n    function updateStakePoolManager(address _stakePoolManager) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STAKE_POOL_MANAGER, _stakePoolManager);\n    }\n\n    function updatePermissionlessPool(address _permissionlessPool) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONLESS_POOL, _permissionlessPool);\n    }\n\n    function updateUserWithdrawManager(address _userWithdrawManager) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(USER_WITHDRAW_MANAGER, _userWithdrawManager);\n    }\n\n    function updateStaderInsuranceFund(address _staderInsuranceFund) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STADER_INSURANCE_FUND, _staderInsuranceFund);\n    }\n\n    function updatePermissionedNodeRegistry(address _permissionedNodeRegistry) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONED_NODE_REGISTRY, _permissionedNodeRegistry);\n    }\n\n    function updatePermissionlessNodeRegistry(address _permissionlessNodeRegistry)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(PERMISSIONLESS_NODE_REGISTRY, _permissionlessNodeRegistry);\n    }\n\n    function updatePermissionedSocializingPool(address _permissionedSocializePool)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(PERMISSIONED_SOCIALIZING_POOL, _permissionedSocializePool);\n    }\n\n    function updatePermissionlessSocializingPool(address _permissionlessSocializePool)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(PERMISSIONLESS_SOCIALIZING_POOL, _permissionlessSocializePool);\n    }\n\n    function updateNodeELRewardImplementation(address _nodeELRewardVaultImpl) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(NODE_EL_REWARD_VAULT_IMPLEMENTATION, _nodeELRewardVaultImpl);\n    }\n\n    function updateValidatorWithdrawalVaultImplementation(address _validatorWithdrawalVaultImpl)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION, _validatorWithdrawalVaultImpl);\n    }\n\n    function updateETHBalancePORFeedProxy(address _ethBalanceProxy) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(ETH_BALANCE_POR_FEED, _ethBalanceProxy);\n    }\n\n    function updateETHXSupplyPORFeedProxy(address _ethXSupplyProxy) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(ETHX_SUPPLY_POR_FEED, _ethXSupplyProxy);\n    }\n\n    function updateStaderToken(address _staderToken) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setToken(SD, _staderToken);\n    }\n\n    function updateETHxToken(address _ethX) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setToken(ETHx, _ethX);\n    }\n\n    //Constants Getters\n\n    function getStakedEthPerNode() external view override returns (uint256) {\n        return constantsMap[ETH_PER_NODE];\n    }\n\n    function getPreDepositSize() external view override returns (uint256) {\n        return constantsMap[PRE_DEPOSIT_SIZE];\n    }\n\n    function getFullDepositSize() external view override returns (uint256) {\n        return constantsMap[FULL_DEPOSIT_SIZE];\n    }\n\n    function getDecimals() external view override returns (uint256) {\n        return constantsMap[DECIMALS];\n    }\n\n    function getTotalFee() external view override returns (uint256) {\n        return constantsMap[TOTAL_FEE];\n    }\n\n    function getOperatorMaxNameLength() external view override returns (uint256) {\n        return constantsMap[OPERATOR_MAX_NAME_LENGTH];\n    }\n\n    //Variables Getters\n\n    function getSocializingPoolCycleDuration() external view override returns (uint256) {\n        return variablesMap[SOCIALIZING_POOL_CYCLE_DURATION];\n    }\n\n    function getSocializingPoolOptInCoolingPeriod() external view override returns (uint256) {\n        return variablesMap[SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD];\n    }\n\n    function getRewardsThreshold() external view override returns (uint256) {\n        return variablesMap[REWARD_THRESHOLD];\n    }\n\n    function getMinDepositAmount() external view override returns (uint256) {\n        return variablesMap[MIN_DEPOSIT_AMOUNT];\n    }\n\n    function getMaxDepositAmount() external view override returns (uint256) {\n        return variablesMap[MAX_DEPOSIT_AMOUNT];\n    }\n\n    function getMinWithdrawAmount() external view override returns (uint256) {\n        return variablesMap[MIN_WITHDRAW_AMOUNT];\n    }\n\n    function getMaxWithdrawAmount() external view override returns (uint256) {\n        return variablesMap[MAX_WITHDRAW_AMOUNT];\n    }\n\n    function getMinBlockDelayToFinalizeWithdrawRequest() external view override returns (uint256) {\n        return variablesMap[MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST];\n    }\n\n    function getWithdrawnKeyBatchSize() external view override returns (uint256) {\n        return variablesMap[WITHDRAWN_KEYS_BATCH_SIZE];\n    }\n\n    //Account Getters\n\n    function getAdmin() external view returns (address) {\n        return accountsMap[ADMIN];\n    }\n\n    function getStaderTreasury() external view override returns (address) {\n        return accountsMap[STADER_TREASURY];\n    }\n\n    //Contracts Getters\n\n    function getPoolUtils() external view override returns (address) {\n        return contractsMap[POOL_UTILS];\n    }\n\n    function getPoolSelector() external view override returns (address) {\n        return contractsMap[POOL_SELECTOR];\n    }\n\n    function getSDCollateral() external view override returns (address) {\n        return contractsMap[SD_COLLATERAL];\n    }\n\n    function getOperatorRewardsCollector() external view override returns (address) {\n        return contractsMap[OPERATOR_REWARD_COLLECTOR];\n    }\n\n    function getVaultFactory() external view override returns (address) {\n        return contractsMap[VAULT_FACTORY];\n    }\n\n    function getStaderOracle() external view override returns (address) {\n        return contractsMap[STADER_ORACLE];\n    }\n\n    function getAuctionContract() external view override returns (address) {\n        return contractsMap[AUCTION_CONTRACT];\n    }\n\n    function getPenaltyContract() external view override returns (address) {\n        return contractsMap[PENALTY_CONTRACT];\n    }\n\n    function getPermissionedPool() external view override returns (address) {\n        return contractsMap[PERMISSIONED_POOL];\n    }\n\n    function getStakePoolManager() external view override returns (address) {\n        return contractsMap[STAKE_POOL_MANAGER];\n    }\n\n    function getETHDepositContract() external view override returns (address) {\n        return contractsMap[ETH_DEPOSIT_CONTRACT];\n    }\n\n    function getPermissionlessPool() external view override returns (address) {\n        return contractsMap[PERMISSIONLESS_POOL];\n    }\n\n    function getUserWithdrawManager() external view override returns (address) {\n        return contractsMap[USER_WITHDRAW_MANAGER];\n    }\n\n    function getStaderInsuranceFund() external view override returns (address) {\n        return contractsMap[STADER_INSURANCE_FUND];\n    }\n\n    function getPermissionedNodeRegistry() external view override returns (address) {\n        return contractsMap[PERMISSIONED_NODE_REGISTRY];\n    }\n\n    function getPermissionlessNodeRegistry() external view override returns (address) {\n        return contractsMap[PERMISSIONLESS_NODE_REGISTRY];\n    }\n\n    function getPermissionedSocializingPool() external view override returns (address) {\n        return contractsMap[PERMISSIONED_SOCIALIZING_POOL];\n    }\n\n    function getPermissionlessSocializingPool() external view override returns (address) {\n        return contractsMap[PERMISSIONLESS_SOCIALIZING_POOL];\n    }\n\n    function getNodeELRewardVaultImplementation() external view override returns (address) {\n        return contractsMap[NODE_EL_REWARD_VAULT_IMPLEMENTATION];\n    }\n\n    function getValidatorWithdrawalVaultImplementation() external view override returns (address) {\n        return contractsMap[VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION];\n    }\n\n    //POR Feed Proxy Getters\n    function getETHBalancePORFeedProxy() external view override returns (address) {\n        return contractsMap[ETH_BALANCE_POR_FEED];\n    }\n\n    function getETHXSupplyPORFeedProxy() external view override returns (address) {\n        return contractsMap[ETHX_SUPPLY_POR_FEED];\n    }\n\n    //Token Getters\n\n    function getStaderToken() external view override returns (address) {\n        return tokensMap[SD];\n    }\n\n    function getETHxToken() external view returns (address) {\n        return tokensMap[ETHx];\n    }\n\n    // SETTER HELPERS\n    function setConstant(bytes32 key, uint256 val) internal {\n        constantsMap[key] = val;\n        emit SetConstant(key, val);\n    }\n\n    function setVariable(bytes32 key, uint256 val) internal {\n        variablesMap[key] = val;\n        emit SetConstant(key, val);\n    }\n\n    function setAccount(bytes32 key, address val) internal {\n        UtilLib.checkNonZeroAddress(val);\n        accountsMap[key] = val;\n        emit SetAccount(key, val);\n    }\n\n    function setContract(bytes32 key, address val) internal {\n        UtilLib.checkNonZeroAddress(val);\n        contractsMap[key] = val;\n        emit SetContract(key, val);\n    }\n\n    function setToken(bytes32 key, address val) internal {\n        UtilLib.checkNonZeroAddress(val);\n        tokensMap[key] = val;\n        emit SetToken(key, val);\n    }\n\n    //only stader protocol contract check\n    function onlyStaderContract(address _addr, bytes32 _contractName) external view returns (bool) {\n        return (_addr == contractsMap[_contractName]);\n    }\n\n    function onlyManagerRole(address account) public view override returns (bool) {\n        return hasRole(MANAGER, account);\n    }\n\n    function onlyOperatorRole(address account) public view override returns (bool) {\n        return hasRole(OPERATOR, account);\n    }\n\n    function verifyDepositAndWithdrawLimits() internal view {\n        if (\n            !(variablesMap[MIN_DEPOSIT_AMOUNT] != 0 &&\n                variablesMap[MIN_WITHDRAW_AMOUNT] != 0 &&\n                variablesMap[MIN_DEPOSIT_AMOUNT] <= variablesMap[MAX_DEPOSIT_AMOUNT] &&\n                variablesMap[MIN_WITHDRAW_AMOUNT] <= variablesMap[MAX_WITHDRAW_AMOUNT] &&\n                variablesMap[MIN_WITHDRAW_AMOUNT] <= variablesMap[MIN_DEPOSIT_AMOUNT] &&\n                variablesMap[MAX_WITHDRAW_AMOUNT] >= variablesMap[MAX_DEPOSIT_AMOUNT])\n        ) {\n            revert InvalidLimits();\n        }\n    }\n}"
    },
    {
      "filename": "contracts/StaderConfig.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.16;\n\nimport './library/UtilLib.sol';\n\nimport './interfaces/IStaderConfig.sol';\n\nimport '@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol';\n\ncontract StaderConfig is IStaderConfig, Initializable, AccessControlUpgradeable {\n    // staked ETH per node on beacon chain i.e. 32 ETH\n    bytes32 public constant ETH_PER_NODE = keccak256('ETH_PER_NODE');\n    //amount of ETH for pre-deposit on beacon chain i.e 1 ETH\n    bytes32 public constant PRE_DEPOSIT_SIZE = keccak256('PRE_DEPOSIT_SIZE');\n    //amount of ETH for full deposit on beacon chain i.e 31 ETH\n    bytes32 public constant FULL_DEPOSIT_SIZE = keccak256('FULL_DEPOSIT_SIZE');\n    // ETH to WEI ratio i.e 10**18\n    bytes32 public constant DECIMALS = keccak256('DECIMALS');\n    //Total fee bips\n    bytes32 public constant TOTAL_FEE = keccak256('TOTAL_FEE');\n    //maximum length of operator name string\n    bytes32 public constant OPERATOR_MAX_NAME_LENGTH = keccak256('OPERATOR_MAX_NAME_LENGTH');\n\n    bytes32 public constant SOCIALIZING_POOL_CYCLE_DURATION = keccak256('SOCIALIZING_POOL_CYCLE_DURATION');\n    bytes32 public constant SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD =\n        keccak256('SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD');\n    bytes32 public constant REWARD_THRESHOLD = keccak256('REWARD_THRESHOLD');\n    bytes32 public constant MIN_DEPOSIT_AMOUNT = keccak256('MIN_DEPOSIT_AMOUNT');\n    bytes32 public constant MAX_DEPOSIT_AMOUNT = keccak256('MAX_DEPOSIT_AMOUNT');\n    bytes32 public constant MIN_WITHDRAW_AMOUNT = keccak256('MIN_WITHDRAW_AMOUNT');\n    bytes32 public constant MAX_WITHDRAW_AMOUNT = keccak256('MAX_WITHDRAW_AMOUNT');\n    //minimum delay between user requesting withdraw and request finalization\n    bytes32 public constant MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST =\n        keccak256('MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST');\n    bytes32 public constant WITHDRAWN_KEYS_BATCH_SIZE = keccak256('WITHDRAWN_KEYS_BATCH_SIZE');\n\n    bytes32 public constant ADMIN = keccak256('ADMIN');\n    bytes32 public constant STADER_TREASURY = keccak256('STADER_TREASURY');\n\n    bytes32 public constant override POOL_UTILS = keccak256('POOL_UTILS');\n    bytes32 public constant override POOL_SELECTOR = keccak256('POOL_SELECTOR');\n    bytes32 public constant override SD_COLLATERAL = keccak256('SD_COLLATERAL');\n    bytes32 public constant override OPERATOR_REWARD_COLLECTOR = keccak256('OPERATOR_REWARD_COLLECTOR');\n    bytes32 public constant override VAULT_FACTORY = keccak256('VAULT_FACTORY');\n    bytes32 public constant override STADER_ORACLE = keccak256('STADER_ORACLE');\n    bytes32 public constant override AUCTION_CONTRACT = keccak256('AuctionContract');\n    bytes32 public constant override PENALTY_CONTRACT = keccak256('PENALTY_CONTRACT');\n    bytes32 public constant override PERMISSIONED_POOL = keccak256('PERMISSIONED_POOL');\n    bytes32 public constant override STAKE_POOL_MANAGER = keccak256('STAKE_POOL_MANAGER');\n    bytes32 public constant override ETH_DEPOSIT_CONTRACT = keccak256('ETH_DEPOSIT_CONTRACT');\n    bytes32 public constant override PERMISSIONLESS_POOL = keccak256('PERMISSIONLESS_POOL');\n    bytes32 public constant override USER_WITHDRAW_MANAGER = keccak256('USER_WITHDRAW_MANAGER');\n    bytes32 public constant override STADER_INSURANCE_FUND = keccak256('STADER_INSURANCE_FUND');\n    bytes32 public constant override PERMISSIONED_NODE_REGISTRY = keccak256('PERMISSIONED_NODE_REGISTRY');\n    bytes32 public constant override PERMISSIONLESS_NODE_REGISTRY = keccak256('PERMISSIONLESS_NODE_REGISTRY');\n    bytes32 public constant override PERMISSIONED_SOCIALIZING_POOL = keccak256('PERMISSIONED_SOCIALIZING_POOL');\n    bytes32 public constant override PERMISSIONLESS_SOCIALIZING_POOL = keccak256('PERMISSIONLESS_SOCIALIZING_POOL');\n    bytes32 public constant override NODE_EL_REWARD_VAULT_IMPLEMENTATION =\n        keccak256('NODE_EL_REWARD_VAULT_IMPLEMENTATION');\n    bytes32 public constant override VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION =\n        keccak256('VALIDATOR_WITHDRAWAL_VAULT_IMPLEMENTATION');\n\n    //POR Feed Proxy\n    bytes32 public constant override ETH_BALANCE_POR_FEED = keccak256('ETH_BALANCE_POR_FEED');\n    bytes32 public constant override ETHX_SUPPLY_POR_FEED = keccak256('ETHX_SUPPLY_POR_FEED');\n\n    //Roles\n    bytes32 public constant override MANAGER = keccak256('MANAGER');\n    bytes32 public constant override OPERATOR = keccak256('OPERATOR');\n\n    bytes32 public constant SD = keccak256('SD');\n    bytes32 public constant ETHx = keccak256('ETHx');\n\n    mapping(bytes32 => uint256) private constantsMap;\n    mapping(bytes32 => uint256) private variablesMap;\n    mapping(bytes32 => address) private accountsMap;\n    mapping(bytes32 => address) private contractsMap;\n    mapping(bytes32 => address) private tokensMap;\n\n    /// @custom:oz-upgrades-unsafe-allow constructor\n    constructor() {\n        _disableInitializers();\n    }\n\n    function initialize(address _admin, address _ethDepositContract) external initializer {\n        UtilLib.checkNonZeroAddress(_admin);\n        UtilLib.checkNonZeroAddress(_ethDepositContract);\n        __AccessControl_init();\n        setConstant(ETH_PER_NODE, 32 ether);\n        setConstant(PRE_DEPOSIT_SIZE, 1 ether);\n        setConstant(FULL_DEPOSIT_SIZE, 31 ether);\n        setConstant(TOTAL_FEE, 10000);\n        setConstant(DECIMALS, 10**18);\n        setConstant(OPERATOR_MAX_NAME_LENGTH, 255);\n        setVariable(MIN_DEPOSIT_AMOUNT, 10**14);\n        setVariable(MAX_DEPOSIT_AMOUNT, 10000 ether);\n        setVariable(MIN_WITHDRAW_AMOUNT, 10**14);\n        setVariable(MAX_WITHDRAW_AMOUNT, 10000 ether);\n        setVariable(WITHDRAWN_KEYS_BATCH_SIZE, 50);\n        setVariable(MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST, 600);\n        setContract(ETH_DEPOSIT_CONTRACT, _ethDepositContract);\n        _grantRole(DEFAULT_ADMIN_ROLE, _admin);\n    }\n\n    //Variables Setters\n\n    function updateSocializingPoolCycleDuration(uint256 _socializingPoolCycleDuration) external onlyRole(MANAGER) {\n        setVariable(SOCIALIZING_POOL_CYCLE_DURATION, _socializingPoolCycleDuration);\n    }\n\n    function updateSocializingPoolOptInCoolingPeriod(uint256 _SocializePoolOptInCoolingPeriod)\n        external\n        onlyRole(MANAGER)\n    {\n        setVariable(SOCIALIZING_POOL_OPT_IN_COOLING_PERIOD, _SocializePoolOptInCoolingPeriod);\n    }\n\n    function updateRewardsThreshold(uint256 _rewardsThreshold) external onlyRole(MANAGER) {\n        setVariable(REWARD_THRESHOLD, _rewardsThreshold);\n    }\n\n    /**\n     * @dev update the minimum deposit amount\n     * @param _minDepositAmount minimum deposit amount\n     */\n    function updateMinDepositAmount(uint256 _minDepositAmount) external onlyRole(MANAGER) {\n        setVariable(MIN_DEPOSIT_AMOUNT, _minDepositAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the maximum deposit amount\n     * @param _maxDepositAmount maximum deposit amount\n     */\n    function updateMaxDepositAmount(uint256 _maxDepositAmount) external onlyRole(MANAGER) {\n        setVariable(MAX_DEPOSIT_AMOUNT, _maxDepositAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the minimum withdraw amount\n     * @param _minWithdrawAmount minimum withdraw amount\n     */\n    function updateMinWithdrawAmount(uint256 _minWithdrawAmount) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setVariable(MIN_WITHDRAW_AMOUNT, _minWithdrawAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    /**\n     * @dev update the maximum withdraw amount\n     * @param _maxWithdrawAmount maximum withdraw amount\n     */\n    function updateMaxWithdrawAmount(uint256 _maxWithdrawAmount) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setVariable(MAX_WITHDRAW_AMOUNT, _maxWithdrawAmount);\n        verifyDepositAndWithdrawLimits();\n    }\n\n    function updateMinBlockDelayToFinalizeWithdrawRequest(uint256 _minBlockDelay)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setVariable(MIN_BLOCK_DELAY_TO_FINALIZE_WITHDRAW_REQUEST, _minBlockDelay);\n    }\n\n    /**\n     * @notice update the max number of withdrawn validator keys reported by oracle in single tx\n     * @dev only `OPERATOR` can call\n     * @param _withdrawnKeysBatchSize updated maximum withdrawn key limit in the oracle input\n     */\n    function updateWithdrawnKeysBatchSize(uint256 _withdrawnKeysBatchSize) external onlyRole(OPERATOR) {\n        setVariable(WITHDRAWN_KEYS_BATCH_SIZE, _withdrawnKeysBatchSize);\n    }\n\n    //Accounts Setters\n\n    function updateAdmin(address _admin) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        address oldAdmin = accountsMap[ADMIN];\n\n        _grantRole(DEFAULT_ADMIN_ROLE, _admin);\n        setAccount(ADMIN, _admin);\n\n        _revokeRole(DEFAULT_ADMIN_ROLE, oldAdmin);\n    }\n\n    function updateStaderTreasury(address _staderTreasury) external onlyRole(MANAGER) {\n        setAccount(STADER_TREASURY, _staderTreasury);\n    }\n\n    // Contracts Setters\n\n    function updatePoolUtils(address _poolUtils) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(POOL_UTILS, _poolUtils);\n    }\n\n    function updatePoolSelector(address _poolSelector) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(POOL_SELECTOR, _poolSelector);\n    }\n\n    function updateSDCollateral(address _sdCollateral) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(SD_COLLATERAL, _sdCollateral);\n    }\n\n    function updateOperatorRewardsCollector(address _operatorRewardsCollector) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(OPERATOR_REWARD_COLLECTOR, _operatorRewardsCollector);\n    }\n\n    function updateVaultFactory(address _vaultFactory) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(VAULT_FACTORY, _vaultFactory);\n    }\n\n    function updateAuctionContract(address _auctionContract) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(AUCTION_CONTRACT, _auctionContract);\n    }\n\n    function updateStaderOracle(address _staderOracle) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STADER_ORACLE, _staderOracle);\n    }\n\n    function updatePenaltyContract(address _penaltyContract) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PENALTY_CONTRACT, _penaltyContract);\n    }\n\n    function updatePermissionedPool(address _permissionedPool) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONED_POOL, _permissionedPool);\n    }\n\n    function updateStakePoolManager(address _stakePoolManager) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STAKE_POOL_MANAGER, _stakePoolManager);\n    }\n\n    function updatePermissionlessPool(address _permissionlessPool) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONLESS_POOL, _permissionlessPool);\n    }\n\n    function updateUserWithdrawManager(address _userWithdrawManager) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(USER_WITHDRAW_MANAGER, _userWithdrawManager);\n    }\n\n    function updateStaderInsuranceFund(address _staderInsuranceFund) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(STADER_INSURANCE_FUND, _staderInsuranceFund);\n    }\n\n    function updatePermissionedNodeRegistry(address _permissionedNodeRegistry) external onlyRole(DEFAULT_ADMIN_ROLE) {\n        setContract(PERMISSIONED_NODE_REGISTRY, _permissionedNodeRegistry);\n    }\n\n    function updatePermissionlessNodeRegistry(address _permissionlessNodeRegistry)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(PERMISSIONLESS_NODE_REGISTRY, _permissionlessNodeRegistry);\n    }\n\n    function updatePermissionedSocializingPool(address _permissionedSocializePool)\n        external\n        onlyRole(DEFAULT_ADMIN_ROLE)\n    {\n        setContract(PERMISSIONED_SOCIALIZING_POOL, _permissionedSocializePool);\n    }\n\n    function updatePermissionlessSocializingPool(address _permissionlessSocializePool)\n        external"
    }
  ]
}