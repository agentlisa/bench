{
  "Title": "[N-01] Consider supporting CryptoPunks and EtherRocks",
  "Content": "\nThe project `README.md` says that `NFTPair`s are specifically ERC721 tokens, but not all NFTs are ERC721s. CryptoPunks and EtherRocks came before the standard and do not conform to it.\n\n```solidity\nFile: README.md   #1\n\n58  - NFT Pair are a version of Cauldrons where the collateral isn't an ERC20 token but an ERC721 token, the deal OTC, the parameters of the loan themselves pre-defined.\n```\n\n<https://github.com/code-423n4/2022-04-abranft/blob/5cd4edc3298c05748e952f8a8c93e42f930a78c2/README.md?plain=1#L58>\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2022-04-abranft",
  "Code": [
    {
      "filename": "README.md?plain=1",
      "content": "# AbraNFT contest details\n- $47,500 MIM main award pot\n- $2,500 MIM gas optimization award pot\n- Join [C4 Discord](https://discord.gg/code4rena) to register\n- Submit findings [using the C4 form](https://code4rena.com/contests/2022-04-abranft-contest/submit)\n- [Read our guidelines for more details](https://docs.code4rena.com/roles/wardens)\n- Starts April 27, 2022 00:00 UTC\n- Ends May 01, 2022 23:59 UTC\n\n## Glossary\n\n| Name                               | Description                                                         |\n| ---------------------------------- | ------------------------------------------------------------------- |\n| Abracadabra                        | Abracadabra the Lending platform                                    |\n| SPELL                              | Governance token Abracadabra                                        |\n| MIM                                | Stablecoin minted by the DeFi protocol                              |\n| Cauldron\t\t\t\t\t\t\t | Smart Contract handling the Lending Logic                           |\n| Private Pool                       | Version of the Cauldron where the collateral is an NFT              |\n| NFTs                               | Non-Fungible Tokens, ERC721s.                                       |\n| CDP / Collateralized Debt Position | A loan backed by some form of collateral                            |\n| LTV / Loan to Value                | Ratio of the debt position to the value of the collateral deposited |\n| Share                              | A share is a Bentobox share.                                        |\n| Collateral                         | The ERC721 (NFT) being used as collateral                           |\n| Asset                              | The ERC20 Token that is borrowed                                    |\n\n\n\n# Contest Scope\n\nThe scope of the contest is contracts/NFTPair.sol, a Private Pool that allows two parties to create a private loan with a NFT as collateral, and contracts/NFTPairWithOracle.sol, which is largely similar, but allows the option of early liquidation if the price drops below a floor set by an oracle.\n\n## Getting started\n\nThe test cases in test/NFTPair.test.ts furnish examples of how to interact with the contract. Versions have also been deployed to Ropsten, using and entirely mocked environment that allows freely minting ERC-20 tokens, NFTs, and messing with the BentoBox balance, simulating vault gains/losses.\n\nTests can be run with\n\n    yarn hardhat test\n\nYou may have to run\n\n    yarn hardhat typechain\n\nonce before doing this.\n\n## Protocol overview\n\nAbracadabra.money is a lending platform that uses interest-bearing tokens (ibTKNs) or NFTs as collateral to borrow a USD pegged stablecoin (Magic Internet Money - MIM), that can be used as any other traditional stablecoin.\nThe protocol is governed by the SPELL token, that manages the parameters of the protocol, the use of the Treasury, the tokenomics.\n\n\n## Smart Contracts\n\nAbracadabra is built upon the Bentobox, and uses a custom version of the KASHI technology.\n- Bentobox is a smart contract that stores funds, handles their transfers, supports flash loans, applications and strategies\n- KASHI is a isolated lending market built on top of Bentobox technology. it features one smart contract per 'pair', a combination of the collateral and the borrowed asset.\n- Cauldrons are a version of KASHI that uses a CDP to mint a stablecoin, MIM, instead of relying on LPs.\n- NFT Pair are a version of Cauldrons where the collateral isn't an ERC20 token but an ERC721 token, the deal OTC, the parameters of the loan themselves pre-defined.\n\nBentobox, KASHI and Cauldrons as listed for context only, as the scope is the NFT Pair.\n\nOne NFTPair is deployed as a MasterContract, to be cloned into actual lending markets via the deploy() function of bentobox.\n\n### NFTPair.sol (653 sloc)\n\nThis contract allows a lender and a borrower to do an OTC loan with an ERC721 as collateral and an ERC20 as borrowed asset. The parameters (valuation, duration and interests) are set by the users.\n\nThis contract uses the following libraries and interfaces:\n- \"@boringcrypto/boring-solidity/contracts/libraries/BoringMath.sol\";\n- \"@boringcrypto/boring-solidity/contracts/BoringOwnable.sol\";\n- \"@boringcrypto/boring-solidity/contracts/Domain.sol\";\n- \"@boringcrypto/boring-solidity/contracts/interfaces/IMasterContract.sol\";\n- \"@boringcrypto/boring-solidity/contracts/libraries/BoringRebase.sol\";\n- \"@boringcrypto/boring-solidity/contracts/libraries/BoringERC20.sol\";\n- \"@sushiswap/bentobox-sdk/contracts/IBentoBoxV1.sol\";\n\n\nThe contract has multiple functions _(eg: requestLoan, removeCollateral, lend)_ that each have an action ID and that can be called either directly or via the cook() function, passing actions ID, value and data as arrays. This function allows for the execution of several actions within the same transaction, which is core to how abracadabra works.\n\n## Testnet deployment\n\nThe NFTPair contract and all it's dependencies are deployed on the Ropsten Ethereum testnet:\n\n- BentoBox: https://ropsten.etherscan.io/address/0x9a5620779fef1928ef87c1111491212efc2c3cb8\n\n- master contract NFT Pair: https://ropsten.etherscan.io/address/0x3a341f5474aac54829a587ce6ab13c86af6b1e29#code\nThe MasterContract is already whitelisted in the mock BentoBox.\n\n- Two mock ERC721 tokens, public mint() (but with sequential IDs)\n    - \"Apes\":\n    https://ropsten.etherscan.io/address/0xcCB893B3b5D7B003FEA0134215E4BCc6F8fb6aC7\n    - \"Bears\"\n    https://ropsten.etherscan.io/address/0x95d7c415baaff9446b457439f2ff269032a73ff6\n\n- Mock ERC20 with public mint() (\"free money\")\n    https://ropsten.etherscan.io/address/0xed79a29ce9f7e285be23e8fc32f74e5289713b86\n\n- NFT Pair deployments using either contract, and the \"free money\":\n    - \"Apes\"\n      https://ropsten.etherscan.io/address/0x9AEEf9f52eCCef2dc970090c304635fb29161805\n    - \"Bears\"\n      https://ropsten.etherscan.io/address/0xb215b44c3439cA72170F379f12A78437eACE9a19"
    }
  ]
}