{
  "Title": "[L03] Interfaces donâ€™t match with their implementations",
  "Content": "Interfaces in the codebase are not fully matching their implementation, defining only a part of the functionalities implemented in their respectives contracts some of the cases and presenting differences in other cases. Some of them are:\n\n\n* The [`IMetaTransactionWalletDeployer` interface](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWalletDeployer.sol#L3) is missing the [`initialize`](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWalletDeployer.sol#L49-L54) and the [`getVersionNumber`](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWalletDeployer.sol#L41-L43) functions.\n* The [`IMetaTransactionWalletDeployer` interface](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWalletDeployer.sol#L3) declares a [`wallets` function](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWalletDeployer.sol#L7) which is not implemented in the [implementation contract](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWalletDeployer.sol#L13).\n* The [`IMetaTransactionWallet` interface](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol#L3) declares the [third parameter of the `executeTransaction` function](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol#L8), the [third parameter of the `getMetaTransactionDigest` function](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol#L17) and the [third parameter of the `getMetaTransactionSigner` function](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol#L24) as parameters of `bytes` type with `calldata` allocation. However, in these three cases the implementation of these three functions: [`executeTransaction`](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWallet.sol#L213), [`getMetaTransactionDigest`](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWallet.sol#L149) and [`getMetaTransactionSigner`](https://github.com/celo-org/celo-monorepo/blob/af49272ef57a077ee6e704aad76d506c039798d3/packages/protocol/contracts/common/MetaTransactionWallet.sol#L170) use the `memory` location for these parameters.\n\n\nThese mismatches between the interface and its implementation are confusing. It can mean that there are problems with the modeling of the system or that the updates to the implementations and interfaces got out of sync.\n\n\nConsider modifying these, and all other mismatches between interfaces and implementations, so there is one basic implementation that directly matches the interface specification. Alternatively, if there are reasons for these functions to be only in the implementations, for each case consider to add a new contract that inherits from the basic implementation, to move the extra functions to this contract, and to add to its docstrings the reason for extending the interface.\n\n\n**Update**: *For the first point, the development decided not to implement our suggestion following their internal conventions. For the second point, the `wallets` function has been removed from the contract and corresponding interface in [PR#5683](https://github.com/celo-org/celo-monorepo/pull/5683). For the third point, the development team correctly pointed out that functions in interfaces with `external` visiblity cannot include parameters declared as `memory`.*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/protocol/contracts/common/interfaces/IMetaTransactionWalletDeployer.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IMetaTransactionWalletDeployer {\n  function deploy(address, address, bytes calldata) external;\n  function changeDeployerPermission(address, bool) external;\n  function canDeploy(address) external view returns (bool);\n  function wallets(address) external view returns (address);\n}"
    },
    {
      "filename": "packages/protocol/contracts/common/interfaces/IMetaTransactionWalletDeployer.sol",
      "content": "pragma solidity ^0.5.3;\n\ninterface IMetaTransactionWalletDeployer {\n  function deploy(address, address, bytes calldata) external;\n  function changeDeployerPermission(address, bool) external;\n  function canDeploy(address) external view returns (bool);\n  function wallets(address) external view returns (address);\n}"
    },
    {
      "filename": "packages/protocol/contracts/common/interfaces/IMetaTransactionWallet.sol",
      "content": "pragma solidity ^0.5.13;\n\ninterface IMetaTransactionWallet {\n  function setEip712DomainSeparator() external;\n  function executeMetaTransaction(address, uint256, bytes calldata, uint8, bytes32, bytes32)\n    external\n    returns (bytes memory);\n  function executeTransaction(address, uint256, bytes calldata) external returns (bytes memory);\n  function executeTransactions(\n    address[] calldata,\n    uint256[] calldata,\n    bytes calldata,\n    uint256[] calldata\n  ) external returns (bytes memory, uint256[] memory);\n\n  // view functions\n  function getMetaTransactionDigest(address, uint256, bytes calldata, uint256)\n    external\n    view\n    returns (bytes32);\n  function getMetaTransactionSigner(\n    address,\n    uint256,\n    bytes calldata,\n    uint256,\n    uint8,\n    bytes32,\n    bytes32\n  ) external view returns (address);\n\n  //only owner\n  function setSigner(address) external;\n}"
    }
  ]
}