{
  "Title": "[M-34] Pause checks are missing on deposit for Private Vault",
  "Content": "\nIt is possible to make a deposit even when `_loadVISlot().isShutdown` is true. This check is done in `whenNotPaused` modifier and is already done for Public Vault but is missing for Private Vault, allowing unexpected deposits.\n\n### Proof of Concept\n\n1.  Observe the deposit function at <https://github.com/code-423n4/2023-01-astaria/blob/main/src/Vault.sol#L59>\n\n```\n\n    function deposit(uint256 amount, address receiver)\n        public\n        virtual\n        returns (uint256)\n      {\n        VIData storage s = _loadVISlot();\n        require(s.allowList[msg.sender] && receiver == owner());\n        ERC20(asset()).safeTransferFrom(msg.sender, address(this), amount);\n        return amount;\n      }\n```\n\n2.  Observe there is no `whenNotPaused` modifier in deposit which confirm that shutdown has not been called yet\n\n```\n\n    modifier whenNotPaused() {\n        if (ROUTER().paused()) {\n          revert InvalidRequest(InvalidRequestReason.PAUSED);\n        }\n\n        if (_loadVISlot().isShutdown) {\n          revert InvalidRequest(InvalidRequestReason.SHUTDOWN);\n        }\n        _;\n      }\n```\n\n### Recommended Mitigation Steps\n\nRevise the deposit function as below:\n\n    function deposit(uint256 amount, address receiver)\n        public\n        virtual \n        whenNotPaused\n        returns (uint256)\n      {\n        VIData storage s = _loadVISlot();\n        require(s.allowList[msg.sender] && receiver == owner());\n        ERC20(asset()).safeTransferFrom(msg.sender, address(this), amount);\n        return amount;\n      }\n\n**[Picodes (judge) commented](https://github.com/code-423n4/2023-01-astaria-findings/issues/25#issuecomment-1405587817):**\n > It makes sense though considering it's a private vault so only the owner can deposit.\n\n**[SantiagoGregory (Astaria) confirmed](https://github.com/code-423n4/2023-01-astaria-findings/issues/25)**\n\n\n\n***\n\n",
  "Impact": "MEDIUM",
  "Source": "https://code4rena.com/reports/2023-01-astaria",
  "Code": [
    {
      "filename": "src/Vault.sol",
      "content": "// SPDX-License-Identifier: BUSL-1.1\n\n/**                                                     \n*  █████╗ ███████╗████████╗ █████╗ ██████╗ ██╗ █████╗ \n* ██╔══██╗██╔════╝╚══██╔══╝██╔══██╗██╔══██╗██║██╔══██╗\n* ███████║███████╗   ██║   ███████║██████╔╝██║███████║\n* ██╔══██║╚════██║   ██║   ██╔══██║██╔══██╗██║██╔══██║\n* ██║  ██║███████║   ██║   ██║  ██║██║  ██║██║██║  ██║\n* ╚═╝  ╚═╝╚══════╝   ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝  ╚═╝\n*\n* Astaria Labs, Inc\n*/\n\npragma solidity =0.8.17;\n\nimport {ERC20} from \"solmate/tokens/ERC20.sol\";\nimport {SafeTransferLib} from \"solmate/utils/SafeTransferLib.sol\";\n\nimport {IERC165} from \"core/interfaces/IERC165.sol\";\nimport {VaultImplementation} from \"core/VaultImplementation.sol\";\n\n/**\n * @title Vault\n */\ncontract Vault is VaultImplementation {\n  using SafeTransferLib for ERC20;\n\n  function name()\n    public\n    view\n    virtual\n    override(VaultImplementation)\n    returns (string memory)\n  {\n    return string(abi.encodePacked(\"AST-Vault-\", ERC20(asset()).symbol()));\n  }\n\n  function symbol()\n    public\n    view\n    virtual\n    override(VaultImplementation)\n    returns (string memory)\n  {\n    return\n      string(abi.encodePacked(\"AST-V\", owner(), \"-\", ERC20(asset()).symbol()));\n  }\n\n  function supportsInterface(bytes4)\n    public\n    pure\n    virtual\n    override(IERC165)\n    returns (bool)\n  {\n    return false;\n  }\n\n  function deposit(uint256 amount, address receiver)\n    public\n    virtual\n    returns (uint256)\n  {\n    VIData storage s = _loadVISlot();\n    require(s.allowList[msg.sender] && receiver == owner());\n    ERC20(asset()).safeTransferFrom(msg.sender, address(this), amount);\n    return amount;\n  }\n\n  function withdraw(uint256 amount) external {\n    require(msg.sender == owner());\n    ERC20(asset()).safeTransferFrom(address(this), msg.sender, amount);\n  }\n\n  function disableAllowList() external pure override(VaultImplementation) {\n    //invalid action allowlist must be enabled for private vaults\n    revert InvalidRequest(InvalidRequestReason.NO_AUTHORITY);\n  }\n\n  function enableAllowList() external pure override(VaultImplementation) {\n    //invalid action allowlist must be enabled for private vaults\n    revert InvalidRequest(InvalidRequestReason.NO_AUTHORITY);\n  }\n\n  function modifyAllowList(address, bool)\n    external\n    pure\n    override(VaultImplementation)\n  {\n    //invalid action private vautls can only be the owner or strategist\n    revert InvalidRequest(InvalidRequestReason.NO_AUTHORITY);\n  }\n}"
    }
  ]
}