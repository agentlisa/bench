{
  "Title": "Missing address validation",
  "Content": "##### Description\nA delegatecall on an callsScript address always returns true if callsScript is non-contract address.\nAt line https://github.com/lidofinance/easy-track/blob/ec694adb872877db814da960d96ce767ccbdf462/contracts/EvmScriptExecutor.sol#L80\n##### Recommendation\nWe recommend making the callsScript address constant or add check that callsScript is contract address in constructor.",
  "Impact": "MEDIUM",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/EvmScriptExecutor.sol",
      "content": "// SPDX-FileCopyrightText: 2021 Lido <info@lido.fi>\n// SPDX-License-Identifier: GPL-3.0\n\npragma solidity ^0.8.4;\n\nimport \"OpenZeppelin/openzeppelin-contracts@4.2.0/contracts/utils/StorageSlot.sol\";\n\ninterface ICallsScript {\n    function execScript(\n        bytes memory _script,\n        bytes memory,\n        address[] memory _blacklist\n    ) external returns (bytes memory);\n}\n\n/// @author psirex\n/// @notice Contains method to execute EVMScripts\n/// @dev EVMScripts use format of Aragon's https://github.com/aragon/aragonOS/blob/v4.0.0/contracts/evmscript/executors/CallsScript.sol executor\ncontract EVMScriptExecutor {\n    // -------------\n    // EVENTS\n    // -------------\n    event ScriptExecuted(address indexed _caller, bytes _evmScript);\n\n    // ------------\n    // CONSTANTS\n    // ------------\n\n    // This variable required to use deployed CallsScript.sol contract because\n    // CalssScript.sol makes check that caller contract is not petrified (https://hack.aragon.org/docs/common_Petrifiable)\n    // Contains value: keccak256(\"aragonOS.initializable.initializationBlock\")\n    bytes32 internal constant INITIALIZATION_BLOCK_POSITION =\n        0xebb05b386a8d34882b8711d156f463690983dc47815980fb82aeeff1aa43579e;\n\n    // ------------\n    // VARIABLES\n    // ------------\n\n    /// @notice Address of deployed CallsScript.sol contract\n    address public immutable callsScript;\n\n    /// @notice Address of depoyed easyTrack.sol contract\n    address public immutable easyTrack;\n\n    /// @notice Address of Aragon's Voting contract\n    address public immutable voting;\n\n    // -------------\n    // CONSTRUCTOR\n    // -------------\n\n    constructor(\n        address _callsScript,\n        address _easyTrack,\n        address _voting\n    ) {\n        voting = _voting;\n        easyTrack = _easyTrack;\n        callsScript = _callsScript;\n        StorageSlot.getUint256Slot(INITIALIZATION_BLOCK_POSITION).value = block.number;\n    }\n\n    // -------------\n    // EXTERNAL METHODS\n    // -------------\n\n    /// @notice Executes EVMScript\n    /// @dev Uses deployed Aragon's CallsScript.sol contract to execute EVMScript.\n    /// @return Empty bytes\n    function executeEVMScript(bytes memory _evmScript) external returns (bytes memory) {\n        require(msg.sender == voting || msg.sender == easyTrack, \"CALLER_IS_FORBIDDEN\");\n\n        bytes memory execScriptCallData =\n            abi.encodeWithSelector(\n                ICallsScript.execScript.selector,\n                _evmScript,\n                new bytes(0),\n                new address[](0)\n            );\n        (bool success, bytes memory output) = callsScript.delegatecall(execScriptCallData);\n        if (!success) {\n            assembly {\n                let ptr := mload(0x40)\n                let size := returndatasize()\n                returndatacopy(ptr, 0, size)\n                revert(ptr, size)\n            }\n        }\n        emit ScriptExecuted(msg.sender, _evmScript);\n        return abi.decode(output, (bytes));\n    }\n}"
    }
  ]
}