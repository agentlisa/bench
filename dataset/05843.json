{
  "Title": "[N-05] The function `updateMember()` change the state of the contract, but there is no emitted event, so an event should be emitted",
  "Content": "\nThe function `updateMember` in the restriction manager contract should emit the event `updatedMember()` with the right parameters.<br>\nhttps://github.com/code-423n4/2023-09-centrifuge/blob/512e7a71ebd9ae76384f837204216f26380c9f91/src/token/RestrictionManager.sol#L57-L60\n```solidity\n    function updateMember(address user, uint256 validUntil) public auth {\n        require(block.timestamp <= validUntil, \"RestrictionManager/invalid-valid-until\");\n        members[user] = validUntil;\n    } \n```\n\n",
  "Impact": "LOW",
  "Source": "https://code4rena.com/reports/2023-09-centrifuge",
  "Code": [
    {
      "filename": "src/token/RestrictionManager.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-only\npragma solidity 0.8.21;\n\nimport {Auth} from \"./../util/Auth.sol\";\n\ninterface MemberlistLike {\n    function updateMember(address user, uint256 validUntil) external;\n    function members(address user) external view returns (uint256);\n    function hasMember(address user) external view returns (bool);\n}\n\n/// @title  Restriction Manager\n/// @notice ERC1404 based contract that checks transfer restrictions.\ncontract RestrictionManager is Auth {\n    uint8 public constant SUCCESS_CODE = 0;\n    uint8 public constant DESTINATION_NOT_A_MEMBER_RESTRICTION_CODE = 1;\n    string public constant SUCCESS_MESSAGE = \"RestrictionManager/transfer-allowed\";\n    string public constant DESTINATION_NOT_A_MEMBER_RESTRICTION_MESSAGE = \"RestrictionManager/destination-not-a-member\";\n\n    mapping(address => uint256) public members;\n\n    constructor() {\n        wards[msg.sender] = 1;\n        emit Rely(msg.sender);\n    }\n\n    // --- ERC1404 implementation ---\n    function detectTransferRestriction(address from, address to, uint256 value) public view returns (uint8) {\n        if (!hasMember(to)) {\n            return DESTINATION_NOT_A_MEMBER_RESTRICTION_CODE;\n        }\n\n        return SUCCESS_CODE;\n    }\n\n    function messageForTransferRestriction(uint8 restrictionCode) public view returns (string memory) {\n        if (restrictionCode == DESTINATION_NOT_A_MEMBER_RESTRICTION_CODE) {\n            return DESTINATION_NOT_A_MEMBER_RESTRICTION_MESSAGE;\n        }\n\n        return SUCCESS_MESSAGE;\n    }\n\n    // --- Checking members ---\n    function member(address user) public view {\n        require((members[user] >= block.timestamp), \"RestrictionManager/destination-not-a-member\");\n    }\n\n    function hasMember(address user) public view returns (bool) {\n        if (members[user] >= block.timestamp) {\n            return true;\n        }\n        return false;\n    }\n\n    // --- Updating members ---\n    function updateMember(address user, uint256 validUntil) public auth {\n        require(block.timestamp <= validUntil, \"RestrictionManager/invalid-valid-until\");\n        members[user] = validUntil;\n    }\n\n    function updateMembers(address[] memory users, uint256 validUntil) public auth {\n        uint256 userLength = users.length;\n        for (uint256 i = 0; i < userLength; i++) {\n            updateMember(users[i], validUntil);\n        }\n    }\n}"
    }
  ]
}