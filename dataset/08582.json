{
  "Title": "[M-13] JBToken: mint function could mint arbitrary amount of tokens",
  "Content": "# Lines of code\n\nhttps://github.com/jbx-protocol/juice-contracts-v2-code4rena//blob/828bf2f3e719873daa08081cfa0d0a6deaa5ace5/contracts/JBToken.sol#L106-L114\n\n\n# Vulnerability details\n\n## Impact\nThe owner of the JBToken contract can mint arbitrary amount of tokens.\nIn general, the owner of the JBToken contract is the JBTokenStore contract, and the minting of the tokens is controlled by the JBController contract, but when the changeTokenOf function of the JBController contract is called, the owner will be transferred to any address, which can mint arbitrary amount of tokens.\n```\n  function mint(\n    uint256 _projectId,\n    address _account,\n    uint256 _amount\n  ) external override onlyOwner {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return _mint(_account, _amount);\n  }\n```\n## Proof of Concept\nhttps://github.com/jbx-protocol/juice-contracts-v2-code4rena//blob/828bf2f3e719873daa08081cfa0d0a6deaa5ace5/contracts/JBToken.sol#L106-L114\n## Tools Used\nNone\n## Recommended Mitigation Steps\nConsider setting minter as the JBTokenStore contract and adding the onlyminter modifier to the mint function\n\n",
  "Impact": "MEDIUM",
  "Source": "https://code4rena.com/contests/2022-07-juicebox-v2-contest",
  "Code": [
    {
      "filename": "contracts/JBToken.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity 0.8.6;\n\nimport '@openzeppelin/contracts/token/ERC20/extensions/draft-ERC20Permit.sol';\nimport '@openzeppelin/contracts/access/Ownable.sol';\nimport './interfaces/IJBToken.sol';\n\n/** \n  @notice\n  An ERC-20 token that can be used by a project in the `JBTokenStore`.\n\n  @dev\n  Adheres to -\n  IJBToken: Allows this contract to be used by projects in the JBTokenStore.\n\n  @dev\n  Inherits from -\n  ERC20Permit: General token standard for fungible accounting. \n  Ownable: Includes convenience functionality for checking a message sender's permissions before executing certain transactions.\n*/\ncontract JBToken is IJBToken, ERC20Permit, Ownable {\n  //*********************************************************************//\n  // ------------------------- external views -------------------------- //\n  //*********************************************************************//\n\n  /** \n    @notice\n    The total supply of this ERC20.\n\n    @param _projectId the ID of the project to which the token belongs. This is ignored.\n\n    @return The total supply of this ERC20, as a fixed point number.\n  */\n  function totalSupply(uint256 _projectId) external view override returns (uint256) {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return super.totalSupply();\n  }\n\n  /** \n    @notice\n    An account's balance of this ERC20.\n\n    @param _account The account to get a balance of.\n    @param _projectId is the ID of the project to which the token belongs. This is ignored.\n\n    @return The balance of the `_account` of this ERC20, as a fixed point number with 18 decimals.\n  */\n  function balanceOf(address _account, uint256 _projectId)\n    external\n    view\n    override\n    returns (uint256)\n  {\n    _account; // Prevents unused var compiler and natspec complaints.\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return super.balanceOf(_account);\n  }\n\n  //*********************************************************************//\n  // -------------------------- public views --------------------------- //\n  //*********************************************************************//\n\n  /** \n    @notice\n    The number of decimals included in the fixed point accounting of this token.\n\n    @return The number of decimals.\n  */\n  function decimals() public view override(ERC20, IJBToken) returns (uint8) {\n    return super.decimals();\n  }\n\n  //*********************************************************************//\n  // -------------------------- constructor ---------------------------- //\n  //*********************************************************************//\n\n  /** \n    @param _name The name of the token.\n    @param _symbol The symbol that the token should be represented by.\n  */\n  constructor(string memory _name, string memory _symbol)\n    ERC20(_name, _symbol)\n    ERC20Permit(_name)\n  // solhint-disable-next-line no-empty-blocks\n  {\n\n  }\n\n  //*********************************************************************//\n  // ---------------------- external transactions ---------------------- //\n  //*********************************************************************//\n\n  /** \n    @notice\n    Mints more of the token.\n\n    @dev\n    Only the owner of this contract cant mint more of it.\n\n    @param _projectId The ID of the project to which the token belongs. This is ignored.\n    @param _account The account to mint the tokens for.\n    @param _amount The amount of tokens to mint, as a fixed point number with 18 decimals.\n  */\n  function mint(\n    uint256 _projectId,\n    address _account,\n    uint256 _amount\n  ) external override onlyOwner {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return _mint(_account, _amount);\n  }\n\n  /** \n    @notice\n    Burn some outstanding tokens.\n\n    @dev\n    Only the owner of this contract cant burn some of its supply.\n\n    @param _projectId The ID of the project to which the token belongs. This is ignored.\n    @param _account The account to burn tokens from.\n    @param _amount The amount of tokens to burn, as a fixed point number with 18 decimals.\n  */\n  function burn(\n    uint256 _projectId,\n    address _account,\n    uint256 _amount\n  ) external override onlyOwner {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return _burn(_account, _amount);\n  }\n\n  /** \n    @notice\n    Approves an account to spend tokens on the `msg.sender`s behalf.\n\n    @param _projectId the ID of the project to which the token belongs. This is ignored.\n    @param _spender The address that will be spending tokens on the `msg.sender`s behalf.\n    @param _amount The amount the `_spender` is allowed to spend.\n  */\n  function approve(\n    uint256 _projectId,\n    address _spender,\n    uint256 _amount\n  ) external override {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    approve(_spender, _amount);\n  }\n\n  /** \n    @notice\n    Transfer tokens to an account.\n    \n    @param _projectId The ID of the project to which the token belongs. This is ignored.\n    @param _to The destination address.\n    @param _amount The amount of the transfer, as a fixed point number with 18 decimals.\n  */\n  function transfer(\n    uint256 _projectId,\n    address _to,\n    uint256 _amount\n  ) external override {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    transfer(_to, _amount);\n  }\n\n  /** \n    @notice\n    Transfer tokens between accounts.\n\n    @param _projectId The ID of the project to which the token belongs. This is ignored.\n    @param _from The originating address.\n    @param _to The destination address.\n    @param _amount The amount of the transfer, as a fixed point number with 18 decimals.\n  */\n  function transferFrom(\n    uint256 _projectId,\n    address _from,\n    address _to,\n    uint256 _amount\n  ) external override {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    transferFrom(_from, _to, _amount);\n  }\n\n  //*********************************************************************//\n  // ------------------------ public transactions ---------------------- //\n  //*********************************************************************//\n\n  /** \n    @notice\n    Transfer ownership of this contract to another address.\n\n    @dev\n    Only the owner of this contract can transfer it.\n\n    @param _projectId The ID of the project to which the token belongs. This is ignored.\n    @param _newOwner The new owner.\n  */\n  function transferOwnership(uint256 _projectId, address _newOwner)\n    public\n    virtual\n    override\n    onlyOwner\n  {\n    _projectId; // Prevents unused var compiler and natspec complaints.\n\n    return super.transferOwnership(_newOwner);\n  }\n}"
    }
  ]
}