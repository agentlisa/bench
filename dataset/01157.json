{
  "Title": "Lost Funds in Messenger Contracts",
  "Content": "The `ScrollMessengerBase` contract has a [`receive` function](https://github.com/scroll-tech/scroll/blob/3bc8a3f5c6ac816ddffadca41024331dcf4d3064/contracts/src/libraries/ScrollMessengerBase.sol#L56) that does not have any code implemented. There is no use case for the messenger contracts to receive any ETH outside of the payable functions. Instead, users might accidentally send ETH to it. Hence, consider removing the `receive` function.\n\n\n***Update:** Resolved in [pull request #637](https://github.com/scroll-tech/scroll/pull/637) at commit [c89704c](https://github.com/scroll-tech/scroll/pull/637/commits/c89704c5713f31083ba8f709bd74053e92d71708). The `receive` function is needed to provide an equal balance in the messenger contracts after initialization of the rollup. A restriction was added to only be callable by the contract owner.*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/src/libraries/ScrollMessengerBase.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity ^0.8.0;\n\nimport {OwnableUpgradeable} from \"@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol\";\n\nimport {ScrollConstants} from \"./constants/ScrollConstants.sol\";\nimport {IScrollMessenger} from \"./IScrollMessenger.sol\";\n\nabstract contract ScrollMessengerBase is OwnableUpgradeable, IScrollMessenger {\n    /**********\n     * Events *\n     **********/\n\n    /// @notice Emitted when owner updates fee vault contract.\n    /// @param _oldFeeVault The address of old fee vault contract.\n    /// @param _newFeeVault The address of new fee vault contract.\n    event UpdateFeeVault(address _oldFeeVault, address _newFeeVault);\n\n    /*************\n     * Constants *\n     *************/\n\n    // https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.5.0/contracts/security/ReentrancyGuard.sol\n    uint256 internal constant _NOT_ENTERED = 1;\n    uint256 internal constant _ENTERED = 2;\n\n    /*************\n     * Variables *\n     *************/\n\n    /// @notice See {IScrollMessenger-xDomainMessageSender}\n    address public override xDomainMessageSender;\n\n    /// @notice The address of counterpart ScrollMessenger contract in L1/L2.\n    address public counterpart;\n\n    /// @notice The address of fee vault, collecting cross domain messaging fee.\n    address public feeVault;\n\n    /***************\n     * Constructor *\n     ***************/\n\n    function _initialize(address _counterpart, address _feeVault) internal {\n        OwnableUpgradeable.__Ownable_init();\n\n        // initialize to a nonzero value\n        xDomainMessageSender = ScrollConstants.DEFAULT_XDOMAIN_MESSAGE_SENDER;\n\n        counterpart = _counterpart;\n        feeVault = _feeVault;\n    }\n\n    // allow others to send ether to messenger\n    receive() external payable {}\n\n    /************************\n     * Restricted Functions *\n     ************************/\n\n    /// @notice Update fee vault contract.\n    /// @dev This function can only called by contract owner.\n    /// @param _newFeeVault The address of new fee vault contract.\n    function updateFeeVault(address _newFeeVault) external onlyOwner {\n        address _oldFeeVault = feeVault;\n\n        feeVault = _newFeeVault;\n        emit UpdateFeeVault(_oldFeeVault, _newFeeVault);\n    }\n\n    /**********************\n     * Internal Functions *\n     **********************/\n\n    /// @dev Internal function to generate the correct cross domain calldata for a message.\n    /// @param _sender Message sender address.\n    /// @param _target Target contract address.\n    /// @param _value The amount of ETH pass to the target.\n    /// @param _messageNonce Nonce for the provided message.\n    /// @param _message Message to send to the target.\n    /// @return ABI encoded cross domain calldata.\n    function _encodeXDomainCalldata(\n        address _sender,\n        address _target,\n        uint256 _value,\n        uint256 _messageNonce,\n        bytes memory _message\n    ) internal pure returns (bytes memory) {\n        return\n            abi.encodeWithSignature(\n                \"relayMessage(address,address,uint256,uint256,bytes)\",\n                _sender,\n                _target,\n                _value,\n                _messageNonce,\n                _message\n            );\n    }\n}"
    }
  ]
}