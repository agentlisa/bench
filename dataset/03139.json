{
  "Title": "Using \"magic\" numbers",
  "Content": "##### Description\nThe use in the source code of some unknown where taken values impairs its understanding.\nAt the lines\n- https://github.com/1inch/farming/blob/7a007ec7784cca2899889e99e46cf06d5788a7d9/contracts/accounting/FarmAccounting.sol#L21\n- https://github.com/1inch/farming/blob/7a007ec7784cca2899889e99e46cf06d5788a7d9/contracts/accounting/FarmAccounting.sol#L29\n- https://github.com/1inch/farming/blob/7a007ec7784cca2899889e99e46cf06d5788a7d9/contracts/accounting/UserAccounting.sol#L29\nthe value is `1e18`.\n##### Recommendation\nIt is recommended that you create constants with meaningful names to use numeric values.\n\n***\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/accounting/FarmAccounting.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity ^0.8.0;\n\nimport \"@openzeppelin/contracts/utils/math/Math.sol\";\n\nlibrary FarmAccounting {\n    struct Info {\n        uint40 finished;\n        uint32 duration;\n        uint184 reward;\n    }\n\n    uint256 constant internal _MAX_REWARD_AMOUNT = 1e42;\n\n    /// @dev Requires extra 18 decimals for precision, result should not exceed 10**54\n    function farmedSinceCheckpointScaled(Info memory info, uint256 checkpoint) internal view returns(uint256 amount) {\n        require(checkpoint >= info.finished - info.duration, \"FA: checkpoint < started\");\n        if (info.duration > 0) {\n            uint256 elapsed = Math.min(block.timestamp, info.finished) - Math.min(checkpoint, info.finished);\n            return elapsed * info.reward * 1e18 / info.duration;\n        }\n    }\n\n    function startFarming(Info storage info, uint256 amount, uint256 period, function() internal updateCheckpoint) internal returns(uint256) {\n        // If something left from prev farming add it to the new farming\n        Info memory prev = info;\n        if (block.timestamp < prev.finished) {\n            amount += prev.reward - farmedSinceCheckpointScaled(prev, prev.finished - prev.duration) / 1e18;\n        }\n\n        updateCheckpoint();\n        require(period <= type(uint32).max, \"FA: duration too large\");\n        require(amount <= _MAX_REWARD_AMOUNT, \"FA: amount too large\");\n        (info.finished, info.duration, info.reward) = (uint40(block.timestamp + period), uint32(period), uint184(amount));\n        return amount;\n    }\n}"
    },
    {
      "filename": "contracts/accounting/FarmAccounting.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity ^0.8.0;\n\nimport \"@openzeppelin/contracts/utils/math/Math.sol\";\n\nlibrary FarmAccounting {\n    struct Info {\n        uint40 finished;\n        uint32 duration;\n        uint184 reward;\n    }\n\n    uint256 constant internal _MAX_REWARD_AMOUNT = 1e42;\n\n    /// @dev Requires extra 18 decimals for precision, result should not exceed 10**54\n    function farmedSinceCheckpointScaled(Info memory info, uint256 checkpoint) internal view returns(uint256 amount) {\n        require(checkpoint >= info.finished - info.duration, \"FA: checkpoint < started\");\n        if (info.duration > 0) {\n            uint256 elapsed = Math.min(block.timestamp, info.finished) - Math.min(checkpoint, info.finished);\n            return elapsed * info.reward * 1e18 / info.duration;\n        }\n    }\n\n    function startFarming(Info storage info, uint256 amount, uint256 period, function() internal updateCheckpoint) internal returns(uint256) {\n        // If something left from prev farming add it to the new farming\n        Info memory prev = info;\n        if (block.timestamp < prev.finished) {\n            amount += prev.reward - farmedSinceCheckpointScaled(prev, prev.finished - prev.duration) / 1e18;\n        }\n\n        updateCheckpoint();\n        require(period <= type(uint32).max, \"FA: duration too large\");\n        require(amount <= _MAX_REWARD_AMOUNT, \"FA: amount too large\");\n        (info.finished, info.duration, info.reward) = (uint40(block.timestamp + period), uint32(period), uint184(amount));\n        return amount;\n    }\n}"
    },
    {
      "filename": "contracts/accounting/UserAccounting.sol",
      "content": "// SPDX-License-Identifier: MIT\n\npragma solidity ^0.8.0;\n\nlibrary UserAccounting {\n    struct Info {\n        uint40 checkpoint;\n        uint216 farmedPerTokenStored;\n        mapping(address => int256) corrections;\n    }\n\n    function farmedPerToken(\n        Info storage info,\n        address context,\n        function(address) internal view returns(uint256) lazyGetSupply,\n        function(address, uint256) internal view returns(uint256) lazyGetFarmed\n    ) internal view returns(uint256) {\n        (uint256 checkpoint, uint256 fpt) = (info.checkpoint, info.farmedPerTokenStored);\n        if (block.timestamp != checkpoint) {\n            uint256 supply = lazyGetSupply(context);\n            if (supply > 0) {\n                fpt += lazyGetFarmed(context, checkpoint) / supply;\n            }\n        }\n        return fpt;\n    }\n\n    function farmed(Info storage info, address account, uint256 balance, uint256 fpt) internal view returns(uint256) {\n        return uint256(int256(balance * fpt) - info.corrections[account]) / 1e18;\n    }\n\n    function eraseFarmed(Info storage info, address account, uint256 balance, uint256 fpt) internal {\n        info.corrections[account] = int256(balance * fpt);\n    }\n\n    function updateCheckpoint(Info storage info, uint256 fpt) internal {\n        (info.checkpoint, info.farmedPerTokenStored) = (uint40(block.timestamp), uint216(fpt));\n    }\n\n    function updateBalances(Info storage info, uint256 fpt, address from, address to, uint256 amount, bool inFrom, bool inTo) internal {\n        if (amount > 0 && (inFrom || inTo)) {\n            if (inFrom != inTo) {\n                updateCheckpoint(info, fpt);\n            }\n            if (inFrom) {\n                info.corrections[from] -= int256(amount * fpt);\n            }\n            if (inTo) {\n                info.corrections[to] += int256(amount * fpt);\n            }\n        }\n    }\n}"
    }
  ]
}