{
  "Title": "[G-02] Remove ``checkDoesNotExist`` function",
  "Content": "\nUsing separate internal functions for non-repeating if blocks in more than one function wastes gas.\n\nThe `checkDoesNotExist` _internal_ function in the `OptionPair.sol` contract is only used in the ``create`` function of the `TimeswapV2OptionFactory.sol` contract.\n\n```solidity \npackages\\v2-option\\src\\TimeswapV2OptionFactory.sol:\n  43:     function create(address token0, address token1) external override returns (address optionPair) {\n  44:         if (token0 == address(0)) Error.zeroAddress();\n  45:         if (token1 == address(0)) Error.zeroAddress();\n  46:         OptionPairLibrary.checkCorrectFormat(token0, token1);\n  47: \n  48:         optionPair = optionPairs[token0][token1];\n  49:         OptionPairLibrary.checkDoesNotExist(token0, token1, optionPair);\n  50: \n  51:         optionPair = deploy(address(this), token0, token1);\n  52: \n  53:         optionPairs[token0][token1] = optionPair;\n  54: \n  55:         emit Create(msg.sender, token0, token1, optionPair);\n  56:     }\n  57  }\n```\nhttps://github.com/code-423n4/2023-01-timeswap/blob/main/packages/v2-option/src/TimeswapV2OptionFactory.sol#L43-L57\n\n**Recommendation:**\n\nI suggest that the check on line 50 be done by adding the **if** block as follows.\n\n**_packages\\v2-option\\src\\TimeswapV2OptionFactory.sol_**\n```diff\n  43:     function create(address token0, address token1) external override returns (address optionPair) {\n  44:         if (token0 == address(0)) Error.zeroAddress();\n  45:         if (token1 == address(0)) Error.zeroAddress();\n  46:         OptionPairLibrary.checkCorrectFormat(token0, token1);\n  47: \n  48:         optionPair = optionPairs[token0][token1];\n- 49:         OptionPairLibrary.checkDoesNotExist(token0, token1, optionPair);\n+                   if (optionPair != address(0)) revert OptionPairAlreadyExisted(token0, token1, optionPair);\n  50: \n  51:         optionPair = deploy(address(this), token0, token1);\n  52: \n  53:         optionPairs[token0][token1] = optionPair;\n  54: \n  55:         emit Create(msg.sender, token0, token1, optionPair);\n  56:     }\n  57  }\n```\nhttps://github.com/code-423n4/2023-01-timeswap/blob/main/packages/v2-option/src/TimeswapV2OptionFactory.sol#L43-L57\n\n\n",
  "Impact": "GAS",
  "Source": "https://code4rena.com/reports/2023-01-timeswap",
  "Code": [
    {
      "filename": "packages/v2-option/src/TimeswapV2OptionFactory.sol",
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity =0.8.8;\n\nimport {IERC20} from \"@openzeppelin/contracts/token/ERC20/IERC20.sol\";\nimport {SafeERC20} from \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\n\nimport {Error} from \"@timeswap-labs/v2-library/src/Error.sol\";\n\nimport {ITimeswapV2OptionFactory} from \"./interfaces/ITimeswapV2OptionFactory.sol\";\n\nimport {TimeswapV2OptionDeployer} from \"./TimeswapV2OptionDeployer.sol\";\n\nimport {OptionPairLibrary} from \"./libraries/OptionPair.sol\";\n\n/// @title Deploys Timeswap V2 Option pair contracts\n/// @author Timeswap Labs\ncontract TimeswapV2OptionFactory is ITimeswapV2OptionFactory, TimeswapV2OptionDeployer {\n    using SafeERC20 for IERC20;\n\n    /* ===== MODEL ===== */\n\n    mapping(address => mapping(address => address)) private optionPairs;\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    address[] public override getByIndex;\n\n    /* ===== VIEW ===== */\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function get(address token0, address token1) external view override returns (address optionPair) {\n        OptionPairLibrary.checkCorrectFormat(token0, token1);\n        optionPair = optionPairs[token0][token1];\n    }\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function numberOfPairs() external view override returns (uint256) {\n        return getByIndex.length;\n    }\n\n    /* ===== UPDATE ===== */\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function create(address token0, address token1) external override returns (address optionPair) {\n        if (token0 == address(0)) Error.zeroAddress();\n        if (token1 == address(0)) Error.zeroAddress();\n        OptionPairLibrary.checkCorrectFormat(token0, token1);\n\n        optionPair = optionPairs[token0][token1];\n        OptionPairLibrary.checkDoesNotExist(token0, token1, optionPair);\n\n        optionPair = deploy(address(this), token0, token1);\n\n        optionPairs[token0][token1] = optionPair;\n\n        emit Create(msg.sender, token0, token1, optionPair);\n    }\n}"
    },
    {
      "filename": "packages/v2-option/src/TimeswapV2OptionFactory.sol",
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity =0.8.8;\n\nimport {IERC20} from \"@openzeppelin/contracts/token/ERC20/IERC20.sol\";\nimport {SafeERC20} from \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\n\nimport {Error} from \"@timeswap-labs/v2-library/src/Error.sol\";\n\nimport {ITimeswapV2OptionFactory} from \"./interfaces/ITimeswapV2OptionFactory.sol\";\n\nimport {TimeswapV2OptionDeployer} from \"./TimeswapV2OptionDeployer.sol\";\n\nimport {OptionPairLibrary} from \"./libraries/OptionPair.sol\";\n\n/// @title Deploys Timeswap V2 Option pair contracts\n/// @author Timeswap Labs\ncontract TimeswapV2OptionFactory is ITimeswapV2OptionFactory, TimeswapV2OptionDeployer {\n    using SafeERC20 for IERC20;\n\n    /* ===== MODEL ===== */\n\n    mapping(address => mapping(address => address)) private optionPairs;\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    address[] public override getByIndex;\n\n    /* ===== VIEW ===== */\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function get(address token0, address token1) external view override returns (address optionPair) {\n        OptionPairLibrary.checkCorrectFormat(token0, token1);\n        optionPair = optionPairs[token0][token1];\n    }\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function numberOfPairs() external view override returns (uint256) {\n        return getByIndex.length;\n    }\n\n    /* ===== UPDATE ===== */\n\n    /// @inheritdoc ITimeswapV2OptionFactory\n    function create(address token0, address token1) external override returns (address optionPair) {\n        if (token0 == address(0)) Error.zeroAddress();\n        if (token1 == address(0)) Error.zeroAddress();\n        OptionPairLibrary.checkCorrectFormat(token0, token1);\n\n        optionPair = optionPairs[token0][token1];\n        OptionPairLibrary.checkDoesNotExist(token0, token1, optionPair);\n\n        optionPair = deploy(address(this), token0, token1);\n\n        optionPairs[token0][token1] = optionPair;\n\n        emit Create(msg.sender, token0, token1, optionPair);\n    }\n}"
    }
  ]
}