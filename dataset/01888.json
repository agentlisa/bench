{
  "Title": "H-10: Wrong Oracle feed addresses",
  "Content": "# Issue H-10: Wrong Oracle feed addresses \n\nSource: https://github.com/sherlock-audit/2023-05-USSD-judging/issues/817 \n\n## Found by \n0xGusMcCrae, 0xHati, 0xPkhatri, 0xRobocop, 0xStalin, 0xeix, 0xlmanini, 0xyPhilic, 14si2o\\_Flint, ADM, Aymen0909, Bahurum, Bauchibred, Bauer, BenRai, Brenzee, BugHunter101, Delvir0, DevABDee, Dug, G-Security, GimelSec, HonorLt, J4de, JohnnyTime, Juntao, Kirkeelee, Kodyvim, Kose, Lilyjjo, Madalad, PNS, PTolev, PokemonAuditSimulator, Proxy, Saeedalipoor01988, SaharDevep, Schpiel, SensoYard, T1MOH, TheNaubit, Vagner, Viktor\\_Cortess, WATCHPUG, \\_\\_141345\\_\\_, ashirleyshe, ast3ros, berlin-101, blockdev, chainNue, chalex.eth, ck, ctf\\_sec, curiousapple, dacian, evilakela, giovannidisiena, immeas, innertia, juancito, kie, kiki\\_dev, kutugu, lil.eth, martin, mrpathfindr, neumo, ni8mare, nobody2018, peanuts, pengun, qpzm, ravikiran.web3, saidam017, sakshamguruji, sam\\_gmk, sashik\\_eth, shaka, shogoki, simon135, theOwl, the\\_endless\\_sea, toshii, twicek, ustas, whiteh4t9527\n## Summary\n\nWrong Oracle feed addresses will result in wrong prices.\n\n## Vulnerability Detail\n\nStableOracleWBTC.sol#L17 the address is not the BTC/USD feed address.\n\nStableOracleDAI.sol#L28, `DAIEthOracle` is wrong.\n\nStableOracleDAI.sol#L30, address for `ethOracle` is address zero (a hanging todo).\n\nStableOracleWBGL.sol#L19, the address for staticOracleUniV3 is wrong, the current one is actually the univ3 pool address.\n\n## Impact\n\nWrong prices for collateral assets.\n\n## Code Snippet\n\nhttps://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleWBTC.sol#L8-L28\n\nhttps://github.com/sherlock-audit/2023-05-USSD/blob/main/ussd-contracts/contracts/oracles/StableOracleDAI.sol#L23-L31\n\nhttps://github.com/USSDofficial/ussd-contracts/blob/f44c726371f3152634bcf0a3e630802e39dec49c/contracts/oracles/StableOracleWBGL.sol#L17-L22\n\n## Tool used\n\nManual Review\n\n## Recommendation\n\nUse correct addresses.\n\n",
  "Impact": "HIGH",
  "Source": "https://app.sherlock.xyz/audits/contests/82",
  "Code": [
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleWBTC.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\n\n/*\n    wbtc 0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599;\n    chainlink btc/usd priceFeed 0xf4030086522a5beea4988f8ca5b36dbc97bee88c;\n*/\ncontract StableOracleWBTC is IStableOracle {\n    AggregatorV3Interface priceFeed;\n\n    constructor() {\n        priceFeed = AggregatorV3Interface(\n            0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419\n        );\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeed.latestRoundData();\n        (, int256 price, , , ) = priceFeed.latestRoundData();\n        // chainlink price data is 8 decimals for WETH/USD\n        return uint256(price) * 1e10;\n    }\n}"
    },
    {
      "filename": "ussd-contracts/contracts/oracles/StableOracleDAI.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol\";\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/*\n    Oracle for DAI using WETH/DAI UniV3 pools (this could also use several DEX pools)\n    \n    curve DAI 3pool 0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7 (400m TVL) -- to other stables\n    curve tricrypto2 0xd51a44d3fae010294c616388b506acda1bfaae46 (200m TVL) -- to ETH, to BTC\n    uniswap DAI/ETH 0x60594a405d53811d3bc4766596efd80fd545a270 (200m TVL) -- to ETH\n    0x773616e4d11a78f511299002da57a0a94577f1f4 Chainlink DAI/ETH feed\n*/\ncontract StableOracleDAI is IStableOracle {\n    AggregatorV3Interface priceFeedDAIETH;\n    IStaticOracle DAIEthOracle;\n    IStableOracle ethOracle;\n\n    constructor() {\n        priceFeedDAIETH = AggregatorV3Interface(\n            0x773616E4d11A78F511299002da57A0a94577F1f4\n        );\n        DAIEthOracle = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(0x0000000000000000000000000000000000000000); // TODO: WETH oracle price\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x60594a405d53811d3BC4766596EFD80fd545A270;\n        uint256 DAIWethPrice = DAIEthOracle.quoteSpecificPoolsWithTimePeriod(\n            1000000000000000000, // 1 Eth\n            0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n            0x6B175474E89094C44Da98b954EedeAC495271d0F, // DAI (quote token)\n            pools, // DAI/WETH pool uni v3\n            600 // period\n        );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        // chainlink price data is 8 decimals for WETH/USD, so multiply by 10 decimals to get 18 decimal fractional\n        //(uint80 roundID, int256 price, uint256 startedAt, uint256 timeStamp, uint80 answeredInRound) = priceFeedDAIETH.latestRoundData();\n        (, int256 price, , , ) = priceFeedDAIETH.latestRoundData();\n\n        return\n            (wethPriceUSD * 1e18) /\n            ((DAIWethPrice + uint256(price) * 1e10) / 2);\n    }\n}"
    },
    {
      "filename": "contracts/oracles/StableOracleWBGL.sol",
      "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.6;\n\nimport \"./UniswapV3StaticOracle.sol\";\n\nimport \"../interfaces/IStableOracle.sol\";\nimport \"../interfaces/IStaticOracle.sol\";\n\n/* \n    wbgl 0x2bA64EFB7A4Ec8983E22A49c81fa216AC33f383A;\n    wbgl/weth uni v3 0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n*/\ncontract StableOracleWBGL is IStableOracle {\n    IStaticOracle staticOracleUniV3;\n    IStableOracle ethOracle;\n\n    constructor(address _WETHoracle) {\n        staticOracleUniV3 = IStaticOracle(\n            0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e\n        );\n        ethOracle = IStableOracle(_WETHoracle);\n    }\n\n    function getPriceUSD() external view override returns (uint256) {\n        address[] memory pools = new address[](1);\n        pools[0] = 0x982152A6C7f732Ec7C9EA998dDD9Ebde00Dfa16e;\n        uint256 wbglWethPrice = staticOracleUniV3\n            .quoteSpecificPoolsWithTimePeriod(\n                1000000000000000000, // 1 Eth\n                0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2, // WETH (base token)\n                0x2bA64EFB7A4Ec8983E22A49c81fa216AC33f383A, // WBGL (quote token)\n                pools, // WBGL/WETH pool uni v3\n                600 // period\n            );\n\n        uint256 wethPriceUSD = ethOracle.getPriceUSD();\n\n        return (wethPriceUSD * 1e18) / wbglWethPrice;\n    }\n}"
    }
  ]
}