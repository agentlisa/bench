{
  "Title": "ETH2 depositor argument design consideration",
  "Content": "##### Description\nThis comment is about absence of possibility to check the correctness of the SHA2-256 hash being passed as a parameter `deposit_data_roots` to the `deposit` function in here: https://github.com/abyssfinance/abyss-eth2depositor/blob/a2d58dea4d79846dc682fe93ac3e0eca02323d11/contracts/AbyssEth2Depositor.sol#L61.\n\n##### Recommendation\nSince the internal structure of data being hashed makes sense, it is better to use some ZK-proof (with Zookrates possibly?), which will bring the possibility to verify the correctness of the input data without having the actual data present.\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/AbyssEth2Depositor.sol",
      "content": "/*\n░█████╗░██████╗░██╗░░░██╗░██████╗░██████╗  ███████╗██╗███╗░░██╗░█████╗░███╗░░██╗░█████╗░███████╗\n██╔══██╗██╔══██╗╚██╗░██╔╝██╔════╝██╔════╝  ██╔════╝██║████╗░██║██╔══██╗████╗░██║██╔══██╗██╔════╝\n███████║██████╦╝░╚████╔╝░╚█████╗░╚█████╗░  █████╗░░██║██╔██╗██║███████║██╔██╗██║██║░░╚═╝█████╗░░\n██╔══██║██╔══██╗░░╚██╔╝░░░╚═══██╗░╚═══██╗  ██╔══╝░░██║██║╚████║██╔══██║██║╚████║██║░░██╗██╔══╝░░\n██║░░██║██████╦╝░░░██║░░░██████╔╝██████╔╝  ██║░░░░░██║██║░╚███║██║░░██║██║░╚███║╚█████╔╝███████╗\n╚═╝░░╚═╝╚═════╝░░░░╚═╝░░░╚═════╝░╚═════╝░  ╚═╝░░░░░╚═╝╚═╝░░╚══╝╚═╝░░╚═╝╚═╝░░╚══╝░╚════╝░╚══════╝\n*/\n\n// SPDX-License-Identifier: MIT\n\npragma solidity 0.6.11;\npragma experimental ABIEncoderV2;\n\nimport \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\nimport \"@openzeppelin/contracts/utils/Pausable.sol\";\nimport \"../contracts/interfaces/IDepositContract.sol\";\n\ncontract AbyssEth2Depositor is Pausable, Ownable {\n    using SafeMath for uint256;\n\n    /**\n     * @dev Eth2 Deposit Contract address.\n     */\n    IDepositContract public depositContract;\n\n    /**\n     * @dev Minimal and maximum amount of nodes per transaction.\n     */\n    uint256 public constant nodesMinAmount = 1;\n    uint256 public constant nodesMaxAmount = 100;\n\n    /**\n     * @dev Collateral size of one node.\n     */\n    uint256 public constant collateral = 32 ether;\n\n    /**\n     * @dev Setting Eth2 Smart Contract address during construction.\n     */\n    constructor(address depositContractAddress) public {\n        depositContract = IDepositContract(address(depositContractAddress));\n    }\n\n    /**\n     * @dev This contract will not accept direct ETH transactions.\n     */\n    receive() external payable {\n        revert(\"AbyssEth2Depositor: do not send ETH directly here\");\n    }\n\n    /**\n     * @dev Function that allows to deposit up to 100 nodes at once.\n     *\n     * - pubkeys                - Array of BLS12-381 public keys.\n     * - withdrawal_credentials - Array of commitments to a public keys for withdrawals.\n     * - signatures             - Array of BLS12-381 signatures.\n     * - deposit_data_roots     - Array of the SHA-256 hashes of the SSZ-encoded DepositData objects.\n     */\n    function deposit(\n        bytes[] calldata pubkeys,\n        bytes[] calldata withdrawal_credentials,\n        bytes[] calldata signatures,\n        bytes32[] calldata deposit_data_roots\n    ) external payable whenNotPaused {\n\n        uint256 nodesAmount = pubkeys.length;\n\n        require(nodesAmount > 0 && nodesAmount <= 100, \"AbyssEth2Depositor: you can deposit only 1 to 100 nodes per transaction\");\n        require(msg.value == SafeMath.mul(collateral, nodesAmount), \"AbyssEth2Depositor: the amount of ETH does not match the amount of nodes\");\n        require(\n            withdrawal_credentials.length == nodesAmount &&\n            signatures.length == nodesAmount &&\n            deposit_data_roots.length == nodesAmount,\n            \"AbyssEth2Depositor: amount of parameters do no match\");\n\n        for (uint256 i = 0; i < nodesAmount; ++i) {\n\n            IDepositContract(address(depositContract)).deposit{value: collateral}(\n                pubkeys[i],\n                withdrawal_credentials[i],\n                signatures[i],\n                deposit_data_roots[i]\n            );\n\n        }\n\n        emit DepositEvent(msg.sender, nodesAmount);\n    }\n\n    /**\n     * @dev Triggers stopped state.\n     *\n     * Requirements:\n     *\n     * - The contract must not be paused.\n     */\n    function pause() public onlyOwner {\n      _pause();\n    }\n\n    /**\n     * @dev Returns to normal state.\n     *\n     * Requirements:\n     *\n     * - The contract must be paused.\n     */\n    function unpause() public onlyOwner {\n      _unpause();\n    }\n\n    event DepositEvent(address from, uint256 nodesAmount);\n}"
    }
  ]
}