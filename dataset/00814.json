{
  "Title": "Lack of event emission after sensitive action",
  "Content": "The [`setSuccinctTargetAmb`](https://github.com/across-protocol/contracts-v2/blob/c01d48cdb2e72812b6b9780fe215d44faced50ba/contracts/Succinct_SpokePool.sol#L53) administrative function does not emit a relevant event after changing the `succinctTargetAmb` address.\n\n\nConsider always emitting events after sensitive changes take place to facilitate tracking and notify off-chain clients that follow the protocol's contracts' activity.\n\n\n***Update:** Resolved in [pull request #252](https://github.com/across-protocol/contracts-v2/pull/252) at commit [10c1190](https://github.com/across-protocol/contracts-v2/commit/10c11905c4f4f6918bad071d474ff70b5da16e48). Additionally, new `ReceivedMessageFromL1` events were added to the `Polygon_SpokePool` and `Succinct_SpokePool`'s message handler functions (`processMessageFromRoot` and `handleTelepathy`, respectively).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/Succinct_SpokePool.sol",
      "content": "// SPDX-License-Identifier: GPL-3.0-only\npragma solidity ^0.8.0;\n\nimport \"./SpokePool.sol\";\nimport \"./interfaces/WETH9Interface.sol\";\nimport \"./external/SuccinctInterfaces.sol\";\n\ncontract Succinct_SpokePool is SpokePool, ITelepathyHandler {\n    // Address of the succinct contract.\n    address public succinctTargetAmb;\n\n    // Warning: this variable should _never_ be touched outside of this contract. It is intentionally set to be\n    // private. Leaving it set to true can permanently disable admin calls.\n    bool private adminCallValidated;\n\n    uint16 public hubChainId;\n\n    // Note: validating calls this way ensures that strange calls coming from the succinctTargetAmb won't be misinterpreted.\n    // Put differently, just checking that msg.sender == succinctTargetAmb is not sufficient.\n    // All calls that have admin privileges must be fired from within the handleTelepathy method that's gone\n    // through validation where the sender is checked and the sender from the other chain is also validated.\n    // This modifier sets the callValidated variable so this condition can be checked in _requireAdminSender().\n    modifier validateInternalCalls() {\n        // Make sure callValidated is set to True only once at beginning of processMessageFromRoot, which prevents\n        // processMessageFromRoot from being re-entered.\n        require(!adminCallValidated, \"adminCallValidated already set\");\n\n        // This sets a variable indicating that we're now inside a validated call.\n        // Note: this is used by other methods to ensure that this call has been validated by this method and is not\n        // spoofed.\n        adminCallValidated = true;\n\n        _;\n\n        // Reset callValidated to false to disallow admin calls after this method exits.\n        adminCallValidated = false;\n    }\n\n    function initialize(\n        uint16 _hubChainId,\n        address _succinctTargetAmb,\n        uint32 _initialDepositId,\n        address _crossDomainAdmin,\n        address _hubPool,\n        address _wrappedNativeToken\n    ) public initializer {\n        __SpokePool_init(_initialDepositId, _crossDomainAdmin, _hubPool, _wrappedNativeToken);\n        succinctTargetAmb = _succinctTargetAmb;\n        hubChainId = _hubChainId;\n    }\n\n    // Admin can reset the succinct contract address.\n    function setSuccinctTargetAmb(address _succinctTargetAmb) external onlyAdmin {\n        succinctTargetAmb = _succinctTargetAmb;\n    }\n\n    function handleTelepathy(\n        uint16 _sourceChainId,\n        address _senderAddress,\n        bytes memory _data\n    ) external override validateInternalCalls returns (bytes4) {\n        // Validate msg.sender as succinct, the x-chain sender as being the hubPool (the admin) and the source chain as\n        // 1 (mainnet).\n        require(\n            msg.sender == succinctTargetAmb && _senderAddress == hubPool && _sourceChainId == hubChainId,\n            \"Invalid message\"\n        );\n\n        /// @custom:oz-upgrades-unsafe-allow delegatecall\n        (bool success, ) = address(this).delegatecall(_data);\n        require(success, \"delegatecall failed\");\n        return ITelepathyHandler.handleTelepathy.selector;\n    }\n\n    function _bridgeTokensToHubPool(RelayerRefundLeaf memory) internal override {\n        // This method is a no-op. If the chain intends to include bridging functionality, this must be overriden.\n        // If not, leaving this unimplemented means this method may be triggered, but the result will be that no\n        // balance is transferred.\n    }\n\n    // Check that the handleTelepathy method has validated the method to ensure the sender is authenticated.\n    function _requireAdminSender() internal view override {\n        require(adminCallValidated, \"Admin call not validated\");\n    }\n}"
    }
  ]
}