{
  "Title": "Parameters not checked",
  "Content": "##### Description\nInput parameters values are not checked:\nhttps://github.com/Gearbox-protocol/gearbox-contracts/blob/0ac33ba87212ce056ac6b6357ad74161d417158a/contracts/pool/LinearInterestRateModel.sol#L46\n##### Recommendation\nWe recommend adding allowable range for each parameter.",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "contracts/pool/LinearInterestRateModel.sol",
      "content": "// SPDX-License-Identifier: BSL-1.1\n// Gearbox. Generalized leverage protocol that allows to take leverage and then use it across other DeFi protocols and platforms in a composable way.\n// (c) Gearbox.fi, 2021\npragma solidity ^0.7.4;\n\nimport {SafeMath} from \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport {PercentageMath} from \"../libraries/math/PercentageMath.sol\";\nimport {WadRayMath} from \"../libraries/math/WadRayMath.sol\";\nimport {IInterestRateModel} from \"../interfaces/IInterestRateModel.sol\";\nimport {Constants} from \"../libraries/helpers/Constants.sol\";\nimport \"hardhat/console.sol\";\n\n/// @title Linear Interest Rate Model\n/// @notice Linear interest rate model, similar which Aave uses\ncontract LinearInterestRateModel is IInterestRateModel {\n    using PercentageMath for uint256;\n    using SafeMath for uint256;\n    using WadRayMath for uint256;\n\n    // Uoptimal[0;1] in Wad\n    uint256 public immutable _U_Optimal_WAD;\n\n    // 1 - Uoptimal [0;1] x10.000, percentage plus two decimals\n    uint256 public immutable _U_Optimal_inverted_WAD;\n\n    // R_base in Ray\n    uint256 public immutable _R_base_RAY;\n\n    // R_Slope1 in Ray\n    uint256 public immutable _R_slope1_RAY;\n\n    // R_Slope2 in Ray\n    uint256 public immutable _R_slope2_RAY;\n\n    /// @dev Constructor\n    /// @param U_optimal Optimal U in percentage format: x10.000 - percentage plus two decimals\n    /// @param R_base R_base in percentage format: x10.000 - percentage plus two decimals @param R_slope1 R_Slope1 in Ray\n    /// @param R_slope1 R_Slope1 in percentage format: x10.000 - percentage plus two decimals\n    /// @param R_slope2 R_Slope2 in percentage format: x10.000 - percentage plus two decimals\n    constructor(\n        uint256 U_optimal,\n        uint256 R_base,\n        uint256 R_slope1,\n        uint256 R_slope2\n    ) {\n        // Convert percetns to WAD\n        uint256 U_optimal_WAD = WadRayMath.WAD.percentMul(U_optimal);\n        _U_Optimal_WAD = U_optimal_WAD;\n\n        // 1 - Uoptimal in WAD\n        _U_Optimal_inverted_WAD = WadRayMath.WAD.sub(U_optimal_WAD);\n\n        _R_base_RAY = WadRayMath.RAY.percentMul(R_base);\n        _R_slope1_RAY = WadRayMath.RAY.percentMul(R_slope1);\n        _R_slope2_RAY = WadRayMath.RAY.percentMul(R_slope2);\n    }\n\n    /// @dev Calculated borrow rate based on expectedLiquidity and availableLiquidity\n    /// @param expectedLiquidity Expected liquidity in the pool\n    /// @param availableLiquidity Available liquidity in the pool\n    function calcBorrowRate(\n        uint256 expectedLiquidity,\n        uint256 availableLiquidity\n    ) external view override returns (uint256) {\n        // Protection from direct sending tokens on PoolService account\n        //    T:[LR-5]                     // T:[LR-6]\n        if (expectedLiquidity == 0 || expectedLiquidity < availableLiquidity) {\n            return _R_base_RAY;\n        }\n\n        //      expectedLiquidity - availableLiquidity\n        // U = -------------------------------------\n        //             expectedLiquidity\n\n        uint256 U_WAD = (expectedLiquidity.sub(availableLiquidity))\n        .mul(WadRayMath.WAD)\n        .div(expectedLiquidity);\n\n        // if U < Uoptimal:\n        //\n        //                                    U\n        // borrowRate = Rbase + Rslope1 * ----------\n        //                                 Uoptimal\n        //\n\n        if (U_WAD < _U_Optimal_WAD) {\n            return\n                _R_base_RAY.add(_R_slope1_RAY.mul(U_WAD).div(_U_Optimal_WAD));\n        }\n\n        // if U >= Uoptimal:\n        //\n        //                                           U - Uoptimal\n        // borrowRate = Rbase + Rslope1 + Rslope2 * --------------\n        //                                           1 - Uoptimal\n\n        return\n            _R_base_RAY.add(_R_slope1_RAY).add(\n                _R_slope2_RAY.mul(U_WAD.sub(_U_Optimal_WAD)).div(\n                    _U_Optimal_inverted_WAD\n                )\n            ); // T:[LR-1,2,3]\n    }\n\n    /// @dev Gets model parameters\n    /// @param U_optimal U_optimal in percentage format: [0;10,000] - percentage plus two decimals\n    /// @param R_base R_base in RAY format\n    /// @param R_slope1 R_slope1 in RAY format\n    /// @param R_slope2 R_slope2 in RAY format\n    function getModelParameters()\n        external\n        view\n        returns (\n            uint256 U_optimal,\n            uint256 R_base,\n            uint256 R_slope1,\n            uint256 R_slope2\n        )\n    {\n        U_optimal = _U_Optimal_WAD.percentDiv(WadRayMath.WAD); // T:[LR-4]\n        R_base = _R_base_RAY; // T:[LR-4]\n        R_slope1 = _R_slope1_RAY; // T:[LR-4]\n        R_slope2 = _R_slope2_RAY; // T:[LR-4]\n    }\n}"
    }
  ]
}