{
  "Title": "Withdraw role is not configured",
  "Content": "The [`DesignatedVotingV2Factory`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/oracle/implementation/DesignatedVotingV2Factory.sol#L11) contract inherits from the [`Withdrawable`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/common/implementation/Withdrawable.sol) contract, a base contract which provides the ability to create a Withdraw role and assign it to one or more addresses to grant them the ability to withdraw ETH or ERC20 tokens from the contract by using the corresponding [`withdraw`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/common/implementation/Withdrawable.sol#L25) and [`withdrawErc20`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/common/implementation/Withdrawable.sol#L34) functions.\n\n\nThe `Withdrawable` contract provides two functions for configuring this role, [`_createWithdrawRole`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/common/implementation/Withdrawable.sol#L47) and [`setWithdrawRole`](https://github.com/UMAprotocol/protocol/blob/7938617bf79854811959eb605237edf6bdccbc90/packages/core/contracts/common/implementation/Withdrawable.sol#L62), and the documentation for these functions indicates that one or the other must be called by the derived contract (`DesignatedVotingV2Factory` in this case) in order for withdraws to function properly. However, the `DesignatedVotingV2Factory` contract does not call either function, rendering the `withdraw` and `withdrawErc20` functions inoperable.\n\n\nGiven the intended purpose of the `DesignatedVotingV2Factory` contract, it does not appear that it requires the `Withdrawable` feature. Consider removing the inheritance from `Withdrawable` and the corresponding import of `Withdrawable.sol`.\n\n\n**Update:** *Fixed as of commit [`88c79f4403d6f61715fab044c8933e8d90ca4366`](https://github.com/UMAprotocol/protocol/pull/4078/commits/88c79f4403d6f61715fab044c8933e8d90ca4366) in [pull request #4078](https://github.com/UMAprotocol/protocol/pull/4078).*\n\n\n",
  "Impact": "LOW",
  "Source": "",
  "Code": [
    {
      "filename": "packages/core/contracts/oracle/implementation/DesignatedVotingV2Factory.sol",
      "content": "// SPDX-License-Identifier: AGPL-3.0-only\npragma solidity ^0.8.0;\n\nimport \"../../common/implementation/Withdrawable.sol\";\nimport \"./DesignatedVotingV2.sol\";\n\n/**\n * @title Factory to deploy new instances of DesignatedVotingV2 and look up previously deployed instances.\n * @dev Allows off-chain infrastructure to look up a hot wallet's deployed DesignatedVoting contract.\n */\ncontract DesignatedVotingV2Factory is Withdrawable {\n    address private finder;\n    mapping(address => DesignatedVotingV2) public designatedVotingContracts;\n\n    event NewDesignatedVoting(address indexed designatedVoter, address indexed designatedVoting);\n\n    /**\n     * @notice Construct the DesignatedVotingFactory contract.\n     * @param finderAddress keeps track of all contracts within the system based on their interfaceName.\n     */\n    constructor(address finderAddress) {\n        finder = finderAddress;\n    }\n\n    /**\n     * @notice Deploys a new `DesignatedVoting` contract.\n     * @param ownerAddress defines who will own the deployed instance of the designatedVoting contract.\n     * @return designatedVoting a new DesignatedVoting contract.\n     */\n    function newDesignatedVoting(address ownerAddress) external returns (DesignatedVotingV2) {\n        DesignatedVotingV2 designatedVoting = new DesignatedVotingV2(finder, ownerAddress, msg.sender);\n        designatedVotingContracts[msg.sender] = designatedVoting;\n        emit NewDesignatedVoting(msg.sender, address(designatedVoting));\n\n        return designatedVoting;\n    }\n\n    /**\n     * @notice Associates a `DesignatedVoting` instance with `msg.sender`.\n     * @param designatedVotingAddress address to designate voting to.\n     * @dev This is generally only used if the owner of a `DesignatedVoting` contract changes their `voter`\n     * address and wants that reflected here.\n     */\n    function setDesignatedVoting(address designatedVotingAddress) external {\n        designatedVotingContracts[msg.sender] = DesignatedVotingV2(designatedVotingAddress);\n        emit NewDesignatedVoting(msg.sender, designatedVotingAddress);\n    }\n}"
    },
    {
      "filename": "packages/core/contracts/common/implementation/Withdrawable.sol",
      "content": "/**\n * Withdrawable contract.\n */\n\n// SPDX-License-Identifier: AGPL-3.0-only\npragma solidity ^0.8.0;\n\nimport \"@openzeppelin/contracts/utils/Address.sol\";\nimport \"@openzeppelin/contracts/token/ERC20/IERC20.sol\";\nimport \"@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\";\n\nimport \"./MultiRole.sol\";\n\n/**\n * @title Base contract that allows a specific role to withdraw any ETH and/or ERC20 tokens that the contract holds.\n */\nabstract contract Withdrawable is MultiRole {\n    using SafeERC20 for IERC20;\n\n    uint256 private roleId;\n\n    /**\n     * @notice Withdraws ETH from the contract.\n     */\n    function withdraw(uint256 amount) external onlyRoleHolder(roleId) {\n        Address.sendValue(payable(msg.sender), amount);\n    }\n\n    /**\n     * @notice Withdraws ERC20 tokens from the contract.\n     * @param erc20Address ERC20 token to withdraw.\n     * @param amount amount of tokens to withdraw.\n     */\n    function withdrawErc20(address erc20Address, uint256 amount) external onlyRoleHolder(roleId) {\n        IERC20 erc20 = IERC20(erc20Address);\n        erc20.safeTransfer(msg.sender, amount);\n    }\n\n    /**\n     * @notice Internal method that allows derived contracts to create a role for withdrawal.\n     * @dev Either this method or `_setWithdrawRole` must be called by the derived class for this contract to function\n     * properly.\n     * @param newRoleId ID corresponding to role whose members can withdraw.\n     * @param managingRoleId ID corresponding to managing role who can modify the withdrawable role's membership.\n     * @param withdrawerAddress new manager of withdrawable role.\n     */\n    function _createWithdrawRole(\n        uint256 newRoleId,\n        uint256 managingRoleId,\n        address withdrawerAddress\n    ) internal {\n        roleId = newRoleId;\n        _createExclusiveRole(newRoleId, managingRoleId, withdrawerAddress);\n    }\n\n    /**\n     * @notice Internal method that allows derived contracts to choose the role for withdrawal.\n     * @dev The role `setRoleId` must exist. Either this method or `_createWithdrawRole` must be\n     * called by the derived class for this contract to function properly.\n     * @param setRoleId ID corresponding to role whose members can withdraw.\n     */\n    function _setWithdrawRole(uint256 setRoleId) internal onlyValidRole(setRoleId) {\n        roleId = setRoleId;\n    }\n}"
    }
  ]
}